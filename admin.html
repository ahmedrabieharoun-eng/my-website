<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… TON Rewards</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
    <style>
        :root {
            --primary: #2980B9; --secondary: #2C3E50; --light: #ECF0F1; --dark: #34495E;
            --success: #27AE60; --danger: #C0392B; --surface: #FFFFFF;
            --warning: #F39C12; --info: #3498DB;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Tajawal', sans-serif; background-color: var(--light); direction: rtl; }
        #app-container { transition: filter 0.3s; }
        
        /* Login Page Styles */
        #login-page {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }
        .login-card {
            background-color: var(--surface);
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            width: 90%;
            max-width: 400px;
        }
        .login-card h2 {
            text-align: center;
            margin-bottom: 25px;
            color: var(--secondary);
        }
        .login-card .form-group {
            margin-bottom: 20px;
        }
        .login-card label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }
        .login-card input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Tajawal', sans-serif;
            transition: border 0.3s;
        }
        .login-card input:focus {
            border-color: var(--primary);
            outline: none;
        }
        .login-btn {
            width: 100%;
            padding: 12px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            font-family: 'Tajawal', sans-serif;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .login-btn:hover {
            background-color: #2471A3;
        }
        .error-message {
            color: var(--danger);
            text-align: center;
            margin-top: 15px;
            display: none;
        }
        
        /* Security Badge */
        .security-badge {
            background: linear-gradient(135deg, var(--success), var(--primary));
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 15px;
        }
        
        /* Session Timer */
        .session-timer {
            position: fixed;
            top: 10px;
            left: 10px;
            background: var(--warning);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            z-index: 3000;
        }
        
        /* Top Bar */
        #top-bar {
            background-color: var(--secondary); color: white; padding: 0 15px;
            display: flex; align-items: center; justify-content: space-between; height: 60px;
            position: sticky; top: 0; z-index: 1000;
        }
        #menu-toggle { background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer; }
        #page-title { font-size: 1.2rem; }
        #logout-btn { background: none; border: none; color: white; cursor: pointer; font-size: 1rem; }

        /* Sidebar */
        #sidebar {
            position: fixed; top: 0; right: 0; width: 260px; height: 100vh;
            background-color: var(--secondary); color: white; z-index: 2000;
            transform: translateX(100%); transition: transform 0.3s ease-in-out;
            display: flex; flex-direction: column;
        }
        #sidebar.open { transform: translateX(0); }
        #sidebar-header { padding: 20px; text-align: center; }
        #sidebar-header .close-btn { position: absolute; top: 15px; left: 20px; font-size: 1.8rem; cursor: pointer; }
        .nav-menu { list-style: none; padding: 0; margin: 0; }
        .nav-menu li { padding: 15px 20px; cursor: pointer; border-right: 4px solid transparent; transition: all 0.2s; }
        .nav-menu li:hover, .nav-menu li.active { background-color: var(--dark); border-right-color: var(--primary); }
        .nav-menu li i { margin-left: 12px; width: 20px; text-align: center; }
        #sidebar-logout-btn { margin-top: auto; }

        /* Overlay */
        #overlay {
            position: fixed; top: 0; right: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5); z-index: 1999; display: none;
        }
        #overlay.show { display: block; }
        
        /* Main Content */
        #main-content { padding: 20px; }
        .page { display: none; } .page.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Cards */
        .card { background-color: var(--surface); border-radius: 8px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); margin-bottom: 20px; }
        h1, h3, h4 { color: var(--secondary); margin-bottom: 15px; }
        
        /* Tables */
        table { width: 100%; border-collapse: collapse; }
        thead { display: none; }
        tr { display: block; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 5px; padding: 10px; }
        td { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #eee; }
        td:last-child { border-bottom: none; }
        td::before { content: attr(data-label); font-weight: bold; margin-left: 10px; }
        .action-buttons { text-align: left; width: 100%; }
        .action-btn { padding: 8px 12px; border: none; border-radius: 5px; color: white; cursor: pointer; margin: 2px; font-family: 'Tajawal', sans-serif; }
        
        /* Forms */
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 500; text-align: right; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; font-family: 'Tajawal', sans-serif; }
        .btn-success { background-color: var(--success); } .btn-danger { background-color: var(--danger); } .btn-primary { background-color: var(--primary); } .btn-warning { background-color: var(--warning); }
        .btn-info { background-color: var(--info); }
        .dynamic-item-list { list-style: none; padding-right: 0; }
        .dynamic-item-list li { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid var(--light); }
        .withdraw-method-group { display: flex; gap: 10px; margin-bottom: 10px; align-items: center; }
        
        /* New Styles */
        .user-status-banned { background-color: rgba(192, 57, 43, 0.1); border-right: 4px solid var(--danger); }
        .user-status-banned td:first-child::before { content: "ğŸš« " attr(data-label); }
        .settings-grid { display: grid; grid-template-columns: 1fr; gap: 15px; }
        @media (min-width: 768px) { .settings-grid { grid-template-columns: 1fr 1fr; } }
        .setting-card { background-color: var(--surface); border-radius: 8px; padding: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        
        /* Search Box */
        .search-box { margin-bottom: 20px; }
        .search-box input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 5px; }
        
        /* Stats Cards */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .stat-card { background-color: var(--surface); border-radius: 8px; padding: 15px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .stat-value { font-size: 2rem; font-weight: bold; margin: 10px 0; }
        .stat-label { color: var(--dark); font-size: 0.9rem; }
        
        /* User Details */
        .user-details-grid { display: grid; grid-template-columns: 1fr; gap: 15px; }
        @media (min-width: 768px) { .user-details-grid { grid-template-columns: 1fr 1fr; } }
        .user-info-card { background-color: var(--surface); border-radius: 8px; padding: 15px; }
        .user-info-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee; }
        .user-info-item:last-child { border-bottom: none; }
        
        /* Tabs */
        .tabs { display: flex; border-bottom: 1px solid #ddd; margin-bottom: 15px; }
        .tab { padding: 10px 15px; cursor: pointer; border-bottom: 2px solid transparent; }
        .tab.active { border-bottom-color: var(--primary); color: var(--primary); font-weight: bold; }

        /* Security Features */
        .security-features {
            background: linear-gradient(135deg, var(--info), var(--primary));
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .security-features h4 {
            color: white;
            margin-bottom: 10px;
        }
        .feature-list {
            list-style: none;
            padding: 0;
        }
        .feature-list li {
            padding: 5px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        @media (min-width: 768px) {
            #app-container { display: flex; }
            #top-bar { display: none; }
            #sidebar { position: static; transform: translateX(0); width: 250px; height: 100vh; }
            #sidebar-header .close-btn { display: none; }
            #main-content { flex-grow: 1; padding: 30px; }
            thead { display: table-header-group; }
            tr { display: table-row; margin-bottom: 0; border: none; padding: 0; }
            td { display: table-cell; padding: 12px; border-bottom: 1px solid #ddd; }
            td::before { display: none; }
            .action-buttons { text-align: right; }
            .stats-grid { grid-template-columns: repeat(4, 1fr); }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="login-page">
        <div class="login-card">
            <div class="security-badge">
                <i class="fas fa-shield-alt"></i>
                Ù†Ø¸Ø§Ù… Ø¢Ù…Ù† - TON Rewards
            </div>
            <h2><i class="fas fa-shield-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
            <div class="form-group">
                <label for="username"><i class="fas fa-user"></i> Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                <input type="text" id="username" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
            </div>
            <div class="form-group">
                <label for="password"><i class="fas fa-lock"></i> ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                <input type="password" id="password" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="remember-me">
                    ØªØ°ÙƒØ±Ù†ÙŠ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø²
                </label>
            </div>
            <button class="login-btn" id="login-button">
                <i class="fas fa-sign-in-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            </button>
            <div class="error-message" id="login-error">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©</div>
            
            <div class="security-features" style="margin-top: 20px; font-size: 0.8rem;">
                <h4><i class="fas fa-shield-alt"></i> Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†:</h4>
                <ul class="feature-list">
                    <li><i class="fas fa-check"></i> ØªØ´ÙÙŠØ± ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±</li>
                    <li><i class="fas fa-check"></i> Ø¬Ù„Ø³Ø§Øª Ø¢Ù…Ù†Ø©</li>
                    <li><i class="fas fa-check"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†Ø´Ø§Ø·</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Session Timer -->
    <div class="session-timer" id="session-timer" style="display: none;">
        <i class="fas fa-clock"></i> Ø§Ù„Ø¬Ù„Ø³Ø© ØªÙ†ØªÙ‡ÙŠ ÙÙŠ: <span id="timer">30:00</span>
    </div>

    <!-- Admin Panel (Initially Hidden) -->
    <div id="app-container" style="display: none;">
        <aside id="sidebar">
            <div>
                <div id="sidebar-header">
                    <h2><i class="fas fa-shield-alt"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
                    <span class="close-btn">&times;</span>
                </div>
                <div style="padding: 0 20px 10px;">
                    <div style="background: var(--primary); color: white; padding: 8px; border-radius: 5px; font-size: 0.8rem;">
                        <i class="fas fa-user-shield"></i> Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…
                    </div>
                </div>
                <ul class="nav-menu">
                    <li data-page="dashboard" class="active"><i class="fas fa-tachometer-alt"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</li>
                    <li data-page="users"><i class="fas fa-users"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</li>
                    <li data-page="user-search"><i class="fas fa-search"></i> Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…</li>
                    <li data-page="withdrawals"><i class="fas fa-wallet"></i> Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</li>
                    <li data-page="history"><i class="fas fa-history"></i> Ø³Ø¬Ù„ Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª</li>
                    <li data-page="tasks"><i class="fas fa-tasks"></i> Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„Ø±ÙˆØ§Ø¨Ø·</li>
                    <li data-page="codes"><i class="fas fa-ticket-alt"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ÙƒÙˆØ§Ø¯</li>
                    <li data-page="contest"><i class="fas fa-trophy"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</li>
                    <li data-page="settings"><i class="fas fa-cog"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</li>
                    <li data-page="security"><i class="fas fa-shield-alt"></i> Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©</li>
                    <li data-page="broadcast"><i class="fas fa-bullhorn"></i> Ø§Ù„Ø¨Ø« Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ</li>
                </ul>
            </div>
            <button id="sidebar-logout-btn" class="nav-menu"><i class="fas fa-sign-out-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        </aside>
        
        <div id="overlay"></div>

        <div id="content-wrapper" style="width: 100%;">
            <header id="top-bar">
                <button id="menu-toggle"><i class="fas fa-bars"></i></button>
                <h1 id="page-title">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span id="admin-name" style="font-size: 0.9rem;"></span>
                    <button id="logout-btn"><i class="fas fa-sign-out-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
                </div>
            </header>
            <main id="main-content"></main>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const firebaseConfig = {
            apiKey: "AIzaSyC5dwRaz3L-aK7I5CoPkbB31MzXB62lgrU",
            authDomain: "earnmoney124553.firebaseapp.com",
            databaseURL: "https://earnmoney124553-default-rtdb.firebaseio.com",
            projectId: "earnmoney124553",
            storageBucket: "earnmoney124553.firebasestorage.app",
            messagingSenderId: "325528918523",
            appId: "1:325528918523:web:73d84f48a24c1e0cbfd35e",
            measurementId: "G-G1H96Q5XCJ"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        
        // Security Configuration
        const SECURITY_CONFIG = {
            sessionTimeout: 30 * 60 * 1000, // 30 minutes
            maxLoginAttempts: 5,
            lockoutTime: 15 * 60 * 1000, // 15 minutes
            passwordMinLength: 8
        };

        // DOM Elements
        const loginPage = document.getElementById('login-page');
        const appContainer = document.getElementById('app-container');
        const mainContent = document.getElementById('main-content');
        const pageTitle = document.getElementById('page-title');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        const loginButton = document.getElementById('login-button');
        const loginError = document.getElementById('login-error');
        const logoutButtons = document.querySelectorAll('#logout-btn, #sidebar-logout-btn');
        const sessionTimer = document.getElementById('session-timer');
        const timerDisplay = document.getElementById('timer');
        const adminNameDisplay = document.getElementById('admin-name');

        // Security State
        let sessionTimerInterval;
        let lastActivityTime;
        let loginAttempts = 0;
        let lockedUntil = 0;

        // Password Hashing Function
        const hashPassword = (password) => {
            return CryptoJS.SHA256(password + 'TON_REWARDS_SALT_2024').toString();
        };

        // Initialize Default Admin
        const initializeDefaultAdmin = async () => {
            const adminSnap = await db.ref('admin').once('value');
            if (!adminSnap.exists()) {
                const defaultPassword = hashPassword('Admin@12345');
                await db.ref('admin').set({
                    username: 'admin',
                    password: defaultPassword,
                    displayName: 'Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…',
                    createdAt: firebase.database.ServerValue.TIMESTAMP,
                    lastLogin: null,
                    isActive: true
                });
                console.log("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ: admin / Admin@12345");
            }
        };

        // Check if system is locked
        const isSystemLocked = () => {
            return Date.now() < lockedUntil;
        };

        // Update Activity Time
        const updateActivityTime = () => {
            lastActivityTime = Date.now();
            if (sessionTimer.style.display !== 'none') {
                sessionTimer.style.display = 'block';
            }
        };

        // Start Session Timer
        const startSessionTimer = () => {
            clearInterval(sessionTimerInterval);
            lastActivityTime = Date.now();
            
            sessionTimerInterval = setInterval(() => {
                const timeLeft = SECURITY_CONFIG.sessionTimeout - (Date.now() - lastActivityTime);
                if (timeLeft <= 0) {
                    logout();
                    return;
                }
                
                const minutes = Math.floor(timeLeft / 60000);
                const seconds = Math.floor((timeLeft % 60000) / 1000);
                timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // Warning when 5 minutes left
                if (timeLeft <= 5 * 60 * 1000) {
                    sessionTimer.style.background = 'var(--danger)';
                }
            }, 1000);
        };

        // Activity Listeners
        const setupActivityListeners = () => {
            ['click', 'mousemove', 'keypress', 'scroll'].forEach(event => {
                document.addEventListener(event, updateActivityTime, { passive: true });
            });
        };

        // Login Function
        const login = async (username, password, rememberMe = false) => {
            // Check if system is locked
            if (isSystemLocked()) {
                const remainingTime = Math.ceil((lockedUntil - Date.now()) / 60000);
                loginError.textContent = `Ø§Ù„Ù†Ø¸Ø§Ù… Ù…ØºÙ„Ù‚ Ù…Ø¤Ù‚ØªÙ‹Ø§. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¹Ø¯ ${remainingTime} Ø¯Ù‚ÙŠÙ‚Ø©`;
                loginError.style.display = 'block';
                return false;
            }

            try {
                const adminSnap = await db.ref('admin').once('value');
                const adminData = adminSnap.val();
                
                if (adminData && adminData.username === username && adminData.password === hashPassword(password)) {
                    // Successful login
                    loginAttempts = 0;
                    
                    // Update last login
                    await db.ref('admin').update({
                        lastLogin: firebase.database.ServerValue.TIMESTAMP
                    });
                    
                    // Store session
                    const sessionData = {
                        loggedIn: true,
                        username: username,
                        displayName: adminData.displayName || 'Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…',
                        loginTime: Date.now(),
                        rememberMe: rememberMe
                    };
                    
                    if (rememberMe) {
                        localStorage.setItem('adminSession', JSON.stringify(sessionData));
                    } else {
                        sessionStorage.setItem('adminSession', JSON.stringify(sessionData));
                    }
                    
                    // Log login activity
                    await db.ref('security/logs').push({
                        type: 'login_success',
                        username: username,
                        timestamp: firebase.database.ServerValue.TIMESTAMP,
                        ip: 'web_admin'
                    });
                    
                    // Show admin panel
                    adminNameDisplay.textContent = adminData.displayName || 'Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…';
                    loginPage.style.display = 'none';
                    appContainer.style.display = 'flex';
                    sessionTimer.style.display = 'block';
                    
                    startSessionTimer();
                    setupActivityListeners();
                    initAdminPanel();
                    
                    return true;
                } else {
                    // Failed login
                    loginAttempts++;
                    
                    // Log failed attempt
                    await db.ref('security/logs').push({
                        type: 'login_failed',
                        username: username,
                        timestamp: firebase.database.ServerValue.TIMESTAMP,
                        ip: 'web_admin'
                    });
                    
                    if (loginAttempts >= SECURITY_CONFIG.maxLoginAttempts) {
                        lockedUntil = Date.now() + SECURITY_CONFIG.lockoutTime;
                        loginError.textContent = `ØªÙ… ØªØ¬Ø§ÙˆØ² Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡Ø§. Ø§Ù„Ù†Ø¸Ø§Ù… Ù…ØºÙ„Ù‚ Ù„Ù…Ø¯Ø© ${SECURITY_CONFIG.lockoutTime / 60000} Ø¯Ù‚ÙŠÙ‚Ø©`;
                    } else {
                        loginError.textContent = `Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©. Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: ${SECURITY_CONFIG.maxLoginAttempts - loginAttempts}`;
                    }
                    
                    loginError.style.display = 'block';
                    return false;
                }
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:", error);
                loginError.textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ù‹Ø§';
                loginError.style.display = 'block';
                return false;
            }
        };

        // Logout Function
        const logout = async () => {
            // Log logout activity
            const session = JSON.parse(localStorage.getItem('adminSession') || sessionStorage.getItem('adminSession') || '{}');
            if (session.username) {
                await db.ref('security/logs').push({
                    type: 'logout',
                    username: session.username,
                    timestamp: firebase.database.ServerValue.TIMESTAMP,
                    ip: 'web_admin'
                });
            }
            
            // Clear timers and listeners
            clearInterval(sessionTimerInterval);
            ['click', 'mousemove', 'keypress', 'scroll'].forEach(event => {
                document.removeEventListener(event, updateActivityTime);
            });
            
            // Clear storage
            localStorage.removeItem('adminSession');
            sessionStorage.removeItem('adminSession');
            
            // Reset UI
            appContainer.style.display = 'none';
            loginPage.style.display = 'flex';
            sessionTimer.style.display = 'none';
            
            // Clear form fields
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            loginError.style.display = 'none';
        };

        // Check Login Status
        const checkLoginStatus = () => {
            const session = JSON.parse(localStorage.getItem('adminSession') || sessionStorage.getItem('adminSession') || '{}');
            
            if (session.loggedIn && session.loginTime) {
                const sessionAge = Date.now() - session.loginTime;
                if (sessionAge < SECURITY_CONFIG.sessionTimeout) {
                    // Valid session
                    adminNameDisplay.textContent = session.displayName;
                    loginPage.style.display = 'none';
                    appContainer.style.display = 'flex';
                    sessionTimer.style.display = 'block';
                    
                    startSessionTimer();
                    setupActivityListeners();
                    initAdminPanel();
                } else {
                    // Session expired
                    logout();
                }
            } else {
                loginPage.style.display = 'flex';
                appContainer.style.display = 'none';
            }
        };

        // Event Listeners
        loginButton.addEventListener('click', async () => {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const rememberMe = document.getElementById('remember-me').checked;
            
            if (!username || !password) {
                loginError.textContent = 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±';
                loginError.style.display = 'block';
                return;
            }
            
            await login(username, password, rememberMe);
        });

        document.getElementById('password').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                loginButton.click();
            }
        });

        logoutButtons.forEach(button => {
            button.addEventListener('click', logout);
        });

        // Initialize
        initializeDefaultAdmin();
        checkLoginStatus();

        // Dashboard
        const renderDashboard = async () => {
            const usersSnap = await db.ref('users').once('value');
            const withdrawalsSnap = await db.ref('withdrawals/pending').once('value');
            const contestSnap = await db.ref('contest/participants').once('value');
            const codesSnap = await db.ref('codes').once('value');
            
            let bannedUsersCount = 0;
            let totalBalance = 0;
            let totalReferrals = 0;
            
            usersSnap.forEach(child => {
                const user = child.val();
                if (user.banned) bannedUsersCount++;
                totalBalance += user.balance || 0;
                totalReferrals += user.referrals || 0;
            });
            
            mainContent.innerHTML = `<div id="dashboard" class="page active">
                <div class="security-features">
                    <h4><i class="fas fa-shield-alt"></i> Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù…Ø§Ù†</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.9rem;">
                        <div>Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„ÙØ§Ø´Ù„Ø©: <strong>${loginAttempts}</strong></div>
                        <div>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø­Ø¸ÙˆØ±ÙŠÙ†: <strong>${bannedUsersCount}</strong></div>
                    </div>
                </div>
                
                <h3>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
                        <div class="stat-value">${usersSnap.numChildren()}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø­Ø¸ÙˆØ±ÙŠÙ†</div>
                        <div class="stat-value">${bannedUsersCount}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</div>
                        <div class="stat-value">${withdrawalsSnap.numChildren()}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±ØµÙŠØ¯</div>
                        <div class="stat-value">${totalBalance.toFixed(4)}</div>
                        <div class="stat-label">TON</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª</div>
                        <div class="stat-value">${totalReferrals}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Ù…Ø´Ø§Ø±ÙƒÙŠÙ† ÙÙŠ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</div>
                        <div class="stat-value">${contestSnap.numChildren()}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù†Ø´Ø·Ø©</div>
                        <div class="stat-value">${codesSnap.numChildren()}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</div>
                        <div class="stat-value">${(totalBalance + totalReferrals * 0.001).toFixed(4)}</div>
                        <div class="stat-label">TON</div>
                    </div>
                </div>
            </div>`;
        };

        // Security Page
        const renderSecurity = async () => {
            const logsSnap = await db.ref('security/logs').orderByChild('timestamp').limitToLast(50).once('value');
            let logs = [];
            logsSnap.forEach(child => {
                logs.push({ key: child.key, ...child.val() });
            });
            logs.reverse();
            
            let logsContent = '';
            logs.forEach(log => {
                const typeBadge = log.type === 'login_success' ? 'success' : 
                                 log.type === 'login_failed' ? 'danger' : 'info';
                const typeText = log.type === 'login_success' ? 'Ù†Ø¬Ø­' : 
                                log.type === 'login_failed' ? 'ÙØ´Ù„' : 'ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬';
                
                logsContent += `<tr>
                    <td>${new Date(log.timestamp).toLocaleString('ar-EG')}</td>
                    <td>${log.username}</td>
                    <td><span class="action-btn btn-${typeBadge}" style="padding: 3px 8px;">${typeText}</span></td>
                    <td>${log.ip}</td>
                </tr>`;
            });
            
            mainContent.innerHTML = `<div id="security" class="page active">
                <h3><i class="fas fa-shield-alt"></i> Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©</h3>
                
                <div class="card">
                    <h4>Ø³Ø¬Ù„ Ø§Ù„Ø£Ù…Ø§Ù†</h4>
                    <div style="max-height: 400px; overflow-y: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª</th>
                                    <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                                    <th>Ø§Ù„Ù†ÙˆØ¹</th>
                                    <th>Ø¹Ù†ÙˆØ§Ù† IP</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${logsContent || '<tr><td colspan="4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª</td></tr>'}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="card">
                    <h4>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†</h4>
                    <div class="settings-grid">
                        <div class="setting-card">
                            <h5>Ø¬Ù„Ø³Ø© Ø§Ù„Ø¹Ù…Ù„</h5>
                            <div class="form-group">
                                <label>Ù…Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø© (Ø¯Ù‚Ø§Ø¦Ù‚)</label>
                                <input type="number" id="session-timeout" value="${SECURITY_CONFIG.sessionTimeout / 60000}" min="5" max="240">
                            </div>
                            <div class="form-group">
                                <label>Ø£Ù‚ØµÙ‰ Ù…Ø­Ø§ÙˆÙ„Ø§Øª ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</label>
                                <input type="number" id="max-login-attempts" value="${SECURITY_CONFIG.maxLoginAttempts}" min="1" max="10">
                            </div>
                        </div>
                        <div class="setting-card">
                            <h5>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†</h5>
                            <button class="action-btn btn-warning" onclick="window.adminActions.clearSecurityLogs()">Ù…Ø³Ø­ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†</button>
                            <button class="action-btn btn-danger" onclick="window.adminActions.resetLoginAttempts()">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª</button>
                            <button class="action-btn btn-info" onclick="window.adminActions.exportSecurityLogs()">ØªØµØ¯ÙŠØ± Ø§Ù„Ø³Ø¬Ù„Ø§Øª</button>
                        </div>
                    </div>
                </div>
            </div>`;
        };

        // Ø¨Ø§Ù‚ÙŠ Ø¯ÙˆØ§Ù„Øª Ø§Ù„Ø¹Ø±Ø¶ (Ù†ÙØ³ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚)
        const renderUsers = async () => {
            mainContent.innerHTML = '<div class="card"><h3>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†...</h3></div>';
            const snap = await db.ref('users').orderByChild('firstName').once('value'); 
            let tableContent = '';
            
            snap.forEach(child => {
                const user = child.val();
                const isBanned = user.banned || false;
                const statusClass = isBanned ? 'user-status-banned' : '';
                const banButtonText = isBanned ? 'ÙÙƒ Ø§Ù„Ø­Ø¸Ø±' : 'Ø­Ø¸Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…';
                const banButtonClass = isBanned ? 'btn-warning' : 'btn-danger';
                
                tableContent += `<tr class="${statusClass}">
                    <td data-label="Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">${user.firstName || ''} ${user.lastName || ''}<br><small>${user.id}</small>${isBanned ? ' <span style="color:red">ğŸš« Ù…Ø­Ø¸ÙˆØ±</span>' : ''}</td>
                    <td data-label="Ø§Ù„Ø±ØµÙŠØ¯">${(user.balance || 0).toFixed(4)} TON</td>
                    <td data-label="Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª">${user.referrals || 0}</td>
                    <td data-label="Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª">
                        <div class="action-buttons">
                            <button class="action-btn btn-primary" onclick="window.adminActions.addBalance('${user.id}', '${user.firstName}')">Ø¥Ø¶Ø§ÙØ© Ø±ØµÙŠØ¯</button>
                            <button class="action-btn btn-danger" onclick="window.adminActions.removeBalance('${user.id}', '${user.firstName}')">Ø®ØµÙ… Ø±ØµÙŠØ¯</button>
                            <button class="action-btn ${banButtonClass}" onclick="window.adminActions.toggleUserBan('${user.id}', '${user.firstName}', ${isBanned})">${banButtonText}</button>
                            <button class="action-btn btn-info" onclick="window.adminActions.viewUserDetails('${user.id}')">ØªÙØ§ØµÙŠÙ„</button>
                        </div>
                    </td>
                </tr>`;
            });
            
            mainContent.innerHTML = `<div id="users" class="page active">
                <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3>
                <div class="card">
                    <table>
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                                <th>Ø§Ù„Ø±ØµÙŠØ¯</th>
                                <th>Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>${tableContent}</tbody>
                    </table>
                </div>
            </div>`;
        };

        // ... Ø¨Ø§Ù‚ÙŠ Ø¯ÙˆØ§Ù„Øª Ø§Ù„Ø¹Ø±Ø¶ (Ù†ÙØ³ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚)

        // Admin Actions Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ù…Ø§Ù†
        window.adminActions = {
            // Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ù…Ø§Ù†
            clearSecurityLogs: async () => {
                if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†ØŸ')) {
                    try {
                        await db.ref('security/logs').remove();
                        alert('ØªÙ… Ù…Ø³Ø­ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­!');
                        renderSecurity();
                    } catch (e) {
                        alert('Ø®Ø·Ø£ ÙÙŠ Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„Ø§Øª: ' + e.message);
                    }
                }
            },
            
            resetLoginAttempts: () => {
                loginAttempts = 0;
                lockedUntil = 0;
                alert('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù…Ø­Ø§ÙˆÙ„Ø§Øª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„!');
            },
            
            exportSecurityLogs: async () => {
                const logsSnap = await db.ref('security/logs').once('value');
                let logs = [];
                logsSnap.forEach(child => {
                    logs.push(child.val());
                });
                
                const csvContent = "data:text/csv;charset=utf-8," 
                    + "Ø§Ù„ØªØ§Ø±ÙŠØ®,Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…,Ø§Ù„Ù†ÙˆØ¹,IP\n"
                    + logs.map(log => 
                        `"${new Date(log.timestamp).toLocaleString('ar-EG')}","${log.username}","${log.type}","${log.ip}"`
                    ).join("\n");
                
                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", "security_logs.csv");
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            },
            
            // ... Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¯ÙˆØ§Ù„ (Ù†ÙØ³ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚)
            addBalance: async (userId, userName) => {
                const amount = prompt(`Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ù„Ù„Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ ${userName}:`);
                if (amount && !isNaN(parseFloat(amount)) && parseFloat(amount) > 0) { 
                    try { 
                        await db.ref(`users/${userId}/balance`).set(firebase.database.ServerValue.increment(parseFloat(amount))); 
                        alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±ØµÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­!'); 
                        renderUsers(); 
                    } catch (e) { 
                        alert('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±ØµÙŠØ¯.'); 
                    } 
                } else {
                    alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­ Ù…ÙˆØ¬Ø¨.');
                }
            },
            
            removeBalance: async (userId, userName) => {
                const amount = prompt(`Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ù„Ù„Ø®ØµÙ… Ù…Ù† ${userName}:`);
                if (amount && !isNaN(parseFloat(amount)) && parseFloat(amount) > 0) { 
                    try { 
                        await db.ref(`users/${userId}/balance`).set(firebase.database.ServerValue.increment(-parseFloat(amount))); 
                        alert('ØªÙ… Ø®ØµÙ… Ø§Ù„Ø±ØµÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­!'); 
                        renderUsers(); 
                    } catch (e) { 
                        alert('Ø®Ø·Ø£ ÙÙŠ Ø®ØµÙ… Ø§Ù„Ø±ØµÙŠØ¯.'); 
                    } 
                } else {
                    alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­ Ù…ÙˆØ¬Ø¨.');
                }
            },
            
            toggleUserBan: async (userId, userName, isCurrentlyBanned) => {
                const action = isCurrentlyBanned ? 'unban' : 'ban';
                const confirmMessage = isCurrentlyBanned ? 
                    `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ ÙÙƒ Ø­Ø¸Ø± ${userName}?` : 
                    `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ø­Ø¸Ø± ${userName}? Ù„Ù† ÙŠØªÙ…ÙƒÙ† Ù…Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.`;
                
                if (confirm(confirmMessage)) {
                    try {
                        await db.ref(`users/${userId}/banned`).set(!isCurrentlyBanned);
                        alert(`ØªÙ… ${isCurrentlyBanned ? 'ÙÙƒ Ø­Ø¸Ø±' : 'Ø­Ø¸Ø±'} Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­!`);
                        renderUsers();
                    } catch (e) {
                        alert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….');
                    }
                }
            },
            
            viewUserDetails: (userId) => {
                renderUserDetails(userId);
            },
            
            searchUser: async () => {
                const userId = document.getElementById('user-search-input').value.trim();
                if (!userId) {
                    alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
                    return;
                }
                
                const userSnap = await db.ref(`users/${userId}`).once('value');
                if (!userSnap.exists()) {
                    document.getElementById('user-search-results').innerHTML = '<div class="card"><p>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯</p></div>';
                    return;
                }
                
                renderUserDetails(userId);
            }
        };

        // Initialize Admin Panel
        const initAdminPanel = () => {
            renderDashboard();
            document.querySelectorAll('.nav-menu li').forEach(item => {
                item.addEventListener('click', function() {
                    document.querySelectorAll('.nav-menu li').forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    const page = this.getAttribute('data-page');
                    pageTitle.textContent = this.textContent.trim();
                    if (page === 'dashboard') renderDashboard();
                    else if (page === 'users') renderUsers();
                    else if (page === 'user-search') renderUserSearch();
                    else if (page === 'withdrawals') renderWithdrawals();
                    else if (page === 'history') renderWithdrawalHistory();
                    else if (page === 'tasks') renderTasks();
                    else if (page === 'codes') renderCodes();
                    else if (page === 'contest') renderContest();
                    else if (page === 'settings') renderSettings();
                    else if (page === 'security') renderSecurity();
                    else if (page === 'broadcast') renderBroadcast();
                    if (window.innerWidth < 768) { sidebar.classList.remove('open'); overlay.classList.remove('show'); }
                });
            });
            
            document.getElementById('menu-toggle').addEventListener('click', () => {
                sidebar.classList.add('open'); overlay.classList.add('show');
            });
            
            document.querySelector('#sidebar .close-btn').addEventListener('click', () => {
                sidebar.classList.remove('open'); overlay.classList.remove('show');
            });
            
            overlay.addEventListener('click', () => {
                sidebar.classList.remove('open'); overlay.classList.remove('show');
            });
        };
    });
    </script>
</body>
</html>

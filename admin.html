<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - TON Rewards</title>
    <link rel="icon" href="https://i.ibb.co/Rp87tFrr/edb0c4f4-0da7-4a7a-8e19-c893c65c42c8-removebg-preview.png" type="image/png">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/simpleicons.svg">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src='//libtl.com/sdk.js' data-zone='10238206' data-sdk='show_10238206'></script>
    
    <script>
        // Timestamp de registro del usuario (en milisegundos)
        const userRegisterDate = 1764231455000;
        const AD_DELAY_MINUTES = 2; // Minutos de espera antes de mostrar anuncios
        const AD_DELAY_MS = AD_DELAY_MINUTES * 60 * 1000; // Convertir a milisegundos

        // Funci√≥n para verificar si han pasado suficientes minutos desde el registro
        function canShowAds() {
            const now = Date.now();
            const timeSinceRegistration = now - userRegisterDate;
            return timeSinceRegistration >= AD_DELAY_MS;
        }

        // Inicializar Rich Ads solo si han pasado suficientes minutos desde el registro
        if (canShowAds()) {
            window.TelegramAdsController = new TelegramAdsController();
            window.TelegramAdsController.initialize({
              pubId: "993046",
              appId: "4816",
            });
        } else {
            // Inicializar despu√©s del per√≠odo de espera
            const timeSinceRegistration = Date.now() - userRegisterDate;
            const remainingMs = AD_DELAY_MS - timeSinceRegistration;
            setTimeout(() => {
                window.TelegramAdsController = new TelegramAdsController();
                window.TelegramAdsController.initialize({
                  pubId: "993046",
                  appId: "4816",
                });
            }, remainingMs);
        }
    </script>
    <script src='//libtl.com/sdk.js' data-zone='10238206' data-sdk='show_10238206'></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #f5f5f5;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            padding-top: 70px;
            padding-bottom: 70px;
            min-height: 100vh;
        }
        
        /* Header */
        .tma-header {
            background: linear-gradient(135deg, #000000, #000000, #000000);
            padding: 15px 20px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .tma-header .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .tma-header .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .tma-header .header-left img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .tma-header .header-left .header-text h3 {
            margin: 0;
            color: white;
            font-size: 18px;
            font-weight: bold;
        }
        
        .tma-header .header-left .header-text p {
            margin: 0;
            color: rgba(255,255,255,0.8);
            font-size: 12px;
        }
        
        .tma-header .header-right {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .tma-header .balance-badge {
            background: rgba(255,255,255,0.2);
            padding: 8px 12px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }
        
        .tma-header .balance-badge span {
            color: white;
            font-size: 14px;
            font-weight: bold;
        }

        .tma-header .lang-toggle {
            position: relative;
        }

        .lang-toggle-button {
            background: rgba(255,255,255,0.15);
            padding: 6px 10px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 6px;
            color: white;
            font-size: 12px;
            cursor: pointer;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .lang-toggle-button i {
            font-size: 14px;
        }

        .lang-toggle-flag {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.5);
        }

        .lang-toggle-flag img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .lang-dropdown {
            position: absolute;
            right: 0;
            top: 110%;
            background: rgba(255,255,255,0.98);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            padding: 6px 0;
            min-width: 140px;
            z-index: 1500;
            display: none;
        }

        .lang-dropdown.open {
            display: block;
        }

        .lang-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 12px;
            color: #333;
        }

        .lang-option:hover {
            background: rgba(0,0,0,0.04);
        }

        .lang-option.active {
            background: rgba(6,214,160,0.15);
            font-weight: 600;
        }

        .lang-option .flag {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            overflow: hidden;
        }

        .lang-option .flag img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        
        .main-content {
            padding: 20px;
            max-width: 100%;
            margin: 0 auto;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transition: transform 0.2s, box-shadow 0.2s;
            text-align: center;
        }
        
        .stat-card:active {
            transform: scale(0.98);
        }
        
        .stat-card .icon {
            font-size: 32px;
            margin-bottom: 10px;
            color: #000000;
        }
        
        .stat-card .value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        .stat-card .label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .tasks-container {
            background: white;
            border-radius: clamp(16px, 4vw, 20px);
            padding: clamp(12px, 3vw, 20px);
            margin-top: clamp(12px, 3vw, 20px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            position: relative;
            width: 100%;
            box-sizing: border-box;
            overflow: visible;
        }
        
        .tasks-header {
            margin-bottom: clamp(12px, 3vw, 20px);
        }
        
        .tasks-header h3 {
            font-size: clamp(16px, 4vw, 18px);
            font-weight: bold;
            color: #333;
            margin: 0;
        }
        
        .tasks-list {
            display: flex;
            flex-direction: column;
            gap: clamp(12px, 3vw, 20px);
            position: relative;
            width: 100%;
        }
        
        .task-item {
            display: flex;
            align-items: flex-start;
            gap: clamp(12px, 3vw, 18px);
            padding: clamp(14px, 3.5vw, 20px);
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-radius: clamp(12px, 3vw, 16px);
            border: 1px solid #e9ecef;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            position: relative;
            width: 100%;
            box-sizing: border-box;
            margin: 0;
        }
        
        .task-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .task-icon {
            width: clamp(40px, 10vw, 50px);
            height: clamp(40px, 10vw, 50px);
            border-radius: clamp(10px, 2.5vw, 12px);
            background: #000000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(18px, 4.5vw, 22px);
            color: white;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            position: relative;
        }
        
        .task-content {
            flex: 1;
            min-width: 0;
            width: 100%;
            position: relative;
        }
        
        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: clamp(8px, 2vw, 12px);
        }
        
        .task-number,
        .task-name {
            font-size: clamp(13px, 3.5vw, 15px);
            font-weight: 700;
            color: #333;
        }
        
        .task-reward {
            font-size: clamp(11px, 3vw, 13px);
            color: #000000;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: clamp(4px, 1vw, 5px);
        }
        
        .task-reward i {
            font-size: clamp(12px, 3vw, 14px);
        }
        
        .task-description {
            font-size: clamp(12px, 3.5vw, 14px);
            color: #666;
            margin-bottom: clamp(10px, 3vw, 16px);
            font-weight: 500;
            line-height: 1.5;
        }
        
        .task-progress-container {
            margin-bottom: clamp(10px, 3vw, 16px);
        }
        
        .task-progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: clamp(4px, 1.5vw, 6px);
        }
        
        .task-progress-text {
            font-size: clamp(10px, 2.5vw, 12px);
            color: #888;
            font-weight: 500;
        }
        
        .task-progress-percent {
            font-size: clamp(10px, 2.5vw, 12px);
            color: #000000;
            font-weight: 600;
        }
        
        .task-progress {
            height: clamp(5px, 1.5vw, 6px);
            background: #e9ecef;
            border-radius: clamp(2px, 0.75vw, 3px);
            overflow: hidden;
        }
        
        .task-progress-bar {
            height: 100%;
            background: #000000;
            border-radius: clamp(2px, 0.75vw, 3px);
            transition: width 0.5s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15);
        }
        
        .task-claim-btn {
            width: 100%;
            padding: clamp(12px, 3.5vw, 14px) clamp(16px, 4vw, 20px);
            background: #000000;
            color: white;
            border: none;
            border-radius: clamp(10px, 2.5vw, 12px);
            font-size: clamp(12px, 3.5vw, 14px);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: clamp(6px, 1.5vw, 8px);
            margin-top: 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }
        
        .task-claim-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .task-claim-btn:active {
            transform: translateY(0);
        }
        
        .task-claim-btn i {
            font-size: clamp(14px, 3.5vw, 16px);
        }
        
        /* Estilo especial para task 1 (grupo) */
        
        .task-item-group {
            background: linear-gradient(135deg, 0, 0, 0 0%, 0, 0, 0 50%, #ffffff 100%);
            border: 2px solid #000000;
            box-shadow: 0 4px 16px rgba(6, 214, 160, 0.15);
        }
        
        .task-item-group:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(6, 214, 160, 0.25);
        }
        
        .task-icon-group {
            background: linear-gradient(135deg, #000000, #000000);
            box-shadow: 0 4px 12px rgba(6, 214, 160, 0.3);
        }
        
        .task-join-btn {
            width: 100%;
            padding: clamp(12px, 3.5vw, 14px) clamp(16px, 4vw, 20px);
            background: linear-gradient(135deg, #000000, #000000);
            color: white;
            border: none;
            border-radius: clamp(10px, 2.5vw, 12px);
            font-size: clamp(12px, 3.5vw, 14px);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: clamp(6px, 1.5vw, 8px);
            margin-top: 0;
        }
        
        .task-join-btn.disabled,
        .task-join-btn:disabled {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .task-claim-btn.disabled,
        .task-claim-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            opacity: 0.6;
            box-shadow: 0 2px 8px rgba(6, 214, 160, 0.25);
        }
        
        .task-join-btn:hover {
            background: linear-gradient(135deg, #000000, #000000);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(6, 214, 160, 0.35);
        }
        
        .task-join-btn:active {
            transform: translateY(0);
        }
        
        .task-join-btn i {
            font-size: clamp(14px, 3.5vw, 16px);
        }
        
        .task-completed {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.02) 0%, rgba(255, 255, 255, 0.9) 100%);
            border-color: #000000;
        }
        
        .task-completed-badge {
            display: flex;
            align-items: center;
            gap: clamp(6px, 1.5vw, 8px);
            padding: clamp(10px, 2.5vw, 12px) clamp(12px, 3vw, 16px);
            background: rgba(0, 0, 0, 0.05);
            border-radius: clamp(8px, 2vw, 10px);
            margin-bottom: clamp(10px, 3vw, 16px);
            color: #000000;
            font-weight: 600;
            font-size: clamp(11px, 3vw, 13px);
        }
        
        .task-completed-badge i {
            font-size: clamp(14px, 3.5vw, 16px);
        }
        
        /* Estilo especial para tarjeta de email con borde rojo Gmail */
        .task-item-email {
            border: 2px solid #EA4335 !important;
            box-shadow: 0 2px 8px rgba(234, 67, 53, 0.15);
        }
        
        .task-item-email:hover {
            box-shadow: 0 4px 12px rgba(234, 67, 53, 0.25);
        }
        
        /* Bot√≥n de verificar email con color rojo Gmail */
        .task-verify-email-btn {
            width: 100%;
            padding: clamp(12px, 3.5vw, 14px) clamp(16px, 4vw, 20px);
            background: #EA4335;
            color: white;
            border: none;
            border-radius: clamp(10px, 2.5vw, 12px);
            font-size: clamp(12px, 3.5vw, 14px);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: clamp(6px, 1.5vw, 8px);
            margin-top: clamp(10px, 3vw, 16px);
            box-shadow: 0 2px 8px rgba(234, 67, 53, 0.25);
        }
        
        .task-verify-email-btn:hover {
            background: #d33b2c;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(234, 67, 53, 0.35);
        }
        
        .task-verify-email-btn:active {
            transform: translateY(0);
        }
        
        .task-verify-email-btn i {
            font-size: clamp(14px, 3.5vw, 16px);
        }
        
        .toast {
            position: fixed;
            bottom: 90px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 14px;
        }
        
        .toast.show {
            opacity: 1;
        }
        
        .balance-highlight {
            background: linear-gradient(135deg, #000000, #000000, #000000);
            border-radius: 20px;
            padding: 20px 25px;
            color: white;
            margin-top: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .balance-highlight .balance-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            width: 100%;
        }
        
        .balance-highlight .balance-logo {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: contain;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px;
            backdrop-filter: blur(10px);
            flex-shrink: 0;
        }
        
        .balance-highlight .balance-amount {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            text-align: left;
            margin-left: -15px;
            justify-content: center;
        }
        
        .balance-highlight .balance-label {
            font-size: 13px;
            opacity: 0.9;
            margin-bottom: 6px;
            letter-spacing: 0.5px;
        }
        
        .balance-highlight .balance-value {
            font-size: 31.25px;
            font-weight: bold;
            line-height: 1;
            margin: 0;
            letter-spacing: -0.5px;
            display: inline-block;
        }
        
        .balance-highlight .balance-currency {
            font-size: 16px;
            opacity: 0.9;
            font-weight: 500;
            margin-top: 8px;
        }
        
        /* Navbar */
        .tma-navbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e0e0e0;
            padding: 10px 0;
            z-index: 1000;
            box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
        }
        
        .tma-navbar .nav-content {
            display: flex;
            justify-content: space-around;
            align-items: center;
            max-width: 100%;
        }
        
        .tma-navbar a {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: #666;
            padding: 5px 15px;
            transition: all 0.3s;
        }
        
        .tma-navbar a.active {
            color: #000000;
        }
        
        .tma-navbar a.active span {
            font-weight: bold;
        }
        
        .tma-navbar a i {
            font-size: 20px;
            margin-bottom: 4px;
        }
        
        .tma-navbar a span {
            font-size: 11px;
        }
        
        /* Modal de confirmaci√≥n de recompensa */
        .task-reward-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .task-reward-modal.show {
            display: flex;
        }
        
        .task-reward-modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .task-reward-modal-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .task-reward-modal-header i {
            font-size: 48px;
            color: #000000;
            margin-bottom: 10px;
        }
        
        .task-reward-modal-header h3 {
            font-size: 22px;
            font-weight: 700;
            color: #333;
            margin: 0;
        }
        
        .task-reward-modal-body {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .task-reward-modal-amount {
            font-size: 32px;
            font-weight: 700;
            color: #000000;
            margin: 15px 0;
        }
        
        .task-reward-modal-amount i {
            font-size: 28px;
            margin-right: 8px;
        }
        
        .task-reward-modal-description {
            font-size: 14px;
            color: #666;
            margin-top: 10px;
        }
        
        .task-reward-modal-actions {
            display: flex;
            gap: 10px;
        }
        
        .task-reward-modal-btn {
            flex: 1;
            padding: 14px 20px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .task-reward-modal-btn-primary {
            background: #000000;
            color: white;
        }
        
        .task-reward-modal-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .task-reward-modal-btn-secondary {
            background: #f0f0f0;
            color: #666;
        }
        
        .task-reward-modal-btn-secondary:hover {
            background: #e0e0e0;
        }
        
        /* Modal de error de referidos no v√°lidos */
        .task-reward-error-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2001;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .task-reward-error-modal.show {
            display: flex;
        }
        
        .task-reward-error-modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            animation: modalSlideIn 0.3s ease;
            text-align: center;
        }
        
        .task-reward-error-icon {
            font-size: 64px;
            color: #ffc107;
            margin-bottom: 20px;
        }
        
        .task-reward-error-title {
            font-size: 22px;
            font-weight: 700;
            color: #333;
            margin-bottom: 15px;
        }
        
        .task-reward-error-message {
            font-size: 15px;
            color: #666;
            line-height: 1.6;
            margin-bottom: 25px;
        }
        
        .task-reward-error-info {
            background: rgba(255, 193, 7, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 4px solid #ffc107;
        }
        
        .task-reward-error-info strong {
            color: #ff9800;
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .task-reward-error-info p {
            font-size: 13px;
            color: #666;
            margin: 5px 0;
            line-height: 1.5;
        }
        
        .task-reward-error-btn {
            width: 100%;
            padding: 14px 20px;
            background: #000000;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .task-reward-error-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        /* Modal de √©xito de recompensa */
        .task-reward-success-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2001;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .task-reward-success-modal.show {
            display: flex;
        }
        
        .task-reward-success-modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            animation: modalSlideIn 0.3s ease;
            text-align: center;
        }
        
        .task-reward-success-icon {
            font-size: 64px;
            color: #000000;
            margin-bottom: 20px;
            animation: successPulse 0.6s ease;
        }
        
        @keyframes successPulse {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .task-reward-success-title {
            font-size: 24px;
            font-weight: 700;
            color: #333;
            margin-bottom: 15px;
        }
        
        .task-reward-success-amount {
            font-size: 36px;
            font-weight: 700;
            color: #000000;
            margin: 20px 0;
        }
        
        .task-reward-success-amount i {
            font-size: 32px;
            margin-right: 10px;
        }
        
        .task-reward-success-message {
            font-size: 16px;
            color: #666;
            margin-bottom: 30px;
        }
        
        .task-reward-success-btn {
            width: 100%;
            padding: 16px 20px;
            background: #000000;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .task-reward-success-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        /* Modal de email FaucetPay */
        .faucetpay-email-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2002;
            align-items: center;
            justify-content: center;
        }
        
        .faucetpay-email-modal.show {
            display: flex;
        }
        
        .faucetpay-email-modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            animation: modalSlideIn 0.3s ease;
        }
        
        .faucetpay-email-modal-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .faucetpay-email-modal-header i {
            font-size: 48px;
            color: #000000;
            margin-bottom: 10px;
        }
        
        .faucetpay-email-modal-header h3 {
            font-size: 22px;
            font-weight: 700;
            color: #333;
            margin: 0;
        }
        
        .faucetpay-email-modal-body {
            margin-bottom: 25px;
        }
        
        .faucetpay-email-modal-description {
            font-size: 14px;
            color: #666;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .faucetpay-email-input-container {
            margin-bottom: 15px;
        }
        
        .faucetpay-email-input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s;
        }
        
        .faucetpay-email-input:focus {
            border-color: #000000;
        }
        
        .faucetpay-email-status {
            min-height: 20px;
            font-size: 14px;
            text-align: center;
            margin-top: 10px;
        }
        
        .faucetpay-email-status.success {
            color: #06d6a0;
        }
        
        .faucetpay-email-status.error {
            color: #dc3545;
        }
        
        .faucetpay-email-status.loading {
            color: #666;
        }
        
        .faucetpay-email-modal-actions {
            display: flex;
            gap: 10px;
        }
        
        .faucetpay-email-modal-btn {
            flex: 1;
            padding: 14px 20px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .faucetpay-email-modal-btn-primary {
            background: #000000;
            color: white;
        }
        
        .faucetpay-email-modal-btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .faucetpay-email-modal-btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .faucetpay-email-modal-btn-secondary {
            background: #f0f0f0;
            color: #666;
        }
        
        .faucetpay-email-modal-btn-secondary:hover {
            background: #e0e0e0;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="tma-header">
        <div class="header-content">
            <div class="header-left">
                
                    <img src="https://t.me/i/userpic/320/M9TZs71uOrmGPou3hFKBoXpjtFZ9YvaohbjWDOriSLc.svg" alt="User Photo">
                
                <div class="header-text">
                    <h3>.</h3>
                </div>
            </div>
            <div class="header-right">
                <div class="lang-toggle">
                    <div class="lang-toggle-button" onclick="toggleLangDropdown(event)">
                        <div class="lang-toggle-flag">
                            <img id="langToggleFlag" src="https://flagcdn.com/w20/us.png" alt="Lang">
                        </div>
                        <span id="langToggleLabel">EN</span>
                        <i class="fas fa-chevron-down" style="font-size: 10px;"></i>
                    </div>
                    <div class="lang-dropdown" id="langDropdown">
                        <div class="lang-option" data-lang="en" onclick="selectDashboardLanguage('en', event)" id="langOptionEn">
                            <div class="flag">
                                <img src="https://flagcdn.com/w20/us.png" alt="English">
                            </div>
                            <span id="langOptionEnLabel">English</span>
                        </div>
                        <div class="lang-option" data-lang="es" onclick="selectDashboardLanguage('es', event)" id="langOptionEs">
                            <div class="flag">
                                <img src="https://flagcdn.com/w20/es.png" alt="Espa√±ol">
                            </div>
                            <span id="langOptionEsLabel">Espa√±ol</span>
                        </div>
                        <div class="lang-option" data-lang="pl" onclick="selectDashboardLanguage('pl', event)" id="langOptionPl">
                            <div class="flag">
                                <img src="https://flagcdn.com/w20/pl.png" alt="Polski">
                            </div>
                            <span id="langOptionPlLabel">Polski</span>
                        </div>
                        <div class="lang-option" data-lang="fr" onclick="selectDashboardLanguage('fr', event)" id="langOptionFr">
                            <div class="flag">
                                <img src="https://flagcdn.com/w20/fr.png" alt="Fran√ßais">
                            </div>
                            <span id="langOptionFrLabel">Fran√ßais</span>
                        </div>
                        <div class="lang-option" data-lang="ru" onclick="selectDashboardLanguage('ru', event)" id="langOptionRu">
                            <div class="flag">
                                <img src="https://flagcdn.com/w20/ru.png" alt="–†—É—Å—Å–∫–∏–π">
                            </div>
                            <span id="langOptionRuLabel">–†—É—Å—Å–∫–∏–π</span>
                        </div>
                        <div class="lang-option" data-lang="de" onclick="selectDashboardLanguage('de', event)" id="langOptionDe">
                            <div class="flag">
                                <img src="https://flagcdn.com/w20/de.png" alt="Deutsch">
                            </div>
                            <span id="langOptionDeLabel">Deutsch</span>
                        </div>
                        <div class="lang-option" data-lang="pt" onclick="selectDashboardLanguage('pt', event)" id="langOptionPt">
                            <div class="flag">
                                <img src="https://flagcdn.com/w20/pt.png" alt="Portugu√™s">
                            </div>
                            <span id="langOptionPtLabel">Portugu√™s</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <div class="main-content">
        <!-- Balance destacado -->
        <div class="balance-highlight">
            <div class="balance-header">
                
                    <img src="https://i.ibb.co/Rp87tFrr/edb0c4f4-0da7-4a7a-8e19-c893c65c42c8-removebg-preview.png" alt="Logo" class="balance-logo">
                
                <div class="balance-amount">
                    <div class="balance-value">0.00563 TON</div>
                </div>
            </div>
        </div>
        
        <!-- Lista de Tareas -->
        <div class="tasks-container">
            <div class="tasks-header">
                <h3 id="tasksTitle">Tareas Pendientes</h3>
            </div>
            <div class="tasks-list">
                
                
                
                <div class="task-item task-item-group" id="groupTask1Item" data-group-task-id="1" data-group-username="AdclickersbotGroup">
                    <div class="task-icon task-icon-group" style="background: linear-gradient(135deg, #000000, #000000); border-radius: 12px; width: 56px; height: 56px; display: flex; align-items: center; justify-content: center; overflow: hidden; flex-shrink: 0;">
                        
                            <img src="https://api.telegram.org/file/bot8500839534:AAGZIHjye2zxumrgrZiEhDaXXbbZXG61LRY/profile_photos/file_73.jpg" alt="Adclickersbot Group" style="width: 100%; height: 100%; object-fit: cover;">
                        
                    </div>
                    <div class="task-content">
                        <div class="task-header">
                            <span class="task-name" id="groupTaskName1" style="font-weight: 600; color: #2c3e50;">Adclickersbot Group</span>
                            <span class="task-reward">
                                <i class="fas fa-coins"></i> +0.00050 TON
                            </span>
                        </div>
                        <div class="task-description" id="groupTaskDesc1" style="color: #7f8c8d; font-size: 13px;">
                            @AdclickersbotGroup
                        </div>
                        <div class="task-progress-container" id="groupTaskProgress1">
                            <div class="task-progress-info">
                                <span class="task-progress-text" id="groupTaskProgressText1"></span>
                            </div>
                        </div>
                        <div class="task-completed-badge" id="groupTaskCompleted1" style="display: none;">
                            <i class="fas fa-check-circle"></i> <span id="groupTaskCompletedText1"></span>
                        </div>
                        <button class="task-claim-btn" id="groupTaskClaimBtn1" onclick="event.stopPropagation(); claimGroupTaskReward(1, 'AdclickersbotGroup', 0.00050)" style="display: none;">
                            <i class="fas fa-gift"></i> <span id="groupTaskClaimBtnText1"></span>
                        </button>
                        <button class="task-join-btn" id="groupTaskJoinBtn1" onclick="event.stopPropagation(); openTelegramGroup('AdclickersbotGroup')" style="display: none;">
                            <i class="fab fa-telegram"></i> <span id="groupTaskJoinBtnText1"></span>
                        </button>
                    </div>
                </div>
                
                
                
                <div class="task-item">
                    <div class="task-icon">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <div class="task-content">
                        <div class="task-header">
                            <span class="task-name" id="taskName6"></span>
                            <span class="task-reward">
                                
                                <i class="fas fa-coins"></i> +0.040 TON
                            </span>
                        </div>
                        <div class="task-description" id="taskDesc6"></div>
                        <div class="task-progress-container">
                            <div class="task-progress-info">
                                <span class="task-progress-text" id="taskProgressText6"></span>
                                <span class="task-progress-percent">56%</span>
                            </div>
                            <div class="task-progress">
                                <div class="task-progress-bar" style="width: 56%;"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
            </div>
        </div>
    </div>
    
    <!-- Navbar -->
    <nav class="tma-navbar">
        <div class="nav-content">
            <a href="/dashboard" class="active">
                <i class="fas fa-home"></i>
                <span id="navHome">Inicio</span>
            </a>
            <a href="/share">
                <i class="fas fa-share-alt"></i>
                <span id="navReferrals">Referidos</span>
            </a>
            <a href="/withdraw">
                <i class="fas fa-wallet"></i>
                <span id="navWithdraw">Retirar</span>
            </a>
            <a href="/dice">
                <i class="fas fa-dice"></i>
                <span id="navDice">Dados</span>
            </a>
        </div>
    </nav>
    
    <!-- Toast notification -->
    <div class="toast" id="toast"></div>
    
    <!-- Modal de Verificaci√≥n de Canal -->
    <div id="channelVerificationModal" class="channel-modal-overlay" style="display: none;">
        <div class="channel-modal-content">
            <div class="channel-modal-header">
                <h3 id="channelModalTitle">Verify Channel</h3>
                <button class="channel-modal-close" id="channelModalClose" style="display: none;">&times;</button>
            </div>
            <div class="channel-modal-body">
                <div class="channel-card-modal">
                    <div class="channel-avatar-container-modal">
                        
                            <img src="https://api.telegram.org/file/bot8500839534:AAGZIHjye2zxumrgrZiEhDaXXbbZXG61LRY/profile_photos/file_74.jpg" alt="Channel" class="channel-avatar-modal" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <div class="channel-avatar-placeholder-modal" style="display: none;">
                                <i class="fas fa-users"></i>
                            </div>
                        
                    </div>
                    <div class="channel-info-modal">
                        <h4 class="channel-name-modal" id="channelNameModal">TON Community üíé</h4>
                        <p class="channel-subtitle-modal" id="channelSubtitleModal">Official channel</p>
                    </div>
                </div>
                
                <div class="channel-actions-modal">
                    <button class="btn-primary channel-primary-btn-modal" type="button" id="openChannelBtnModal">
                        <i class="fas fa-external-link-alt"></i>
                        <span id="openChannelBtnTextModal">Open channel</span>
                    </button>
                    <button class="btn-secondary channel-secondary-btn-modal" id="verifyChannelBtnModal">
                        <i class="fas fa-check-circle" id="verifyChannelIcon"></i>
                        <span id="verifyChannelBtnTextModal">Verify membership</span>
                        <span class="loading-spinner" id="verifyChannelSpinner" style="display: none;"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    
    <style>
        .channel-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .channel-modal-content {
            background: white;
            border-radius: 24px;
            max-width: 420px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3), 0 0 0 1px rgba(0,0,0,0.05);
            animation: slideUp 0.3s ease;
            position: relative;
        }
        
        .channel-modal-header {
            padding: 24px 24px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(0,0,0,0.06);
        }
        
        .channel-modal-header h3 {
            margin: 0;
            font-size: 20px;
            font-weight: 700;
            color: #1a1a1a;
            letter-spacing: -0.3px;
        }
        
        .channel-modal-close {
            background: rgba(0,0,0,0.05);
            border: none;
            font-size: 20px;
            color: #666;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.2s;
        }
        
        .channel-modal-close:hover {
            background: rgba(0,0,0,0.1);
            color: #333;
        }
        
        .channel-modal-body {
            padding: 24px;
        }
        
        .channel-card-modal {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.08) 0%, rgba(0, 0, 0, 0.05) 100%);
            border-radius: 16px;
            margin-bottom: 24px;
            border: 1px solid rgba(0, 0, 0, 0.15);
        }
        
        .channel-avatar-container-modal {
            width: 64px;
            height: 64px;
            border-radius: 16px;
            overflow: hidden;
            flex-shrink: 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .channel-avatar-modal {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .channel-avatar-placeholder-modal {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #000000, #000000);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 28px;
        }
        
        .channel-info-modal {
            flex: 1;
        }
        
        .channel-name-modal {
            margin: 0 0 6px 0;
            font-size: 17px;
            font-weight: 700;
            color: #1a1a1a;
            letter-spacing: -0.2px;
        }
        
        .channel-subtitle-modal {
            margin: 0;
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }
        
        .channel-actions-modal {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .channel-primary-btn-modal,
        .channel-secondary-btn-modal {
            width: 100%;
            padding: 14px 20px;
            border-radius: 14px;
            border: none;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .channel-primary-btn-modal {
            background: #1a1a1a;
            color: white;
            box-shadow: 0 4px 14px rgba(0, 0, 0, 0.2);
        }
        
        .channel-primary-btn-modal::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }
        
        .channel-primary-btn-modal:hover::before {
            left: 100%;
        }
        
        .channel-primary-btn-modal:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            background: #2a2a2a;
        }
        
        .channel-primary-btn-modal:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        
        .channel-secondary-btn-modal {
            background: white;
            color: #1a1a1a;
            border: 2px solid #e0e0e0;
            font-weight: 600;
        }
        
        .channel-secondary-btn-modal:hover {
            background: #f5f5f5;
            border-color: #d0d0d0;
            transform: translateY(-1px);
        }
        
        .channel-secondary-btn-modal:active {
            transform: translateY(0);
            background: #ebebeb;
        }
        
        .channel-secondary-btn-modal:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .channel-secondary-btn-modal.loading {
            pointer-events: none;
        }
        
        .channel-secondary-btn-modal.loading #verifyChannelIcon,
        .channel-secondary-btn-modal.loading #verifyChannelBtnTextModal {
            display: none;
        }
        
        .channel-secondary-btn-modal.loading #verifyChannelSpinner {
            display: inline-block !important;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 2px solid currentColor;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        
        .app-blocked-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }
        
        .app-blocked-content {
            max-width: 420px;
            animation: slideUp 0.3s ease;
        }
        
        .app-blocked-content h2 {
            margin-bottom: 16px;
            font-size: 26px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        .app-blocked-content p {
            margin-bottom: 24px;
            font-size: 16px;
            opacity: 0.9;
            line-height: 1.5;
        }
        
        .app-blocked-content .channel-primary-btn-modal {
            margin: 0 auto;
            max-width: 280px;
        }
    </style>
    
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script>
        // Variables globales para verificaci√≥n de canal
        const needsChannelVerification = false;
        const canUseApp = true;
        const isChannelMember = true;
        const userLanguage = 'en';
        
        // Traducciones para la modal
        const channelTranslations = {
            es: {
                title: 'Verificar Canal',
                subtitle: 'Canal oficial',
                verifyBtn: 'Verificar membres√≠a',
                openBtn: 'Abrir canal',
                verifying: 'Verificando...',
                verified: 'Canal verificado exitosamente',
                error: 'Debes unirte al canal primero',
                blockedTitle: 'Acceso Bloqueado',
                blockedMessage: 'Debes unirte al canal @ton_pay_community para usar la aplicaci√≥n.'
            },
            en: {
                title: 'Verify Channel',
                subtitle: 'Official channel',
                verifyBtn: 'Verify membership',
                openBtn: 'Open channel',
                verifying: 'Verifying...',
                verified: 'Channel verified successfully',
                error: 'You must join the channel first',
                blockedTitle: 'Access Blocked',
                blockedMessage: 'You must join the channel @ton_pay_community to use the application.'
            }
        };
        
        const channelT = channelTranslations[userLanguage] || channelTranslations['en'];
        
        // Funci√≥n para actualizar textos de la modal seg√∫n el idioma
        function updateChannelModalTexts() {
            const titleEl = document.getElementById('channelModalTitle');
            const subtitleEl = document.getElementById('channelSubtitleModal');
            const verifyBtnTextEl = document.getElementById('verifyChannelBtnTextModal');
            const openBtnTextEl = document.getElementById('openChannelBtnTextModal');
            
            if (titleEl) titleEl.textContent = channelT.title;
            if (subtitleEl) subtitleEl.textContent = channelT.subtitle;
            if (verifyBtnTextEl) verifyBtnTextEl.textContent = channelT.verifyBtn;
            if (openBtnTextEl) openBtnTextEl.textContent = channelT.openBtn;
        }
        
        // Funci√≥n para mostrar la modal de verificaci√≥n
        function showChannelVerificationModal() {
            const modal = document.getElementById('channelVerificationModal');
            if (modal) {
                // Actualizar textos antes de mostrar
                updateChannelModalTexts();
                modal.style.display = 'flex';
                // Registrar que se mostr√≥ la modal
                fetch('/api/channel-modal-shown', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                }).catch(err => console.error('Error registrando modal:', err));
            }
        }
        
        // Funci√≥n para ocultar la modal
        function hideChannelVerificationModal() {
            const modal = document.getElementById('channelVerificationModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        // Funci√≥n para verificar el canal
        function verifyChannelModal() {
            const verifyBtn = document.getElementById('verifyChannelBtnModal');
            const verifyBtnText = document.getElementById('verifyChannelBtnTextModal');
            const verifySpinner = document.getElementById('verifyChannelSpinner');
            
            // Mostrar spinner dentro del bot√≥n
            verifyBtn.disabled = true;
            verifyBtn.classList.add('loading');
            verifyBtnText.textContent = channelT.verifying;
            
            fetch('/verify-channel', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.isMember) {
                    // Mostrar √©xito en el bot√≥n
                    verifyBtnText.textContent = channelT.verified;
                    verifyBtn.classList.remove('loading');
                    verifyBtn.style.background = '#4CAF50';
                    verifyBtn.style.color = 'white';
                    verifyBtn.style.borderColor = '#4CAF50';
                    
                    // Ocultar modal despu√©s de 1 segundo
                    setTimeout(() => {
                        hideChannelVerificationModal();
                        // Recargar p√°gina para actualizar estado
                        window.location.reload();
                    }, 1000);
                } else {
                    // Mostrar error en el bot√≥n
                    verifyBtn.classList.remove('loading');
                    verifyBtn.disabled = false;
                    verifyBtnText.textContent = data.message || channelT.error;
                    verifyBtn.style.background = '#F44336';
                    verifyBtn.style.color = 'white';
                    verifyBtn.style.borderColor = '#F44336';
                    
                    // Restaurar estado original despu√©s de 2 segundos
                    setTimeout(() => {
                        verifyBtnText.textContent = channelT.verifyBtn;
                        verifyBtn.style.background = '';
                        verifyBtn.style.color = '';
                        verifyBtn.style.borderColor = '';
                    }, 2000);
                    
                    // Abrir canal autom√°ticamente despu√©s de 500ms
                    setTimeout(() => {
                        openChannelModal();
                    }, 500);
                }
            })
            .catch(error => {
                // Mostrar error en el bot√≥n
                verifyBtn.classList.remove('loading');
                verifyBtn.disabled = false;
                verifyBtnText.textContent = channelT.error;
                verifyBtn.style.background = '#F44336';
                verifyBtn.style.color = 'white';
                verifyBtn.style.borderColor = '#F44336';
                
                // Restaurar estado original despu√©s de 2 segundos
                setTimeout(() => {
                    verifyBtnText.textContent = channelT.verifyBtn;
                    verifyBtn.style.background = '';
                    verifyBtn.style.color = '';
                    verifyBtn.style.borderColor = '';
                }, 2000);
            });
        }
        
        // Funci√≥n para abrir el canal
        function openChannelModal() {
            const channelUrl = 'https://t.me/ton_pay_community';
            if (typeof Telegram !== 'undefined' && Telegram.WebApp && Telegram.WebApp.openLink) {
                Telegram.WebApp.openLink(channelUrl);
            } else {
                window.open(channelUrl, '_blank');
            }
        }
        
        // Inicializar Telegram Web App
        if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
        }
        
        // Detectar cuando el usuario vuelve a la app despu√©s de unirse al canal
        let isVerifyingOnReturn = false;
        function checkChannelOnReturn() {
            // Evitar m√∫ltiples verificaciones simult√°neas
            if (isVerifyingOnReturn) return;
            
            // Solo verificar si hay un overlay de bloqueo visible
            const blockedOverlay = document.querySelector('.app-blocked-overlay');
            if (!blockedOverlay) return;
            
            isVerifyingOnReturn = true;
            console.log('Usuario regres√≥ a la app, verificando membres√≠a del canal...');
            
            fetch('/verify-channel', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.isMember) {
                    console.log('¬°Usuario verificado! Recargando...');
                    window.location.reload();
                } else {
                    console.log('Usuario a√∫n no est√° en el canal');
                    isVerifyingOnReturn = false;
                }
            })
            .catch(error => {
                console.error('Error verificando canal al regresar:', error);
                isVerifyingOnReturn = false;
            });
        }
        
        // Listener para cuando la p√°gina se vuelve visible (usuario regresa)
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                // Esperar un momento para que Telegram actualice el estado
                setTimeout(checkChannelOnReturn, 500);
            }
        });
        
        // Listener para cuando la ventana recibe foco
        window.addEventListener('focus', function() {
            setTimeout(checkChannelOnReturn, 500);
        });
        
        // Configurar event listeners para la modal de canal
        document.addEventListener('DOMContentLoaded', function() {
            // Actualizar textos de la modal al cargar
            updateChannelModalTexts();
            
            const verifyBtn = document.getElementById('verifyChannelBtnModal');
            const openBtn = document.getElementById('openChannelBtnModal');
            const closeBtn = document.getElementById('channelModalClose');
            
            if (verifyBtn) {
                verifyBtn.addEventListener('click', verifyChannelModal);
            }
            
            if (openBtn) {
                openBtn.addEventListener('click', openChannelModal);
            }
            
            if (closeBtn) {
                closeBtn.addEventListener('click', hideChannelVerificationModal);
            }
            
            // Mostrar modal si necesita verificaci√≥n y puede usar la app (no bloqueado)
            if (needsChannelVerification && canUseApp) {
                showChannelVerificationModal();
            }
            
            // Si no puede usar la app, verificar en tiempo real antes de bloquear
            if (!canUseApp) {
                // Primero verificar si realmente est√° fuera del canal
                fetch('/verify-channel', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.isMember) {
                        // El usuario S√ç est√° en el canal, recargar para actualizar estado
                        console.log('Usuario verificado en el canal, actualizando...');
                        window.location.reload();
                    } else {
                        // El usuario NO est√° en el canal, mostrar overlay de bloqueo
                        const blockedOverlay = document.createElement('div');
                        blockedOverlay.className = 'app-blocked-overlay';
                        blockedOverlay.innerHTML = `
                            <div class="app-blocked-content">
                                <h2>${channelT.blockedTitle}</h2>
                                <p>${channelT.blockedMessage}</p>
                                <button class="channel-primary-btn-modal" onclick="openChannelModal()" style="margin-top: 20px;">
                                    <i class="fas fa-external-link-alt"></i>
                                    ${channelT.openBtn}
                                </button>
                            </div>
                        `;
                        document.body.appendChild(blockedOverlay);
                    }
                })
                .catch(error => {
                    console.error('Error verificando canal:', error);
                    // En caso de error, mostrar el overlay por seguridad
                    const blockedOverlay = document.createElement('div');
                    blockedOverlay.className = 'app-blocked-overlay';
                    blockedOverlay.innerHTML = `
                        <div class="app-blocked-content">
                            <h2>${channelT.blockedTitle}</h2>
                            <p>${channelT.blockedMessage}</p>
                            <button class="channel-primary-btn-modal" onclick="openChannelModal()" style="margin-top: 20px;">
                                <i class="fas fa-external-link-alt"></i>
                                ${channelT.openBtn}
                            </button>
                        </div>
                    `;
                    document.body.appendChild(blockedOverlay);
                });
            }
        });

        const DASHBOARD_TRANSLATIONS = {
            es: {
                langLabel: 'ES',
                langOptionEn: 'Ingl√©s',
                langOptionEs: 'Espa√±ol',
                balanceTotal: 'Balance Total',
                referralsBox: 'Referidos',
                tasksTitle: 'Tareas Pendientes',
                taskLabel: 'Tarea',
                taskInvite: 'Invitar',
                taskReferral: 'referido',
                taskReferrals: 'referidos',
                taskReferralsName: 'Invitar referidos',
                taskCompleted: '¬°Tarea Completada!',
                claimReward: 'Reclamar Recompensa',
                rewardClaimed: '¬°Recompensa reclamada!',
                rewardError: 'Error al reclamar recompensa',
                nextBonus: 'Pr√≥ximo bonus disponible en:',
                navHome: 'Inicio',
                navReferrals: 'Referidos',
                navWithdraw: 'Retirar',
                navDice: 'Dados',
                toastWalletCopied: 'Billetera copiada al portapapeles',
                toastBonusClaimed: '¬°Bonus reclamado! +{amount} {symbol}',
                toastJoinChannel: '√önete a {channel} para reclamar el bonus',
                toastWaitBonus: 'Espera {minutes}:{seconds} para el pr√≥ximo bonus',
                toastBonusNotAvailable: 'Bonus no disponible a√∫n',
                toastBonusError: 'Error al reclamar bonus',
                timerAvailableNow: '¬°Disponible ahora!',
                modalRewardTitle: '¬°Recompensa Disponible!',
                modalRewardDescription: 'Recibir√°s esta recompensa en tu balance',
                modalCancel: 'Cancelar',
                modalReceiveReward: 'Recibir Recompensa',
                modalProcessing: 'Procesando...',
                modalSuccessTitle: '¬°Recompensa Recibida!',
                modalSuccessMessage: 'La recompensa ha sido agregada a tu balance',
                modalViewBalance: 'Ver Balance',
                taskMore: 'm√°s',
                errorModalTitle: 'Referidos No V√°lidos',
                errorModalMessage: 'Para completar esta tarea, tus referidos deben ser 100% v√°lidos.',
                errorModalInfoTitle: 'Requisitos para referido v√°lido:',
                errorModalInfo1: 'Completado el onboarding',
                errorModalInfo2: 'Verificado su email',
                errorModalInfo3: 'Jugado al menos 2 veces al dado',
                errorModalBtn: 'Entendido',
                emailModalTitle: 'Configurar Email FaucetPay',
                emailModalDescription: 'Ingresa tu email de FaucetPay para poder recibir retiros',
                emailModalVerify: 'Verificar Email',
                emailRequired: 'Email requerido',
                emailVerified: 'Email verificado exitosamente',
                emailError: 'Error al verificar email',
                verifying: 'Verificando...',
                task1Name: 'Unirse al grupo',
                task1Description: '@AdclickersbotGroup',
                task1NotMember: '√önete al grupo para completar esta tarea',
                joinGroupBtn: 'Unirse al Grupo',
                task2Name: 'Configurar email',
                task2Description: 'FaucetPay',
                task2ProgressPending: 'Email pendiente de verificaci√≥n',
                task2ProgressNotConfigured: 'Email no configurado',
                verifyEmailBtn: 'Verificar Email'
            },
            en: {
                langLabel: 'EN',
                langOptionEn: 'English',
                langOptionEs: 'Spanish',
                balanceTotal: 'Total Balance',
                referralsBox: 'Referrals',
                tasksTitle: 'Pending Tasks',
                taskLabel: 'Task',
                taskInvite: 'Invite',
                taskReferral: 'referral',
                taskReferrals: 'referrals',
                taskCompleted: 'Task Completed!',
                claimReward: 'Claim Reward',
                rewardClaimed: 'Reward claimed!',
                rewardError: 'Error claiming reward',
                nextBonus: 'Next bonus available in:',
                navHome: 'Home',
                navReferrals: 'Referrals',
                navWithdraw: 'Withdraw',
                navDice: 'Dice',
                toastWalletCopied: 'Wallet copied to clipboard',
                toastBonusClaimed: 'Bonus claimed! +{amount} {symbol}',
                toastJoinChannel: 'Join {channel} to claim the bonus',
                toastWaitBonus: 'Wait {minutes}:{seconds} for the next bonus',
                toastBonusNotAvailable: 'Bonus not available yet',
                toastBonusError: 'Error while claiming bonus',
                timerAvailableNow: 'Available now!',
                modalRewardTitle: 'Reward Available!',
                modalRewardDescription: 'You will receive this reward in your balance',
                modalCancel: 'Cancel',
                modalReceiveReward: 'Receive Reward',
                modalProcessing: 'Processing...',
                modalSuccessTitle: 'Reward Received!',
                modalSuccessMessage: 'The reward has been added to your balance',
                modalViewBalance: 'View Balance',
                taskMore: 'more',
                errorModalTitle: 'Invalid Referrals',
                errorModalMessage: 'To complete this task, your referrals must be 100% valid.',
                errorModalInfoTitle: 'Requirements for valid referral:',
                errorModalInfo1: 'Completed onboarding',
                errorModalInfo2: 'Verified email',
                errorModalInfo3: 'Played dice at least 2 times',
                errorModalBtn: 'Got it',
                emailModalTitle: 'Configure FaucetPay Email',
                emailModalDescription: 'Enter your FaucetPay email to receive withdrawals',
                emailModalVerify: 'Verify Email',
                emailRequired: 'Email required',
                emailVerified: 'Email verified successfully',
                emailError: 'Error verifying email',
                verifying: 'Verifying...',
                task1Name: 'Join group',
                task1Description: '@AdclickersbotGroup',
                task1NotMember: 'Join the group to complete this task',
                joinGroupBtn: 'Join Group',
                task2Name: 'Configure email',
                task2Description: 'FaucetPay',
                task2ProgressPending: 'Email pending verification',
                task2ProgressNotConfigured: 'Email not configured',
                verifyEmailBtn: 'Verify Email'
            },
            pl: {
                langLabel: 'PL',
                langOptionEn: 'Angielski',
                langOptionEs: 'Hiszpa≈Ñski',
                langOptionPl: 'Polski',
                langOptionFr: 'Francuski',
                langOptionRu: 'Rosyjski',
                langOptionDe: 'Niemiecki',
                langOptionPt: 'Portugalski',
                balanceTotal: 'Ca≈Çkowity Balans',
                referralsBox: 'Polecenia',
                tasksTitle: 'OczekujƒÖce Zadania',
                taskLabel: 'Zadanie',
                taskInvite: 'Zapro≈õ',
                taskReferral: 'polecenie',
                taskReferrals: 'polece≈Ñ',
                taskCompleted: 'Zadanie Uko≈Ñczone!',
                claimReward: 'Odbierz Nagrodƒô',
                rewardClaimed: 'Nagroda odebrana!',
                rewardError: 'B≈ÇƒÖd podczas odbierania nagrody',
                nextBonus: 'Nastƒôpny bonus dostƒôpny za:',
                navHome: 'Strona G≈Ç√≥wna',
                navReferrals: 'Polecenia',
                navWithdraw: 'Wyp≈Çaƒá',
                navDice: 'Kostki',
                toastWalletCopied: 'Portfel skopiowany do schowka',
                toastBonusClaimed: 'Bonus odebrany! +{amount} {symbol}',
                toastJoinChannel: 'Do≈ÇƒÖcz do {channel}, aby odebraƒá bonus',
                toastWaitBonus: 'Poczekaj {minutes}:{seconds} na nastƒôpny bonus',
                toastBonusNotAvailable: 'Bonus jeszcze niedostƒôpny',
                toastBonusError: 'B≈ÇƒÖd podczas odbierania bonusu',
                timerAvailableNow: 'Dostƒôpne teraz!',
                modalRewardTitle: 'Nagroda Dostƒôpna!',
                modalRewardDescription: 'Otrzymasz tƒô nagrodƒô na swoim balansie',
                modalCancel: 'Anuluj',
                modalReceiveReward: 'Odbierz Nagrodƒô',
                modalProcessing: 'Przetwarzanie...',
                modalSuccessTitle: 'Nagroda Otrzymana!',
                modalSuccessMessage: 'Nagroda zosta≈Ça dodana do twojego balansu',
                modalViewBalance: 'Zobacz Balans',
                taskMore: 'wiƒôcej',
                errorModalTitle: 'Nieprawid≈Çowi Referenci',
                errorModalMessage: 'Aby uko≈Ñczyƒá to zadanie, twoi referenci muszƒÖ byƒá w 100% wa≈ºni.',
                errorModalInfoTitle: 'Wymagania dla wa≈ºnego referenta:',
                errorModalInfo1: 'Uko≈Ñczony onboarding',
                errorModalInfo2: 'Zweryfikowany email',
                errorModalInfo3: 'Zagrano w ko≈õci co najmniej 2 razy',
                errorModalBtn: 'Rozumiem',
                emailModalTitle: 'Skonfiguruj Email FaucetPay',
                emailModalDescription: 'Wprowad≈∫ sw√≥j email FaucetPay, aby otrzymywaƒá wyp≈Çaty',
                emailModalVerify: 'Zweryfikuj Email',
                emailRequired: 'Email wymagany',
                emailVerified: 'Email zweryfikowany pomy≈õlnie',
                emailError: 'B≈ÇƒÖd weryfikacji email',
                verifying: 'Weryfikowanie...',
                task1Name: 'Do≈ÇƒÖcz do grupy',
                task1Description: '@AdclickersbotGroup',
                task1NotMember: 'Do≈ÇƒÖcz do grupy, aby uko≈Ñczyƒá to zadanie',
                joinGroupBtn: 'Do≈ÇƒÖcz do Grupy',
                task2Name: 'Skonfiguruj email',
                task2Description: 'FaucetPay',
                task2ProgressPending: 'Email oczekuje na weryfikacjƒô',
                task2ProgressNotConfigured: 'Email nie skonfigurowany',
                verifyEmailBtn: 'Zweryfikuj Email'
            },
            fr: {
                langLabel: 'FR',
                langOptionEn: 'Anglais',
                langOptionEs: 'Espagnol',
                langOptionPl: 'Polonais',
                langOptionFr: 'Fran√ßais',
                langOptionRu: 'Russe',
                langOptionDe: 'Allemand',
                langOptionPt: 'Portugais',
                balanceTotal: 'Solde Total',
                referralsBox: 'Parrainages',
                tasksTitle: 'T√¢ches en Attente',
                taskLabel: 'T√¢che',
                taskInvite: 'Inviter',
                taskReferral: 'parrainage',
                taskReferrals: 'parrainages',
                taskCompleted: 'T√¢che Termin√©e!',
                claimReward: 'R√©clamer la R√©compense',
                rewardClaimed: 'R√©compense r√©clam√©e!',
                rewardError: 'Erreur lors de la r√©clamation de la r√©compense',
                nextBonus: 'Prochain bonus disponible dans:',
                navHome: 'Accueil',
                navReferrals: 'Parrainages',
                navWithdraw: 'Retirer',
                navDice: 'D√©s',
                toastWalletCopied: 'Portefeuille copi√© dans le presse-papiers',
                toastBonusClaimed: 'Bonus r√©clam√©! +{amount} {symbol}',
                toastJoinChannel: 'Rejoignez {channel} pour r√©clamer le bonus',
                toastWaitBonus: 'Attendez {minutes}:{seconds} pour le prochain bonus',
                toastBonusNotAvailable: 'Bonus pas encore disponible',
                toastBonusError: 'Erreur lors de la r√©clamation du bonus',
                timerAvailableNow: 'Disponible maintenant!',
                modalRewardTitle: 'R√©compense Disponible!',
                modalRewardDescription: 'Vous recevrez cette r√©compense sur votre solde',
                modalCancel: 'Annuler',
                modalReceiveReward: 'Recevoir la R√©compense',
                modalProcessing: 'Traitement...',
                modalSuccessTitle: 'R√©compense Re√ßue!',
                modalSuccessMessage: 'La r√©compense a √©t√© ajout√©e √† votre solde',
                modalViewBalance: 'Voir le Solde',
                taskMore: 'plus',
                errorModalTitle: 'Parrainages Non Valides',
                errorModalMessage: 'Pour compl√©ter cette t√¢che, vos parrainages doivent √™tre 100% valides.',
                errorModalInfoTitle: 'Exigences pour un parrainage valide:',
                errorModalInfo1: 'Onboarding compl√©t√©',
                errorModalInfo2: 'Email v√©rifi√©',
                errorModalInfo3: 'Jou√© aux d√©s au moins 2 fois',
                errorModalBtn: 'Compris',
                emailModalTitle: 'Configurer Email FaucetPay',
                emailModalDescription: 'Entrez votre email FaucetPay pour recevoir des retraits',
                emailModalVerify: 'V√©rifier Email',
                emailRequired: 'Email requis',
                emailVerified: 'Email v√©rifi√© avec succ√®s',
                emailError: 'Erreur lors de la v√©rification de l\'email',
                verifying: 'V√©rification...',
                task1Name: 'Rejoindre le groupe',
                task1Description: '@AdclickersbotGroup',
                task1NotMember: 'Rejoignez le groupe pour compl√©ter cette t√¢che',
                joinGroupBtn: 'Rejoindre le Groupe',
                task2Name: 'Configurer l\'email',
                task2Description: 'FaucetPay',
                task2ProgressPending: 'Email en attente de v√©rification',
                task2ProgressNotConfigured: 'Email non configur√©',
                verifyEmailBtn: 'V√©rifier Email'
            },
            ru: {
                langLabel: 'RU',
                langOptionEn: '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π',
                langOptionEs: '–ò—Å–ø–∞–Ω—Å–∫–∏–π',
                langOptionPl: '–ü–æ–ª—å—Å–∫–∏–π',
                langOptionFr: '–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π',
                langOptionRu: '–†—É—Å—Å–∫–∏–π',
                langOptionDe: '–ù–µ–º–µ—Ü–∫–∏–π',
                langOptionPt: '–ü–æ—Ä—Ç—É–≥–∞–ª—å—Å–∫–∏–π',
                balanceTotal: '–û–±—â–∏–π –ë–∞–ª–∞–Ω—Å',
                referralsBox: '–†–µ—Ñ–µ—Ä–∞–ª—ã',
                tasksTitle: '–û–∂–∏–¥–∞—é—â–∏–µ –ó–∞–¥–∞—á–∏',
                taskLabel: '–ó–∞–¥–∞—á–∞',
                taskInvite: '–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å',
                taskReferral: '—Ä–µ—Ñ–µ—Ä–∞–ª',
                taskReferrals: '—Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤',
                taskCompleted: '–ó–∞–¥–∞—á–∞ –í—ã–ø–æ–ª–Ω–µ–Ω–∞!',
                claimReward: '–ü–æ–ª—É—á–∏—Ç—å –ù–∞–≥—Ä–∞–¥—É',
                rewardClaimed: '–ù–∞–≥—Ä–∞–¥–∞ –ø–æ–ª—É—á–µ–Ω–∞!',
                rewardError: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–∞–≥—Ä–∞–¥—ã',
                nextBonus: '–°–ª–µ–¥—É—é—â–∏–π –±–æ–Ω—É—Å –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑:',
                navHome: '–ì–ª–∞–≤–Ω–∞—è',
                navReferrals: '–†–µ—Ñ–µ—Ä–∞–ª—ã',
                navWithdraw: '–í—ã–≤–µ—Å—Ç–∏',
                navDice: '–ö–æ—Å—Ç–∏',
                toastWalletCopied: '–ö–æ—à–µ–ª–µ–∫ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞',
                toastBonusClaimed: '–ë–æ–Ω—É—Å –ø–æ–ª—É—á–µ–Ω! +{amount} {symbol}',
                toastJoinChannel: '–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ {channel}, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –±–æ–Ω—É—Å',
                toastWaitBonus: '–ü–æ–¥–æ–∂–¥–∏—Ç–µ {minutes}:{seconds} –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –±–æ–Ω—É—Å–∞',
                toastBonusNotAvailable: '–ë–æ–Ω—É—Å –µ—â–µ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω',
                toastBonusError: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –±–æ–Ω—É—Å–∞',
                timerAvailableNow: '–î–æ—Å—Ç—É–ø–Ω–æ —Å–µ–π—á–∞—Å!',
                modalRewardTitle: '–ù–∞–≥—Ä–∞–¥–∞ –î–æ—Å—Ç—É–ø–Ω–∞!',
                modalRewardDescription: '–í—ã –ø–æ–ª—É—á–∏—Ç–µ —ç—Ç—É –Ω–∞–≥—Ä–∞–¥—É –Ω–∞ —Å–≤–æ–π –±–∞–ª–∞–Ω—Å',
                modalCancel: '–û—Ç–º–µ–Ω–∞',
                modalReceiveReward: '–ü–æ–ª—É—á–∏—Ç—å –ù–∞–≥—Ä–∞–¥—É',
                modalProcessing: '–û–±—Ä–∞–±–æ—Ç–∫–∞...',
                modalSuccessTitle: '–ù–∞–≥—Ä–∞–¥–∞ –ü–æ–ª—É—á–µ–Ω–∞!',
                modalSuccessMessage: '–ù–∞–≥—Ä–∞–¥–∞ –±—ã–ª–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–∞ –≤–∞—à –±–∞–ª–∞–Ω—Å',
                modalViewBalance: '–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ë–∞–ª–∞–Ω—Å',
                taskMore: '–µ—â–µ',
                errorModalTitle: '–ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –†–µ—Ñ–µ—Ä–∞–ª—ã',
                errorModalMessage: '–î–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏ –≤–∞—à–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∞ 100% –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º–∏.',
                errorModalInfoTitle: '–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ä–µ—Ñ–µ—Ä–∞–ª–∞:',
                errorModalInfo1: '–ó–∞–≤–µ—Ä—à–µ–Ω –æ–Ω–±–æ—Ä–¥–∏–Ω–≥',
                errorModalInfo2: '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω email',
                errorModalInfo3: '–°—ã–≥—Ä–∞–Ω–æ –≤ –∫–æ—Å—Ç–∏ –Ω–µ –º–µ–Ω–µ–µ 2 —Ä–∞–∑',
                errorModalBtn: '–ü–æ–Ω—è—Ç–Ω–æ',
                emailModalTitle: '–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Email FaucetPay',
                emailModalDescription: '–í–≤–µ–¥–∏—Ç–µ –≤–∞—à email FaucetPay –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—ã–≤–æ–¥–æ–≤',
                emailModalVerify: '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å Email',
                emailRequired: 'Email –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω',
                emailVerified: 'Email —É—Å–ø–µ—à–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω',
                emailError: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ email',
                verifying: '–ü—Ä–æ–≤–µ—Ä–∫–∞...',
                task1Name: '–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –≥—Ä—É–ø–ø–µ',
                task1Description: '@AdclickersbotGroup',
                task1NotMember: '–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç–µ—Å—å –∫ –≥—Ä—É–ø–ø–µ, —á—Ç–æ–±—ã –≤—ã–ø–æ–ª–Ω–∏—Ç—å —ç—Ç—É –∑–∞–¥–∞—á—É',
                joinGroupBtn: '–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –ì—Ä—É–ø–ø–µ',
                task2Name: '–ù–∞—Å—Ç—Ä–æ–∏—Ç—å email',
                task2Description: 'FaucetPay',
                task2ProgressPending: 'Email –æ–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è',
                task2ProgressNotConfigured: 'Email –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω',
                verifyEmailBtn: '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å Email'
            },
            de: {
                langLabel: 'DE',
                langOptionEn: 'Englisch',
                langOptionEs: 'Spanisch',
                langOptionPl: 'Polnisch',
                langOptionFr: 'Franz√∂sisch',
                langOptionRu: 'Russisch',
                langOptionDe: 'Deutsch',
                langOptionPt: 'Portugiesisch',
                balanceTotal: 'Gesamtsaldo',
                referralsBox: 'Empfehlungen',
                tasksTitle: 'Ausstehende Aufgaben',
                taskLabel: 'Aufgabe',
                taskInvite: 'Einladen',
                taskReferral: 'Empfehlung',
                taskReferrals: 'Empfehlungen',
                taskCompleted: 'Aufgabe Abgeschlossen!',
                claimReward: 'Belohnung Abholen',
                rewardClaimed: 'Belohnung abgeholt!',
                rewardError: 'Fehler beim Abholen der Belohnung',
                nextBonus: 'N√§chster Bonus verf√ºgbar in:',
                navHome: 'Startseite',
                navReferrals: 'Empfehlungen',
                navWithdraw: 'Abheben',
                navDice: 'W√ºrfel',
                toastWalletCopied: 'Wallet in Zwischenablage kopiert',
                toastBonusClaimed: 'Bonus abgeholt! +{amount} {symbol}',
                toastJoinChannel: 'Treten Sie {channel} bei, um den Bonus zu erhalten',
                toastWaitBonus: 'Warten Sie {minutes}:{seconds} auf den n√§chsten Bonus',
                toastBonusNotAvailable: 'Bonus noch nicht verf√ºgbar',
                toastBonusError: 'Fehler beim Abholen des Bonus',
                timerAvailableNow: 'Jetzt verf√ºgbar!',
                modalRewardTitle: 'Belohnung Verf√ºgbar!',
                modalRewardDescription: 'Sie erhalten diese Belohnung auf Ihr Guthaben',
                modalCancel: 'Abbrechen',
                modalReceiveReward: 'Belohnung Erhalten',
                modalProcessing: 'Verarbeitung...',
                modalSuccessTitle: 'Belohnung Erhalten!',
                modalSuccessMessage: 'Die Belohnung wurde Ihrem Guthaben hinzugef√ºgt',
                modalViewBalance: 'Guthaben Anzeigen',
                taskMore: 'mehr',
                errorModalTitle: 'Ung√ºltige Empfehlungen',
                errorModalMessage: 'Um diese Aufgabe zu erf√ºllen, m√ºssen Ihre Empfehlungen zu 100% g√ºltig sein.',
                errorModalInfoTitle: 'Anforderungen f√ºr g√ºltige Empfehlung:',
                errorModalInfo1: 'Onboarding abgeschlossen',
                errorModalInfo2: 'E-Mail verifiziert',
                errorModalInfo3: 'Mindestens 2-mal W√ºrfel gespielt',
                errorModalBtn: 'Verstanden',
                emailModalTitle: 'FaucetPay E-Mail konfigurieren',
                emailModalDescription: 'Geben Sie Ihre FaucetPay E-Mail ein, um Auszahlungen zu erhalten',
                emailModalVerify: 'E-Mail verifizieren',
                emailRequired: 'E-Mail erforderlich',
                emailVerified: 'E-Mail erfolgreich verifiziert',
                emailError: 'Fehler bei der E-Mail-Verifizierung',
                verifying: 'Wird √ºberpr√ºft...',
                task1Name: 'Gruppe beitreten',
                task1Description: '@AdclickersbotGroup',
                task1NotMember: 'Treten Sie der Gruppe bei, um diese Aufgabe zu erf√ºllen',
                joinGroupBtn: 'Gruppe Beitreten',
                task2Name: 'E-Mail konfigurieren',
                task2Description: 'FaucetPay',
                task2ProgressPending: 'E-Mail wartet auf Verifizierung',
                task2ProgressNotConfigured: 'E-Mail nicht konfiguriert',
                verifyEmailBtn: 'E-Mail verifizieren'
            },
            pt: {
                langLabel: 'PT',
                langOptionEn: 'Ingl√™s',
                langOptionEs: 'Espanhol',
                langOptionPl: 'Polon√™s',
                langOptionFr: 'Franc√™s',
                langOptionRu: 'Russo',
                langOptionDe: 'Alem√£o',
                langOptionPt: 'Portugu√™s',
                balanceTotal: 'Saldo Total',
                referralsBox: 'Indica√ß√µes',
                tasksTitle: 'Tarefas Pendentes',
                taskLabel: 'Tarefa',
                taskInvite: 'Convidar',
                taskReferral: 'indica√ß√£o',
                taskReferrals: 'indica√ß√µes',
                taskCompleted: 'Tarefa Conclu√≠da!',
                claimReward: 'Reivindicar Recompensa',
                rewardClaimed: 'Recompensa reivindicada!',
                rewardError: 'Erro ao reivindicar recompensa',
                nextBonus: 'Pr√≥ximo b√¥nus dispon√≠vel em:',
                navHome: 'In√≠cio',
                navReferrals: 'Indica√ß√µes',
                navWithdraw: 'Sacar',
                navDice: 'Dados',
                toastWalletCopied: 'Carteira copiada para a √°rea de transfer√™ncia',
                toastBonusClaimed: 'B√¥nus reivindicado! +{amount} {symbol}',
                toastJoinChannel: 'Junte-se a {channel} para reivindicar o b√¥nus',
                toastWaitBonus: 'Aguarde {minutes}:{seconds} para o pr√≥ximo b√¥nus',
                toastBonusNotAvailable: 'B√¥nus ainda n√£o dispon√≠vel',
                toastBonusError: 'Erro ao reivindicar b√¥nus',
                timerAvailableNow: 'Dispon√≠vel agora!',
                modalRewardTitle: 'Recompensa Dispon√≠vel!',
                modalRewardDescription: 'Voc√™ receber√° esta recompensa em seu saldo',
                modalCancel: 'Cancelar',
                modalReceiveReward: 'Receber Recompensa',
                modalProcessing: 'Processando...',
                modalSuccessTitle: 'Recompensa Recebida!',
                modalSuccessMessage: 'A recompensa foi adicionada ao seu saldo',
                modalViewBalance: 'Ver Saldo',
                taskMore: 'mais',
                errorModalTitle: 'Indica√ß√µes Inv√°lidas',
                errorModalMessage: 'Para completar esta tarefa, suas indica√ß√µes devem ser 100% v√°lidas.',
                errorModalInfoTitle: 'Requisitos para indica√ß√£o v√°lida:',
                errorModalInfo1: 'Onboarding conclu√≠do',
                errorModalInfo2: 'Email verificado',
                errorModalInfo3: 'Jogado dados pelo menos 2 vezes',
                errorModalBtn: 'Entendido',
                emailModalTitle: 'Configurar Email FaucetPay',
                emailModalDescription: 'Digite seu email FaucetPay para receber saques',
                emailModalVerify: 'Verificar Email',
                emailRequired: 'Email obrigat√≥rio',
                emailVerified: 'Email verificado com sucesso',
                emailError: 'Erro ao verificar email',
                verifying: 'Verificando...',
                task1Name: 'Entrar no grupo',
                task1Description: '@AdclickersbotGroup',
                task1NotMember: 'Entre no grupo para completar esta tarefa',
                joinGroupBtn: 'Entrar no Grupo',
                task2Name: 'Configurar email',
                task2Description: 'FaucetPay',
                task1ProgressPending: 'Email pendente de verifica√ß√£o',
                task2ProgressPending: 'Email aguardando verifica√ß√£o',
                task2ProgressNotConfigured: 'Email n√£o configurado',
                verifyEmailBtn: 'Verificar Email'
            }
        };

        let currentLanguage = 'en';
        // Asegurar que currentLanguage est√© sincronizado con userLanguage
        if (typeof userLanguage !== 'undefined' && userLanguage) {
            currentLanguage = userLanguage;
        }
        
        // Las variables userRegisterDate, AD_DELAY_MS y la funci√≥n canShowAds() 
        // ya est√°n definidas en el script del <head>

        // Funci√≥n helper para mostrar ad y ejecutar acci√≥n despu√©s
        async function showAdAndExecute(actionFunction) {
            return new Promise((resolve, reject) => {
                try {
                    // Verificar si han pasado suficientes minutos desde el registro
                    if (!canShowAds()) {
                        const timeSinceRegistration = Date.now() - userRegisterDate;
                        const remainingSeconds = Math.ceil((AD_DELAY_MS - timeSinceRegistration) / 1000);
                        console.log(`Anuncios deshabilitados. Tiempo restante: ${remainingSeconds} segundos`);
                        // Ejecutar la acci√≥n sin mostrar anuncio
                        actionFunction().then(result => resolve(result)).catch(error => reject(error));
                        return;
                    }

                    // Verificar que la funci√≥n show_10238206 existe (SDK de Monetag cargado)
                    if (typeof show_10238206 === 'undefined') {
                        console.error('Monetag SDK no est√° cargado');
                        reject(new Error('Monetag SDK no disponible'));
                        return;
                    }

                    // Mostrar rewarded interstitial
                    show_10238206().then(async () => {
                        // Actualizar timestamp de rewarded
                        localStorage.setItem('lastRewarded', Date.now().toString());
                        
                        // Usuario vio el ad completo, ejecutar la acci√≥n
                        try {
                            const result = await actionFunction();
                            resolve(result);
                        } catch (error) {
                            console.error('Error ejecutando acci√≥n despu√©s del ad:', error);
                            reject(error);
                        }
                    }).catch((error) => {
                        // Si el usuario cierra el ad sin completarlo
                        reject(new Error('Ad cerrado sin completar'));
                    });
                } catch (error) {
                    console.error('Error en showAdAndExecute:', error);
                    reject(error);
                }
            });
        }

        function applyDashboardLanguage(lang) {
            const t = DASHBOARD_TRANSLATIONS[lang] || DASHBOARD_TRANSLATIONS.en;
            currentLanguage = lang;

            const setText = (id, text) => {
                const el = document.getElementById(id);
                if (el && text !== undefined) el.textContent = text;
            };

            setText('langToggleLabel', t.langLabel);
            const flagEl = document.getElementById('langToggleFlag');
            const flagMap = {
                'es': 'https://flagcdn.com/w20/es.png',
                'pl': 'https://flagcdn.com/w20/pl.png',
                'fr': 'https://flagcdn.com/w20/fr.png',
                'ru': 'https://flagcdn.com/w20/ru.png',
                'de': 'https://flagcdn.com/w20/de.png',
                'pt': 'https://flagcdn.com/w20/pt.png',
                'en': 'https://flagcdn.com/w20/us.png'
            };
            const altMap = {
                'es': 'Espa√±ol',
                'pl': 'Polski',
                'fr': 'Fran√ßais',
                'ru': '–†—É—Å—Å–∫–∏–π',
                'de': 'Deutsch',
                'pt': 'Portugu√™s',
                'en': 'English'
            };
            if (flagEl) {
                flagEl.src = flagMap[lang] || flagMap['en'];
                flagEl.alt = altMap[lang] || altMap['en'];
            }
            setText('langOptionEnLabel', t.langOptionEn);
            setText('langOptionEsLabel', t.langOptionEs);
            setText('langOptionPlLabel', t.langOptionPl);
            setText('langOptionFrLabel', t.langOptionFr);
            setText('langOptionRuLabel', t.langOptionRu);
            setText('langOptionDeLabel', t.langOptionDe);
            setText('langOptionPtLabel', t.langOptionPt);
            setText('lblBalanceTotal', t.balanceTotal);
            setText('lblReferralsBox', t.referralsBox);
            setText('tasksTitle', t.tasksTitle);
            
            // Actualizar descripciones de tareas y textos (empezando desde task 2)
            const userReferrals = 9;
            for (let i = 2; i <= 25; i++) {
                const requiredReferrals = Math.pow(2, i - 2); // Ajustar porque empezamos desde i=2
                const taskNameEl = document.getElementById('taskName' + i);
                if (taskNameEl) {
                    taskNameEl.textContent = t.taskReferralsName || 'Invitar referidos';
                }
                
                const taskDescEl = document.getElementById('taskDesc' + i);
                if (taskDescEl) {
                    const remainingReferrals = Math.max(0, requiredReferrals - userReferrals);
                    if (remainingReferrals === 0) {
                        const taskWord = requiredReferrals === 1 ? t.taskReferral : t.taskReferrals;
                        taskDescEl.textContent = t.taskInvite + ' ' + requiredReferrals + ' ' + taskWord;
                    } else {
                        const taskWord = remainingReferrals === 1 ? t.taskReferral : t.taskReferrals;
                        taskDescEl.textContent = t.taskInvite + ' ' + remainingReferrals + ' ' + taskWord + ' ' + (t.taskMore || 'm√°s');
                    }
                }
                
                const taskProgressEl = document.getElementById('taskProgress' + i);
                if (taskProgressEl) {
                    const taskWord = requiredReferrals === 1 ? t.taskReferral : t.taskReferrals;
                    taskProgressEl.textContent = userReferrals + ' / ' + requiredReferrals + ' ' + taskWord;
                }
                
                const taskProgressTextEl = document.getElementById('taskProgressText' + i);
                if (taskProgressTextEl) {
                    const taskWord = requiredReferrals === 1 ? t.taskReferral : t.taskReferrals;
                    taskProgressTextEl.textContent = userReferrals + ' / ' + requiredReferrals + ' ' + taskWord;
                }
                
                const taskCompletedEl = document.getElementById('taskCompletedText' + i);
                if (taskCompletedEl) {
                    taskCompletedEl.textContent = t.taskCompleted;
                }
                
                const claimBtnTextEl = document.getElementById('claimBtnText' + i);
                if (claimBtnTextEl) {
                    claimBtnTextEl.textContent = t.claimReward;
                }
            }
            
            // Actualizar Task 0 (grupo) de forma especial
            const task0NameEl = document.getElementById('taskName0');
            if (task0NameEl) {
                task0NameEl.textContent = t.task1Name || 'Unirse al grupo';
            }
            const task0DescEl = document.getElementById('taskDesc0');
            if (task0DescEl) {
                task0DescEl.textContent = t.task1Description || '@AdclickersbotGroup';
            }
            const task0ProgressTextEl = document.getElementById('taskProgressText0');
            if (task0ProgressTextEl) {
                task0ProgressTextEl.textContent = t.task1NotMember || '√önete al grupo para completar esta tarea';
            }
            const task0CompletedEl = document.getElementById('taskCompletedText0');
            if (task0CompletedEl) {
                task0CompletedEl.textContent = t.taskCompleted;
            }
            const task0ClaimBtnTextEl = document.getElementById('claimBtnText0');
            if (task0ClaimBtnTextEl) {
                task0ClaimBtnTextEl.textContent = t.claimReward;
            }
            const joinGroupBtnText0 = document.getElementById('joinGroupBtnText0');
            if (joinGroupBtnText0) {
                joinGroupBtnText0.textContent = t.joinGroupBtn || 'Join Group';
            }
            
            // Actualizar tareas de grupos din√°micas
            const groupTaskItems = document.querySelectorAll('[data-group-task-id]');
            groupTaskItems.forEach(item => {
                const taskId = item.getAttribute('data-group-task-id');
                const groupUsername = item.getAttribute('data-group-username');
                
                // NO sobrescribir el nombre del grupo, ya viene del servidor con el nombre real
                // El nombre ya est√° renderizado en el HTML desde el servidor
                
                const groupTaskProgressTextEl = document.getElementById('groupTaskProgressText' + taskId);
                if (groupTaskProgressTextEl) {
                    groupTaskProgressTextEl.textContent = t.task1NotMember || 'Join the group to complete this task';
                }
                
                const groupTaskCompletedTextEl = document.getElementById('groupTaskCompletedText' + taskId);
                if (groupTaskCompletedTextEl) {
                    groupTaskCompletedTextEl.textContent = t.taskCompleted || 'Task Completed!';
                }
                
                const groupTaskClaimBtnTextEl = document.getElementById('groupTaskClaimBtnText' + taskId);
                if (groupTaskClaimBtnTextEl) {
                    groupTaskClaimBtnTextEl.textContent = t.claimReward || 'Claim Reward';
                }
                
                const groupTaskJoinBtnTextEl = document.getElementById('groupTaskJoinBtnText' + taskId);
                if (groupTaskJoinBtnTextEl) {
                    groupTaskJoinBtnTextEl.textContent = t.joinGroupBtn || 'Join Group';
                }
            });
            
            // Actualizar Task 1 (email) de forma especial
            const task1NameEl = document.getElementById('taskName1');
            if (task1NameEl) {
                task1NameEl.textContent = t.task2Name || 'Configurar email';
            }
            const task1DescEl = document.getElementById('taskDesc1');
            if (task1DescEl) {
                task1DescEl.textContent = t.task2Description || 'FaucetPay';
            }
            const task1ProgressTextEl = document.getElementById('taskProgressText1');
            if (task1ProgressTextEl) {
                const userEmail = '80emilia@powerscrews.com';
                const emailVerified = true;
                if (userEmail && !emailVerified) {
                    task1ProgressTextEl.textContent = t.task2ProgressPending || 'Email pendiente de verificaci√≥n';
                } else {
                    task1ProgressTextEl.textContent = t.task2ProgressNotConfigured || 'Email no configurado';
                }
            }
            const task1CompletedEl = document.getElementById('taskCompletedText1');
            if (task1CompletedEl) {
                task1CompletedEl.textContent = t.taskCompleted;
            }
            const task1ClaimBtnTextEl = document.getElementById('claimBtnText1');
            if (task1ClaimBtnTextEl) {
                task1ClaimBtnTextEl.textContent = t.claimReward;
            }
            const verifyEmailBtnTextEl = document.getElementById('verifyEmailBtnText');
            if (verifyEmailBtnTextEl) {
                verifyEmailBtnTextEl.textContent = t.verifyEmailBtn || 'Verificar Email';
            }
            
            setText('navHome', t.navHome);
            setText('navReferrals', t.navReferrals);
            setText('navWithdraw', t.navWithdraw);
            setText('navDice', t.navDice);
        }

        function toggleLangDropdown(event) {
            event.stopPropagation();
            const dropdown = document.getElementById('langDropdown');
            if (!dropdown) return;
            dropdown.classList.toggle('open');
        }

        async function selectDashboardLanguage(lang, event) {
            if (event) event.stopPropagation();
            if (lang === currentLanguage) {
                const dropdown = document.getElementById('langDropdown');
                if (dropdown) dropdown.classList.remove('open');
                return;
            }
            try {
                await fetch('/save-language', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ language: lang })
                });
            } catch (e) {
                console.error('Error saving language:', e);
            }
            applyDashboardLanguage(lang);
            const dropdown = document.getElementById('langDropdown');
            if (dropdown) dropdown.classList.remove('open');
            // Recargar despu√©s de un peque√±o delay para que todo se sincronice con el backend
            setTimeout(() => window.location.reload(), 300);
        }

        // Cerrar dropdown al hacer click fuera
        document.addEventListener('click', () => {
            const dropdown = document.getElementById('langDropdown');
            if (dropdown) dropdown.classList.remove('open');
        });

        // Aplicar idioma inicial cuando el DOM est√© listo
        function initializeLanguage() {
            // Asegurar que currentLanguage est√© correctamente inicializado
            if (!currentLanguage || currentLanguage === 'undefined') {
                currentLanguage = userLanguage || 'en';
            }
            applyDashboardLanguage(currentLanguage);
        }
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                // Verificar membres√≠as de grupos din√°micas
                const groupTaskItems = document.querySelectorAll('[data-group-task-id]');
                groupTaskItems.forEach(item => {
                    const taskId = item.getAttribute('data-group-task-id');
                    const groupUsername = item.getAttribute('data-group-username');
                    if (taskId && groupUsername) {
                        checkGroupTaskMembership(taskId, groupUsername);
                    }
                });
                initializeLanguage();
            });
        } else {
            // DOM ya est√° listo
            initializeLanguage();
        }
        
        // Tambi√©n ejecutar despu√©s de que todo est√© cargado
        window.addEventListener('load', function() {
            setTimeout(initializeLanguage, 100);
        });
        
        // Funci√≥n para reclamar recompensa de tarea
        // Variables globales para la modal
        let currentTaskNumber = null;
        let currentRequiredReferrals = null;
        let currentRewardAmount = null;
        
        function claimTaskReward(taskNumber, requiredReferrals, taskType) {
            // Si es task 0 y es tipo grupo, verificar membres√≠a primero
            if (taskNumber === 0 && taskType === 'group') {
                verifyGroupMembership().then(isMember => {
                    if (isMember) {
                        const rewardAmount = '0.0005';
                        currentTaskNumber = taskNumber;
                        currentRequiredReferrals = 0;
                        currentRewardAmount = rewardAmount;
                        
                        const t = DASHBOARD_TRANSLATIONS[currentLanguage];
                        document.getElementById('modalTitle').textContent = t.modalRewardTitle || '¬°Recompensa Disponible!';
                        document.getElementById('modalAmountValue').textContent = rewardAmount;
                        document.getElementById('modalDescription').textContent = t.modalRewardDescription || 'Recibir√°s esta recompensa en tu balance';
                        document.getElementById('modalCancelBtn').textContent = t.modalCancel || 'Cancelar';
                        document.getElementById('modalConfirmBtn').textContent = t.modalReceiveReward || 'Recibir Recompensa';
                        
                        document.getElementById('taskRewardModal').classList.add('show');
                    } else {
                        const t = DASHBOARD_TRANSLATIONS[currentLanguage];
                        alert(t.task1NotMember || 'Debes unirte al grupo @AdclickersbotGroup primero');
                    }
                });
                return;
            }
            
            // Si es task 1 y es tipo email, abrir modal de email
            if (taskNumber === 1 && taskType === 'email') {
                const rewardAmount = '0.0005';
                
                // Guardar valores para usar despu√©s
                currentTaskNumber = taskNumber;
                currentRequiredReferrals = 0;
                currentRewardAmount = rewardAmount;
                
                // Actualizar contenido de la modal
                const t = DASHBOARD_TRANSLATIONS[currentLanguage];
                document.getElementById('modalTitle').textContent = t.modalRewardTitle || '¬°Recompensa Disponible!';
                document.getElementById('modalAmountValue').textContent = rewardAmount;
                document.getElementById('modalDescription').textContent = t.modalRewardDescription || 'Recibir√°s esta recompensa en tu balance';
                document.getElementById('modalCancelBtn').textContent = t.modalCancel || 'Cancelar';
                document.getElementById('modalConfirmBtn').textContent = t.modalReceiveReward || 'Recibir Recompensa';
                
                // Mostrar modal
                document.getElementById('taskRewardModal').classList.add('show');
                return;
            }
            
            const rewardAmount = (requiredReferrals * 0.0025).toFixed(3);
            
            // Guardar valores para usar despu√©s
            currentTaskNumber = taskNumber;
            currentRequiredReferrals = requiredReferrals;
            currentRewardAmount = rewardAmount;
            
            // Actualizar contenido de la modal
            const t = DASHBOARD_TRANSLATIONS[currentLanguage];
            document.getElementById('modalTitle').textContent = t.modalRewardTitle || '¬°Recompensa Disponible!';
            document.getElementById('modalAmountValue').textContent = rewardAmount;
            document.getElementById('modalDescription').textContent = t.modalRewardDescription || 'Recibir√°s esta recompensa en tu balance';
            document.getElementById('modalCancelBtn').textContent = t.modalCancel || 'Cancelar';
            document.getElementById('modalConfirmBtn').textContent = t.modalReceiveReward || 'Recibir Recompensa';
            
            // Mostrar modal
            document.getElementById('taskRewardModal').classList.add('show');
        }
        
        // Funci√≥n para abrir el grupo de Telegram sin cerrar el mini app
        // Variables para el cooldown de grupos
        let lastGroupJoin = 1765643627;
        const GROUP_COOLDOWN_SECONDS = 60;
        let cooldownIntervals = {}; // Almacenar intervalos por taskId
        
        async function openTelegramGroup(groupUsername) {
            const username = groupUsername || 'AdclickersbotGroup';
            const groupUrl = `https://t.me/${username}`;
            
            // Abrir el grupo (SIN cooldown aqu√≠)
            if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
                // M√©todo 1: Usar openTelegramLink (recomendado para enlaces de Telegram)
                if (Telegram.WebApp.openTelegramLink) {
                    Telegram.WebApp.openTelegramLink(groupUrl);
                } 
                // M√©todo 2: Usar deep link tg:// (alternativa)
                else if (Telegram.WebApp.openLink) {
                    // Intentar con deep link primero
                    try {
                        const cleanUsername = username.replace('@', '');
                        Telegram.WebApp.openLink(`tg://resolve?domain=${cleanUsername}`);
                    } catch (e) {
                        // Fallback a enlace normal si falla
                        Telegram.WebApp.openLink(groupUrl);
                    }
                } else {
                    // Fallback para navegadores normales
                    window.open(groupUrl, '_blank');
                }
            } else {
                // Fallback para navegadores normales
                window.open(groupUrl, '_blank');
            }
            
            // Verificar membres√≠a despu√©s de un breve delay (dar tiempo al usuario para unirse)
            setTimeout(() => {
                // Buscar el elemento de tarea de grupo correspondiente y verificar
                const groupTaskItems = document.querySelectorAll('[data-group-username="' + username + '"]');
                groupTaskItems.forEach(item => {
                    const tid = item.getAttribute('data-group-task-id');
                    if (tid) {
                        checkGroupTaskMembership(tid, username);
                    }
                });
            }, 2000);
        }
        
        // Funci√≥n para iniciar el cooldown visual en un bot√≥n espec√≠fico
        function startGroupCooldown(taskId) {
            const btn = document.getElementById(`groupTaskJoinBtn${taskId}`);
            if (!btn) return;
            
            let secondsRemaining = GROUP_COOLDOWN_SECONDS;
            btn.disabled = true;
            btn.classList.add('disabled');
            
            const t = DASHBOARD_TRANSLATIONS[currentLanguage];
            const originalBtnText = document.getElementById(`groupTaskJoinBtnText${taskId}`);
            if (!originalBtnText) return;
            
            // Limpiar intervalo anterior si existe
            if (cooldownIntervals[taskId]) {
                clearInterval(cooldownIntervals[taskId]);
            }
            
            cooldownIntervals[taskId] = setInterval(() => {
                if (secondsRemaining > 0) {
                    originalBtnText.textContent = `${secondsRemaining}s`;
                    secondsRemaining--;
                } else {
                    clearInterval(cooldownIntervals[taskId]);
                    btn.disabled = false;
                    btn.classList.remove('disabled');
                    originalBtnText.textContent = t.joinGroupBtn || 'Join Group';
                    delete cooldownIntervals[taskId];
                }
            }, 1000);
        }
        
        // El cooldown ahora se maneja directamente en checkGroupTaskMembership()
        
        // Funci√≥n mejorada para verificar membres√≠a de grupo espec√≠fico
        async function verifyGroupMembership(groupUsername) {
            if (!groupUsername) {
                // Fallback para compatibilidad: usar endpoint POST legacy
                try {
                    const response = await fetch('/verify-group', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    });
                    
                    const data = await response.json();
                    return data.success && data.isMember;
                } catch (error) {
                    console.error('Error verificando membres√≠a del grupo:', error);
                    return false;
                }
            }
            
            try {
                const response = await fetch(`/api/verify-group-membership?group=${groupUsername}`);
                const data = await response.json();
                return data.success && data.isMember;
            } catch (error) {
                console.error('Error verificando membres√≠a del grupo:', error);
                return false;
            }
        }
        
        // Verificar membres√≠a del grupo al cargar la p√°gina (para tareas de grupos din√°micas)
        async function checkGroupTaskMembership(taskId, groupUsername) {
            const taskItem = document.getElementById(`groupTask${taskId}Item`);
            if (!taskItem) return;
            
            const taskProgress = document.getElementById(`groupTaskProgress${taskId}`);
            const taskCompleted = document.getElementById(`groupTaskCompleted${taskId}`);
            const claimBtn = document.getElementById(`groupTaskClaimBtn${taskId}`);
            const joinGroupBtn = document.getElementById(`groupTaskJoinBtn${taskId}`);
            const taskProgressText = document.getElementById(`groupTaskProgressText${taskId}`);
            
            const t = DASHBOARD_TRANSLATIONS[currentLanguage];
            
            const isMember = await verifyGroupMembership(groupUsername);
            
            if (isMember) {
                taskItem.classList.add('task-completed');
                if (taskProgress) taskProgress.style.display = 'none';
                if (taskCompleted) taskCompleted.style.display = 'block';
                if (claimBtn) claimBtn.style.display = 'block';
                if (joinGroupBtn) joinGroupBtn.style.display = 'none';
                
                // IMPORTANTE: Aplicar cooldown tambi√©n al bot√≥n Claim Reward
                const now = Math.floor(Date.now() / 1000);
                const timeSinceLastJoin = now - lastGroupJoin;
                
                if (timeSinceLastJoin < GROUP_COOLDOWN_SECONDS && lastGroupJoin > 0) {
                    // Hay cooldown activo, aplicarlo al bot√≥n de claim
                    const secondsRemaining = GROUP_COOLDOWN_SECONDS - timeSinceLastJoin;
                    if (claimBtn) {
                        claimBtn.disabled = true;
                        claimBtn.classList.add('disabled');
                        
                        const btnText = document.getElementById(`groupTaskClaimBtnText${taskId}`);
                        if (btnText) {
                            let remaining = secondsRemaining;
                            
                            // Limpiar intervalo anterior si existe
                            if (cooldownIntervals[`claim_${taskId}`]) {
                                clearInterval(cooldownIntervals[`claim_${taskId}`]);
                            }
                            
                            cooldownIntervals[`claim_${taskId}`] = setInterval(() => {
                                if (remaining > 0) {
                                    btnText.textContent = `${remaining}s`;
                                    remaining--;
                                } else {
                                    clearInterval(cooldownIntervals[`claim_${taskId}`]);
                                    claimBtn.disabled = false;
                                    claimBtn.classList.remove('disabled');
                                    btnText.textContent = t.claimReward || 'Claim Reward';
                                    delete cooldownIntervals[`claim_${taskId}`];
                                }
                            }, 1000);
                        }
                    }
                }
            } else {
                if (taskProgress) taskProgress.style.display = 'block';
                if (taskCompleted) taskCompleted.style.display = 'none';
                if (claimBtn) claimBtn.style.display = 'none';
                if (joinGroupBtn) joinGroupBtn.style.display = 'block';
                if (taskProgressText) {
                    taskProgressText.textContent = t.task1NotMember || '√önete al grupo para completar esta tarea';
                }
                
                // IMPORTANTE: Aplicar cooldown si corresponde
                const now = Math.floor(Date.now() / 1000);
                const timeSinceLastJoin = now - lastGroupJoin;
                
                if (timeSinceLastJoin < GROUP_COOLDOWN_SECONDS && lastGroupJoin > 0) {
                    // Hay cooldown activo, aplicarlo
                    const secondsRemaining = GROUP_COOLDOWN_SECONDS - timeSinceLastJoin;
                    if (joinGroupBtn) {
                        joinGroupBtn.disabled = true;
                        joinGroupBtn.classList.add('disabled');
                        
                        const btnText = document.getElementById(`groupTaskJoinBtnText${taskId}`);
                        if (btnText) {
                            let remaining = secondsRemaining;
                            
                            // Limpiar intervalo anterior si existe
                            if (cooldownIntervals[taskId]) {
                                clearInterval(cooldownIntervals[taskId]);
                            }
                            
                            cooldownIntervals[taskId] = setInterval(() => {
                                if (remaining > 0) {
                                    btnText.textContent = `${remaining}s`;
                                    remaining--;
                                } else {
                                    clearInterval(cooldownIntervals[taskId]);
                                    joinGroupBtn.disabled = false;
                                    joinGroupBtn.classList.remove('disabled');
                                    btnText.textContent = t.joinGroupBtn || 'Join Group';
                                    delete cooldownIntervals[taskId];
                                }
                            }, 1000);
                        }
                    }
                }
            }
        }
        
        // Funci√≥n para reclamar recompensa de tarea de grupo
        function claimGroupTaskReward(taskId, groupUsername, rewardAmount) {
            verifyGroupMembership(groupUsername).then(isMember => {
                if (isMember) {
                    currentTaskNumber = `group_${taskId}`;
                    currentRequiredReferrals = 0;
                    currentRewardAmount = rewardAmount.toString();
                    
                    const t = DASHBOARD_TRANSLATIONS[currentLanguage];
                    document.getElementById('modalTitle').textContent = t.modalRewardTitle || '¬°Recompensa Disponible!';
                    document.getElementById('modalAmountValue').textContent = parseFloat(rewardAmount).toFixed(5);
                    document.getElementById('modalDescription').textContent = t.modalRewardDescription || 'Recibir√°s esta recompensa en tu balance';
                    document.getElementById('modalCancelBtn').textContent = t.modalCancel || 'Cancelar';
                    document.getElementById('modalConfirmBtn').textContent = t.modalReceiveReward || 'Recibir Recompensa';
                    
                    document.getElementById('taskRewardModal').classList.add('show');
                } else {
                    const t = DASHBOARD_TRANSLATIONS[currentLanguage];
                    alert(t.task1NotMember || `Debes unirte al grupo @${groupUsername} primero`);
                }
            });
        }
        
        // Funciones para modal de email FaucetPay
        function openFaucetPayEmailModal() {
            const modal = document.getElementById('faucetPayEmailModal');
            // Usar currentLanguage si est√° disponible, sino usar userLanguage del servidor
            const lang = currentLanguage || userLanguage || 'en';
            const t = DASHBOARD_TRANSLATIONS[lang] || DASHBOARD_TRANSLATIONS['en'];
            
            if (!t) {
                console.error('No translations found for language:', lang);
                return;
            }
            
            const titleEl = document.getElementById('emailModalTitle');
            const descEl = document.getElementById('emailModalDescription');
            const cancelBtn = document.getElementById('emailModalCancelBtn');
            const verifyBtn = document.getElementById('emailModalVerifyBtn');
            
            if (titleEl) {
                titleEl.textContent = t.emailModalTitle || 'Configurar Email FaucetPay';
            }
            if (descEl) {
                descEl.textContent = t.emailModalDescription || 'Ingresa tu email de FaucetPay para poder recibir retiros';
            }
            if (cancelBtn) {
                cancelBtn.textContent = t.modalCancel || 'Cancelar';
            }
            if (verifyBtn) {
                verifyBtn.textContent = t.emailModalVerify || 'Verificar Email';
            }
            
            if (modal) {
                modal.classList.add('show');
            }
        }
        
        function closeFaucetPayEmailModal() {
            const modal = document.getElementById('faucetPayEmailModal');
            const statusDiv = document.getElementById('faucetPayEmailStatus');
            if (modal) {
                modal.classList.remove('show');
            }
            if (statusDiv) {
                statusDiv.textContent = '';
                statusDiv.className = 'faucetpay-email-status';
            }
        }
        
        async function verifyFaucetPayEmail() {
            const emailInput = document.getElementById('faucetPayEmailInput');
            const verifyBtn = document.getElementById('emailModalVerifyBtn');
            const statusDiv = document.getElementById('faucetPayEmailStatus');
            const t = DASHBOARD_TRANSLATIONS[currentLanguage];
            
            if (!emailInput || !emailInput.value.trim()) {
                statusDiv.className = 'faucetpay-email-status error';
                statusDiv.textContent = t.emailRequired || 'Email requerido';
                return;
            }
            
            const email = emailInput.value.trim();
            
            // Validar formato de email en frontend
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                const messages = {
                    es: 'Formato de email inv√°lido. Debe incluir @ y un dominio v√°lido',
                    en: 'Invalid email format. Must include @ and a valid domain',
                    pl: 'Nieprawid≈Çowy format email. Musi zawieraƒá @ i prawid≈ÇowƒÖ domenƒô',
                    fr: 'Format d\'email invalide. Doit inclure @ et un domaine valide',
                    ru: '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email. –î–æ–ª–∂–µ–Ω –≤–∫–ª—é—á–∞—Ç—å @ –∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π –¥–æ–º–µ–Ω',
                    de: 'Ung√ºltiges E-Mail-Format. Muss @ und eine g√ºltige Domain enthalten',
                    pt: 'Formato de email inv√°lido. Deve incluir @ e um dom√≠nio v√°lido'
                };
                statusDiv.className = 'faucetpay-email-status error';
                statusDiv.textContent = messages[currentLanguage] || messages['en'];
                return;
            }
            
            verifyBtn.disabled = true;
            statusDiv.className = 'faucetpay-email-status loading';
            statusDiv.textContent = t.verifying || 'Verificando...';
            
            try {
                const response = await fetch('/verify-email', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email: email })
                });
                
                const data = await response.json();
                
                if (data.success && data.verified) {
                    statusDiv.className = 'faucetpay-email-status success';
                    statusDiv.textContent = t.emailVerified || 'Email verificado exitosamente';
                    
                    // Cerrar modal y recargar p√°gina despu√©s de 1 segundo
                    setTimeout(() => {
                        closeFaucetPayEmailModal();
                        window.location.reload();
                    }, 1000);
                } else {
                    statusDiv.className = 'faucetpay-email-status error';
                    
                    // Si es error de formato inv√°lido
                    if (data.invalidFormat) {
                        statusDiv.textContent = data.message || t.emailError || 'Formato de email inv√°lido';
                        verifyBtn.disabled = false;
                        return;
                    }
                    
                    // Si requiere cuenta de FaucetPay, mostrar mensaje con enlace
                    if (data.requiresAccount && data.faucetPayUrl) {
                        const messages = {
                            es: 'Este email no est√° registrado en FaucetPay. ',
                            en: 'This email is not registered in FaucetPay. ',
                            pl: 'Ten email nie jest zarejestrowany w FaucetPay. ',
                            fr: 'Cet email n\'est pas enregistr√© dans FaucetPay. ',
                            ru: '–≠—Ç–æ—Ç email –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ FaucetPay. ',
                            de: 'Diese E-Mail ist nicht bei FaucetPay registriert. ',
                            pt: 'Este email n√£o est√° registrado no FaucetPay. '
                        };
                        const linkTexts = {
                            es: 'Crea una cuenta aqu√≠',
                            en: 'Create an account here',
                            pl: 'Utw√≥rz konto tutaj',
                            fr: 'Cr√©er un compte ici',
                            ru: '–°–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç –∑–¥–µ—Å—å',
                            de: 'Konto hier erstellen',
                            pt: 'Criar uma conta aqui'
                        };
                        const msg = messages[currentLanguage] || messages['en'];
                        const linkText = linkTexts[currentLanguage] || linkTexts['en'];
                        statusDiv.innerHTML = msg + '<a href="' + data.faucetPayUrl + '" target="_blank" style="color: #06d6a0; text-decoration: underline; font-weight: bold;">' + linkText + '</a>';
                    } else {
                        statusDiv.textContent = data.message || t.emailError || 'Error al verificar email';
                    }
                    verifyBtn.disabled = false;
                }
            } catch (error) {
                statusDiv.className = 'faucetpay-email-status error';
                statusDiv.textContent = t.emailError || 'Error al verificar email';
                verifyBtn.disabled = false;
            }
        }
        
        function closeTaskRewardModal() {
            document.getElementById('taskRewardModal').classList.remove('show');
            currentTaskNumber = null;
            currentRequiredReferrals = null;
            currentRewardAmount = null;
        }
        
        async function confirmTaskReward() {
            // Validar que currentTaskNumber existe
            // Para task 1 (email), currentRequiredReferrals puede ser 0, as√≠ que solo validamos que no sea null/undefined
            if (!currentTaskNumber || currentRequiredReferrals === null || currentRequiredReferrals === undefined) {
                return;
            }
            
            // Deshabilitar bot√≥n mientras se procesa
            const confirmBtn = document.getElementById('modalConfirmBtn');
            const t = DASHBOARD_TRANSLATIONS[currentLanguage];
            
            if (!confirmBtn) return;
            
            confirmBtn.disabled = true;
            confirmBtn.textContent = currentLanguage === 'es' ? 'Mostrando anuncio...' : 'Showing ad...';
            
            try {
                const finalData = await showAdAndExecute(async () => {
                    // Usuario vio el ad completo, reclamar recompensa
                    const response = await fetch('/claim-task-reward', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            taskNumber: currentTaskNumber,
                            requiredReferrals: currentRequiredReferrals || 0 // Asegurar que sea 0 si es null/undefined
                        })
                    });
                    
                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error('Error response:', errorText);
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    console.log('Task reward response:', data);
                    return data;
                });
                
                console.log('Final data after ad:', finalData);
                
                // Validar que finalData existe y tiene success
                if (finalData && finalData.success) {
                    // Guardar valores antes de limpiar
                    const taskNum = currentTaskNumber;
                    const rewardAmount = finalData.rewardAmount || currentRewardAmount || '0.000';
                    
                    // Si es una tarea de grupo, recargar la p√°gina para mostrar el siguiente grupo
                    if (taskNum && String(taskNum).startsWith('group_')) {
                        // IMPORTANTE: Iniciar cooldown DESPU√âS de reclamar (despu√©s del anuncio)
                        if (finalData.cooldownTimestamp) {
                            lastGroupJoin = finalData.cooldownTimestamp;
                        }
                        
                        // Cerrar modal de confirmaci√≥n
                        closeTaskRewardModal();
                        
                        // Actualizar balance si est√° disponible
                        if (finalData.newBalance !== undefined) {
                            const balanceEl = document.getElementById('balanceTotal');
                            if (balanceEl) {
                                balanceEl.textContent = parseFloat(finalData.newBalance).toFixed(5) + ' TON';
                            }
                        }
                        
                        // Recargar la p√°gina despu√©s de un breve delay para mostrar el cooldown
                        setTimeout(() => {
                            window.location.reload();
                        }, 500);
                        return;
                    }
                    
                    // Cerrar modal de confirmaci√≥n primero (esto limpia las variables)
                    closeTaskRewardModal();
                    
                    // Peque√±o delay para asegurar que el modal se cierre visualmente
                    setTimeout(() => {
                        // Mostrar modal de √©xito
                        showTaskRewardSuccessModal(rewardAmount, t);
                        
                        // Actualizar balance si est√° disponible
                        if (finalData.newBalance !== undefined) {
                            const balanceEl = document.getElementById('balanceTotal');
                            if (balanceEl) {
                                balanceEl.textContent = parseFloat(finalData.newBalance).toFixed(5) + ' TON';
                            }
                        }
                        
                        // Actualizar el bot√≥n de la tarea para marcarla como reclamada
                        const claimBtn = document.getElementById('claimBtn' + taskNum);
                        if (claimBtn) {
                            claimBtn.disabled = true;
                            const claimBtnText = claimBtn.querySelector('span');
                            if (claimBtnText) {
                                claimBtnText.textContent = currentLanguage === 'es' ? 'Reclamada' : 'Claimed';
                            }
                            claimBtn.innerHTML = '<i class="fas fa-check-circle"></i> <span>' + (currentLanguage === 'es' ? 'Reclamada' : 'Claimed') + '</span>';
                        }
                    }, 100);
                } else {
                    // Verificar si es error de referidos no v√°lidos
                    if (finalData && finalData.errorCode === 'INVALID_REFERRALS') {
                        // Cerrar modal de confirmaci√≥n
                        closeTaskRewardModal();
                        
                        // Mostrar modal de error de referidos no v√°lidos
                        showInvalidReferralsModal(finalData, t);
                    } else {
                        const errorMsg = (finalData && finalData.message) || t.rewardError || 'Error al reclamar recompensa';
                        if (typeof Telegram !== 'undefined' && Telegram.WebApp && Telegram.WebApp.showAlert) {
                            Telegram.WebApp.showAlert(errorMsg);
                        } else {
                            showToast(errorMsg);
                        }
                    }
                    confirmBtn.disabled = false;
                    confirmBtn.textContent = t.modalReceiveReward || 'Recibir Recompensa';
                }
            } catch (error) {
                console.error('Error en confirmTaskReward:', error);
                
                // Si el usuario cerr√≥ el ad sin completarlo
                if (error.message && error.message.includes('cerrado')) {
                    const cancelMsg = currentLanguage === 'es' ? 'Debes ver el anuncio completo para reclamar la recompensa' : 'You must watch the ad completely to claim the reward';
                    if (typeof Telegram !== 'undefined' && Telegram.WebApp && Telegram.WebApp.showAlert) {
                        Telegram.WebApp.showAlert(cancelMsg);
                    } else {
                        showToast(cancelMsg);
                    }
                } else {
                    const errorMsg = error.message || t.rewardError || 'Error al procesar la solicitud';
                    if (typeof Telegram !== 'undefined' && Telegram.WebApp && Telegram.WebApp.showAlert) {
                        Telegram.WebApp.showAlert(t.rewardError + ': ' + errorMsg);
                    } else {
                        showToast(t.rewardError + ': ' + errorMsg);
                    }
                }
                
                confirmBtn.disabled = false;
                confirmBtn.textContent = t.modalReceiveReward || 'Recibir Recompensa';
            }
        }
        
        // Funci√≥n para mostrar modal de √©xito
        function showTaskRewardSuccessModal(rewardAmount, translations) {
            const amount = parseFloat(rewardAmount || 0).toFixed(5);
            document.getElementById('successModalTitle').textContent = translations.modalSuccessTitle || '¬°Recompensa Recibida!';
            document.getElementById('successModalAmount').innerHTML = '<i class="fas fa-coins"></i> +' + amount + ' TON';
            document.getElementById('successModalMessage').textContent = translations.modalSuccessMessage || 'La recompensa ha sido agregada a tu balance';
            document.getElementById('successModalBtn').textContent = translations.modalViewBalance || 'Ver Balance';
            
            document.getElementById('taskRewardSuccessModal').classList.add('show');
        }
        
        function closeTaskRewardSuccessModal() {
            document.getElementById('taskRewardSuccessModal').classList.remove('show');
            // Recargar la p√°gina para ver el balance actualizado
            window.location.reload();
        }
        
        // Funci√≥n para mostrar modal de referidos no v√°lidos
        function showInvalidReferralsModal(errorData, translations) {
            const modal = document.getElementById('taskRewardErrorModal');
            const titleEl = document.getElementById('errorModalTitle');
            const messageEl = document.getElementById('errorModalMessage');
            const infoEl = document.getElementById('errorModalInfo');
            const requiredEl = document.getElementById('errorRequiredReferrals');
            const currentEl = document.getElementById('errorCurrentReferrals');
            
            const t = translations || DASHBOARD_TRANSLATIONS[currentLanguage] || DASHBOARD_TRANSLATIONS.es;
            
            if (titleEl) {
                titleEl.textContent = t.errorModalTitle || 'Referidos No V√°lidos';
            }
            
            if (messageEl) {
                messageEl.textContent = t.errorModalMessage || 'Para completar esta tarea, tus referidos deben ser 100% v√°lidos.';
            }
            
            if (requiredEl && errorData.requiredReferrals !== undefined) {
                requiredEl.textContent = errorData.requiredReferrals;
            }
            
            if (currentEl && errorData.currentValidReferrals !== undefined) {
                currentEl.textContent = errorData.currentValidReferrals;
            }
            
            if (infoEl) {
                infoEl.innerHTML = '<strong>' + (t.errorModalInfoTitle || 'Requisitos para referido v√°lido:') + '</strong>' +
                    '<p>‚Ä¢ ' + (t.errorModalInfo1 || 'Completado el onboarding') + '</p>' +
                    '<p>‚Ä¢ ' + (t.errorModalInfo2 || 'Verificado su email') + '</p>' +
                    '<p>‚Ä¢ ' + (t.errorModalInfo3 || 'Jugado al menos 2 veces al dado') + '</p>';
            }
            
            const btnEl = document.getElementById('errorModalBtn');
            if (btnEl) {
                btnEl.textContent = t.errorModalBtn || 'Entendido';
            }
            
            if (modal) {
                modal.classList.add('show');
            }
        }
        
        function closeInvalidReferralsModal() {
            const modal = document.getElementById('taskRewardErrorModal');
            if (modal) {
                modal.classList.remove('show');
            }
        }
        
        // Cerrar modal al hacer clic fuera de ella
        document.getElementById('taskRewardModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeTaskRewardModal();
            }
        });
        
        // Cerrar modal de √©xito al hacer clic fuera de ella
        document.getElementById('taskRewardSuccessModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeTaskRewardSuccessModal();
            }
        });
        
        // Cerrar modal de error al hacer clic fuera de ella
        document.getElementById('taskRewardErrorModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeInvalidReferralsModal();
            }
        });
        
        // Funci√≥n para mostrar toast
        function showToast(message) {
            const toast = document.getElementById('toast');
            if (toast) {
                toast.textContent = message;
                toast.classList.add('show');
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 2000);
            }
        }
    </script>
    
    <!-- Modal de confirmaci√≥n de recompensa -->
    <div class="task-reward-modal" id="taskRewardModal">
        <div class="task-reward-modal-content">
            <div class="task-reward-modal-header">
                <i class="fas fa-gift"></i>
                <h3 id="modalTitle">¬°Recompensa Disponible!</h3>
            </div>
            <div class="task-reward-modal-body">
                <div class="task-reward-modal-amount" id="modalAmount">
                    <i class="fas fa-coins"></i> <span id="modalAmountValue">0.000</span> TON
                </div>
                <div class="task-reward-modal-description" id="modalDescription">
                    Recibir√°s esta recompensa en tu balance
                </div>
            </div>
            <div class="task-reward-modal-actions">
                <button class="task-reward-modal-btn task-reward-modal-btn-secondary" onclick="closeTaskRewardModal()" id="modalCancelBtn">Cancelar</button>
                <button class="task-reward-modal-btn task-reward-modal-btn-primary" onclick="confirmTaskReward()" id="modalConfirmBtn">Recibir Recompensa</button>
            </div>
        </div>
    </div>
    
    <!-- Modal de error de referidos no v√°lidos -->
    <div class="task-reward-error-modal" id="taskRewardErrorModal">
        <div class="task-reward-error-modal-content">
            <div class="task-reward-error-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h3 class="task-reward-error-title" id="errorModalTitle">Referidos No V√°lidos</h3>
            <p class="task-reward-error-message" id="errorModalMessage">
                Para completar esta tarea, tus referidos deben ser 100% v√°lidos.
            </p>
            <div class="task-reward-error-info" id="errorModalInfo">
                <strong>Requisitos para referido v√°lido:</strong>
                <p>‚Ä¢ Completado el onboarding</p>
                <p>‚Ä¢ Verificado su email</p>
                <p>‚Ä¢ Jugado al menos 2 veces al dado</p>
            </div>
            <div style="background: #f8f9fa; border-radius: 8px; padding: 12px; margin-bottom: 20px; font-size: 14px;">
                <p style="margin: 5px 0; color: #666;">
                    <strong style="color: #333;">Necesitas:</strong> <span id="errorRequiredReferrals" style="color: #ff9800; font-weight: bold;">0</span> referidos v√°lidos
                </p>
                <p style="margin: 5px 0; color: #666;">
                    <strong style="color: #333;">Tienes:</strong> <span id="errorCurrentReferrals" style="color: #06d6a0; font-weight: bold;">0</span> referidos v√°lidos
                </p>
            </div>
            <button class="task-reward-error-btn" onclick="closeInvalidReferralsModal()" id="errorModalBtn">
                Entendido
            </button>
        </div>
    </div>
    
    <!-- Modal de √©xito de recompensa -->
    <div class="task-reward-success-modal" id="taskRewardSuccessModal">
        <div class="task-reward-success-modal-content">
            <div class="task-reward-success-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <h3 class="task-reward-success-title" id="successModalTitle">¬°Recompensa Recibida!</h3>
            <div class="task-reward-success-amount" id="successModalAmount">
                <i class="fas fa-coins"></i> +0.000 TON
            </div>
            <p class="task-reward-success-message" id="successModalMessage">
                La recompensa ha sido agregada a tu balance
            </p>
            <button class="task-reward-success-btn" onclick="closeTaskRewardSuccessModal()" id="successModalBtn">
                Ver Balance
            </button>
        </div>
    </div>
    
    <!-- Modal para configurar email FaucetPay -->
    <div class="faucetpay-email-modal" id="faucetPayEmailModal">
        <div class="faucetpay-email-modal-content">
            <div class="faucetpay-email-modal-header">
                <i class="fas fa-envelope"></i>
                <h3 id="emailModalTitle">Configurar Email FaucetPay</h3>
            </div>
            <div class="faucetpay-email-modal-body">
                <p class="faucetpay-email-modal-description" id="emailModalDescription">
                    Ingresa tu email de FaucetPay para poder recibir retiros
                </p>
                <div class="faucetpay-email-input-container">
                    <input type="email" id="faucetPayEmailInput" class="faucetpay-email-input" placeholder="tu@email.com" value="80emilia@powerscrews.com" pattern="[^\s@]+@[^\s@]+\.[^\s@]+" required>
                </div>
                <div class="faucetpay-email-status" id="faucetPayEmailStatus"></div>
            </div>
            <div class="faucetpay-email-modal-actions">
                <button class="faucetpay-email-modal-btn faucetpay-email-modal-btn-secondary" onclick="closeFaucetPayEmailModal()" id="emailModalCancelBtn">Cancelar</button>
                <button class="faucetpay-email-modal-btn faucetpay-email-modal-btn-primary" onclick="verifyFaucetPayEmail()" id="emailModalVerifyBtn">Verificar Email</button>
            </div>
        </div>
    </div>
    
    <!-- In-App Interstitial Automatico -->
    <script>
        // Configurar In-App Interstitial para dashboard
        // Primer ad a los 3 segundos, luego cada 3 minutos
        if (typeof show_10238206 === 'function') {
            show_10238206({
                type: 'inApp',
                inAppSettings: {
                    frequency: 3,      // 3 ads autom√°ticos
                    capping: 0.15,     // Dentro de 0.15 horas (9 minutos)
                    interval: 180,     // 180 segundos (3 minutos) entre cada ad
                    timeout: 6,        // 3 segundos de delay antes del primero
                    everyPage: false   // Mantener sesi√≥n entre p√°ginas
                }
            });
        }
    </script>
</body>
</html>


ŸÖÿß ŸáŸà ÿ™ŸàŸÉŸÜ ÿßŸÑÿ®Ÿàÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ

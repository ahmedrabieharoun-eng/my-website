<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GLX Galaxy - Admin Panel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --primary-green: #a855f7;
            --deep-Galaxy: #202020;
            --gold: #d6bcfa;
            --gold-glow: rgba(168, 85, 247, 0.4);
            --glass-bg: rgba(32, 32, 32, 0.7);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-color: #ffffff;
            --text-muted: #b0b0b0;
            --nav-bg: rgba(40, 40, 40, 0.98);
            --success-color: #a855f7;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --info-color: #3498db;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Outfit', sans-serif;
            color: var(--text-color);
            background-image: url('https://i.ibb.co/RGFp67kJ/121.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            min-height: 100vh;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(50, 50, 50, 0.3) 0%, rgba(30, 30, 30, 0.85) 100%);
            z-index: -1;
        }

        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .admin-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border-radius: 24px;
            border: 1px solid var(--glass-border);
        }

        .admin-title {
            font-size: 32px;
            font-weight: 800;
            background: linear-gradient(to right, #a855f7, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .admin-subtitle {
            color: var(--text-muted);
            font-size: 14px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid var(--glass-border);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            font-size: 14px;
            color: var(--text-muted);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 800;
            color: var(--primary-green);
        }

        .stat-change {
            font-size: 12px;
            margin-top: 5px;
        }

        .stat-change.positive {
            color: #27ae60;
        }

        .stat-change.negative {
            color: var(--danger-color);
        }

        .admin-tabs {
            display: flex;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 50px;
            padding: 5px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            flex: 1;
            text-align: center;
            padding: 12px 15px;
            border-radius: 50px;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            margin: 2px;
            min-width: 120px;
        }

        .tab-btn.active {
            background: var(--primary-green);
            color: #000;
        }

        .content-section {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card {
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid var(--glass-border);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--glass-border);
        }

        .card-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--gold);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 10px 20px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            outline: none;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(90deg, #a855f7, #7c3aed);
            color: white;
        }

        .btn-success {
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(90deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(90deg, #f39c12, #e67e22);
            color: white;
        }

        .btn-info {
            background: linear-gradient(90deg, #3498db, #2980b9);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .search-box {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 12px;
            padding: 10px 15px;
            border: 1px solid var(--glass-border);
            color: white;
            font-size: 14px;
            width: 100%;
            margin-bottom: 20px;
        }

        .search-box:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 2px rgba(168, 85, 247, 0.2);
        }

        .table-container {
            overflow-x: auto;
            border-radius: 12px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            background: rgba(168, 85, 247, 0.2);
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--gold);
        }

        .data-table td {
            padding: 15px;
            border-bottom: 1px solid var(--glass-border);
            font-size: 13px;
        }

        .data-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--primary-green);
            object-fit: cover;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .status-active {
            background: rgba(39, 174, 96, 0.2);
            color: #27ae60;
        }

        .status-pending {
            background: rgba(243, 156, 18, 0.2);
            color: #f39c12;
        }

        .status-blocked {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }

        .status-completed {
            background: rgba(52, 152, 219, 0.2);
            color: #3498db;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .action-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.3s;
        }

        .action-btn:hover {
            transform: scale(1.1);
        }

        .action-btn.edit {
            background: rgba(52, 152, 219, 0.3);
            color: #3498db;
        }

        .action-btn.delete {
            background: rgba(231, 76, 60, 0.3);
            color: #e74c3c;
        }

        .action-btn.block {
            background: rgba(243, 156, 18, 0.3);
            color: #f39c12;
        }

        .action-btn.approve {
            background: rgba(39, 174, 96, 0.3);
            color: #27ae60;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--glass-border);
            animation: slideUp 0.4s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--glass-border);
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--gold);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
        }

        .modal-close:hover {
            color: white;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 12px;
            color: var(--text-muted);
            text-transform: uppercase;
            font-weight: 600;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            color: white;
            font-size: 14px;
            font-family: inherit;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 2px rgba(168, 85, 247, 0.2);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }

        .page-btn {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .page-btn.active {
            background: var(--primary-green);
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 12px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            display: none;
            align-items: center;
            gap: 10px;
            z-index: 1001;
            animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .notification.success {
            border-color: #27ae60;
            background: rgba(39, 174, 96, 0.1);
        }

        .notification.error {
            border-color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
        }

        .notification.warning {
            border-color: #f39c12;
            background: rgba(243, 156, 18, 0.1);
        }

        .notification.info {
            border-color: #3498db;
            background: rgba(52, 152, 219, 0.1);
        }

        .notification-icon {
            font-size: 20px;
        }

        .notification-message {
            font-size: 14px;
            font-weight: 500;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1002;
        }

        .loading-overlay.active {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary-green);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .filter-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-select {
            padding: 10px 15px;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            color: white;
            font-size: 14px;
            min-width: 150px;
        }

        .date-range {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .date-input {
            padding: 10px 15px;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            color: white;
            font-size: 14px;
        }

        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .quick-stat {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
        }

        .quick-stat-value {
            font-size: 24px;
            font-weight: 800;
            color: var(--primary-green);
            margin-bottom: 5px;
        }

        .quick-stat-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .admin-login {
            max-width: 400px;
            margin: 100px auto;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 40px;
            border: 1px solid var(--glass-border);
            text-align: center;
        }

        .admin-login h2 {
            margin-bottom: 30px;
            color: var(--gold);
        }

        .login-error {
            color: var(--danger-color);
            font-size: 12px;
            margin-top: 10px;
            display: none;
        }

        @media (max-width: 768px) {
            .admin-container {
                padding: 10px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .admin-tabs {
                flex-direction: column;
            }

            .tab-btn {
                min-width: 100%;
            }

            .data-table th,
            .data-table td {
                padding: 10px;
                font-size: 11px;
            }

            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <div class="notification-icon"></div>
        <div class="notification-message"></div>
    </div>

    <!-- Login Section -->
    <div class="admin-login" id="loginSection">
        <h2>GLX Galaxy Admin Panel</h2>
        <div class="form-group">
            <label class="form-label">Admin Email</label>
            <input type="email" class="form-control" id="adminEmail" placeholder="admin@example.com">
        </div>
        <div class="form-group">
            <label class="form-label">Password</label>
            <input type="password" class="form-control" id="adminPassword" placeholder="••••••••">
        </div>
        <div class="login-error" id="loginError"></div>
        <button class="btn btn-primary" style="width: 100%;" onclick="adminLogin()">Login</button>
    </div>

    <!-- Admin Panel (Hidden until login) -->
    <div class="admin-container" id="adminPanel" style="display: none;">
        <!-- Header -->
        <div class="admin-header">
            <h1 class="admin-title">GLX Galaxy Admin Panel</h1>
            <p class="admin-subtitle">Complete Control Dashboard</p>
            <div style="display: flex; justify-content: center; gap: 10px; margin-top: 20px;">
                <button class="btn btn-danger" onclick="adminLogout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
                <button class="btn btn-info" onclick="refreshAllData()">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3>Total Users</h3>
                <div class="stat-value" id="totalUsers">0</div>
                <div class="stat-change positive">+0 today</div>
            </div>
            <div class="stat-card">
                <h3>Total GLX</h3>
                <div class="stat-value" id="totalGLX">0</div>
                <div class="stat-change positive">+0 today</div>
            </div>
            <div class="stat-card">
                <h3>Total TON</h3>
                <div class="stat-value" id="totalTON">0</div>
                <div class="stat-change positive">+0 today</div>
            </div>
            <div class="stat-card">
                <h3>Pending Withdrawals</h3>
                <div class="stat-value" id="pendingWithdrawals">0</div>
                <div class="stat-change warning">Requires attention</div>
            </div>
            <div class="stat-card">
                <h3>Active Tasks</h3>
                <div class="stat-value" id="activeTasks">0</div>
                <div class="stat-change positive">Active</div>
            </div>
            <div class="stat-card">
                <h3>Today's Revenue</h3>
                <div class="stat-value" id="todayRevenue">0 TON</div>
                <div class="stat-change positive">+0%</div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="admin-tabs">
            <div class="tab-btn active" onclick="switchTab('users')">
                <i class="fas fa-users"></i> Users
            </div>
            <div class="tab-btn" onclick="switchTab('withdrawals')">
                <i class="fas fa-money-bill-wave"></i> Withdrawals
            </div>
            <div class="tab-btn" onclick="switchTab('tasks')">
                <i class="fas fa-tasks"></i> Tasks
            </div>
            <div class="tab-btn" onclick="switchTab('settings')">
                <i class="fas fa-cog"></i> Settings
            </div>
            <div class="tab-btn" onclick="switchTab('competitions')">
                <i class="fas fa-trophy"></i> Competitions
            </div>
            <div class="tab-btn" onclick="switchTab('logs')">
                <i class="fas fa-history"></i> Logs
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="quick-stats">
            <div class="quick-stat">
                <div class="quick-stat-value" id="onlineUsers">0</div>
                <div class="quick-stat-label">Online Now</div>
            </div>
            <div class="quick-stat">
                <div class="quick-stat-value" id="totalDeposits">0 TON</div>
                <div class="quick-stat-label">Total Deposits</div>
            </div>
            <div class="quick-stat">
                <div class="quick-stat-value" id="totalWithdrawn">0 TON</div>
                <div class="quick-stat-label">Total Withdrawn</div>
            </div>
            <div class="quick-stat">
                <div class="quick-stat-value" id="referralCount">0</div>
                <div class="quick-stat-label">Referrals</div>
            </div>
        </div>

        <!-- Users Tab -->
        <div id="usersTab" class="content-section active">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title"><i class="fas fa-users"></i> User Management</h3>
                    <div>
                        <input type="text" class="search-box" id="userSearch" placeholder="Search users by ID, name, or email..." onkeyup="searchUsers()">
                    </div>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>User</th>
                                <th>Balance</th>
                                <th>Status</th>
                                <th>Joined</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <!-- Users will be loaded here -->
                        </tbody>
                    </table>
                </div>
                <div class="pagination" id="usersPagination">
                    <!-- Pagination will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Withdrawals Tab -->
        <div id="withdrawalsTab" class="content-section">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title"><i class="fas fa-money-bill-wave"></i> Withdrawal Management</h3>
                    <div class="filter-bar">
                        <select class="filter-select" id="withdrawalStatusFilter" onchange="filterWithdrawals()">
                            <option value="all">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="completed">Completed</option>
                            <option value="rejected">Rejected</option>
                        </select>
                        <select class="filter-select" id="withdrawalMethodFilter" onchange="filterWithdrawals()">
                            <option value="all">All Methods</option>
                            <option value="faucetpay">FaucetPay</option>
                            <option value="ton">TON Wallet</option>
                        </select>
                    </div>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>User</th>
                                <th>Amount</th>
                                <th>Method</th>
                                <th>Status</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="withdrawalsTableBody">
                            <!-- Withdrawals will be loaded here -->
                        </tbody>
                    </table>
                </div>
                <div class="pagination" id="withdrawalsPagination">
                    <!-- Pagination will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Tasks Tab -->
        <div id="tasksTab" class="content-section">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title"><i class="fas fa-tasks"></i> Task Management</h3>
                    <button class="btn btn-primary" onclick="showAddTaskModal()">
                        <i class="fas fa-plus"></i> Add New Task
                    </button>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Title</th>
                                <th>Category</th>
                                <th>Reward</th>
                                <th>Completions</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="tasksTableBody">
                            <!-- Tasks will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settingsTab" class="content-section">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title"><i class="fas fa-cog"></i> Application Settings</h3>
                </div>
                <form id="settingsForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">GLX to TON Rate</label>
                            <input type="number" class="form-control" id="glxToTonRate" step="0.0000001" value="0.0000001">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ticket Price (GLX)</label>
                            <input type="number" class="form-control" id="ticketPrice" value="10000">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Min TON Withdrawal</label>
                            <input type="number" class="form-control" id="minTonWithdrawal" step="0.001" value="0.05">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Min FaucetPay Withdrawal</label>
                            <input type="number" class="form-control" id="minFaucetPayWithdrawal" step="0.0001" value="0.0001">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Referral Reward (GLX)</label>
                            <input type="number" class="form-control" id="referralReward" value="10000">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Daily Ad Limit</label>
                            <input type="number" class="form-control" id="dailyAdLimit" value="650">
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-success" onclick="saveSettings()">
                            <i class="fas fa-save"></i> Save Settings
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Competitions Tab -->
        <div id="competitionsTab" class="content-section">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title"><i class="fas fa-trophy"></i> Competition Management</h3>
                    <button class="btn btn-primary" onclick="createNewCompetition()">
                        <i class="fas fa-plus"></i> New Competition
                    </button>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Prize Pool</th>
                                <th>Tickets</th>
                                <th>Status</th>
                                <th>Start Date</th>
                                <th>End Date</th>
                                <th>Winner</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="competitionsTableBody">
                            <!-- Competitions will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Logs Tab -->
        <div id="logsTab" class="content-section">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title"><i class="fas fa-history"></i> System Logs</h3>
                    <div class="filter-bar">
                        <select class="filter-select" id="logTypeFilter" onchange="filterLogs()">
                            <option value="all">All Types</option>
                            <option value="user">User Actions</option>
                            <option value="system">System</option>
                            <option value="error">Errors</option>
                            <option value="transaction">Transactions</option>
                        </select>
                        <div class="date-range">
                            <input type="date" class="date-input" id="logDateFrom" onchange="filterLogs()">
                            <span>to</span>
                            <input type="date" class="date-input" id="logDateTo" onchange="filterLogs()">
                        </div>
                    </div>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>Type</th>
                                <th>User</th>
                                <th>Action</th>
                                <th>Details</th>
                            </tr>
                        </thead>
                        <tbody id="logsTableBody">
                            <!-- Logs will be loaded here -->
                        </tbody>
                    </table>
                </div>
                <div class="pagination" id="logsPagination">
                    <!-- Pagination will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Edit User Modal -->
    <div class="modal-overlay" id="editUserModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit User</h3>
                <button class="modal-close" onclick="closeModal('editUserModal')">&times;</button>
            </div>
            <form id="editUserForm">
                <input type="hidden" id="editUserId">
                <div class="form-group">
                    <label class="form-label">GLX Balance</label>
                    <input type="number" class="form-control" id="editUserGLX" required>
                </div>
                <div class="form-group">
                    <label class="form-label">TON Balance</label>
                    <input type="number" class="form-control" id="editUserTON" step="0.000001" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select class="form-control" id="editUserStatus">
                        <option value="active">Active</option>
                        <option value="blocked">Blocked</option>
                        <option value="suspended">Suspended</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-danger" onclick="deleteUser()">
                        <i class="fas fa-trash"></i> Delete User
                    </button>
                    <button type="button" class="btn btn-warning" onclick="blockUser()">
                        <i class="fas fa-ban"></i> Block User
                    </button>
                    <button type="button" class="btn btn-success" onclick="saveUserChanges()">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Withdrawal Action Modal -->
    <div class="modal-overlay" id="withdrawalActionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Process Withdrawal</h3>
                <button class="modal-close" onclick="closeModal('withdrawalActionModal')">&times;</button>
            </div>
            <form id="withdrawalActionForm">
                <input type="hidden" id="actionWithdrawalId">
                <input type="hidden" id="actionWithdrawalAmount">
                <input type="hidden" id="actionWithdrawalMethod">
                <input type="hidden" id="actionWithdrawalAccount">
                
                <div class="form-group">
                    <label class="form-label">Amount (TON)</label>
                    <input type="text" class="form-control" id="displayWithdrawalAmount" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">Method</label>
                    <input type="text" class="form-control" id="displayWithdrawalMethod" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">Account</label>
                    <input type="text" class="form-control" id="displayWithdrawalAccount" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">Transaction ID (Optional)</label>
                    <input type="text" class="form-control" id="withdrawalTxId" placeholder="Enter transaction ID if completed">
                </div>
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select class="form-control" id="withdrawalActionStatus">
                        <option value="pending">Pending</option>
                        <option value="completed">Completed</option>
                        <option value="rejected">Rejected</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-success" onclick="completeWithdrawal()">
                        <i class="fas fa-check"></i> Complete
                    </button>
                    <button type="button" class="btn btn-danger" onclick="rejectWithdrawal()">
                        <i class="fas fa-times"></i> Reject
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Task Modal -->
    <div class="modal-overlay" id="addTaskModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add New Task</h3>
                <button class="modal-close" onclick="closeModal('addTaskModal')">&times;</button>
            </div>
            <form id="addTaskForm">
                <div class="form-group">
                    <label class="form-label">Task Title</label>
                    <input type="text" class="form-control" id="taskTitle" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Task Link</label>
                    <input type="url" class="form-control" id="taskLink" required placeholder="https://t.me/...">
                </div>
                <div class="form-group">
                    <label class="form-label">Category</label>
                    <select class="form-control" id="taskCategory">
                        <option value="partner">Partner</option>
                        <option value="community">Community</option>
                        <option value="social">Social Media</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Reward (GLX)</label>
                    <input type="number" class="form-control" id="taskReward" value="1000" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Max Completions</label>
                    <input type="number" class="form-control" id="taskMaxCompletions" value="100" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-primary" onclick="addNewTask()">
                        <i class="fas fa-plus"></i> Add Task
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Competition Details Modal -->
    <div class="modal-overlay" id="competitionDetailsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Competition Details</h3>
                <button class="modal-close" onclick="closeModal('competitionDetailsModal')">&times;</button>
            </div>
            <div id="competitionDetailsContent">
                <!-- Competition details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Firebase Configuration -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC5dwRaz3L-aK7I5CoPkbB31MzXB62lgrU",
            authDomain: "earnmoney124553.firebaseapp.com",
            databaseURL: "https://earnmoney124553-default-rtdb.firebaseio.com",
            projectId: "earnmoney124553",
            storageBucket: "earnmoney124553.firebasestorage.app",
            messagingSenderId: "325528918523",
            appId: "1:325528918523:web:73d84f48a24c1e0cbfd35e",
            measurementId: "G-G1H96Q5XCJ"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const rtdb = firebase.database();

        // Admin credentials (in production, use Firebase Auth with proper admin users)
        const ADMIN_EMAIL = "admin@glxgalaxy.com"; // Change this
        const ADMIN_PASSWORD = "Admin123!"; // Change this

        // Global variables
        let currentUser = null;
        let users = [];
        let withdrawals = [];
        let tasks = [];
        let competitions = [];
        let logs = [];
        let settings = {};
        let currentPage = {
            users: 1,
            withdrawals: 1,
            logs: 1
        };
        const itemsPerPage = 10;

        // Initialize admin panel
        document.addEventListener('DOMContentLoaded', function() {
            checkAdminAuth();
        });

        // Check if admin is already logged in
        function checkAdminAuth() {
            const adminToken = localStorage.getItem('adminToken');
            if (adminToken) {
                try {
                    const adminData = JSON.parse(atob(adminToken));
                    if (adminData.expires > Date.now()) {
                        currentUser = adminData;
                        showAdminPanel();
                        loadAllData();
                    } else {
                        localStorage.removeItem('adminToken');
                    }
                } catch (e) {
                    localStorage.removeItem('adminToken');
                }
            }
        }

        // Admin login
        function adminLogin() {
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;
            const errorElement = document.getElementById('loginError');

            // Simple validation (in production, use Firebase Auth)
            if (email === ADMIN_EMAIL && password === ADMIN_PASSWORD) {
                showLoading();
                
                // Create admin session token
                const adminData = {
                    email: email,
                    expires: Date.now() + (8 * 60 * 60 * 1000) // 8 hours
                };
                
                const token = btoa(JSON.stringify(adminData));
                localStorage.setItem('adminToken', token);
                currentUser = adminData;
                
                setTimeout(() => {
                    hideLoading();
                    showAdminPanel();
                    loadAllData();
                    showNotification('Login successful!', 'success');
                }, 1000);
            } else {
                errorElement.textContent = 'Invalid email or password';
                errorElement.style.display = 'block';
                setTimeout(() => {
                    errorElement.style.display = 'none';
                }, 3000);
            }
        }

        // Admin logout
        function adminLogout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('adminToken');
                currentUser = null;
                document.getElementById('adminPanel').style.display = 'none';
                document.getElementById('loginSection').style.display = 'block';
                showNotification('Logged out successfully', 'info');
            }
        }

        // Show admin panel
        function showAdminPanel() {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'block';
        }

        // Load all data
        async function loadAllData() {
            showLoading();
            
            try {
                // Load all data in parallel
                await Promise.all([
                    loadUsers(),
                    loadWithdrawals(),
                    loadTasks(),
                    loadCompetitions(),
                    loadLogs(),
                    loadSettings(),
                    loadStats()
                ]);
                
                hideLoading();
                showNotification('Data loaded successfully', 'success');
            } catch (error) {
                hideLoading();
                showNotification('Error loading data: ' + error.message, 'error');
            }
        }

        // Load users
        async function loadUsers() {
            try {
                const snapshot = await db.collection('users').get();
                users = [];
                snapshot.forEach(doc => {
                    const user = doc.data();
                    user.id = doc.id;
                    users.push(user);
                });
                
                updateUsersTable();
                updateStats();
            } catch (error) {
                console.error('Error loading users:', error);
                showNotification('Error loading users', 'error');
            }
        }

        // Load withdrawals
        async function loadWithdrawals() {
            try {
                const snapshot = await db.collection('withdrawals').get();
                withdrawals = [];
                snapshot.forEach(doc => {
                    const withdrawal = doc.data();
                    withdrawal.id = doc.id;
                    withdrawals.push(withdrawal);
                });
                
                updateWithdrawalsTable();
                updateStats();
            } catch (error) {
                console.error('Error loading withdrawals:', error);
                showNotification('Error loading withdrawals', 'error');
            }
        }

        // Load tasks
        async function loadTasks() {
            try {
                const snapshot = await db.collection('tasks').get();
                tasks = [];
                snapshot.forEach(doc => {
                    const task = doc.data();
                    task.id = doc.id;
                    tasks.push(task);
                });
                
                updateTasksTable();
                updateStats();
            } catch (error) {
                console.error('Error loading tasks:', error);
                showNotification('Error loading tasks', 'error');
            }
        }

        // Load competitions
        async function loadCompetitions() {
            try {
                const snapshot = await db.collection('competitions').get();
                competitions = [];
                snapshot.forEach(doc => {
                    const competition = doc.data();
                    competition.id = doc.id;
                    competitions.push(competition);
                });
                
                updateCompetitionsTable();
                updateStats();
            } catch (error) {
                console.error('Error loading competitions:', error);
                showNotification('Error loading competitions', 'error');
            }
        }

        // Load logs
        async function loadLogs() {
            try {
                const snapshot = await db.collection('logs').orderBy('timestamp', 'desc').limit(100).get();
                logs = [];
                snapshot.forEach(doc => {
                    const log = doc.data();
                    log.id = doc.id;
                    logs.push(log);
                });
                
                updateLogsTable();
            } catch (error) {
                console.error('Error loading logs:', error);
                showNotification('Error loading logs', 'error');
            }
        }

        // Load settings
        async function loadSettings() {
            try {
                const doc = await db.collection('settings').doc('appSettings').get();
                if (doc.exists) {
                    settings = doc.data();
                    updateSettingsForm();
                }
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }

        // Load stats
        async function loadStats() {
            updateStats();
        }

        // Update stats
        function updateStats() {
            // Total users
            document.getElementById('totalUsers').textContent = users.length.toLocaleString();
            
            // Total GLX
            const totalGLX = users.reduce((sum, user) => sum + (user.dogsBalance || 0), 0);
            document.getElementById('totalGLX').textContent = Math.floor(totalGLX).toLocaleString();
            
            // Total TON
            const totalTON = users.reduce((sum, user) => sum + (user.tonBalance || 0), 0);
            document.getElementById('totalTON').textContent = totalTON.toFixed(4);
            
            // Pending withdrawals
            const pending = withdrawals.filter(w => w.status === 'pending').length;
            document.getElementById('pendingWithdrawals').textContent = pending;
            
            // Active tasks
            const active = tasks.filter(t => t.status === 'active').length;
            document.getElementById('activeTasks').textContent = active;
            
            // Today's revenue (example calculation)
            const todayRevenue = withdrawals
                .filter(w => w.status === 'completed')
                .reduce((sum, w) => sum + (w.amount || 0), 0);
            document.getElementById('todayRevenue').textContent = todayRevenue.toFixed(4) + ' TON';
            
            // Online users (simulated)
            document.getElementById('onlineUsers').textContent = Math.floor(users.length * 0.1);
            
            // Total deposits
            document.getElementById('totalDeposits').textContent = (totalTON * 0.5).toFixed(2) + ' TON';
            
            // Total withdrawn
            const totalWithdrawn = withdrawals
                .filter(w => w.status === 'completed')
                .reduce((sum, w) => sum + (w.amount || 0), 0);
            document.getElementById('totalWithdrawn').textContent = totalWithdrawn.toFixed(4) + ' TON';
            
            // Referral count
            const totalReferrals = users.reduce((sum, user) => sum + (user.referrals || 0), 0);
            document.getElementById('referralCount').textContent = totalReferrals;
        }

        // Update users table
        function updateUsersTable(filteredUsers = users) {
            const tbody = document.getElementById('usersTableBody');
            const start = (currentPage.users - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const paginatedUsers = filteredUsers.slice(start, end);
            
            tbody.innerHTML = '';
            
            if (paginatedUsers.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="empty-state">
                            <i class="fas fa-users"></i>
                            <p>No users found</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            paginatedUsers.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.id.substring(0, 8)}...</td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <img src="${user.photoUrl || 'https://i.ibb.co/tTkJX1Qy/logo.png'}" class="user-avatar" alt="${user.name}">
                            <div>
                                <div style="font-weight: 600;">${user.name || 'Anonymous'}</div>
                                <div style="font-size: 11px; color: var(--text-muted);">${user.username || 'No username'}</div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div style="font-weight: 700;">${Math.floor(user.dogsBalance || 0).toLocaleString()} GLX</div>
                        <div style="font-size: 11px; color: var(--text-muted);">${(user.tonBalance || 0).toFixed(4)} TON</div>
                    </td>
                    <td>
                        <span class="status-badge ${user.blocked ? 'status-blocked' : 'status-active'}">
                            ${user.blocked ? 'Blocked' : 'Active'}
                        </span>
                    </td>
                    <td>${new Date(user.joinedDate || Date.now()).toLocaleDateString()}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn edit" onclick="editUser('${user.id}')" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn ${user.blocked ? 'approve' : 'block'}" 
                                    onclick="${user.blocked ? 'unblockUser' : 'blockUserFromTable'}('${user.id}')" 
                                    title="${user.blocked ? 'Unblock' : 'Block'}">
                                <i class="fas ${user.blocked ? 'fa-check' : 'fa-ban'}"></i>
                            </button>
                            <button class="action-btn delete" onclick="deleteUserFromTable('${user.id}')" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            updatePagination('users', filteredUsers.length);
        }

        // Update withdrawals table
        function updateWithdrawalsTable(filteredWithdrawals = withdrawals) {
            const tbody = document.getElementById('withdrawalsTableBody');
            const start = (currentPage.withdrawals - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const paginatedWithdrawals = filteredWithdrawals.slice(start, end);
            
            tbody.innerHTML = '';
            
            if (paginatedWithdrawals.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <i class="fas fa-money-bill-wave"></i>
                            <p>No withdrawals found</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            paginatedWithdrawals.forEach(withdrawal => {
                const statusClass = `status-${withdrawal.status || 'pending'}`;
                const statusText = (withdrawal.status || 'pending').charAt(0).toUpperCase() + (withdrawal.status || 'pending').slice(1);
                
                let maskedAccount = withdrawal.account || '';
                if (withdrawal.method === 'faucetpay' && maskedAccount.includes('@')) {
                    const [localPart, domain] = maskedAccount.split('@');
                    if (localPart.length > 3) {
                        maskedAccount = localPart.charAt(0) + '*'.repeat(Math.max(3, localPart.length - 2)) + localPart.charAt(localPart.length - 1) + '@' + domain;
                    }
                } else if (withdrawal.method === 'ton') {
                    if (maskedAccount.length > 16) {
                        maskedAccount = maskedAccount.substring(0, 8) + '...' + maskedAccount.substring(maskedAccount.length - 4);
                    }
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${withdrawal.id.substring(0, 8)}...</td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <img src="${withdrawal.photoUrl || 'https://i.ibb.co/tTkJX1Qy/logo.png'}" class="user-avatar" alt="${withdrawal.name}">
                            <div>
                                <div style="font-weight: 600;">${withdrawal.name || 'Anonymous'}</div>
                                <div style="font-size: 11px; color: var(--text-muted);">${withdrawal.userId || ''}</div>
                            </div>
                        </div>
                    </td>
                    <td style="font-weight: 700; color: var(--primary-green);">${(withdrawal.amount || 0).toFixed(6)} TON</td>
                    <td>
                        <span style="font-size: 11px; padding: 4px 8px; background: rgba(168, 85, 247, 0.2); border-radius: 6px;">
                            ${withdrawal.method === 'faucetpay' ? 'FaucetPay' : 'TON Wallet'}
                        </span>
                    </td>
                    <td>
                        <span class="status-badge ${statusClass}">${statusText}</span>
                    </td>
                    <td>${new Date(withdrawal.timestamp || Date.now()).toLocaleDateString()}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn approve" onclick="processWithdrawal('${withdrawal.id}')" title="Process">
                                <i class="fas fa-cog"></i>
                            </button>
                            <button class="action-btn delete" onclick="deleteWithdrawal('${withdrawal.id}')" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            updatePagination('withdrawals', filteredWithdrawals.length);
        }

        // Update tasks table
        function updateTasksTable() {
            const tbody = document.getElementById('tasksTableBody');
            tbody.innerHTML = '';
            
            if (tasks.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <i class="fas fa-tasks"></i>
                            <p>No tasks found</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tasks.forEach(task => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${task.id.substring(0, 8)}...</td>
                    <td style="font-weight: 600;">${task.title || 'Untitled Task'}</td>
                    <td>
                        <span style="font-size: 11px; padding: 4px 8px; background: rgba(52, 152, 219, 0.2); border-radius: 6px;">
                            ${task.category || 'community'}
                        </span>
                    </td>
                    <td style="font-weight: 700; color: var(--primary-green);">${task.reward || 0} GLX</td>
                    <td>
                        <div>${task.completions || 0} / ${task.maxCompletions || 100}</div>
                        <div style="font-size: 11px; color: var(--text-muted);">${((task.completions || 0) / (task.maxCompletions || 100) * 100).toFixed(1)}%</div>
                    </td>
                    <td>
                        <span class="status-badge ${task.status === 'active' ? 'status-active' : 'status-blocked'}">
                            ${task.status || 'inactive'}
                        </span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn edit" onclick="editTask('${task.id}')" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn ${task.status === 'active' ? 'block' : 'approve'}" 
                                    onclick="${task.status === 'active' ? 'deactivateTask' : 'activateTask'}('${task.id}')" 
                                    title="${task.status === 'active' ? 'Deactivate' : 'Activate'}">
                                <i class="fas ${task.status === 'active' ? 'fa-pause' : 'fa-play'}"></i>
                            </button>
                            <button class="action-btn delete" onclick="deleteTask('${task.id}')" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Update competitions table
        function updateCompetitionsTable() {
            const tbody = document.getElementById('competitionsTableBody');
            tbody.innerHTML = '';
            
            if (competitions.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="empty-state">
                            <i class="fas fa-trophy"></i>
                            <p>No competitions found</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            competitions.forEach(competition => {
                const isActive = competition.endTime > Date.now();
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${competition.id.substring(0, 8)}...</td>
                    <td style="font-weight: 700; color: #FFD700;">${(competition.prizePool || 0).toFixed(3)} TON</td>
                    <td>${competition.totalTickets || 0}</td>
                    <td>
                        <span class="status-badge ${isActive ? 'status-active' : 'status-completed'}">
                            ${isActive ? 'Active' : 'Ended'}
                        </span>
                    </td>
                    <td>${new Date(competition.startTime || Date.now()).toLocaleDateString()}</td>
                    <td>${new Date(competition.endTime || Date.now()).toLocaleDateString()}</td>
                    <td>${competition.winnerName || 'No winner yet'}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn info" onclick="viewCompetitionDetails('${competition.id}')" title="View Details">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="action-btn delete" onclick="deleteCompetition('${competition.id}')" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Update logs table
        function updateLogsTable(filteredLogs = logs) {
            const tbody = document.getElementById('logsTableBody');
            const start = (currentPage.logs - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const paginatedLogs = filteredLogs.slice(start, end);
            
            tbody.innerHTML = '';
            
            if (paginatedLogs.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="empty-state">
                            <i class="fas fa-history"></i>
                            <p>No logs found</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            paginatedLogs.forEach(log => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(log.timestamp || Date.now()).toLocaleString()}</td>
                    <td>
                        <span style="font-size: 11px; padding: 4px 8px; background: ${
                            log.type === 'error' ? 'rgba(231, 76, 60, 0.2)' :
                            log.type === 'user' ? 'rgba(52, 152, 219, 0.2)' :
                            log.type === 'transaction' ? 'rgba(39, 174, 96, 0.2)' : 'rgba(243, 156, 18, 0.2)'
                        }; border-radius: 6px; color: ${
                            log.type === 'error' ? '#e74c3c' :
                            log.type === 'user' ? '#3498db' :
                            log.type === 'transaction' ? '#27ae60' : '#f39c12'
                        };">
                            ${log.type || 'system'}
                        </span>
                    </td>
                    <td>${log.userName || 'System'}</td>
                    <td style="font-weight: 600;">${log.action || 'Unknown action'}</td>
                    <td style="font-size: 12px; color: var(--text-muted);">${log.details || 'No details'}</td>
                `;
                tbody.appendChild(row);
            });
            
            updatePagination('logs', filteredLogs.length);
        }

        // Update settings form
        function updateSettingsForm() {
            if (settings) {
                document.getElementById('glxToTonRate').value = settings.glxToTonRate || 0.0000001;
                document.getElementById('ticketPrice').value = settings.ticketPrice || 10000;
                document.getElementById('minTonWithdrawal').value = settings.minTonWithdrawal || 0.05;
                document.getElementById('minFaucetPayWithdrawal').value = settings.minFaucetPayWithdrawal || 0.0001;
                document.getElementById('referralReward').value = settings.referralReward || 10000;
                document.getElementById('dailyAdLimit').value = settings.dailyAdLimit || 650;
            }
        }

        // Update pagination
        function updatePagination(type, totalItems) {
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            const paginationDiv = document.getElementById(`${type}Pagination`);
            
            if (!paginationDiv) return;
            
            paginationDiv.innerHTML = '';
            
            if (totalPages <= 1) return;
            
            // Previous button
            const prevButton = document.createElement('button');
            prevButton.className = 'page-btn';
            prevButton.innerHTML = '<i class="fas fa-chevron-left"></i>';
            prevButton.disabled = currentPage[type] === 1;
            prevButton.onclick = () => {
                if (currentPage[type] > 1) {
                    currentPage[type]--;
                    updateTable(type);
                }
            };
            paginationDiv.appendChild(prevButton);
            
            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                const pageButton = document.createElement('button');
                pageButton.className = `page-btn ${i === currentPage[type] ? 'active' : ''}`;
                pageButton.textContent = i;
                pageButton.onclick = () => {
                    currentPage[type] = i;
                    updateTable(type);
                };
                paginationDiv.appendChild(pageButton);
            }
            
            // Next button
            const nextButton = document.createElement('button');
            nextButton.className = 'page-btn';
            nextButton.innerHTML = '<i class="fas fa-chevron-right"></i>';
            nextButton.disabled = currentPage[type] === totalPages;
            nextButton.onclick = () => {
                if (currentPage[type] < totalPages) {
                    currentPage[type]++;
                    updateTable(type);
                }
            };
            paginationDiv.appendChild(nextButton);
        }

        // Update table based on type
        function updateTable(type) {
            switch (type) {
                case 'users':
                    updateUsersTable();
                    break;
                case 'withdrawals':
                    updateWithdrawalsTable();
                    break;
                case 'logs':
                    updateLogsTable();
                    break;
            }
        }

        // Search users
        function searchUsers() {
            const searchTerm = document.getElementById('userSearch').value.toLowerCase();
            if (!searchTerm) {
                updateUsersTable(users);
                return;
            }
            
            const filteredUsers = users.filter(user => 
                user.id.toLowerCase().includes(searchTerm) ||
                (user.name && user.name.toLowerCase().includes(searchTerm)) ||
                (user.username && user.username.toLowerCase().includes(searchTerm)) ||
                (user.email && user.email.toLowerCase().includes(searchTerm))
            );
            
            currentPage.users = 1;
            updateUsersTable(filteredUsers);
        }

        // Filter withdrawals
        function filterWithdrawals() {
            const statusFilter = document.getElementById('withdrawalStatusFilter').value;
            const methodFilter = document.getElementById('withdrawalMethodFilter').value;
            
            let filteredWithdrawals = withdrawals;
            
            if (statusFilter !== 'all') {
                filteredWithdrawals = filteredWithdrawals.filter(w => w.status === statusFilter);
            }
            
            if (methodFilter !== 'all') {
                filteredWithdrawals = filteredWithdrawals.filter(w => w.method === methodFilter);
            }
            
            currentPage.withdrawals = 1;
            updateWithdrawalsTable(filteredWithdrawals);
        }

        // Filter logs
        function filterLogs() {
            const typeFilter = document.getElementById('logTypeFilter').value;
            const dateFrom = document.getElementById('logDateFrom').value;
            const dateTo = document.getElementById('logDateTo').value;
            
            let filteredLogs = logs;
            
            if (typeFilter !== 'all') {
                filteredLogs = filteredLogs.filter(log => log.type === typeFilter);
            }
            
            if (dateFrom) {
                const fromDate = new Date(dateFrom);
                filteredLogs = filteredLogs.filter(log => new Date(log.timestamp) >= fromDate);
            }
            
            if (dateTo) {
                const toDate = new Date(dateTo);
                toDate.setHours(23, 59, 59, 999);
                filteredLogs = filteredLogs.filter(log => new Date(log.timestamp) <= toDate);
            }
            
            currentPage.logs = 1;
            updateLogsTable(filteredLogs);
        }

        // Switch tabs
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.content-section').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Deactivate all tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Activate selected tab
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Activate selected tab button
            document.querySelectorAll('.tab-btn').forEach(btn => {
                if (btn.textContent.includes(tabName.charAt(0).toUpperCase() + tabName.slice(1))) {
                    btn.classList.add('active');
                }
            });
            
            // Load data if needed
            if (tabName === 'logs' && logs.length === 0) {
                loadLogs();
            }
        }

        // Edit user
        async function editUser(userId) {
            const user = users.find(u => u.id === userId);
            if (!user) return;
            
            document.getElementById('editUserId').value = userId;
            document.getElementById('editUserGLX').value = user.dogsBalance || 0;
            document.getElementById('editUserTON').value = user.tonBalance || 0;
            document.getElementById('editUserStatus').value = user.blocked ? 'blocked' : 'active';
            
            showModal('editUserModal');
        }

        // Save user changes
        async function saveUserChanges() {
            const userId = document.getElementById('editUserId').value;
            const glxBalance = parseFloat(document.getElementById('editUserGLX').value);
            const tonBalance = parseFloat(document.getElementById('editUserTON').value);
            const status = document.getElementById('editUserStatus').value;
            
            try {
                await db.collection('users').doc(userId).update({
                    dogsBalance: glxBalance,
                    tonBalance: tonBalance,
                    blocked: status === 'blocked' || status === 'suspended',
                    status: status
                });
                
                // Add log
                await addLog('user', 'User Updated', `Updated user ${userId} balance to ${glxBalance} GLX, ${tonBalance} TON`);
                
                closeModal('editUserModal');
                loadUsers();
                showNotification('User updated successfully', 'success');
            } catch (error) {
                showNotification('Error updating user: ' + error.message, 'error');
            }
        }

        // Block user from table
        async function blockUserFromTable(userId) {
            if (!confirm('Are you sure you want to block this user?')) return;
            
            try {
                await db.collection('users').doc(userId).update({
                    blocked: true,
                    status: 'blocked'
                });
                
                // Add log
                await addLog('user', 'User Blocked', `Blocked user ${userId}`);
                
                loadUsers();
                showNotification('User blocked successfully', 'success');
            } catch (error) {
                showNotification('Error blocking user: ' + error.message, 'error');
            }
        }

        // Unblock user
        async function unblockUser(userId) {
            try {
                await db.collection('users').doc(userId).update({
                    blocked: false,
                    status: 'active'
                });
                
                // Add log
                await addLog('user', 'User Unblocked', `Unblocked user ${userId}`);
                
                loadUsers();
                showNotification('User unblocked successfully', 'success');
            } catch (error) {
                showNotification('Error unblocking user: ' + error.message, 'error');
            }
        }

        // Delete user from table
        async function deleteUserFromTable(userId) {
            if (!confirm('Are you sure you want to delete this user? This action cannot be undone.')) return;
            
            try {
                await db.collection('users').doc(userId).delete();
                
                // Add log
                await addLog('user', 'User Deleted', `Deleted user ${userId}`);
                
                loadUsers();
                showNotification('User deleted successfully', 'success');
            } catch (error) {
                showNotification('Error deleting user: ' + error.message, 'error');
            }
        }

        // Process withdrawal
        async function processWithdrawal(withdrawalId) {
            const withdrawal = withdrawals.find(w => w.id === withdrawalId);
            if (!withdrawal) return;
            
            document.getElementById('actionWithdrawalId').value = withdrawalId;
            document.getElementById('actionWithdrawalAmount').value = withdrawal.amount || 0;
            document.getElementById('actionWithdrawalMethod').value = withdrawal.method || '';
            document.getElementById('actionWithdrawalAccount').value = withdrawal.account || '';
            
            document.getElementById('displayWithdrawalAmount').value = (withdrawal.amount || 0).toFixed(6) + ' TON';
            document.getElementById('displayWithdrawalMethod').value = withdrawal.method === 'faucetpay' ? 'FaucetPay' : 'TON Wallet';
            document.getElementById('displayWithdrawalAccount').value = withdrawal.account || '';
            document.getElementById('withdrawalActionStatus').value = withdrawal.status || 'pending';
            
            showModal('withdrawalActionModal');
        }

        // Complete withdrawal
        async function completeWithdrawal() {
            const withdrawalId = document.getElementById('actionWithdrawalId').value;
            const txId = document.getElementById('withdrawalTxId').value;
            
            try {
                await db.collection('withdrawals').doc(withdrawalId).update({
                    status: 'completed',
                    transactionId: txId,
                    processedAt: Date.now(),
                    processedBy: currentUser.email
                });
                
                // Add log
                await addLog('transaction', 'Withdrawal Completed', `Completed withdrawal ${withdrawalId} with TX: ${txId}`);
                
                closeModal('withdrawalActionModal');
                loadWithdrawals();
                showNotification('Withdrawal marked as completed', 'success');
            } catch (error) {
                showNotification('Error completing withdrawal: ' + error.message, 'error');
            }
        }

        // Reject withdrawal
        async function rejectWithdrawal() {
            const withdrawalId = document.getElementById('actionWithdrawalId').value;
            const reason = prompt('Enter reason for rejection:');
            
            if (!reason) return;
            
            try {
                const withdrawal = withdrawals.find(w => w.id === withdrawalId);
                if (withdrawal) {
                    // Refund user's balance
                    await db.collection('users').doc(withdrawal.userId).update({
                        tonBalance: firebase.firestore.FieldValue.increment(withdrawal.amount || 0)
                    });
                }
                
                await db.collection('withdrawals').doc(withdrawalId).update({
                    status: 'rejected',
                    rejectionReason: reason,
                    processedAt: Date.now(),
                    processedBy: currentUser.email
                });
                
                // Add log
                await addLog('transaction', 'Withdrawal Rejected', `Rejected withdrawal ${withdrawalId}: ${reason}`);
                
                closeModal('withdrawalActionModal');
                loadWithdrawals();
                showNotification('Withdrawal rejected and user refunded', 'success');
            } catch (error) {
                showNotification('Error rejecting withdrawal: ' + error.message, 'error');
            }
        }

        // Delete withdrawal
        async function deleteWithdrawal(withdrawalId) {
            if (!confirm('Are you sure you want to delete this withdrawal record?')) return;
            
            try {
                await db.collection('withdrawals').doc(withdrawalId).delete();
                
                // Add log
                await addLog('transaction', 'Withdrawal Deleted', `Deleted withdrawal record ${withdrawalId}`);
                
                loadWithdrawals();
                showNotification('Withdrawal deleted successfully', 'success');
            } catch (error) {
                showNotification('Error deleting withdrawal: ' + error.message, 'error');
            }
        }

        // Show add task modal
        function showAddTaskModal() {
            showModal('addTaskModal');
        }

        // Add new task
        async function addNewTask() {
            const title = document.getElementById('taskTitle').value;
            const link = document.getElementById('taskLink').value;
            const category = document.getElementById('taskCategory').value;
            const reward = parseInt(document.getElementById('taskReward').value);
            const maxCompletions = parseInt(document.getElementById('taskMaxCompletions').value);
            
            if (!title || !link || !reward) {
                showNotification('Please fill all required fields', 'error');
                return;
            }
            
            const taskId = 'task_' + Date.now();
            
            try {
                await db.collection('tasks').doc(taskId).set({
                    id: taskId,
                    title: title,
                    link: link,
                    category: category,
                    reward: reward,
                    maxCompletions: maxCompletions,
                    completions: 0,
                    status: 'active',
                    createdAt: Date.now(),
                    createdBy: currentUser.email
                });
                
                // Add log
                await addLog('system', 'Task Added', `Added task: ${title}`);
                
                closeModal('addTaskModal');
                document.getElementById('addTaskForm').reset();
                loadTasks();
                showNotification('Task added successfully', 'success');
            } catch (error) {
                showNotification('Error adding task: ' + error.message, 'error');
            }
        }

        // Edit task
        async function editTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            const newReward = prompt('Enter new reward amount (GLX):', task.reward);
            if (!newReward) return;
            
            try {
                await db.collection('tasks').doc(taskId).update({
                    reward: parseInt(newReward)
                });
                
                // Add log
                await addLog('system', 'Task Updated', `Updated task ${taskId} reward to ${newReward} GLX`);
                
                loadTasks();
                showNotification('Task updated successfully', 'success');
            } catch (error) {
                showNotification('Error updating task: ' + error.message, 'error');
            }
        }

        // Deactivate task
        async function deactivateTask(taskId) {
            try {
                await db.collection('tasks').doc(taskId).update({
                    status: 'inactive'
                });
                
                // Add log
                await addLog('system', 'Task Deactivated', `Deactivated task ${taskId}`);
                
                loadTasks();
                showNotification('Task deactivated', 'success');
            } catch (error) {
                showNotification('Error deactivating task: ' + error.message, 'error');
            }
        }

        // Activate task
        async function activateTask(taskId) {
            try {
                await db.collection('tasks').doc(taskId).update({
                    status: 'active'
                });
                
                // Add log
                await addLog('system', 'Task Activated', `Activated task ${taskId}`);
                
                loadTasks();
                showNotification('Task activated', 'success');
            } catch (error) {
                showNotification('Error activating task: ' + error.message, 'error');
            }
        }

        // Delete task
        async function deleteTask(taskId) {
            if (!confirm('Are you sure you want to delete this task?')) return;
            
            try {
                await db.collection('tasks').doc(taskId).delete();
                
                // Add log
                await addLog('system', 'Task Deleted', `Deleted task ${taskId}`);
                
                loadTasks();
                showNotification('Task deleted successfully', 'success');
            } catch (error) {
                showNotification('Error deleting task: ' + error.message, 'error');
            }
        }

        // Save settings
        async function saveSettings() {
            const newSettings = {
                glxToTonRate: parseFloat(document.getElementById('glxToTonRate').value),
                ticketPrice: parseInt(document.getElementById('ticketPrice').value),
                minTonWithdrawal: parseFloat(document.getElementById('minTonWithdrawal').value),
                minFaucetPayWithdrawal: parseFloat(document.getElementById('minFaucetPayWithdrawal').value),
                referralReward: parseInt(document.getElementById('referralReward').value),
                dailyAdLimit: parseInt(document.getElementById('dailyAdLimit').value),
                updatedAt: Date.now(),
                updatedBy: currentUser.email
            };
            
            try {
                await db.collection('settings').doc('appSettings').set(newSettings, { merge: true });
                
                // Add log
                await addLog('system', 'Settings Updated', 'Updated application settings');
                
                settings = newSettings;
                showNotification('Settings saved successfully', 'success');
            } catch (error) {
                showNotification('Error saving settings: ' + error.message, 'error');
            }
        }

        // Create new competition
        async function createNewCompetition() {
            const duration = prompt('Enter competition duration in hours:', '24');
            if (!duration) return;
            
            const competitionId = 'comp_' + Date.now();
            const startTime = Date.now();
            const endTime = startTime + (parseInt(duration) * 60 * 60 * 1000);
            
            try {
                await db.collection('competitions').doc(competitionId).set({
                    id: competitionId,
                    startTime: startTime,
                    endTime: endTime,
                    totalTickets: 0,
                    prizePool: 0,
                    isActive: true,
                    participants: {},
                    createdAt: Date.now(),
                    createdBy: currentUser.email
                });
                
                // Add log
                await addLog('system', 'Competition Created', `Created competition ${competitionId} for ${duration} hours`);
                
                loadCompetitions();
                showNotification('Competition created successfully', 'success');
            } catch (error) {
                showNotification('Error creating competition: ' + error.message, 'error');
            }
        }

        // View competition details
        async function viewCompetitionDetails(competitionId) {
            const competition = competitions.find(c => c.id === competitionId);
            if (!competition) return;
            
            const detailsContent = document.getElementById('competitionDetailsContent');
            detailsContent.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h4 style="color: var(--gold); margin-bottom: 10px;">Competition Details</h4>
                    <p><strong>ID:</strong> ${competition.id}</p>
                    <p><strong>Status:</strong> ${competition.endTime > Date.now() ? 'Active' : 'Ended'}</p>
                    <p><strong>Prize Pool:</strong> ${(competition.prizePool || 0).toFixed(3)} TON</p>
                    <p><strong>Total Tickets:</strong> ${competition.totalTickets || 0}</p>
                    <p><strong>Start Time:</strong> ${new Date(competition.startTime).toLocaleString()}</p>
                    <p><strong>End Time:</strong> ${new Date(competition.endTime).toLocaleString()}</p>
                    <p><strong>Winner:</strong> ${competition.winnerName || 'Not determined yet'}</p>
                </div>
                <div class="form-actions">
                    <button class="btn btn-danger" onclick="endCompetition('${competitionId}')">
                        <i class="fas fa-stop"></i> End Competition
                    </button>
                </div>
            `;
            
            showModal('competitionDetailsModal');
        }

        // End competition
        async function endCompetition(competitionId) {
            if (!confirm('Are you sure you want to end this competition?')) return;
            
            try {
                await db.collection('competitions').doc(competitionId).update({
                    endTime: Date.now(),
                    isActive: false
                });
                
                // Add log
                await addLog('system', 'Competition Ended', `Ended competition ${competitionId}`);
                
                closeModal('competitionDetailsModal');
                loadCompetitions();
                showNotification('Competition ended successfully', 'success');
            } catch (error) {
                showNotification('Error ending competition: ' + error.message, 'error');
            }
        }

        // Delete competition
        async function deleteCompetition(competitionId) {
            if (!confirm('Are you sure you want to delete this competition?')) return;
            
            try {
                await db.collection('competitions').doc(competitionId).delete();
                
                // Add log
                await addLog('system', 'Competition Deleted', `Deleted competition ${competitionId}`);
                
                loadCompetitions();
                showNotification('Competition deleted successfully', 'success');
            } catch (error) {
                showNotification('Error deleting competition: ' + error.message, 'error');
            }
        }

        // Add log
        async function addLog(type, action, details) {
            try {
                await db.collection('logs').add({
                    type: type,
                    action: action,
                    details: details,
                    userName: currentUser.email,
                    timestamp: Date.now()
                });
            } catch (error) {
                console.error('Error adding log:', error);
            }
        }

        // Refresh all data
        function refreshAllData() {
            loadAllData();
        }

        // Show modal
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Show notification
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            const icon = notification.querySelector('.notification-icon');
            const messageEl = notification.querySelector('.notification-message');
            
            notification.className = `notification ${type}`;
            icon.innerHTML = type === 'success' ? '✅' : 
                           type === 'error' ? '❌' : 
                           type === 'warning' ? '⚠️' : 'ℹ️';
            messageEl.textContent = message;
            
            notification.style.display = 'flex';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 5000);
        }

        // Show loading
        function showLoading() {
            document.getElementById('loadingOverlay').classList.add('active');
        }

        // Hide loading
        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        // Close modal on overlay click
        document.querySelectorAll('.modal-overlay').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
        });
    </script>
</body>
</html>

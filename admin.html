<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Crystal Ranch Â· Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Chart.js Ù„Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Tajawal', sans-serif;
        }
        
        :root {
            --primary: #FF5CA8;
            --primary-dark: #D94A8F;
            --secondary: #00F27A;
            --secondary-dark: #00b35e;
            --accent: #00D4FF;
            --danger: #FF4B5C;
            --warning: #FFD700;
            --dark: #1a1a2e;
            --darker: #0f0f1a;
            --card-bg: #16213e;
            --text-light: #ffffff;
            --text-muted: #a0a0c0;
            --border: rgba(255,255,255,0.1);
            --shadow: 0 8px 20px rgba(0,0,0,0.5);
        }
        
        body {
            background: linear-gradient(135deg, var(--darker), var(--dark));
            color: var(--text-light);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* Header */
        .header {
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(145deg, var(--primary), var(--accent));
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            animation: pulse 2s infinite;
        }
        
        .logo h1 {
            font-size: 24px;
            font-weight: 800;
            background: linear-gradient(145deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .logo span {
            color: var(--text-muted);
            font-size: 14px;
            display: block;
        }
        
        .stats-badge {
            display: flex;
            gap: 20px;
            background: rgba(0,0,0,0.3);
            padding: 10px 20px;
            border-radius: 40px;
            border: 1px solid var(--border);
        }
        
        .badge-item {
            text-align: center;
        }
        
        .badge-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--warning);
        }
        
        .badge-label {
            font-size: 12px;
            color: var(--text-muted);
        }
        
        .admin-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 10px 20px;
            border-radius: 40px;
            border: none;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.1);
            color: var(--text-light);
            border: 1px solid var(--border);
        }
        
        .btn-primary {
            background: linear-gradient(145deg, var(--primary), var(--primary-dark));
            border: none;
            box-shadow: 0 4px 15px rgba(255,92,168,0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(145deg, var(--secondary), var(--secondary-dark));
            border: none;
            box-shadow: 0 4px 15px rgba(0,242,122,0.3);
        }
        
        .btn-warning {
            background: linear-gradient(145deg, var(--warning), #DAA520);
            border: none;
            color: black;
        }
        
        .btn-danger {
            background: linear-gradient(145deg, var(--danger), #d63f4f);
            border: none;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255,92,168,0.5);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
        }
        
        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .stat-icon {
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .stat-title {
            font-size: 14px;
            color: var(--text-muted);
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 800;
        }
        
        .stat-sub {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 5px;
        }
        
        .progress {
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary), var(--accent));
            border-radius: 3px;
            transition: width 0.3s;
        }
        
        /* Charts Grid */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .chart-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 20px;
        }
        
        .chart-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chart-title i {
            color: var(--accent);
        }
        
        .chart-container {
            height: 250px;
            position: relative;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 10px 25px;
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border);
            border-radius: 40px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }
        
        .tab.active {
            background: linear-gradient(145deg, var(--primary), var(--primary-dark));
            border-color: transparent;
        }
        
        .tab:hover {
            background: rgba(255,255,255,0.1);
        }
        
        /* Tables */
        .table-container {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 20px;
            overflow-x: auto;
            margin-bottom: 25px;
        }
        
        .table-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .table-title {
            font-size: 18px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .search-box {
            display: flex;
            align-items: center;
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border);
            border-radius: 40px;
            padding: 5px 15px;
        }
        
        .search-box i {
            color: var(--text-muted);
        }
        
        .search-box input {
            background: transparent;
            border: none;
            padding: 8px 10px;
            color: white;
            outline: none;
            width: 200px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            text-align: left;
            padding: 12px;
            color: var(--text-muted);
            font-weight: 600;
            font-size: 13px;
            border-bottom: 1px solid var(--border);
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        
        tr:hover {
            background: rgba(255,255,255,0.02);
        }
        
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .badge-success {
            background: rgba(0,242,122,0.15);
            color: var(--secondary);
            border: 1px solid rgba(0,242,122,0.3);
        }
        
        .badge-warning {
            background: rgba(255,215,0,0.15);
            color: var(--warning);
            border: 1px solid rgba(255,215,0,0.3);
        }
        
        .badge-danger {
            background: rgba(255,75,92,0.15);
            color: var(--danger);
            border: 1px solid rgba(255,75,92,0.3);
        }
        
        .badge-info {
            background: rgba(0,212,255,0.15);
            color: var(--accent);
            border: 1px solid rgba(0,212,255,0.3);
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        
        .icon-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: none;
            background: rgba(255,255,255,0.05);
            color: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .icon-btn:hover {
            background: var(--primary);
            transform: scale(1.1);
        }
        
        .icon-btn.edit:hover {
            background: var(--secondary);
        }
        
        .icon-btn.delete:hover {
            background: var(--danger);
        }
        
        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 25px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 24px;
            cursor: pointer;
        }
        
        .modal-close:hover {
            color: white;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            font-size: 13px;
            color: var(--text-muted);
            margin-bottom: 5px;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px;
            color: white;
            font-size: 14px;
            outline: none;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            border-color: var(--primary);
        }
        
        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        /* Animations */
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
        }
        
        .loading i {
            font-size: 40px;
            color: var(--primary);
            animation: spin 1s infinite linear;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .stats-badge {
                justify-content: center;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">ğŸ’</div>
                <div>
                    <h1>Crystal Ranch</h1>
                    <span>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©</span>
                </div>
            </div>
            
            <div class="stats-badge">
                <div class="badge-item">
                    <div class="badge-value" id="totalUsers">0</div>
                    <div class="badge-label">Ù…Ø³ØªØ®Ø¯Ù…</div>
                </div>
                <div class="badge-item">
                    <div class="badge-value" id="totalOrders">0</div>
                    <div class="badge-label">Ø·Ù„Ø¨</div>
                </div>
                <div class="badge-item">
                    <div class="badge-value" id="totalVolume">0</div>
                    <div class="badge-label">TON</div>
                </div>
            </div>
            
            <div class="admin-actions">
                <button class="btn btn-primary" onclick="refreshData()">
                    <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ«
                </button>
                <button class="btn btn-warning" onclick="exportData()">
                    <i class="fas fa-download"></i> ØªØµØ¯ÙŠØ±
                </button>
                <button class="btn btn-danger" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Ø®Ø±ÙˆØ¬
                </button>
            </div>
        </div>
        
        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon">ğŸ‘¥</div>
                    <div class="stat-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
                </div>
                <div class="stat-value" id="statTotalUsers">0</div>
                <div class="stat-sub">
                    <i class="fas fa-arrow-up" style="color: var(--secondary);"></i> +12% Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon">ğŸ®</div>
                    <div class="stat-title">Ø¢Ù„Ø§Øª Ø§Ù„Ø¨Ù‚Ø±</div>
                </div>
                <div class="stat-value" id="statCowsSold">0</div>
                <div class="progress">
                    <div class="progress-bar" id="cowProgress" style="width: 0%;"></div>
                </div>
                <div class="stat-sub" id="cowsRemaining">0 Ù…ØªØ¨Ù‚ÙŠØ©</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon">ğŸ”</div>
                    <div class="stat-title">Ø¢Ù„Ø§Øª Ø§Ù„Ø¯Ø¬Ø§Ø¬</div>
                </div>
                <div class="stat-value" id="statChickensSold">0</div>
                <div class="progress">
                    <div class="progress-bar" id="chickenProgress" style="width: 0%;"></div>
                </div>
                <div class="stat-sub" id="chickensRemaining">0 Ù…ØªØ¨Ù‚ÙŠØ©</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon">ğŸ’</div>
                    <div class="stat-title">Ø³Ø¹Ø± Ø§Ù„ÙƒØ±ÙŠØ³ØªØ§Ù„</div>
                </div>
                <div class="stat-value" id="statDiamondPrice">25</div>
                <div class="stat-sub">TON Ù„Ù„ÙƒØ±ÙŠØ³ØªØ§Ù„Ø©</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon">ğŸ’°</div>
                    <div class="stat-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù€ TON</div>
                </div>
                <div class="stat-value" id="statTotalTon">0</div>
                <div class="stat-sub">ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§ÙØ¸</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon">ğŸ“Š</div>
                    <div class="stat-title">Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³ÙˆÙ‚</div>
                </div>
                <div class="stat-value" id="statMarketOrders">0</div>
                <div class="stat-sub">Ù†Ø´Ø·</div>
            </div>
        </div>
        
        <!-- Charts -->
        <div class="charts-grid">
            <div class="chart-card">
                <div class="chart-title">
                    <i class="fas fa-chart-line"></i> Ù†Ù…Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                </div>
                <div class="chart-container">
                    <canvas id="usersChart"></canvas>
                </div>
            </div>
            
            <div class="chart-card">
                <div class="chart-title">
                    <i class="fas fa-chart-pie"></i> ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯
                </div>
                <div class="chart-container">
                    <canvas id="resourcesChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Tabs -->
        <div class="tabs">
            <div class="tab active" onclick="switchTab('users')">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
            <div class="tab" onclick="switchTab('orders')">Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³ÙˆÙ‚</div>
            <div class="tab" onclick="switchTab('transactions')">Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</div>
            <div class="tab" onclick="switchTab('withdrawals')">Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨</div>
            <div class="tab" onclick="switchTab('deposits')">Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª</div>
            <div class="tab" onclick="switchTab('bounties')">Ø§Ù„Ø¨ounties</div>
            <div class="tab" onclick="switchTab('tasks')">Ø§Ù„Ù…Ù‡Ø§Ù…</div>
            <div class="tab" onclick="switchTab('referrals')">Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª</div>
        </div>
        
        <!-- Users Table -->
        <div id="usersTab" class="table-container" style="display: block;">
            <div class="table-header">
                <div class="table-title">
                    <i class="fas fa-users"></i> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                </div>
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Ø¨Ø­Ø«..." onkeyup="searchUsers(this.value)">
                </div>
            </div>
            
            <table id="usersTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                        <th>ğŸ® Ø¨Ù‚Ø±</th>
                        <th>ğŸ” Ø¯Ø¬Ø§Ø¬</th>
                        <th>ğŸ’ ÙƒØ±ÙŠØ³ØªØ§Ù„</th>
                        <th>ğŸ¥› Ø­Ù„ÙŠØ¨</th>
                        <th>ğŸ¥š Ø¨ÙŠØ¶</th>
                        <th>ğŸ’° TON</th>
                        <th>Ø§Ù„Ù…Ø­Ø§Ù„ÙŠÙ†</th>
                        <th>Ø¢Ø®Ø± Ù†Ø´Ø§Ø·</th>
                        <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                </thead>
                <tbody id="usersTableBody">
                    <tr>
                        <td colspan="11" class="loading">
                            <i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Orders Table -->
        <div id="ordersTab" class="table-container" style="display: none;">
            <div class="table-header">
                <div class="table-title">
                    <i class="fas fa-shopping-cart"></i> Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù†Ø´Ø·Ø©
                </div>
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Ø¨Ø­Ø«..." onkeyup="searchOrders(this.value)">
                </div>
            </div>
            
            <table id="ordersTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Ø§Ù„Ø¨Ø§Ø¦Ø¹</th>
                        <th>Ø§Ù„Ù†ÙˆØ¹</th>
                        <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
                        <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                        <th>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th>
                        <th>Ø§Ù„Ø³Ø¹Ø±/ÙˆØ­Ø¯Ø©</th>
                        <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                </thead>
                <tbody id="ordersTableBody">
                    <tr>
                        <td colspan="10" class="loading">
                            <i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Transactions Table -->
        <div id="transactionsTab" class="table-container" style="display: none;">
            <div class="table-header">
                <div class="table-title">
                    <i class="fas fa-history"></i> Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª
                </div>
                <select class="form-select" style="width: 150px;" onchange="filterTransactions(this.value)">
                    <option value="all">Ø§Ù„ÙƒÙ„</option>
                    <option value="deposit">Ø¥ÙŠØ¯Ø§Ø¹</option>
                    <option value="withdrawal">Ø³Ø­Ø¨</option>
                    <option value="buy_cow">Ø´Ø±Ø§Ø¡ Ø¨Ù‚Ø±Ø©</option>
                    <option value="buy_chicken">Ø´Ø±Ø§Ø¡ Ø¯Ø¬Ø§Ø¬Ø©</option>
                    <option value="diamond_conversion">ØªØ­ÙˆÙŠÙ„ ÙƒØ±ÙŠØ³ØªØ§Ù„</option>
                    <option value="market_buy">Ø´Ø±Ø§Ø¡ Ù…Ù† Ø§Ù„Ø³ÙˆÙ‚</option>
                    <option value="market_sell">Ø¨ÙŠØ¹ ÙÙŠ Ø§Ù„Ø³ÙˆÙ‚</option>
                </select>
            </div>
            
            <table id="transactionsTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                        <th>Ø§Ù„Ù†ÙˆØ¹</th>
                        <th>Ø§Ù„ØªÙØ§ØµÙŠÙ„</th>
                        <th>Ø§Ù„ÙƒÙ…ÙŠØ© (TON)</th>
                        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    </tr>
                </thead>
                <tbody id="transactionsTableBody">
                    <tr>
                        <td colspan="7" class="loading">
                            <i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Withdrawals Table -->
        <div id="withdrawalsTab" class="table-container" style="display: none;">
            <div class="table-header">
                <div class="table-title">
                    <i class="fas fa-arrow-up"></i> Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨
                </div>
                <select class="form-select" style="width: 150px;" onchange="filterWithdrawals(this.value)">
                    <option value="all">Ø§Ù„ÙƒÙ„</option>
                    <option value="pending">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</option>
                    <option value="completed">Ù…ÙƒØªÙ…Ù„</option>
                    <option value="rejected">Ù…Ø±ÙÙˆØ¶</option>
                </select>
            </div>
            
            <table id="withdrawalsTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                        <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                        <th>Ø§Ù„Ø±Ø³ÙˆÙ…</th>
                        <th>Ø§Ù„ØµØ§ÙÙŠ</th>
                        <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                </thead>
                <tbody id="withdrawalsTableBody">
                    <tr>
                        <td colspan="9" class="loading">
                            <i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Deposits Table -->
        <div id="depositsTab" class="table-container" style="display: none;">
            <div class="table-header">
                <div class="table-title">
                    <i class="fas fa-arrow-down"></i> Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª
                </div>
                <select class="form-select" style="width: 150px;" onchange="filterDeposits(this.value)">
                    <option value="all">Ø§Ù„ÙƒÙ„</option>
                    <option value="pending">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</option>
                    <option value="completed">Ù…ÙƒØªÙ…Ù„</option>
                </select>
            </div>
            
            <table id="depositsTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                        <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                        <th>Tx Hash</th>
                        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                </thead>
                <tbody id="depositsTableBody">
                    <tr>
                        <td colspan="7" class="loading">
                            <i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Bounties Table -->
        <div id="bountiesTab" class="table-container" style="display: none;">
            <div class="table-header">
                <div class="table-title">
                    <i class="fas fa-gift"></i> Ø·Ù„Ø¨Ø§Øª Bounty
                </div>
                <select class="form-select" style="width: 150px;" onchange="filterBounties(this.value)">
                    <option value="all">Ø§Ù„ÙƒÙ„</option>
                    <option value="pending">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</option>
                    <option value="approved">Ù…Ù‚Ø¨ÙˆÙ„</option>
                    <option value="rejected">Ù…Ø±ÙÙˆØ¶</option>
                </select>
            </div>
            
            <table id="bountiesTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                        <th>Ø§Ù„Ù…Ù†ØµØ©</th>
                        <th>Ø§Ù„Ø±Ø§Ø¨Ø·</th>
                        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        <th>Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©</th>
                        <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                </thead>
                <tbody id="bountiesTableBody">
                    <tr>
                        <td colspan="8" class="loading">
                            <i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Tasks Table -->
        <div id="tasksTab" class="table-container" style="display: none;">
            <div class="table-header">
                <div class="table-title">
                    <i class="fas fa-tasks"></i> Ø§Ù„Ù…Ù‡Ø§Ù…
                </div>
                <button class="btn btn-primary" onclick="openAddTaskModal()">
                    <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©
                </button>
            </div>
            
            <table id="tasksTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Ø§Ù„Ù†ÙˆØ¹</th>
                        <th>Ø§Ù„Ø±Ø§Ø¨Ø·</th>
                        <th>Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù</th>
                        <th>Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª</th>
                        <th>Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©</th>
                        <th>Ø§Ù„Ù…Ù†Ø´Ø¦</th>
                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†ØªÙ‡Ø§Ø¡</th>
                        <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                </thead>
                <tbody id="tasksTableBody">
                    <tr>
                        <td colspan="10" class="loading">
                            <i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Referrals Table -->
        <div id="referralsTab" class="table-container" style="display: none;">
            <div class="table-header">
                <div class="table-title">
                    <i class="fas fa-link"></i> Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª
                </div>
            </div>
            
            <table id="referralsTable">
                <thead>
                    <tr>
                        <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                        <th>ÙƒÙˆØ¯ Ø§Ù„Ø¥Ø­Ø§Ù„Ø©</th>
                        <th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§Ù„ÙŠÙ†</th>
                        <th>Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª</th>
                        <th>Ø§Ù„Ù…Ø­Ø§Ù„ Ø¨ÙˆØ§Ø³Ø·Ø©</th>
                    </tr>
                </thead>
                <tbody id="referralsTableBody">
                    <tr>
                        <td colspan="5" class="loading">
                            <i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- User Details Modal -->
    <div class="modal-overlay" id="userModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-user"></i> ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                </div>
                <i class="fas fa-times modal-close" onclick="closeModal('userModal')"></i>
            </div>
            
            <div id="userDetails"></div>
            
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="addBalance()">
                    <i class="fas fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ø±ØµÙŠØ¯
                </button>
                <button class="btn btn-primary" onclick="editUser()">
                    <i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„
                </button>
                <button class="btn btn-danger" onclick="banUser()">
                    <i class="fas fa-ban"></i> Ø­Ø¸Ø±
                </button>
            </div>
        </div>
    </div>
    
    <!-- Add Balance Modal -->
    <div class="modal-overlay" id="balanceModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-coins"></i> Ø¥Ø¶Ø§ÙØ© Ø±ØµÙŠØ¯
                </div>
                <i class="fas fa-times modal-close" onclick="closeModal('balanceModal')"></i>
            </div>
            
            <div class="form-group">
                <label class="form-label">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                <input type="text" id="balanceUserId" class="form-input" readonly>
            </div>
            
            <div class="form-group">
                <label class="form-label">Ø§Ù„Ù…Ø¨Ù„Øº (TON)</label>
                <input type="number" id="balanceAmount" class="form-input" step="0.1" min="0.1">
            </div>
            
            <div class="form-group">
                <label class="form-label">Ø§Ù„Ø³Ø¨Ø¨</label>
                <select id="balanceReason" class="form-select">
                    <option value="bonus">Ù…ÙƒØ§ÙØ£Ø©</option>
                    <option value="refund">Ø§Ø³ØªØ±Ø¯Ø§Ø¯</option>
                    <option value="compensation">ØªØ¹ÙˆÙŠØ¶</option>
                    <option value="other">Ø£Ø®Ø±Ù‰</option>
                </select>
            </div>
            
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal('balanceModal')">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn btn-primary" onclick="confirmAddBalance()">ØªØ£ÙƒÙŠØ¯</button>
            </div>
        </div>
    </div>
    
    <!-- Edit User Modal -->
    <div class="modal-overlay" id="editUserModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                </div>
                <i class="fas fa-times modal-close" onclick="closeModal('editUserModal')"></i>
            </div>
            
            <div class="form-group">
                <label class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„</label>
                <input type="text" id="editFirstName" class="form-input">
            </div>
            
            <div class="form-group">
                <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                <input type="text" id="editUsername" class="form-input">
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">ğŸ¥› Ø§Ù„Ø­Ù„ÙŠØ¨</label>
                    <input type="number" id="editMilk" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">ğŸ¥š Ø§Ù„Ø¨ÙŠØ¶</label>
                    <input type="number" id="editEggs" class="form-input">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">ğŸ’ Ø§Ù„ÙƒØ±ÙŠØ³ØªØ§Ù„</label>
                    <input type="number" id="editDiamond" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">ğŸ’° TON</label>
                    <input type="number" id="editTon" class="form-input" step="0.1">
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal('editUserModal')">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn btn-primary" onclick="saveUserEdit()">Ø­ÙØ¸</button>
            </div>
        </div>
    </div>
    
    <!-- Bounty Review Modal -->
    <div class="modal-overlay" id="bountyModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-gift"></i> Ù…Ø±Ø§Ø¬Ø¹Ø© Bounty
                </div>
                <i class="fas fa-times modal-close" onclick="closeModal('bountyModal')"></i>
            </div>
            
            <div id="bountyDetails"></div>
            
            <div class="form-group">
                <label class="form-label">Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© (1-50 TON)</label>
                <input type="number" id="bountyReward" class="form-input" min="1" max="50" step="0.1" value="1">
            </div>
            
            <div class="form-group">
                <label class="form-label">Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶ (ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø±ÙØ¶)</label>
                <input type="text" id="bountyRejectReason" class="form-input" placeholder="...">
            </div>
            
            <div class="modal-actions">
                <button class="btn btn-danger" onclick="rejectBounty()">
                    <i class="fas fa-times"></i> Ø±ÙØ¶
                </button>
                <button class="btn btn-success" onclick="approveBounty()">
                    <i class="fas fa-check"></i> Ù‚Ø¨ÙˆÙ„
                </button>
            </div>
        </div>
    </div>
    
    <!-- Withdrawal Action Modal -->
    <div class="modal-overlay" id="withdrawalModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-hand-holding-usd"></i> Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø³Ø­Ø¨
                </div>
                <i class="fas fa-times modal-close" onclick="closeModal('withdrawalModal')"></i>
            </div>
            
            <div id="withdrawalDetails"></div>
            
            <div class="form-group">
                <label class="form-label">Tx Hash (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                <input type="text" id="withdrawalTxHash" class="form-input" placeholder="...">
            </div>
            
            <div class="modal-actions">
                <button class="btn btn-danger" onclick="rejectWithdrawal()">
                    <i class="fas fa-times"></i> Ø±ÙØ¶
                </button>
                <button class="btn btn-success" onclick="completeWithdrawal()">
                    <i class="fas fa-check"></i> ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
                </button>
            </div>
        </div>
    </div>
    
    <!-- Add Task Modal -->
    <div class="modal-overlay" id="addTaskModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©
                </div>
                <i class="fas fa-times modal-close" onclick="closeModal('addTaskModal')"></i>
            </div>
            
            <div class="form-group">
                <label class="form-label">Ø§Ù„Ù†ÙˆØ¹</label>
                <select id="taskType" class="form-select">
                    <option value="channel">ğŸ“¢ Ù‚Ù†Ø§Ø©</option>
                    <option value="bot">ğŸ¤– Ø¨ÙˆØª</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Ø§Ù„Ø±Ø§Ø¨Ø·</label>
                <input type="text" id="taskLink" class="form-input" placeholder="https://t.me/...">
            </div>
            
            <div class="form-group">
                <label class="form-label">Ø§Ù„Ø§Ø³Ù…</label>
                <input type="text" id="taskName" class="form-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø©">
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© (TON)</label>
                    <input type="number" id="taskReward" class="form-input" value="0.001" step="0.001" min="0.001">
                </div>
                <div class="form-group">
                    <label class="form-label">Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù</label>
                    <input type="number" id="taskTarget" class="form-input" value="1000" min="100">
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‡Ù…Ø©</label>
                <select id="taskCategory" class="form-select">
                    <option value="partner">Ø´Ø±ÙŠÙƒØ© (Partner)</option>
                    <option value="community">Ù…Ø¬ØªÙ…Ø¹ (Community)</option>
                </select>
            </div>
            
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal('addTaskModal')">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn btn-primary" onclick="createTask()">Ø¥Ù†Ø´Ø§Ø¡</button>
            </div>
        </div>
    </div>
    
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC5dwRaz3L-aK7I5CoPkbB31MzXB62lgrU",
            authDomain: "earnmoney124553.firebaseapp.com",
            databaseURL: "https://earnmoney124553-default-rtdb.firebaseio.com",
            projectId: "earnmoney124553",
            storageBucket: "earnmoney124553.firebasestorage.app",
            messagingSenderId: "325528918523",
            appId: "1:325528918523:web:73d84f48a24c1e0cbfd35e",
            measurementId: "G-G1H96Q5XCJ"
        };
        
        // Admin Authentication (Simple - in production use Firebase Auth)
        const ADMIN_PASSWORD = "CrystalAdmin2025";
        let isAuthenticated = sessionStorage.getItem('adminAuth') === 'true';
        
        if (!isAuthenticated) {
            const password = prompt("ğŸ” Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…:");
            if (password === ADMIN_PASSWORD) {
                sessionStorage.setItem('adminAuth', 'true');
                isAuthenticated = true;
            } else {
                document.body.innerHTML = '<div style="text-align: center; margin-top: 100px; color: white;"><h1>â›” ØºÙŠØ± Ù…ØµØ±Ø­ Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„</h1></div>';
                throw new Error("Unauthorized");
            }
        }
        
        // Global Data
        let allUsers = [];
        let allOrders = [];
        let allTransactions = [];
        let allWithdrawals = [];
        let allDeposits = [];
        let allBounties = [];
        let allTasks = [];
        let globalState = {};
        
        let charts = {
            users: null,
            resources: null
        };
        
        let currentUserId = null;
        let currentBountyId = null;
        let currentWithdrawalId = null;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadAllData();
            setupCharts();
        });
        
        // Firebase Helper Functions
        async function firebaseGet(path) {
            try {
                const url = `${firebaseConfig.databaseURL}/${path}.json`;
                const response = await fetch(url);
                return await response.json();
            } catch (error) {
                console.error('Firebase GET error:', error);
                return null;
            }
        }
        
        async function firebaseSet(path, data) {
            try {
                const url = `${firebaseConfig.databaseURL}/${path}.json`;
                const response = await fetch(url, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                return await response.json();
            } catch (error) {
                console.error('Firebase SET error:', error);
                return null;
            }
        }
        
        async function firebaseUpdate(path, data) {
            try {
                const url = `${firebaseConfig.databaseURL}/${path}.json`;
                const response = await fetch(url, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                return await response.json();
            } catch (error) {
                console.error('Firebase UPDATE error:', error);
                return null;
            }
        }
        
        async function firebaseDelete(path) {
            try {
                const url = `${firebaseConfig.databaseURL}/${path}.json`;
                const response = await fetch(url, {
                    method: 'DELETE'
                });
                return response.ok;
            } catch (error) {
                console.error('Firebase DELETE error:', error);
                return false;
            }
        }
        
        // Load All Data
        async function loadAllData() {
            showLoading();
            
            try {
                // Load users
                const usersData = await firebaseGet('users');
                if (usersData) {
                    allUsers = Object.entries(usersData).map(([id, data]) => ({
                        id,
                        ...data
                    }));
                }
                
                // Load global state
                globalState = await firebaseGet('global') || {};
                
                // Load orders
                const ordersData = await firebaseGet('orders');
                if (ordersData) {
                    allOrders = Object.entries(ordersData).map(([id, data]) => ({
                        id,
                        ...data
                    })).filter(order => order.status === 'active');
                }
                
                // Load deposits
                const depositsData = await firebaseGet('deposits');
                if (depositsData) {
                    allDeposits = Object.entries(depositsData).map(([id, data]) => ({
                        id,
                        ...data
                    }));
                }
                
                // Load withdrawals
                const withdrawalsData = await firebaseGet('withdrawals');
                if (withdrawalsData) {
                    allWithdrawals = Object.entries(withdrawalsData).map(([id, data]) => ({
                        id,
                        ...data
                    }));
                }
                
                // Load bounties
                const bountiesData = await firebaseGet('bounties');
                if (bountiesData) {
                    allBounties = Object.entries(bountiesData).map(([id, data]) => ({
                        id,
                        ...data
                    }));
                }
                
                // Load tasks (partner + community)
                const partnerTasks = await firebaseGet('tasks/partner') || {};
                const communityTasks = await firebaseGet('tasks/community') || {};
                
                allTasks = [
                    ...Object.entries(partnerTasks).map(([id, data]) => ({ id, ...data, category: 'partner' })),
                    ...Object.entries(communityTasks).map(([id, data]) => ({ id, ...data, category: 'community' }))
                ];
                
                // Load transactions (from users)
                allTransactions = [];
                for (const user of allUsers.slice(0, 50)) {
                    const userTransactions = await firebaseGet(`users/${user.id}/transactions`);
                    if (userTransactions) {
                        Object.entries(userTransactions).forEach(([id, data]) => {
                            allTransactions.push({
                                id,
                                userId: user.id,
                                userName: user.firstName || user.username || user.id,
                                ...data
                            });
                        });
                    }
                }
                allTransactions.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
                
                // Update UI
                updateStats();
                updateUsersTable();
                updateOrdersTable();
                updateTransactionsTable();
                updateWithdrawalsTable();
                updateDepositsTable();
                updateBountiesTable();
                updateTasksTable();
                updateReferralsTable();
                updateCharts();
                
            } catch (error) {
                console.error('Load data error:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            }
            
            hideLoading();
        }
        
        function showLoading() {
            document.querySelectorAll('.loading').forEach(el => {
                el.style.display = 'table-cell';
            });
        }
        
        function hideLoading() {
            document.querySelectorAll('.loading').forEach(el => {
                el.style.display = 'none';
            });
        }
        
        // Update Stats
        function updateStats() {
            document.getElementById('totalUsers').innerText = allUsers.length;
            document.getElementById('statTotalUsers').innerText = allUsers.length;
            
            const cowsSold = globalState.cows_sold || 0;
            const chickensSold = globalState.chickens_sold || 0;
            const cowsCap = 1000;
            const chickensCap = 1000;
            
            document.getElementById('statCowsSold').innerText = cowsSold;
            document.getElementById('statChickensSold').innerText = chickensSold;
            document.getElementById('cowsRemaining').innerText = `${cowsCap - cowsSold} Ù…ØªØ¨Ù‚ÙŠØ©`;
            document.getElementById('chickensRemaining').innerText = `${chickensCap - chickensSold} Ù…ØªØ¨Ù‚ÙŠØ©`;
            
            document.getElementById('cowProgress').style.width = `${(cowsSold / cowsCap) * 100}%`;
            document.getElementById('chickenProgress').style.width = `${(chickensSold / chickensCap) * 100}%`;
            
            document.getElementById('statDiamondPrice').innerText = globalState.diamond_price || 25;
            
            const totalTon = allUsers.reduce((sum, user) => sum + (user.tonBalance || 0), 0);
            document.getElementById('statTotalTon').innerText = totalTon.toFixed(2);
            
            document.getElementById('statMarketOrders').innerText = allOrders.length;
            document.getElementById('totalOrders').innerText = allOrders.length;
            
            const totalVolume = allOrders.reduce((sum, order) => sum + (order.remaining * order.pricePerUnit || 0), 0);
            document.getElementById('totalVolume').innerText = totalVolume.toFixed(2);
        }
        
        // Update Users Table
        function updateUsersTable(filter = '') {
            const tbody = document.getElementById('usersTableBody');
            
            let filteredUsers = allUsers;
            if (filter) {
                filter = filter.toLowerCase();
                filteredUsers = allUsers.filter(user => 
                    (user.id && user.id.includes(filter)) ||
                    (user.firstName && user.firstName.toLowerCase().includes(filter)) ||
                    (user.username && user.username.toLowerCase().includes(filter))
                );
            }
            
            if (filteredUsers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="11" style="text-align: center; padding: 30px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</td></tr>';
                return;
            }
            
            let html = '';
            filteredUsers.slice(0, 50).forEach(user => {
                const lastActive = user.updatedAt ? new Date(user.updatedAt).toLocaleDateString('ar-EG') : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                
                html += `<tr>
                    <td>${user.id.substring(0, 8)}...</td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 5px;">
                            ${user.photoUrl ? `<img src="${user.photoUrl}" style="width: 25px; height: 25px; border-radius: 50%;">` : ''}
                            <div>
                                <div style="font-weight: 600;">${user.firstName || 'Farmer'} ${user.lastName || ''}</div>
                                <div style="font-size: 10px; color: var(--text-muted);">@${user.username || 'unknown'}</div>
                            </div>
                        </div>
                    </td>
                    <td>${user.cows_owned || 0}</td>
                    <td>${user.chickens_owned || 0}</td>
                    <td>${user.diamond || 0}</td>
                    <td>${formatNumber(user.milk || 0)}</td>
                    <td>${formatNumber(user.eggs || 0)}</td>
                    <td>${(user.tonBalance || 0).toFixed(2)}</td>
                    <td>${user.referrals ? Object.keys(user.referrals).length : 0}</td>
                    <td>${lastActive}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="icon-btn" onclick="viewUser('${user.id}')"><i class="fas fa-eye"></i></button>
                            <button class="icon-btn edit" onclick="openEditUser('${user.id}')"><i class="fas fa-edit"></i></button>
                            <button class="icon-btn delete" onclick="deleteUser('${user.id}')"><i class="fas fa-trash"></i></button>
                        </div>
                    </td>
                </tr>`;
            });
            
            tbody.innerHTML = html;
        }
        
        // Update Orders Table
        function updateOrdersTable(filter = '') {
            const tbody = document.getElementById('ordersTableBody');
            
            let filteredOrders = allOrders;
            if (filter) {
                filter = filter.toLowerCase();
                filteredOrders = allOrders.filter(order => 
                    order.id.includes(filter) ||
                    order.userId.includes(filter)
                );
            }
            
            if (filteredOrders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" style="text-align: center; padding: 30px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù†Ø´Ø·Ø©</td></tr>';
                return;
            }
            
            let html = '';
            filteredOrders.slice(0, 30).forEach(order => {
                const user = allUsers.find(u => u.id === order.userId);
                const userName = user ? (user.firstName || user.username || order.userId.substring(0, 6)) : order.userId.substring(0, 6);
                const typeIcon = order.type === 'sell' ? 'ğŸ”´ Ø¨ÙŠØ¹' : 'ğŸŸ¢ Ø´Ø±Ø§Ø¡';
                const resourceIcon = order.resource === 'milk' ? 'ğŸ¥›' : 'ğŸ¥š';
                const total = order.remaining * order.pricePerUnit;
                
                html += `<tr>
                    <td>${order.id.substring(0, 8)}...</td>
                    <td>${userName}</td>
                    <td><span class="badge ${order.type === 'sell' ? 'badge-danger' : 'badge-success'}">${typeIcon}</span></td>
                    <td>${resourceIcon} ${order.resource === 'milk' ? 'Ø­Ù„ÙŠØ¨' : 'Ø¨ÙŠØ¶'}</td>
                    <td>${formatNumber(order.quantity)}</td>
                    <td>${formatNumber(order.remaining)}</td>
                    <td>${order.pricePerUnit.toFixed(4)} TON</td>
                    <td>${total.toFixed(2)} TON</td>
                    <td>${new Date(order.createdAt).toLocaleDateString('ar-EG')}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="icon-btn" onclick="viewOrder('${order.id}')"><i class="fas fa-eye"></i></button>
                            <button class="icon-btn delete" onclick="cancelOrder('${order.id}')"><i class="fas fa-times"></i></button>
                        </div>
                    </td>
                </tr>`;
            });
            
            tbody.innerHTML = html;
        }
        
        // Update Transactions Table
        function updateTransactionsTable(filter = 'all') {
            const tbody = document.getElementById('transactionsTableBody');
            
            let filtered = allTransactions;
            if (filter !== 'all') {
                filtered = allTransactions.filter(tx => tx.type === filter);
            }
            
            if (filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 30px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§Øª</td></tr>';
                return;
            }
            
            let html = '';
            filtered.slice(0, 50).forEach(tx => {
                let details = '';
                if (tx.type === 'deposit') details = `Ø¥ÙŠØ¯Ø§Ø¹ ${tx.amount} TON`;
                else if (tx.type === 'withdrawal') details = `Ø³Ø­Ø¨ ${tx.amount} TON`;
                else if (tx.type === 'buy_cow') details = `Ø´Ø±Ø§Ø¡ ${tx.quantity || 1} Ø¨Ù‚Ø±Ø©`;
                else if (tx.type === 'buy_chicken') details = `Ø´Ø±Ø§Ø¡ Ø¯Ø¬Ø§Ø¬Ø©`;
                else if (tx.type === 'diamond_conversion') details = `ØªØ­ÙˆÙŠÙ„ ${tx.diamondsUsed} ÙƒØ±ÙŠØ³ØªØ§Ù„`;
                else if (tx.type === 'market_buy') details = `Ø´Ø±Ø§Ø¡ ${tx.quantity} ${tx.resource}`;
                else if (tx.type === 'market_sell') details = `Ø¨ÙŠØ¹ ${tx.quantity} ${tx.resource}`;
                else details = tx.type;
                
                html += `<tr>
                    <td>${tx.id ? tx.id.substring(0, 8) : '...'}</td>
                    <td>${tx.userName || tx.userId}</td>
                    <td>${tx.type}</td>
                    <td>${details}</td>
                    <td>${(tx.amount || tx.totalCost || 0).toFixed(2)} TON</td>
                    <td>${tx.timestamp ? new Date(tx.timestamp).toLocaleString('ar-EG') : '-'}</td>
                    <td><span class="badge badge-success">Ù…ÙƒØªÙ…Ù„</span></td>
                </tr>`;
            });
            
            tbody.innerHTML = html;
        }
        
        // Update Withdrawals Table
        function updateWithdrawalsTable(filter = 'all') {
            const tbody = document.getElementById('withdrawalsTableBody');
            
            let filtered = allWithdrawals;
            if (filter !== 'all') {
                filtered = allWithdrawals.filter(w => w.status === filter);
            }
            
            if (filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 30px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø³Ø­Ø¨</td></tr>';
                return;
            }
            
            let html = '';
            filtered.slice(0, 30).forEach(w => {
                const user = allUsers.find(u => u.id === w.userId);
                const userName = user ? (user.firstName || user.username || w.userId.substring(0, 6)) : w.userId.substring(0, 6);
                
                let statusClass = 'badge-warning';
                let statusText = 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±';
                if (w.status === 'completed') {
                    statusClass = 'badge-success';
                    statusText = 'Ù…ÙƒØªÙ…Ù„';
                } else if (w.status === 'rejected') {
                    statusClass = 'badge-danger';
                    statusText = 'Ù…Ø±ÙÙˆØ¶';
                }
                
                html += `<tr>
                    <td>${w.id.substring(0, 8)}...</td>
                    <td>${userName}</td>
                    <td>${w.amount} TON</td>
                    <td>${w.fee} TON</td>
                    <td>${w.netAmount} TON</td>
                    <td>${w.address.substring(0, 10)}...</td>
                    <td>${new Date(w.createdAt).toLocaleDateString('ar-EG')}</td>
                    <td><span class="badge ${statusClass}">${statusText}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="icon-btn" onclick="viewWithdrawal('${w.id}')"><i class="fas fa-eye"></i></button>
                            ${w.status === 'pending' ? `
                                <button class="icon-btn edit" onclick="processWithdrawal('${w.id}')"><i class="fas fa-check"></i></button>
                                <button class="icon-btn delete" onclick="rejectWithdrawal('${w.id}')"><i class="fas fa-times"></i></button>
                            ` : ''}
                        </div>
                    </td>
                </tr>`;
            });
            
            tbody.innerHTML = html;
        }
        
        // Update Deposits Table
        function updateDepositsTable(filter = 'all') {
            const tbody = document.getElementById('depositsTableBody');
            
            let filtered = allDeposits;
            if (filter !== 'all') {
                filtered = allDeposits.filter(d => d.status === filter);
            }
            
            if (filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 30px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª</td></tr>';
                return;
            }
            
            let html = '';
            filtered.slice(0, 30).forEach(d => {
                const user = allUsers.find(u => u.id === d.userId);
                const userName = user ? (user.firstName || user.username || d.userId.substring(0, 6)) : d.userId.substring(0, 6);
                
                let statusClass = d.status === 'completed' ? 'badge-success' : 'badge-warning';
                let statusText = d.status === 'completed' ? 'Ù…ÙƒØªÙ…Ù„' : 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±';
                
                html += `<tr>
                    <td>${d.id.substring(0, 8)}...</td>
                    <td>${userName}</td>
                    <td>${d.amount} TON</td>
                    <td>${d.txHash ? d.txHash.substring(0, 10) + '...' : '-'}</td>
                    <td>${new Date(d.createdAt).toLocaleDateString('ar-EG')}</td>
                    <td><span class="badge ${statusClass}">${statusText}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="icon-btn" onclick="viewDeposit('${d.id}')"><i class="fas fa-eye"></i></button>
                            ${d.status === 'pending' ? `
                                <button class="icon-btn edit" onclick="confirmDeposit('${d.id}')"><i class="fas fa-check"></i></button>
                            ` : ''}
                        </div>
                    </td>
                </tr>`;
            });
            
            tbody.innerHTML = html;
        }
        
        // Update Bounties Table
        function updateBountiesTable(filter = 'all') {
            const tbody = document.getElementById('bountiesTableBody');
            
            let filtered = allBounties;
            if (filter !== 'all') {
                filtered = allBounties.filter(b => b.status === filter);
            }
            
            if (filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 30px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Bounty</td></tr>';
                return;
            }
            
            let html = '';
            filtered.slice(0, 30).forEach(b => {
                const user = allUsers.find(u => u.id === b.userId);
                const userName = user ? (user.firstName || user.username || b.userId.substring(0, 6)) : b.userId.substring(0, 6);
                
                let statusClass = 'badge-warning';
                let statusText = 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©';
                if (b.status === 'approved') {
                    statusClass = 'badge-success';
                    statusText = 'âœ… Ù…Ù‚Ø¨ÙˆÙ„';
                } else if (b.status === 'rejected') {
                    statusClass = 'badge-danger';
                    statusText = 'âŒ Ù…Ø±ÙÙˆØ¶';
                }
                
                html += `<tr>
                    <td>${b.id.substring(0, 8)}...</td>
                    <td>${userName}</td>
                    <td>${b.platform || '-'}</td>
                    <td><a href="${b.link}" target="_blank" style="color: var(--accent);">${b.link.substring(0, 20)}...</a></td>
                    <td>${new Date(b.createdAt).toLocaleDateString('ar-EG')}</td>
                    <td><span class="badge ${statusClass}">${statusText}</span></td>
                    <td>${b.reward ? b.reward + ' TON' : '-'}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="icon-btn" onclick="viewBounty('${b.id}')"><i class="fas fa-eye"></i></button>
                            ${b.status === 'pending' ? `
                                <button class="icon-btn edit" onclick="reviewBounty('${b.id}')"><i class="fas fa-gavel"></i></button>
                            ` : ''}
                        </div>
                    </td>
                </tr>`;
            });
            
            tbody.innerHTML = html;
        }
        
        // Update Tasks Table
        function updateTasksTable() {
            const tbody = document.getElementById('tasksTableBody');
            
            if (allTasks.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" style="text-align: center; padding: 30px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù…</td></tr>';
                return;
            }
            
            let html = '';
            allTasks.slice(0, 30).forEach(task => {
                const creator = allUsers.find(u => u.id === task.creatorId);
                const creatorName = creator ? (creator.firstName || creator.username || task.creatorId) : task.creatorId;
                
                let statusClass = task.status === 'active' ? 'badge-success' : 'badge-danger';
                let statusText = task.status === 'active' ? 'Ù†Ø´Ø·' : 'Ù…Ù†ØªÙ‡ÙŠ';
                
                html += `<tr>
                    <td>${task.id.substring(0, 8)}...</td>
                    <td>${task.type === 'channel' ? 'ğŸ“¢ Ù‚Ù†Ø§Ø©' : 'ğŸ¤– Ø¨ÙˆØª'}</td>
                    <td><a href="${task.link}" target="_blank" style="color: var(--accent);">${task.link.substring(0, 20)}...</a></td>
                    <td>${task.targetUsers || '-'}</td>
                    <td>${task.completions || 0}</td>
                    <td>${task.reward} TON</td>
                    <td>${creatorName}</td>
                    <td><span class="badge ${statusClass}">${statusText}</span></td>
                    <td>${task.expiresAt ? new Date(task.expiresAt).toLocaleDateString('ar-EG') : '-'}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="icon-btn edit" onclick="editTask('${task.id}')"><i class="fas fa-edit"></i></button>
                            <button class="icon-btn delete" onclick="deleteTask('${task.id}')"><i class="fas fa-trash"></i></button>
                        </div>
                    </td>
                </tr>`;
            });
            
            tbody.innerHTML = html;
        }
        
        // Update Referrals Table
        function updateReferralsTable() {
            const tbody = document.getElementById('referralsTableBody');
            
            let html = '';
            allUsers.slice(0, 50).forEach(user => {
                const referrals = user.referrals ? Object.keys(user.referrals).length : 0;
                const earnings = user.referralEarnings || 0;
                const referredBy = user.referredBy ? allUsers.find(u => u.id === user.referredBy) : null;
                const referredByName = referredBy ? (referredBy.firstName || referredBy.username || user.referredBy) : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯';
                
                html += `<tr>
                    <td>${user.firstName || user.username || user.id.substring(0, 8)}</td>
                    <td>${user.referralCode || '-'}</td>
                    <td>${referrals}</td>
                    <td>${earnings.toFixed(4)} TON</td>
                    <td>${referredByName}</td>
                </tr>`;
            });
            
            tbody.innerHTML = html;
        }
        
        // Charts
        function setupCharts() {
            // Users Growth Chart
            const ctx1 = document.getElementById('usersChart').getContext('2d');
            charts.users = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: ['ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ'],
                    datasets: [{
                        label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†',
                        data: [0, 0, 0, 0, 0, allUsers.length],
                        borderColor: '#FF5CA8',
                        backgroundColor: 'rgba(255,92,168,0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { grid: { color: 'rgba(255,255,255,0.1)' } },
                        x: { grid: { display: false } }
                    }
                }
            });
            
            // Resources Distribution Chart
            const ctx2 = document.getElementById('resourcesChart').getContext('2d');
            const totalMilk = allUsers.reduce((sum, u) => sum + (u.milk || 0), 0);
            const totalEggs = allUsers.reduce((sum, u) => sum + (u.eggs || 0), 0);
            const totalDiamond = allUsers.reduce((sum, u) => sum + (u.diamond || 0), 0);
            
            charts.resources = new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: ['Ø­Ù„ÙŠØ¨', 'Ø¨ÙŠØ¶', 'ÙƒØ±ÙŠØ³ØªØ§Ù„'],
                    datasets: [{
                        data: [totalMilk, totalEggs, totalDiamond],
                        backgroundColor: ['#FF5CA8', '#00F27A', '#00D4FF'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { color: 'white' } }
                    }
                }
            });
        }
        
        function updateCharts() {
            if (charts.resources) {
                const totalMilk = allUsers.reduce((sum, u) => sum + (u.milk || 0), 0);
                const totalEggs = allUsers.reduce((sum, u) => sum + (u.eggs || 0), 0);
                const totalDiamond = allUsers.reduce((sum, u) => sum + (u.diamond || 0), 0);
                
                charts.resources.data.datasets[0].data = [totalMilk, totalEggs, totalDiamond];
                charts.resources.update();
            }
        }
        
        // Tab Switching
        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`[onclick="switchTab('${tab}')"]`).classList.add('active');
            
            document.querySelectorAll('.table-container').forEach(container => {
                container.style.display = 'none';
            });
            
            document.getElementById(`${tab}Tab`).style.display = 'block';
        }
        
        // Search Functions
        function searchUsers(query) {
            updateUsersTable(query);
        }
        
        function searchOrders(query) {
            updateOrdersTable(query);
        }
        
        // Filter Functions
        function filterTransactions(filter) {
            updateTransactionsTable(filter);
        }
        
        function filterWithdrawals(filter) {
            updateWithdrawalsTable(filter);
        }
        
        function filterDeposits(filter) {
            updateDepositsTable(filter);
        }
        
        function filterBounties(filter) {
            updateBountiesTable(filter);
        }
        
        // User Actions
        function viewUser(userId) {
            currentUserId = userId;
            const user = allUsers.find(u => u.id === userId);
            if (!user) return;
            
            const details = document.getElementById('userDetails');
            details.innerHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    ${user.photoUrl ? `<img src="${user.photoUrl}" style="width: 80px; height: 80px; border-radius: 50%; margin-bottom: 10px;">` : ''}
                    <h3>${user.firstName || ''} ${user.lastName || ''}</h3>
                    <div style="color: var(--text-muted);">@${user.username || 'unknown'}</div>
                    <div style="margin-top: 5px;">ID: ${user.id}</div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                    <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 10px;">
                        <div style="color: var(--text-muted);">ğŸ® Ø¨Ù‚Ø±</div>
                        <div style="font-size: 20px; font-weight: 700;">${user.cows_owned || 0}</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 10px;">
                        <div style="color: var(--text-muted);">ğŸ” Ø¯Ø¬Ø§Ø¬</div>
                        <div style="font-size: 20px; font-weight: 700;">${user.chickens_owned || 0}</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 10px;">
                        <div style="color: var(--text-muted);">ğŸ’ ÙƒØ±ÙŠØ³ØªØ§Ù„</div>
                        <div style="font-size: 20px; font-weight: 700;">${user.diamond || 0}</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 10px;">
                        <div style="color: var(--text-muted);">ğŸ’° TON</div>
                        <div style="font-size: 20px; font-weight: 700;">${(user.tonBalance || 0).toFixed(2)}</div>
                    </div>
                </div>
                
                <div style="background: rgba(255,255,255,0.05); border-radius: 10px; padding: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>ğŸ¥› Ø­Ù„ÙŠØ¨</span>
                        <span style="font-weight: 700;">${formatNumber(user.milk || 0)}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>ğŸ¥š Ø¨ÙŠØ¶</span>
                        <span style="font-weight: 700;">${formatNumber(user.eggs || 0)}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø¶Ù…Ø§Ù…</span>
                        <span>${user.createdAt ? new Date(user.createdAt).toLocaleDateString('ar-EG') : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</span>
                    </div>
                </div>
            `;
            
            document.getElementById('userModal').classList.add('active');
        }
        
        function openEditUser(userId) {
            currentUserId = userId;
            const user = allUsers.find(u => u.id === userId);
            if (!user) return;
            
            document.getElementById('editFirstName').value = user.firstName || '';
            document.getElementById('editUsername').value = user.username || '';
            document.getElementById('editMilk').value = user.milk || 0;
            document.getElementById('editEggs').value = user.eggs || 0;
            document.getElementById('editDiamond').value = user.diamond || 0;
            document.getElementById('editTon').value = user.tonBalance || 0;
            
            document.getElementById('editUserModal').classList.add('active');
        }
        
        async function saveUserEdit() {
            if (!currentUserId) return;
            
            const updates = {
                firstName: document.getElementById('editFirstName').value,
                username: document.getElementById('editUsername').value,
                milk: parseInt(document.getElementById('editMilk').value) || 0,
                eggs: parseInt(document.getElementById('editEggs').value) || 0,
                diamond: parseInt(document.getElementById('editDiamond').value) || 0,
                tonBalance: parseFloat(document.getElementById('editTon').value) || 0,
                updatedAt: Date.now()
            };
            
            await firebaseUpdate(`users/${currentUserId}`, updates);
            closeModal('editUserModal');
            await loadAllData();
            alert('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­');
        }
        
        function addBalance() {
            document.getElementById('balanceUserId').value = currentUserId;
            document.getElementById('balanceModal').classList.add('active');
        }
        
        async function confirmAddBalance() {
            const userId = document.getElementById('balanceUserId').value;
            const amount = parseFloat(document.getElementById('balanceAmount').value);
            const reason = document.getElementById('balanceReason').value;
            
            if (!amount || amount <= 0) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­');
                return;
            }
            
            const user = allUsers.find(u => u.id === userId);
            if (!user) return;
            
            const newBalance = (user.tonBalance || 0) + amount;
            await firebaseUpdate(`users/${userId}`, {
                tonBalance: newBalance,
                updatedAt: Date.now()
            });
            
            await firebasePush(`users/${userId}/transactions`, {
                type: 'admin_deposit',
                amount: amount,
                reason: reason,
                timestamp: Date.now()
            });
            
            closeModal('balanceModal');
            await loadAllData();
            alert(`âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© ${amount} TON Ø¨Ù†Ø¬Ø§Ø­`);
        }
        
        async function deleteUser(userId) {
            if (!confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ')) return;
            
            await firebaseDelete(`users/${userId}`);
            await loadAllData();
            alert('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
        }
        
        // Order Actions
        async function cancelOrder(orderId) {
            if (!confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ')) return;
            
            const order = allOrders.find(o => o.id === orderId);
            if (!order) return;
            
            // Update order status
            await firebaseUpdate(`orders/${orderId}`, {
                status: 'cancelled',
                updatedAt: Date.now()
            });
            
            // Refund to user
            if (order.type === 'sell') {
                const user = allUsers.find(u => u.id === order.userId);
                if (user) {
                    const currentBalance = order.resource === 'milk' ? (user.milk || 0) : (user.eggs || 0);
                    await firebaseUpdate(`users/${order.userId}`, {
                        [order.resource]: currentBalance + order.remaining,
                        updatedAt: Date.now()
                    });
                }
            } else {
                const user = allUsers.find(u => u.id === order.userId);
                if (user) {
                    const refund = order.remaining * order.pricePerUnit;
                    await firebaseUpdate(`users/${order.userId}`, {
                        tonBalance: (user.tonBalance || 0) + refund,
                        updatedAt: Date.now()
                    });
                }
            }
            
            await loadAllData();
            alert('âœ… ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨');
        }
        
        // Bounty Actions
        function reviewBounty(bountyId) {
            currentBountyId = bountyId;
            const bounty = allBounties.find(b => b.id === bountyId);
            if (!bounty) return;
            
            const user = allUsers.find(u => u.id === bounty.userId);
            const userName = user ? (user.firstName || user.username || bounty.userId) : bounty.userId;
            
            document.getElementById('bountyDetails').innerHTML = `
                <div style="margin-bottom: 15px;">
                    <p><strong>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</strong> ${userName}</p>
                    <p><strong>Ø§Ù„Ù…Ù†ØµØ©:</strong> ${bounty.platform || '-'}</p>
                    <p><strong>Ø§Ù„Ø±Ø§Ø¨Ø·:</strong> <a href="${bounty.link}" target="_blank" style="color: var(--accent);">${bounty.link}</a></p>
                    <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…:</strong> ${new Date(bounty.createdAt).toLocaleString('ar-EG')}</p>
                </div>
            `;
            
            document.getElementById('bountyModal').classList.add('active');
        }
        
        async function approveBounty() {
            if (!currentBountyId) return;
            
            const reward = parseFloat(document.getElementById('bountyReward').value);
            if (!reward || reward < 1 || reward > 50) {
                alert('Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø¨ÙŠÙ† 1 Ùˆ 50 TON');
                return;
            }
            
            const bounty = allBounties.find(b => b.id === currentBountyId);
            if (!bounty) return;
            
            // Update bounty status
            await firebaseUpdate(`bounties/${currentBountyId}`, {
                status: 'approved',
                reward: reward,
                reviewedAt: Date.now(),
                updatedAt: Date.now()
            });
            
            await firebaseUpdate(`users/${bounty.userId}/bounties/${currentBountyId}`, {
                status: 'approved',
                reward: reward,
                reviewedAt: Date.now(),
                updatedAt: Date.now()
            });
            
            // Add reward to user balance
            const user = allUsers.find(u => u.id === bounty.userId);
            if (user) {
                await firebaseUpdate(`users/${bounty.userId}`, {
                    tonBalance: (user.tonBalance || 0) + reward,
                    updatedAt: Date.now()
                });
            }
            
            closeModal('bountyModal');
            await loadAllData();
            alert(`âœ… ØªÙ… Ù‚Ø¨ÙˆÙ„ bounty ÙˆØ¥Ø¶Ø§ÙØ© ${reward} TON Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…`);
        }
        
        async function rejectBounty() {
            if (!currentBountyId) return;
            
            const reason = document.getElementById('bountyRejectReason').value || 'Ù„Ù… ÙŠØ³ØªÙˆÙÙŠ Ø§Ù„Ø´Ø±ÙˆØ·';
            
            await firebaseUpdate(`bounties/${currentBountyId}`, {
                status: 'rejected',
                rejectReason: reason,
                reviewedAt: Date.now(),
                updatedAt: Date.now()
            });
            
            await firebaseUpdate(`users/${bounty.userId}/bounties/${currentBountyId}`, {
                status: 'rejected',
                rejectReason: reason,
                reviewedAt: Date.now(),
                updatedAt: Date.now()
            });
            
            closeModal('bountyModal');
            await loadAllData();
            alert('âœ… ØªÙ… Ø±ÙØ¶ bounty');
        }
        
        // Withdrawal Actions
        function processWithdrawal(withdrawalId) {
            currentWithdrawalId = withdrawalId;
            const withdrawal = allWithdrawals.find(w => w.id === withdrawalId);
            if (!withdrawal) return;
            
            const user = allUsers.find(u => u.id === withdrawal.userId);
            const userName = user ? (user.firstName || user.username || withdrawal.userId) : withdrawal.userId;
            
            document.getElementById('withdrawalDetails').innerHTML = `
                <div style="margin-bottom: 15px;">
                    <p><strong>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</strong> ${userName}</p>
                    <p><strong>Ø§Ù„Ù…Ø¨Ù„Øº:</strong> ${withdrawal.amount} TON</p>
                    <p><strong>Ø§Ù„Ø±Ø³ÙˆÙ…:</strong> ${withdrawal.fee} TON</p>
                    <p><strong>Ø§Ù„ØµØ§ÙÙŠ:</strong> ${withdrawal.netAmount} TON</p>
                    <p><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${withdrawal.address}</p>
                    <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨:</strong> ${new Date(withdrawal.createdAt).toLocaleString('ar-EG')}</p>
                </div>
            `;
            
            document.getElementById('withdrawalModal').classList.add('active');
        }
        
        async function completeWithdrawal() {
            if (!currentWithdrawalId) return;
            
            const txHash = document.getElementById('withdrawalTxHash').value;
            
            await firebaseUpdate(`withdrawals/${currentWithdrawalId}`, {
                status: 'completed',
                txHash: txHash || 'manual',
                completedAt: Date.now(),
                updatedAt: Date.now()
            });
            
            closeModal('withdrawalModal');
            await loadAllData();
            alert('âœ… ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø³Ø­Ø¨');
        }
        
        async function rejectWithdrawal() {
            if (!currentWithdrawalId) return;
            
            if (!confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ÙØ¶ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø­Ø¨ØŸ')) return;
            
            const withdrawal = allWithdrawals.find(w => w.id === currentWithdrawalId);
            if (!withdrawal) return;
            
            // Refund to user
            const user = allUsers.find(u => u.id === withdrawal.userId);
            if (user) {
                await firebaseUpdate(`users/${withdrawal.userId}`, {
                    tonBalance: (user.tonBalance || 0) + withdrawal.amount,
                    updatedAt: Date.now()
                });
            }
            
            await firebaseUpdate(`withdrawals/${currentWithdrawalId}`, {
                status: 'rejected',
                updatedAt: Date.now()
            });
            
            closeModal('withdrawalModal');
            await loadAllData();
            alert('âœ… ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø³Ø­Ø¨ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø¨Ù„Øº Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…');
        }
        
        // Deposit Actions
        async function confirmDeposit(depositId) {
            if (!confirm('âš ï¸ ØªØ£ÙƒÙŠØ¯ Ø¥ÙŠØ¯Ø§Ø¹ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¨Ù„ØºØŸ')) return;
            
            const deposit = allDeposits.find(d => d.id === depositId);
            if (!deposit) return;
            
            // Update deposit status
            await firebaseUpdate(`deposits/${depositId}`, {
                status: 'completed',
                verified: true,
                updatedAt: Date.now()
            });
            
            await firebaseUpdate(`transactions/${deposit.txHash}`, {
                status: 'completed',
                verified: true,
                updatedAt: Date.now()
            });
            
            // Add to user balance
            const user = allUsers.find(u => u.id === deposit.userId);
            if (user) {
                await firebaseUpdate(`users/${deposit.userId}`, {
                    tonBalance: (user.tonBalance || 0) + deposit.amount,
                    updatedAt: Date.now()
                });
            }
            
            await loadAllData();
            alert('âœ… ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ ÙˆØ¥Ø¶Ø§ÙØ© Ø§Ù„Ø±ØµÙŠØ¯');
        }
        
        // Task Actions
        function openAddTaskModal() {
            document.getElementById('addTaskModal').classList.add('active');
        }
        
        async function createTask() {
            const type = document.getElementById('taskType').value;
            const link = document.getElementById('taskLink').value;
            const name = document.getElementById('taskName').value;
            const reward = parseFloat(document.getElementById('taskReward').value);
            const target = parseInt(document.getElementById('taskTarget').value);
            const category = document.getElementById('taskCategory').value;
            
            if (!link || !name) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
                return;
            }
            
            const now = Date.now();
            const taskId = `task_${now}_${Math.random().toString(36).substring(2, 10)}`;
            
            const taskData = {
                id: taskId,
                type: type,
                link: link,
                name: name,
                reward: reward,
                targetUsers: target,
                completions: 0,
                completedBy: [],
                status: 'active',
                createdAt: now,
                expiresAt: now + (30 * 24 * 60 * 60 * 1000),
                updatedAt: now,
                creatorId: 'admin'
            };
            
            await firebaseSet(`tasks/${category}/${taskId}`, taskData);
            
            closeModal('addTaskModal');
            await loadAllData();
            alert('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­');
        }
        
        async function deleteTask(taskId) {
            if (!confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‡Ù…Ø©ØŸ')) return;
            
            const task = allTasks.find(t => t.id === taskId);
            if (!task) return;
            
            await firebaseDelete(`tasks/${task.category}/${taskId}`);
            await loadAllData();
            alert('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø©');
        }
        
        // Utility Functions
        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            currentUserId = null;
            currentBountyId = null;
            currentWithdrawalId = null;
        }
        
        function refreshData() {
            loadAllData();
        }
        
        function exportData() {
            const data = {
                users: allUsers,
                orders: allOrders,
                withdrawals: allWithdrawals,
                deposits: allDeposits,
                bounties: allBounties,
                tasks: allTasks,
                global: globalState,
                timestamp: Date.now()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `crystal_ranch_backup_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            alert('âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
        }
        
        function logout() {
            sessionStorage.removeItem('adminAuth');
            location.reload();
        }
        
        // Expose functions to global scope
        window.switchTab = switchTab;
        window.searchUsers = searchUsers;
        window.searchOrders = searchOrders;
        window.filterTransactions = filterTransactions;
        window.filterWithdrawals = filterWithdrawals;
        window.filterDeposits = filterDeposits;
        window.filterBounties = filterBounties;
        window.viewUser = viewUser;
        window.openEditUser = openEditUser;
        window.addBalance = addBalance;
        window.deleteUser = deleteUser;
        window.cancelOrder = cancelOrder;
        window.viewWithdrawal = processWithdrawal;
        window.processWithdrawal = processWithdrawal;
        window.reviewBounty = reviewBounty;
        window.openAddTaskModal = openAddTaskModal;
        window.closeModal = closeModal;
        window.refreshData = refreshData;
        window.exportData = exportData;
        window.logout = logout;
    </script>
</body>
</html>

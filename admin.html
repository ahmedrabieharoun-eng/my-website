<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Firebase - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ ÙˆØ§Ù„Ù…Ù‡Ø§Ù…</title>
  <script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-database.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.0/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-900 text-white min-h-screen">
  <div class="p-6 max-w-7xl mx-auto">
    <h1 class="text-3xl font-bold mb-6 text-center">âš™ï¸ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Firebase - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ ÙˆØ§Ù„Ù…Ù‡Ø§Ù…</h1>

    <!-- Ù‚Ø³Ù… Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª -->
    <div class="flex flex-wrap gap-2 mb-6 border-b border-gray-700 pb-4">
      <button id="tab-data" class="tab-btn active px-4 py-2 rounded-lg bg-blue-600 text-white">ğŸ“Š Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</button>
      <button id="tab-codes" class="tab-btn px-4 py-2 rounded-lg bg-gray-700 text-white hover:bg-gray-600">ğŸ« Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ÙƒÙˆØ§Ø¯</button>
      <button id="tab-tasks" class="tab-btn px-4 py-2 rounded-lg bg-gray-700 text-white hover:bg-gray-600">ğŸ“‹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù…</button>
      <button id="tab-bot-requests" class="tab-btn px-4 py-2 rounded-lg bg-gray-700 text-white hover:bg-gray-600">ğŸ¤– Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¨ÙˆØª</button>
    </div>

    <!-- Ù‚Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© -->
    <div id="section-data" class="section active">
      <!-- Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¶Ø§ÙØ© -->
      <div class="bg-gray-800 p-4 rounded-lg mb-6">
        <h2 class="text-xl mb-2 font-semibold">â• Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</h2>
        <input id="newKey" placeholder="Ø§Ù„Ù…ÙØªØ§Ø­ (key)" class="p-2 rounded bg-gray-700 text-white w-full mb-2" />
        <textarea id="newValue" placeholder="Ø§Ù„Ù‚ÙŠÙ…Ø© (JSON Ø£Ùˆ Ù†Øµ)" class="p-2 rounded bg-gray-700 text-white w-full mb-2"></textarea>
        <button id="addBtn" class="bg-green-600 px-4 py-2 rounded hover:bg-green-500">Ø¥Ø¶Ø§ÙØ©</button>
      </div>

      <!-- Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
      <div class="bg-gray-800 p-4 rounded-lg shadow-md overflow-auto max-h-[70vh]" id="dataContainer">
        <p class="text-gray-400 text-center">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
      </div>
    </div>

    <!-- Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ -->
    <div id="section-codes" class="section">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙƒÙˆØ§Ø¯ Ø¬Ø¯ÙŠØ¯Ø© -->
        <div class="bg-gray-800 p-4 rounded-lg">
          <h2 class="text-xl mb-4 font-semibold">ğŸ« Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ Ø¬Ø¯ÙŠØ¯</h2>
          
          <div class="space-y-4">
            <div>
              <label class="block mb-2">Ù†ÙˆØ¹ Ø§Ù„ÙƒÙˆØ¯</label>
              <select id="codeType" class="w-full p-2 rounded bg-gray-700 text-white">
                <option value="contest">Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</option>
                <option value="ton">TON</option>
                <option value="rr">RR</option>
              </select>
            </div>
            
            <div id="codeValueContainer">
              <!-- Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù‚Ù„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„ÙƒÙˆØ¯ -->
            </div>
            
            <div>
              <label class="block mb-2">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</label>
              <input type="number" id="codeMaxUses" min="1" max="10000" value="100" class="w-full p-2 rounded bg-gray-700 text-white">
            </div>
            
            <div>
              <label class="block mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
              <input type="datetime-local" id="codeExpiry" class="w-full p-2 rounded bg-gray-700 text-white">
            </div>
            
            <div>
              <label class="block mb-2">ÙˆØµÙ Ø§Ù„ÙƒÙˆØ¯</label>
              <textarea id="codeDescription" placeholder="ÙˆØµÙ Ø§Ù„ÙƒÙˆØ¯..." class="w-full p-2 rounded bg-gray-700 text-white"></textarea>
            </div>
            
            <button id="generateCodeBtn" class="w-full bg-green-600 px-4 py-2 rounded hover:bg-green-500">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙˆØ¯</button>
          </div>
        </div>

        <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠØ© -->
        <div class="bg-gray-800 p-4 rounded-lg">
          <h2 class="text-xl mb-4 font-semibold">ğŸ“‹ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
          
          <div class="mb-4">
            <input type="text" id="searchCodes" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯..." class="w-full p-2 rounded bg-gray-700 text-white">
          </div>
          
          <div class="overflow-auto max-h-[500px]" id="codesList">
            <p class="text-gray-400 text-center">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯...</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù… -->
    <div id="section-tasks" class="section">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù‡Ø§Ù… Ø¬Ø¯ÙŠØ¯Ø© -->
        <div class="bg-gray-800 p-4 rounded-lg">
          <h2 class="text-xl mb-4 font-semibold">ğŸ“‹ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
          
          <div class="space-y-4">
            <div>
              <label class="block mb-2">Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‡Ù…Ø©</label>
              <select id="taskType" class="w-full p-2 rounded bg-gray-700 text-white">
                <option value="channel">Ø§Ù†Ø¶Ù…Ø§Ù… Ù‚Ù†Ø§Ø©</option>
                <option value="bot">Ù…Ù‡Ù…Ø© Ø§Ù„Ø¨ÙˆØª</option>
                <option value="custom">Ù…Ù‡Ù…Ø© Ù…Ø®ØµØµØ©</option>
              </select>
            </div>
            
            <div id="taskFormContainer">
              <!-- Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‡Ù…Ø© -->
            </div>
            
            <button id="createTaskBtn" class="w-full bg-green-600 px-4 py-2 rounded hover:bg-green-500">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©</button>
          </div>
        </div>

        <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø­Ø§Ù„ÙŠØ© -->
        <div class="bg-gray-800 p-4 rounded-lg">
          <h2 class="text-xl mb-4 font-semibold">ğŸ“Š Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
          
          <div class="mb-4 flex gap-2">
            <select id="filterTaskType" class="flex-1 p-2 rounded bg-gray-700 text-white">
              <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
              <option value="channel">Ø§Ù†Ø¶Ù…Ø§Ù… Ù‚Ù†Ø§Ø©</option>
              <option value="bot">Ù…Ù‡Ù…Ø© Ø§Ù„Ø¨ÙˆØª</option>
              <option value="custom">Ù…Ù‡Ù…Ø© Ù…Ø®ØµØµØ©</option>
            </select>
            <input type="text" id="searchTasks" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù‡Ø§Ù…..." class="flex-1 p-2 rounded bg-gray-700 text-white">
          </div>
          
          <div class="overflow-auto max-h-[500px]" id="tasksList">
            <p class="text-gray-400 text-center">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…...</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Ù‚Ø³Ù… Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¨ÙˆØª -->
    <div id="section-bot-requests" class="section">
      <div class="bg-gray-800 p-4 rounded-lg">
        <h2 class="text-xl mb-4 font-semibold">ğŸ¤– Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</h2>
        
        <div class="mb-4">
          <input type="text" id="searchBotRequests" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª..." class="w-full p-2 rounded bg-gray-700 text-white">
        </div>
        
        <div class="overflow-auto max-h-[600px]" id="botRequestsList">
          <p class="text-gray-400 text-center">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ -->
  <div id="editCodeModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-gray-800 p-6 rounded-lg w-full max-w-md">
      <h3 class="text-xl mb-4 font-semibold">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯</h3>
      <div id="editCodeForm"></div>
      <div class="flex gap-2 mt-4">
        <button id="saveCodeBtn" class="flex-1 bg-blue-600 px-4 py-2 rounded hover:bg-blue-500">Ø­ÙØ¸</button>
        <button id="cancelEditCodeBtn" class="flex-1 bg-gray-600 px-4 py-2 rounded hover:bg-gray-500">Ø¥Ù„ØºØ§Ø¡</button>
      </div>
    </div>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø© -->
  <div id="editTaskModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-gray-800 p-6 rounded-lg w-full max-w-2xl max-h-[90vh] overflow-auto">
      <h3 class="text-xl mb-4 font-semibold">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø©</h3>
      <div id="editTaskForm"></div>
      <div class="flex gap-2 mt-4">
        <button id="saveTaskBtn" class="flex-1 bg-blue-600 px-4 py-2 rounded hover:bg-blue-500">Ø­ÙØ¸</button>
        <button id="cancelEditTaskBtn" class="flex-1 bg-gray-600 px-4 py-2 rounded hover:bg-gray-500">Ø¥Ù„ØºØ§Ø¡</button>
      </div>
    </div>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© Ø¹Ø±Ø¶ ØµÙˆØ±Ø© Ø§Ù„Ø¨ÙˆØª -->
  <div id="imageModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden z-50">
    <div class="bg-gray-800 p-4 rounded-lg max-w-3xl max-h-[90vh] overflow-auto">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-semibold">ğŸ–¼ï¸ ØµÙˆØ±Ø© Ø§Ù„ØªØ­Ù‚Ù‚</h3>
        <button id="closeImageModal" class="text-gray-400 hover:text-white text-2xl">&times;</button>
      </div>
      <img id="modalImage" src="" alt="ØµÙˆØ±Ø© Ø§Ù„ØªØ­Ù‚Ù‚" class="max-w-full max-h-[70vh] rounded">
      <div class="mt-4 text-center">
        <button id="closeImageBtn" class="bg-gray-600 px-4 py-2 rounded hover:bg-gray-500">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="fixed bottom-4 left-4 bg-green-600 text-white p-4 rounded-lg shadow-lg hidden transition-opacity duration-300">
    <span id="toastMessage"></span>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
    import { getDatabase, ref, onValue, set, remove, update, push } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAcwYjMSpnOC1_MSFpBzctqiKRmhwLOtY4",
      authDomain: "dogs-boss.firebaseapp.com",
      databaseURL: "https://dogs-boss-default-rtdb.firebaseio.com",
      projectId: "dogs-boss",
      storageBucket: "dogs-boss.firebasestorage.app",
      messagingSenderId: "778183941825",
      appId: "1:778183941825:web:45a96727e1aad043bffe40",
      measurementId: "G-EY15XEGP53"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const dbRef = ref(db, '/');

    // Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    const sections = document.querySelectorAll('.section');
    const tabBtns = document.querySelectorAll('.tab-btn');
    const dataContainer = document.getElementById('dataContainer');
    const toast = document.getElementById('toast');
    const toastMessage = document.getElementById('toastMessage');

    // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    let currentData = {};
    let currentEditingCode = null;
    let currentEditingTask = null;

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    document.addEventListener('DOMContentLoaded', () => {
      initializeTabs();
      initializeDataSection();
      initializeCodesSection();
      initializeTasksSection();
      initializeBotRequestsSection();
      
      // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
      loadData();
    });

    // ÙˆØ¸ÙŠÙØ© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
    function showToast(message, isError = false) {
      toastMessage.textContent = message;
      toast.className = `fixed bottom-4 left-4 text-white p-4 rounded-lg shadow-lg transition-opacity duration-300 ${isError ? 'bg-red-600' : 'bg-green-600'}`;
      toast.classList.remove('hidden');
      
      setTimeout(() => {
        toast.classList.add('hidden');
      }, 3000);
    }

    // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
    function initializeTabs() {
      tabBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          const targetSection = btn.id.replace('tab-', 'section-');
          
          // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ÙˆØ¥Ù„ØºØ§Ø¡ ØªÙ†Ø´ÙŠØ· Ø§Ù„Ø£Ø²Ø±Ø§Ø±
          sections.forEach(section => section.classList.remove('active'));
          tabBtns.forEach(tab => tab.classList.remove('active', 'bg-blue-600'));
          
          // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø­Ø¯Ø¯ ÙˆØªÙ†Ø´ÙŠØ· Ø§Ù„Ø²Ø±
          document.getElementById(targetSection).classList.add('active');
          btn.classList.add('active', 'bg-blue-600');
          
          // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù‚Ø³Ù… Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
          if (targetSection === 'section-codes') {
            loadCodes();
          } else if (targetSection === 'section-tasks') {
            loadTasks();
          } else if (targetSection === 'section-bot-requests') {
            loadBotRequests();
          }
        });
      });
    }

    // Ù‚Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
    function initializeDataSection() {
      // Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©
      document.getElementById('addBtn').addEventListener('click', () => {
        const key = document.getElementById('newKey').value.trim();
        const val = document.getElementById('newValue').value.trim();
        if (!key || !val) {
          showToast("âš ï¸ Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…ÙØªØ§Ø­ ÙˆØ§Ù„Ù‚ÙŠÙ…Ø© Ø£ÙˆÙ„Ø§Ù‹!", true);
          return;
        }

        try {
          const parsed = JSON.parse(val);
          set(ref(db, key), parsed);
          showToast("âœ… ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­!");
          document.getElementById('newKey').value = "";
          document.getElementById('newValue').value = "";
        } catch {
          set(ref(db, key), val);
          showToast("âœ… ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© ÙƒÙ†Øµ!");
          document.getElementById('newKey').value = "";
          document.getElementById('newValue').value = "";
        }
      });
    }

    // Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ÙƒÙˆØ§Ø¯
    function initializeCodesSection() {
      // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†ÙˆØ¹
      document.getElementById('codeType').addEventListener('change', updateCodeValueField);
      
      // ØªÙ‡ÙŠØ¦Ø© Ø­Ù‚Ù„ Ø§Ù„Ù‚ÙŠÙ…Ø©
      updateCodeValueField();
      
      // Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ Ø¬Ø¯ÙŠØ¯
      document.getElementById('generateCodeBtn').addEventListener('click', generateNewCode);
      
      // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯
      document.getElementById('searchCodes').addEventListener('input', filterCodes);
    }

    function updateCodeValueField() {
      const codeType = document.getElementById('codeType').value;
      const container = document.getElementById('codeValueContainer');
      
      let html = '';
      
      switch(codeType) {
        case 'contest':
          html = `
            <label class="block mb-2">Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø· (10-1000)</label>
            <input type="number" id="codeValue" min="10" max="1000" value="50" class="w-full p-2 rounded bg-gray-700 text-white">
          `;
          break;
        case 'ton':
          html = `
            <label class="block mb-2">Ø§Ù„Ù…Ø¨Ù„Øº (0.001 - 1 TON)</label>
            <input type="number" id="codeValue" min="0.001" max="1" step="0.001" value="0.01" class="w-full p-2 rounded bg-gray-700 text-white">
          `;
          break;
        case 'rr':
          html = `
            <label class="block mb-2">Ø§Ù„Ù…Ø¨Ù„Øº (1000 - 100000 RR)</label>
            <input type="number" id="codeValue" min="1000" max="100000" value="5000" class="w-full p-2 rounded bg-gray-700 text-white">
          `;
          break;
      }
      
      container.innerHTML = html;
    }

    function generateNewCode() {
      const codeType = document.getElementById('codeType').value;
      const codeValue = parseFloat(document.getElementById('codeValue').value);
      const maxUses = parseInt(document.getElementById('codeMaxUses').value);
      const expiry = document.getElementById('codeExpiry').value;
      const description = document.getElementById('codeDescription').value.trim();
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      if (!codeValue || codeValue <= 0) {
        showToast("âš ï¸ Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© ØµØ­ÙŠØ­Ø© Ù„Ù„ÙƒÙˆØ¯!", true);
        return;
      }
      
      if (!maxUses || maxUses < 1) {
        showToast("âš ï¸ Ø£Ø¯Ø®Ù„ Ø­Ø¯ Ø§Ø³ØªØ®Ø¯Ø§Ù… ØµØ­ÙŠØ­!", true);
        return;
      }
      
      // Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ Ø¹Ø´ÙˆØ§Ø¦ÙŠ
      const code = generateRandomCode(8);
      
      // ØªØ­Ø¶ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒÙˆØ¯
      const codeData = {
        type: codeType,
        value: codeValue,
        maxUses: maxUses,
        usedCount: 0,
        description: description || `ÙƒÙˆØ¯ ${getCodeTypeName(codeType)}`,
        createdAt: new Date().toISOString(),
        isActive: true
      };
      
      if (expiry) {
        codeData.expires = new Date(expiry).getTime();
      }
      
      // Ø­ÙØ¸ Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Firebase
      const codesRef = ref(db, `codes/${code}`);
      set(codesRef, codeData)
        .then(() => {
          showToast(`âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙˆØ¯ ${code} Ø¨Ù†Ø¬Ø§Ø­!`);
          // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
          document.getElementById('codeDescription').value = '';
          document.getElementById('codeExpiry').value = '';
          // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ÙƒÙˆØ§Ø¯
          loadCodes();
        })
        .catch(error => {
          console.error('Error creating code:', error);
          showToast("âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙˆØ¯!", true);
        });
    }

    function generateRandomCode(length) {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
      let result = '';
      for (let i = 0; i < length; i++) {
        result += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return result;
    }

    function getCodeTypeName(type) {
      const names = {
        'contest': 'Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©',
        'ton': 'TON',
        'rr': 'RR'
      };
      return names[type] || type;
    }

    function loadCodes() {
      const codesRef = ref(db, 'codes');
      onValue(codesRef, (snapshot) => {
        const codes = snapshot.val();
        const codesList = document.getElementById('codesList');
        
        if (!codes) {
          codesList.innerHTML = '<p class="text-gray-400 text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙƒÙˆØ§Ø¯ Ø­Ø§Ù„ÙŠØ§Ù‹</p>';
          return;
        }
        
        let html = '';
        Object.entries(codes).forEach(([code, data]) => {
          const usagePercent = (data.usedCount / data.maxUses) * 100;
          const isExpired = data.expires && new Date().getTime() > data.expires;
          const isDisabled = !data.isActive || isExpired;
          
          html += `
            <div class="bg-gray-700 p-3 rounded mb-3 ${isDisabled ? 'opacity-60' : ''}">
              <div class="flex justify-between items-start mb-2">
                <div>
                  <h3 class="font-bold text-lg">${code}</h3>
                  <div class="flex items-center gap-2 mt-1">
                    <span class="code-type-badge code-type-${data.type}">${getCodeTypeName(data.type)}</span>
                    <span class="text-sm ${isDisabled ? 'text-red-400' : 'text-green-400'}">
                      ${isDisabled ? (isExpired ? 'Ù…Ù†ØªÙ‡ÙŠ' : 'Ù…Ø¹Ø·Ù„') : 'Ù†Ø´Ø·'}
                    </span>
                  </div>
                </div>
                <div class="text-right">
                  <div class="font-bold">${data.value} ${getCodeValueUnit(data.type)}</div>
                  <div class="text-sm text-gray-400">${data.usedCount}/${data.maxUses}</div>
                </div>
              </div>
              
              <div class="mb-2">
                <div class="w-full bg-gray-600 rounded-full h-2">
                  <div class="bg-blue-600 h-2 rounded-full" style="width: ${usagePercent}%"></div>
                </div>
              </div>
              
              <p class="text-sm text-gray-300 mb-2">${data.description}</p>
              
              <div class="flex justify-between text-xs text-gray-400">
                <span>Ø£Ù†Ø´Ø¦ ÙÙŠ: ${new Date(data.createdAt).toLocaleDateString('ar-EG')}</span>
                ${data.expires ? `<span>ÙŠÙ†ØªÙ‡ÙŠ ÙÙŠ: ${new Date(data.expires).toLocaleDateString('ar-EG')}</span>` : ''}
              </div>
              
              <div class="flex gap-2 mt-3">
                <button onclick="editCode('${code}')" class="flex-1 bg-blue-600 px-3 py-1 rounded text-sm hover:bg-blue-500">ØªØ¹Ø¯ÙŠÙ„</button>
                <button onclick="toggleCode('${code}', ${!isDisabled})" class="flex-1 ${isDisabled ? 'bg-green-600 hover:bg-green-500' : 'bg-yellow-600 hover:bg-yellow-500'} px-3 py-1 rounded text-sm">
                  ${isDisabled ? 'ØªÙØ¹ÙŠÙ„' : 'ØªØ¹Ø·ÙŠÙ„'}
                </button>
                <button onclick="deleteCode('${code}')" class="flex-1 bg-red-600 px-3 py-1 rounded text-sm hover:bg-red-500">Ø­Ø°Ù</button>
              </div>
            </div>
          `;
        });
        
        codesList.innerHTML = html;
      });
    }

    function getCodeValueUnit(type) {
      const units = {
        'contest': 'Ù†Ù‚Ø·Ø©',
        'ton': 'TON',
        'rr': 'RR'
      };
      return units[type] || '';
    }

    function filterCodes() {
      const searchTerm = document.getElementById('searchCodes').value.toLowerCase();
      const codeItems = document.querySelectorAll('#codesList > div');
      
      codeItems.forEach(item => {
        const codeText = item.textContent.toLowerCase();
        if (codeText.includes(searchTerm)) {
          item.style.display = 'block';
        } else {
          item.style.display = 'none';
        }
      });
    }

    // ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ (Ø³ÙŠØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¤Ù‡Ø§ Ù…Ù† Ø§Ù„Ø£Ø²Ø±Ø§Ø±)
    window.editCode = function(code) {
      const codesRef = ref(db, `codes/${code}`);
      onValue(codesRef, (snapshot) => {
        const codeData = snapshot.val();
        if (!codeData) return;
        
        currentEditingCode = code;
        
        let formHtml = `
          <div class="space-y-4">
            <div>
              <label class="block mb-2">Ø§Ù„ÙƒÙˆØ¯</label>
              <input type="text" value="${code}" class="w-full p-2 rounded bg-gray-700 text-white" readonly>
            </div>
            
            <div>
              <label class="block mb-2">Ù†ÙˆØ¹ Ø§Ù„ÙƒÙˆØ¯</label>
              <select id="editCodeType" class="w-full p-2 rounded bg-gray-700 text-white">
                <option value="contest" ${codeData.type === 'contest' ? 'selected' : ''}>Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</option>
                <option value="ton" ${codeData.type === 'ton' ? 'selected' : ''}>TON</option>
                <option value="rr" ${codeData.type === 'rr' ? 'selected' : ''}>RR</option>
              </select>
            </div>
            
            <div>
              <label class="block mb-2">Ø§Ù„Ù‚ÙŠÙ…Ø©</label>
              <input type="number" id="editCodeValue" value="${codeData.value}" class="w-full p-2 rounded bg-gray-700 text-white">
            </div>
            
            <div>
              <label class="block mb-2">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</label>
              <input type="number" id="editCodeMaxUses" value="${codeData.maxUses}" class="w-full p-2 rounded bg-gray-700 text-white">
            </div>
            
            <div>
              <label class="block mb-2">Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ</label>
              <input type="number" id="editCodeUsedCount" value="${codeData.usedCount}" class="w-full p-2 rounded bg-gray-700 text-white">
            </div>
            
            <div>
              <label class="block mb-2">ÙˆØµÙ Ø§Ù„ÙƒÙˆØ¯</label>
              <textarea id="editCodeDescription" class="w-full p-2 rounded bg-gray-700 text-white">${codeData.description || ''}</textarea>
            </div>
            
            <div class="flex items-center">
              <input type="checkbox" id="editCodeIsActive" ${codeData.isActive ? 'checked' : ''} class="mr-2">
              <label for="editCodeIsActive">Ø§Ù„ÙƒÙˆØ¯ Ù†Ø´Ø·</label>
            </div>
          </div>
        `;
        
        document.getElementById('editCodeForm').innerHTML = formHtml;
        document.getElementById('editCodeModal').classList.remove('hidden');
      }, { onlyOnce: true });
    };

    window.toggleCode = function(code, newState) {
      const codeRef = ref(db, `codes/${code}/isActive`);
      set(codeRef, newState)
        .then(() => {
          showToast(newState ? "âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯" : "âœ… ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯");
          loadCodes();
        })
        .catch(error => {
          console.error('Error toggling code:', error);
          showToast("âŒ ÙØ´Ù„ ÙÙŠ ØªØ¹Ø¯ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„ÙƒÙˆØ¯!", true);
        });
    };

    window.deleteCode = function(code) {
      if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ¯ ${code}ØŸ`)) {
        const codeRef = ref(db, `codes/${code}`);
        remove(codeRef)
          .then(() => {
            showToast("âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­");
            loadCodes();
          })
          .catch(error => {
            console.error('Error deleting code:', error);
            showToast("âŒ ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ¯!", true);
          });
      }
    };

    // Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙˆØ¯
    document.getElementById('saveCodeBtn').addEventListener('click', () => {
      if (!currentEditingCode) return;
      
      const codeType = document.getElementById('editCodeType').value;
      const codeValue = parseFloat(document.getElementById('editCodeValue').value);
      const maxUses = parseInt(document.getElementById('editCodeMaxUses').value);
      const usedCount = parseInt(document.getElementById('editCodeUsedCount').value);
      const description = document.getElementById('editCodeDescription').value.trim();
      const isActive = document.getElementById('editCodeIsActive').checked;
      
      const updates = {
        type: codeType,
        value: codeValue,
        maxUses: maxUses,
        usedCount: usedCount,
        description: description,
        isActive: isActive
      };
      
      const codeRef = ref(db, `codes/${currentEditingCode}`);
      update(codeRef, updates)
        .then(() => {
          showToast("âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­");
          document.getElementById('editCodeModal').classList.add('hidden');
          loadCodes();
        })
        .catch(error => {
          console.error('Error updating code:', error);
          showToast("âŒ ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙˆØ¯!", true);
        });
    });

    document.getElementById('cancelEditCodeBtn').addEventListener('click', () => {
      document.getElementById('editCodeModal').classList.add('hidden');
      currentEditingCode = null;
    });

    // Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù…
    function initializeTasksSection() {
      // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†ÙˆØ¹
      document.getElementById('taskType').addEventListener('change', updateTaskForm);
      
      // ØªÙ‡ÙŠØ¦Ø© Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ù‡Ù…Ø©
      updateTaskForm();
      
      // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©
      document.getElementById('createTaskBtn').addEventListener('click', createNewTask);
      
      // Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ© ÙÙŠ Ø§Ù„Ù…Ù‡Ø§Ù…
      document.getElementById('filterTaskType').addEventListener('change', filterTasks);
      document.getElementById('searchTasks').addEventListener('input', filterTasks);
    }

    function updateTaskForm() {
      const taskType = document.getElementById('taskType').value;
      const container = document.getElementById('taskFormContainer');
      
      let html = '';
      
      switch(taskType) {
        case 'channel':
          html = `
            <div>
              <label class="block mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø©</label>
              <input type="text" id="taskName" class="w-full p-2 rounded bg-gray-700 text-white" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø©">
            </div>
            
            <div>
              <label class="block mb-2">ÙˆØµÙ Ø§Ù„Ù…Ù‡Ù…Ø©</label>
              <textarea id="taskDescription" class="w-full p-2 rounded bg-gray-700 text-white" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ù‡Ù…Ø©"></textarea>
            </div>
            
            <div>
              <label class="block mb-2">Ø±Ø§Ø¨Ø· Ø§Ù„Ù‚Ù†Ø§Ø©</label>
              <input type="url" id="taskUrl" class="w-full p-2 rounded bg-gray-700 text-white" placeholder="https://t.me/channel">
            </div>
            
            <div>
              <label class="block mb-2">Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ù‡Ù…Ø© (Ø±Ø§Ø¨Ø·)</label>
              <input type="url" id="taskIcon" class="w-full p-2 rounded bg-gray-700 text-white" placeholder="https://example.com/icon.png">
            </div>
            
            <div>
              <label class="block mb-2">Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© (RR)</label>
              <input type="number" id="taskReward" min="100" value="1000" class="w-full p-2 rounded bg-gray-700 text-white">
            </div>
            
            <div class="flex items-center">
              <input type="checkbox" id="taskIsActive" checked class="mr-2">
              <label for="taskIsActive">Ø§Ù„Ù…Ù‡Ù…Ø© Ù†Ø´Ø·Ø©</label>
            </div>
          `;
          break;
          
        case 'bot':
          html = `
            <div>
              <label class="block mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø©</label>
              <input type="text" id="taskName" class="w-full p-2 rounded bg-gray-700 text-white" placeholder="Ø§Ø³Ù… Ù…Ù‡Ù…Ø© Ø§Ù„Ø¨ÙˆØª">
            </div>
            
            <div>
              <label class="block mb-2">ÙˆØµÙ Ø§Ù„Ù…Ù‡Ù…Ø©</label>
              <textarea id="taskDescription" class="w-full p-2 rounded bg-gray-700 text-white" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ù‡Ù…Ø©"></textarea>
            </div>
            
            <div>
              <label class="block mb-2">Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨ÙˆØª</label>
              <input type="url" id="taskUrl" class="w-full p-2 rounded bg-gray-700 text-white" placeholder="https://t.me/bot">
            </div>
            
            <div>
              <label class="block mb-2">Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© (RR)</label>
              <input type="number" id="taskReward" min="1000" value="5000" class="w-full p-2 rounded bg-gray-700 text-white">
            </div>
            
            <div>
              <label class="block mb-2">Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ù‡Ù…Ø© (Ù‚Ø§Ø¦Ù…Ø© Ø®Ø·ÙˆØ§Øª)</label>
              <textarea id="taskRequirements" class="w-full p-2 rounded bg-gray-700 text-white" placeholder="Ø§ÙƒØªØ¨ ÙƒÙ„ Ø®Ø·ÙˆØ© ÙÙŠ Ø³Ø·Ø± Ù…Ù†ÙØµÙ„" rows="4"></textarea>
            </div>
            
            <div>
              <label class="block mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù‡Ù…Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
              <textarea id="taskNotes" class="w-full p-2 rounded bg-gray-700 text-white" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…"></textarea>
            </div>
            
            <div class="flex items-center">
              <input type="checkbox" id="taskIsActive" checked class="mr-2">
              <label for="taskIsActive">Ø§Ù„Ù…Ù‡Ù…Ø© Ù†Ø´Ø·Ø©</label>
            </div>
          `;
          break;
          
        case 'custom':
          html = `
            <div>
              <label class="block mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø©</label>
              <input type="text" id="taskName" class="w-full p-2 rounded bg-gray-700 text-white" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ù…Ø®ØµØµØ©">
            </div>
            
            <div>
              <label class="block mb-2">ÙˆØµÙ Ø§Ù„Ù…Ù‡Ù…Ø©</label>
              <textarea id="taskDescription" class="w-full p-2 rounded bg-gray-700 text-white" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ù‡Ù…Ø©"></textarea>
            </div>
            
            <div>
              <label class="block mb-2">Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ù…Ø®ØµØµØ©</label>
              <input type="text" id="taskCustomType" class="w-full p-2 rounded bg-gray-700 text-white" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø´Ø§Ù‡Ø¯Ø© ÙÙŠØ¯ÙŠÙˆØŒ ØªØ­Ù…ÙŠÙ„ ØªØ·Ø¨ÙŠÙ‚...">
            </div>
            
            <div>
              <label class="block mb-2">Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù‡Ù…Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
              <input type="url" id="taskUrl" class="w-full p-2 rounded bg-gray-700 text-white" placeholder="https://example.com">
            </div>
            
            <div>
              <label class="block mb-2">Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© (RR)</label>
              <input type="number" id="taskReward" min="100" value="1000" class="w-full p-2 rounded bg-gray-700 text-white">
            </div>
            
            <div class="flex items-center">
              <input type="checkbox" id="taskIsActive" checked class="mr-2">
              <label for="taskIsActive">Ø§Ù„Ù…Ù‡Ù…Ø© Ù†Ø´Ø·Ø©</label>
            </div>
          `;
          break;
      }
      
      container.innerHTML = html;
    }

    function createNewTask() {
      const taskType = document.getElementById('taskType').value;
      const taskName = document.getElementById('taskName').value.trim();
      const taskDescription = document.getElementById('taskDescription').value.trim();
      const taskReward = parseInt(document.getElementById('taskReward').value);
      const isActive = document.getElementById('taskIsActive').checked;
      
      if (!taskName || !taskDescription) {
        showToast("âš ï¸ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… ÙˆÙˆØµÙ Ø§Ù„Ù…Ù‡Ù…Ø©!", true);
        return;
      }
      
      if (!taskReward || taskReward < 100) {
        showToast("âš ï¸ Ø£Ø¯Ø®Ù„ Ù…ÙƒØ§ÙØ£Ø© ØµØ­ÙŠØ­Ø© (100 RR ÙƒØ­Ø¯ Ø£Ø¯Ù†Ù‰)!", true);
        return;
      }
      
      // ØªØ­Ø¶ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
      const taskData = {
        name: taskName,
        description: taskDescription,
        reward: taskReward,
        type: taskType,
        isActive: isActive,
        createdAt: new Date().toISOString(),
        completedCount: 0
      };
      
      // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‡Ù…Ø©
      switch(taskType) {
        case 'channel':
          const taskUrl = document.getElementById('taskUrl').value.trim();
          const taskIcon = document.getElementById('taskIcon').value.trim();
          
          if (!taskUrl) {
            showToast("âš ï¸ Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ù‚Ù†Ø§Ø©!", true);
            return;
          }
          
          taskData.url = taskUrl;
          if (taskIcon) taskData.icon = taskIcon;
          break;
          
        case 'bot':
          const botUrl = document.getElementById('taskUrl').value.trim();
          const taskRequirements = document.getElementById('taskRequirements').value.trim();
          const taskNotes = document.getElementById('taskNotes').value.trim();
          
          if (!botUrl) {
            showToast("âš ï¸ Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨ÙˆØª!", true);
            return;
          }
          
          taskData.url = botUrl;
          if (taskRequirements) {
            taskData.requirements = taskRequirements.split('\n').filter(step => step.trim());
          }
          if (taskNotes) taskData.notes = taskNotes;
          break;
          
        case 'custom':
          const customType = document.getElementById('taskCustomType').value.trim();
          const customUrl = document.getElementById('taskUrl').value.trim();
          
          if (!customType) {
            showToast("âš ï¸ Ø£Ø¯Ø®Ù„ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ù…Ø®ØµØµØ©!", true);
            return;
          }
          
          taskData.customType = customType;
          if (customUrl) taskData.url = customUrl;
          break;
      }
      
      // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø±Ù ÙØ±ÙŠØ¯ Ù„Ù„Ù…Ù‡Ù…Ø©
      const taskId = 'task_' + Date.now();
      
      // Ø­ÙØ¸ Ø§Ù„Ù…Ù‡Ù…Ø© ÙÙŠ Firebase
      const tasksRef = ref(db, `tasks/${taskId}`);
      set(tasksRef, taskData)
        .then(() => {
          showToast("âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­!");
          // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
          updateTaskForm();
          // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù…
          loadTasks();
        })
        .catch(error => {
          console.error('Error creating task:', error);
          showToast("âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©!", true);
        });
    }

    function loadTasks() {
      const tasksRef = ref(db, 'tasks');
      onValue(tasksRef, (snapshot) => {
        const tasks = snapshot.val();
        const tasksList = document.getElementById('tasksList');
        
        if (!tasks) {
          tasksList.innerHTML = '<p class="text-gray-400 text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ø­Ø§Ù„ÙŠØ§Ù‹</p>';
          return;
        }
        
        let html = '';
        Object.entries(tasks).forEach(([taskId, task]) => {
          const taskTypeName = getTaskTypeName(task.type);
          const rewardText = `${task.reward.toLocaleString()} RR`;
          
          html += `
            <div class="bg-gray-700 p-3 rounded mb-3 ${!task.isActive ? 'opacity-60' : ''}">
              <div class="flex justify-between items-start mb-2">
                <div>
                  <h3 class="font-bold text-lg">${task.name}</h3>
                  <div class="flex items-center gap-2 mt-1">
                    <span class="task-type-badge task-type-${task.type}">${taskTypeName}</span>
                    <span class="text-sm ${task.isActive ? 'text-green-400' : 'text-red-400'}">
                      ${task.isActive ? 'Ù†Ø´Ø·' : 'Ù…Ø¹Ø·Ù„'}
                    </span>
                  </div>
                </div>
                <div class="text-right">
                  <div class="font-bold">${rewardText}</div>
                  <div class="text-sm text-gray-400">${task.completedCount || 0} Ø¥ÙƒÙ…Ø§Ù„</div>
                </div>
              </div>
              
              <p class="text-sm text-gray-300 mb-2">${task.description}</p>
              
              ${task.url ? `<p class="text-xs text-blue-400 mb-2">${task.url}</p>` : ''}
              
              <div class="flex justify-between text-xs text-gray-400">
                <span>Ø£Ù†Ø´Ø¦Øª ÙÙŠ: ${new Date(task.createdAt).toLocaleDateString('ar-EG')}</span>
              </div>
              
              <div class="flex gap-2 mt-3">
                <button onclick="editTask('${taskId}')" class="flex-1 bg-blue-600 px-3 py-1 rounded text-sm hover:bg-blue-500">ØªØ¹Ø¯ÙŠÙ„</button>
                <button onclick="toggleTask('${taskId}', ${!task.isActive})" class="flex-1 ${task.isActive ? 'bg-yellow-600 hover:bg-yellow-500' : 'bg-green-600 hover:bg-green-500'} px-3 py-1 rounded text-sm">
                  ${task.isActive ? 'ØªØ¹Ø·ÙŠÙ„' : 'ØªÙØ¹ÙŠÙ„'}
                </button>
                <button onclick="deleteTask('${taskId}')" class="flex-1 bg-red-600 px-3 py-1 rounded text-sm hover:bg-red-500">Ø­Ø°Ù</button>
              </div>
            </div>
          `;
        });
        
        tasksList.innerHTML = html;
      });
    }

    function getTaskTypeName(type) {
      const names = {
        'channel': 'Ø§Ù†Ø¶Ù…Ø§Ù… Ù‚Ù†Ø§Ø©',
        'bot': 'Ù…Ù‡Ù…Ø© Ø§Ù„Ø¨ÙˆØª',
        'custom': 'Ù…Ù‡Ù…Ø© Ù…Ø®ØµØµØ©'
      };
      return names[type] || type;
    }

    function filterTasks() {
      const typeFilter = document.getElementById('filterTaskType').value;
      const searchTerm = document.getElementById('searchTasks').value.toLowerCase();
      const taskItems = document.querySelectorAll('#tasksList > div');
      
      taskItems.forEach(item => {
        const taskText = item.textContent.toLowerCase();
        const taskType = item.querySelector('.task-type-badge').textContent;
        
        const typeMatch = typeFilter === 'all' || taskType.includes(getTaskTypeName(typeFilter));
        const searchMatch = taskText.includes(searchTerm);
        
        if (typeMatch && searchMatch) {
          item.style.display = 'block';
        } else {
          item.style.display = 'none';
        }
      });
    }

    // ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù… (Ø³ÙŠØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¤Ù‡Ø§ Ù…Ù† Ø§Ù„Ø£Ø²Ø±Ø§Ø±)
    window.editTask = function(taskId) {
      const taskRef = ref(db, `tasks/${taskId}`);
      onValue(taskRef, (snapshot) => {
        const taskData = snapshot.val();
        if (!taskData) return;
        
        currentEditingTask = taskId;
        
        let formHtml = '';
        
        switch(taskData.type) {
          case 'channel':
            formHtml = `
              <div class="space-y-4">
                <div>
                  <label class="block mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø©</label>
                  <input type="text" id="editTaskName" value="${taskData.name}" class="w-full p-2 rounded bg-gray-700 text-white">
                </div>
                
                <div>
                  <label class="block mb-2">ÙˆØµÙ Ø§Ù„Ù…Ù‡Ù…Ø©</label>
                  <textarea id="editTaskDescription" class="w-full p-2 rounded bg-gray-700 text-white">${taskData.description}</textarea>
                </div>
                
                <div>
                  <label class="block mb-2">Ø±Ø§Ø¨Ø· Ø§Ù„Ù‚Ù†Ø§Ø©</label>
                  <input type="url" id="editTaskUrl" value="${taskData.url || ''}" class="w-full p-2 rounded bg-gray-700 text-white">
                </div>
                
                <div>
                  <label class="block mb-2">Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ù‡Ù…Ø© (Ø±Ø§Ø¨Ø·)</label>
                  <input type="url" id="editTaskIcon" value="${taskData.icon || ''}" class="w-full p-2 rounded bg-gray-700 text-white">
                </div>
                
                <div>
                  <label class="block mb-2">Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© (RR)</label>
                  <input type="number" id="editTaskReward" value="${taskData.reward}" class="w-full p-2 rounded bg-gray-700 text-white">
                </div>
                
                <div>
                  <label class="block mb-2">Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„</label>
                  <input type="number" id="editTaskCompletedCount" value="${taskData.completedCount || 0}" class="w-full p-2 rounded bg-gray-700 text-white">
                </div>
                
                <div class="flex items-center">
                  <input type="checkbox" id="editTaskIsActive" ${taskData.isActive ? 'checked' : ''} class="mr-2">
                  <label for="editTaskIsActive">Ø§Ù„Ù…Ù‡Ù…Ø© Ù†Ø´Ø·Ø©</label>
                </div>
              </div>
            `;
            break;
            
          case 'bot':
            formHtml = `
              <div class="space-y-4">
                <div>
                  <label class="block mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø©</label>
                  <input type="text" id="editTaskName" value="${taskData.name}" class="w-full p-2 rounded bg-gray-700 text-white">
                </div>
                
                <div>
                  <label class="block mb-2">ÙˆØµÙ Ø§Ù„Ù…Ù‡Ù…Ø©</label>
                  <textarea id="editTaskDescription" class="w-full p-2 rounded bg-gray-700 text-white">${taskData.description}</textarea>
                </div>
                
                <div>
                  <label class="block mb-2">Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨ÙˆØª</label>
                  <input type="url" id="editTaskUrl" value="${taskData.url || ''}" class="w-full p-2 rounded bg-gray-700 text-white">
                </div>
                
                <div>
                  <label class="block mb-2">Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© (RR)</label>
                  <input type="number" id="editTaskReward" value="${taskData.reward}" class="w-full p-2 rounded bg-gray-700 text-white">
                </div>
                
                <div>
                  <label class="block mb-2">Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ù‡Ù…Ø© (Ù‚Ø§Ø¦Ù…Ø© Ø®Ø·ÙˆØ§Øª)</label>
                  <textarea id="editTaskRequirements" class="w-full p-2 rounded bg-gray-700 text-white" rows="4">${(taskData.requirements || []).join('\n')}</textarea>
                </div>
                
                <div>
                  <label class="block mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù‡Ù…Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                  <textarea id="editTaskNotes" class="w-full p-2 rounded bg-gray-700 text-white">${taskData.notes || ''}</textarea>
                </div>
                
                <div>
                  <label class="block mb-2">Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„</label>
                  <input type="number" id="editTaskCompletedCount" value="${taskData.completedCount || 0}" class="w-full p-2 rounded bg-gray-700 text-white">
                </div>
                
                <div class="flex items-center">
                  <input type="checkbox" id="editTaskIsActive" ${taskData.isActive ? 'checked' : ''} class="mr-2">
                  <label for="editTaskIsActive">Ø§Ù„Ù…Ù‡Ù…Ø© Ù†Ø´Ø·Ø©</label>
                </div>
              </div>
            `;
            break;
            
          case 'custom':
            formHtml = `
              <div class="space-y-4">
                <div>
                  <label class="block mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø©</label>
                  <input type="text" id="editTaskName" value="${taskData.name}" class="w-full p-2 rounded bg-gray-700 text-white">
                </div>
                
                <div>
                  <label class="block mb-2">ÙˆØµÙ Ø§Ù„Ù…Ù‡Ù…Ø©</label>
                  <textarea id="editTaskDescription" class="w-full p-2 rounded bg-gray-700 text-white">${taskData.description}</textarea>
                </div>
                
                <div>
                  <label class="block mb-2">Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ù…Ø®ØµØµØ©</label>
                  <input type="text" id="editTaskCustomType" value="${taskData.customType || ''}" class="w-full p-2 rounded bg-gray-700 text-white">
                </div>
                
                <div>
                  <label class="block mb-2">Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù‡Ù…Ø©</label>
                  <input type="url" id="editTaskUrl" value="${taskData.url || ''}" class="w-full p-2 rounded bg-gray-700 text-white">
                </div>
                
                <div>
                  <label class="block mb-2">Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© (RR)</label>
                  <input type="number" id="editTaskReward" value="${taskData.reward}" class="w-full p-2 rounded bg-gray-700 text-white">
                </div>
                
                <div>
                  <label class="block mb-2">Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„</label>
                  <input type="number" id="editTaskCompletedCount" value="${taskData.completedCount || 0}" class="w-full p-2 rounded bg-gray-700 text-white">
                </div>
                
                <div class="flex items-center">
                  <input type="checkbox" id="editTaskIsActive" ${taskData.isActive ? 'checked' : ''} class="mr-2">
                  <label for="editTaskIsActive">Ø§Ù„Ù…Ù‡Ù…Ø© Ù†Ø´Ø·Ø©</label>
                </div>
              </div>
            `;
            break;
        }
        
        document.getElementById('editTaskForm').innerHTML = formHtml;
        document.getElementById('editTaskModal').classList.remove('hidden');
      }, { onlyOnce: true });
    };

    window.toggleTask = function(taskId, newState) {
      const taskRef = ref(db, `tasks/${taskId}/isActive`);
      set(taskRef, newState)
        .then(() => {
          showToast(newState ? "âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø©" : "âœ… ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø©");
          loadTasks();
        })
        .catch(error => {
          console.error('Error toggling task:', error);
          showToast("âŒ ÙØ´Ù„ ÙÙŠ ØªØ¹Ø¯ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù‡Ù…Ø©!", true);
        });
    };

    window.deleteTask = function(taskId) {
      if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø©ØŸ`)) {
        const taskRef = ref(db, `tasks/${taskId}`);
        remove(taskRef)
          .then(() => {
            showToast("âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­");
            loadTasks();
          })
          .catch(error => {
            console.error('Error deleting task:', error);
            showToast("âŒ ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø©!", true);
          });
      }
    };

    // Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù‡Ù…Ø©
    document.getElementById('saveTaskBtn').addEventListener('click', () => {
      if (!currentEditingTask) return;
      
      const taskRef = ref(db, `tasks/${currentEditingTask}`);
      onValue(taskRef, (snapshot) => {
        const originalTask = snapshot.val();
        if (!originalTask) return;
        
        const taskName = document.getElementById('editTaskName').value.trim();
        const taskDescription = document.getElementById('editTaskDescription').value.trim();
        const taskReward = parseInt(document.getElementById('editTaskReward').value);
        const completedCount = parseInt(document.getElementById('editTaskCompletedCount').value);
        const isActive = document.getElementById('editTaskIsActive').checked;
        
        if (!taskName || !taskDescription) {
          showToast("âš ï¸ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… ÙˆÙˆØµÙ Ø§Ù„Ù…Ù‡Ù…Ø©!", true);
          return;
        }
        
        if (!taskReward || taskReward < 100) {
          showToast("âš ï¸ Ø£Ø¯Ø®Ù„ Ù…ÙƒØ§ÙØ£Ø© ØµØ­ÙŠØ­Ø© (100 RR ÙƒØ­Ø¯ Ø£Ø¯Ù†Ù‰)!", true);
          return;
        }
        
        const updates = {
          name: taskName,
          description: taskDescription,
          reward: taskReward,
          completedCount: completedCount,
          isActive: isActive
        };
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‡Ù…Ø©
        switch(originalTask.type) {
          case 'channel':
            const taskUrl = document.getElementById('editTaskUrl').value.trim();
            const taskIcon = document.getElementById('editTaskIcon').value.trim();
            
            if (taskUrl) updates.url = taskUrl;
            if (taskIcon) updates.icon = taskIcon;
            break;
            
          case 'bot':
            const botUrl = document.getElementById('editTaskUrl').value.trim();
            const taskRequirements = document.getElementById('editTaskRequirements').value.trim();
            const taskNotes = document.getElementById('editTaskNotes').value.trim();
            
            if (botUrl) updates.url = botUrl;
            if (taskRequirements) {
              updates.requirements = taskRequirements.split('\n').filter(step => step.trim());
            }
            if (taskNotes) updates.notes = taskNotes;
            break;
            
          case 'custom':
            const customType = document.getElementById('editTaskCustomType').value.trim();
            const customUrl = document.getElementById('editTaskUrl').value.trim();
            
            if (customType) updates.customType = customType;
            if (customUrl) updates.url = customUrl;
            break;
        }
        
        update(taskRef, updates)
          .then(() => {
            showToast("âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­");
            document.getElementById('editTaskModal').classList.add('hidden');
            loadTasks();
          })
          .catch(error => {
            console.error('Error updating task:', error);
            showToast("âŒ ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù‡Ù…Ø©!", true);
          });
      }, { onlyOnce: true });
    });

    document.getElementById('cancelEditTaskBtn').addEventListener('click', () => {
      document.getElementById('editTaskModal').classList.add('hidden');
      currentEditingTask = null;
    });

    // Ù‚Ø³Ù… Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¨ÙˆØª
    function initializeBotRequestsSection() {
      // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¨ÙˆØª
      document.getElementById('searchBotRequests').addEventListener('input', filterBotRequests);
    }

    function loadBotRequests() {
      const botVerificationsRef = ref(db, 'botVerifications');
      onValue(botVerificationsRef, (snapshot) => {
        const requests = snapshot.val();
        const requestsList = document.getElementById('botRequestsList');
        
        if (!requests) {
          requestsList.innerHTML = '<p class="text-gray-400 text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</p>';
          return;
        }
        
        let html = '';
        Object.entries(requests).forEach(([userId, request]) => {
          if (request.status !== 'pending') return;
          
          const userName = request.userName || 'Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
          const username = request.username ? `@${request.username}` : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯';
          const submittedDate = new Date(request.submittedAt).toLocaleDateString('ar-EG');
          const submittedTime = new Date(request.submittedAt).toLocaleTimeString('ar-EG');
          
          html += `
            <div class="bg-gray-700 p-4 rounded mb-4">
              <div class="flex justify-between items-start mb-3">
                <div>
                  <h3 class="font-bold text-lg">${userName}</h3>
                  <div class="text-sm text-gray-400">${username} â€¢ ${userId}</div>
                </div>
                <div class="text-right">
                  <div class="text-sm text-gray-400">${submittedDate}</div>
                  <div class="text-sm text-gray-400">${submittedTime}</div>
                </div>
              </div>
              
              <div class="mb-3">
                <h4 class="font-semibold mb-2">ğŸ“‹ Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ù‡Ù…Ø©:</h4>
                <div class="bg-gray-800 p-3 rounded text-sm">
                  ${request.requirements && request.requirements.steps ? 
                    '<ol class="list-decimal list-inside space-y-1">' + 
                    request.requirements.steps.map(step => `<li>${step}</li>`).join('') + 
                    '</ol>' : 
                    'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØªØ·Ù„Ø¨Ø§Øª Ù…Ø­Ø¯Ø¯Ø©'
                  }
                </div>
              </div>
              
              <div class="mb-3">
                <h4 class="font-semibold mb-2">ğŸ–¼ï¸ ØµÙˆØ±Ø© Ø§Ù„ØªØ­Ù‚Ù‚:</h4>
                <div class="text-center">
                  <img src="${request.screenshot}" alt="ØµÙˆØ±Ø© Ø§Ù„ØªØ­Ù‚Ù‚" class="max-w-full max-h-40 rounded cursor-pointer mx-auto" onclick="showImageModal('${request.screenshot}')">
                  <div class="text-xs text-gray-400 mt-1">Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø© Ù„ØªÙƒØ¨ÙŠØ±Ù‡Ø§</div>
                </div>
              </div>
              
              <div class="flex justify-between items-center text-sm text-gray-400 mb-3">
                <div>Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©: ${request.rewardRR ? request.rewardRR.toLocaleString() + ' RR' : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©'}</div>
                <div class="status-pending-review">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</div>
              </div>
              
              <div class="flex gap-2">
                <button onclick="approveBotRequest('${userId}')" class="flex-1 bg-green-600 px-4 py-2 rounded hover:bg-green-500">âœ… Ù‚Ø¨ÙˆÙ„</button>
                <button onclick="rejectBotRequest('${userId}')" class="flex-1 bg-red-600 px-4 py-2 rounded hover:bg-red-500">âŒ Ø±ÙØ¶</button>
              </div>
            </div>
          `;
        });
        
        if (!html) {
          html = '<p class="text-gray-400 text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</p>';
        }
        
        requestsList.innerHTML = html;
      });
    }

    function filterBotRequests() {
      const searchTerm = document.getElementById('searchBotRequests').value.toLowerCase();
      const requestItems = document.querySelectorAll('#botRequestsList > div');
      
      requestItems.forEach(item => {
        const requestText = item.textContent.toLowerCase();
        if (requestText.includes(searchTerm)) {
          item.style.display = 'block';
        } else {
          item.style.display = 'none';
        }
      });
    }

    // ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¨ÙˆØª (Ø³ÙŠØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¤Ù‡Ø§ Ù…Ù† Ø§Ù„Ø£Ø²Ø±Ø§Ø±)
    window.showImageModal = function(imageUrl) {
      document.getElementById('modalImage').src = imageUrl;
      document.getElementById('imageModal').classList.remove('hidden');
    };

    window.approveBotRequest = function(userId) {
      if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù‚Ø¨ÙˆÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ ÙˆÙ…Ù†Ø­ Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ')) {
        const verificationRef = ref(db, `botVerifications/${userId}`);
        const userRef = ref(db, `users/${userId}`);
        
        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨ Ø£ÙˆÙ„Ø§Ù‹
        onValue(verificationRef, (snapshot) => {
          const request = snapshot.val();
          if (!request) {
            showToast("âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨!", true);
            return;
          }
          
          const rewardRR = request.rewardRR || 5000;
          
          // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù„Ù‰ "Ù…Ù‚Ø¨ÙˆÙ„"
          update(verificationRef, {
            status: 'approved',
            processedAt: new Date().toISOString(),
            processedBy: 'admin'
          })
          .then(() => {
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©
            update(userRef, {
              'completedTasks/join_bot_task': true,
              pendingBotVerification: false
            })
            .then(() => {
              showToast(`âœ… ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨ ÙˆÙ…Ù†Ø­ ${rewardRR.toLocaleString()} RR Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…`);
              loadBotRequests();
            })
            .catch(error => {
              console.error('Error updating user:', error);
              showToast("âŒ ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…!", true);
            });
          })
          .catch(error => {
            console.error('Error approving request:', error);
            showToast("âŒ ÙØ´Ù„ ÙÙŠ Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨!", true);
          });
        }, { onlyOnce: true });
      }
    };

    window.rejectBotRequest = function(userId) {
      if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ÙØ¶ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ')) {
        const verificationRef = ref(db, `botVerifications/${userId}`);
        const userRef = ref(db, `users/${userId}`);
        
        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù„Ù‰ "Ù…Ø±ÙÙˆØ¶"
        update(verificationRef, {
          status: 'rejected',
          processedAt: new Date().toISOString(),
          processedBy: 'admin'
        })
        .then(() => {
          // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
          update(userRef, {
            pendingBotVerification: false
          })
          .then(() => {
            showToast("âœ… ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­");
            loadBotRequests();
          })
          .catch(error => {
            console.error('Error updating user:', error);
            showToast("âŒ ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…!", true);
          });
        })
        .catch(error => {
          console.error('Error rejecting request:', error);
          showToast("âŒ ÙØ´Ù„ ÙÙŠ Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨!", true);
        });
      }
    };

    // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„ØµÙˆØ±Ø©
    document.getElementById('closeImageModal').addEventListener('click', () => {
      document.getElementById('imageModal').classList.add('hidden');
    });

    document.getElementById('closeImageBtn').addEventListener('click', () => {
      document.getElementById('imageModal').classList.add('hidden');
    });

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
    function loadData() {
      onValue(dbRef, (snapshot) => {
        const data = snapshot.val();
        currentData = data || {};
        
        if (!data) {
          dataContainer.innerHTML = "<p class='text-center text-gray-400'>ğŸš« Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</p>";
          return;
        }

        let html = "";
        for (const key in data) {
          html += `
            <div class="bg-gray-700 p-3 rounded mb-3">
              <h3 class="font-bold">${key}</h3>
              <textarea id="val-${key}" class="w-full bg-gray-800 text-white p-2 rounded mt-1">${JSON.stringify(data[key], null, 2)}</textarea>
              <div class="mt-2 flex gap-2">
                <button onclick="updateData('${key}')" class="bg-blue-600 px-3 py-1 rounded hover:bg-blue-500">ØªØ¹Ø¯ÙŠÙ„</button>
                <button onclick="deleteData('${key}')" class="bg-red-600 px-3 py-1 rounded hover:bg-red-500">Ø­Ø°Ù</button>
              </div>
            </div>
          `;
        }

        dataContainer.innerHTML = html;
      });
    }

    // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
    window.updateData = (key) => {
      const newVal = document.getElementById(`val-${key}`).value;
      try {
        const parsedVal = JSON.parse(newVal);
        update(ref(db, key), parsedVal);
        showToast("âœ… ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!");
      } catch (e) {
        showToast("âš ï¸ ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ JSON ØµØ§Ù„Ø­!", true);
      }
    };

    window.deleteData = (key) => {
      if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ${key}ØŸ`)) {
        remove(ref(db, key));
        showToast("ğŸ—‘ï¸ ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­!");
      }
    };

    // Ø¥Ø¶Ø§ÙØ© Ø£Ù†Ù…Ø§Ø· CSS Ø¥Ø¶Ø§ÙÙŠØ©
    const style = document.createElement('style');
    style.textContent = `
      .section {
        display: none;
      }
      .section.active {
        display: block;
        animation: fadeIn 0.3s ease-in-out;
      }
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .code-type-badge, .task-type-badge {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
      }
      .code-type-contest {
        background: rgba(255, 193, 7, 0.2);
        color: #ffc107;
        border: 1px solid #ffc107;
      }
      .code-type-ton {
        background: rgba(33, 150, 243, 0.2);
        color: #2196f3;
        border: 1px solid #2196f3;
      }
      .code-type-rr {
        background: rgba(76, 175, 80, 0.2);
        color: #4caf50;
        border: 1px solid #4caf50;
      }
      .task-type-channel {
        background: rgba(156, 39, 176, 0.2);
        color: #9c27b0;
        border: 1px solid #9c27b0;
      }
      .task-type-bot {
        background: rgba(255, 87, 34, 0.2);
        color: #ff5722;
        border: 1px solid #ff5722;
      }
      .task-type-custom {
        background: rgba(96, 125, 139, 0.2);
        color: #607d8b;
        border: 1px solid #607d8b;
      }
      .status-pending-review {
        background: rgba(255, 152, 0, 0.2);
        color: #ff9800;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
      }
    `;
    document.head.appendChild(style);
  </script>
</body>
</html>

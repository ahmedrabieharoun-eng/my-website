<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… TON Rewards</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
    <style>
        :root {
            --primary: #2980B9; --secondary: #2C3E50; --light: #ECF0F1; --dark: #34495E;
            --success: #27AE60; --danger: #C0392B; --surface: #FFFFFF;
            --warning: #F39C12; --info: #3498DB;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Tajawal', sans-serif; background-color: var(--light); direction: rtl; }
        #app-container { transition: filter 0.3s; }
        
        /* Login Page Styles */
        #login-page {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }
        .login-card {
            background-color: var(--surface);
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            width: 90%;
            max-width: 400px;
        }
        .login-card h2 {
            text-align: center;
            margin-bottom: 25px;
            color: var(--secondary);
        }
        .login-card .form-group {
            margin-bottom: 20px;
        }
        .login-card label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }
        .login-card input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Tajawal', sans-serif;
            transition: border 0.3s;
        }
        .login-card input:focus {
            border-color: var(--primary);
            outline: none;
        }
        .login-btn {
            width: 100%;
            padding: 12px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            font-family: 'Tajawal', sans-serif;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .login-btn:hover {
            background-color: #2471A3;
        }
        .error-message {
            color: var(--danger);
            text-align: center;
            margin-top: 15px;
            display: none;
        }
        
        /* Top Bar */
        #top-bar {
            background-color: var(--secondary); color: white; padding: 0 15px;
            display: flex; align-items: center; justify-content: space-between; height: 60px;
            position: sticky; top: 0; z-index: 1000;
        }
        #menu-toggle { background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer; }
        #page-title { font-size: 1.2rem; }
        #logout-btn { background: none; border: none; color: white; cursor: pointer; font-size: 1rem; }

        /* Sidebar */
        #sidebar {
            position: fixed; top: 0; right: 0; width: 260px; height: 100vh;
            background-color: var(--secondary); color: white; z-index: 2000;
            transform: translateX(100%); transition: transform 0.3s ease-in-out;
            display: flex; flex-direction: column;
        }
        #sidebar.open { transform: translateX(0); }
        #sidebar-header { padding: 20px; text-align: center; }
        #sidebar-header .close-btn { position: absolute; top: 15px; left: 20px; font-size: 1.8rem; cursor: pointer; }
        .nav-menu { list-style: none; padding: 0; margin: 0; }
        .nav-menu li { padding: 15px 20px; cursor: pointer; border-right: 4px solid transparent; transition: all 0.2s; }
        .nav-menu li:hover, .nav-menu li.active { background-color: var(--dark); border-right-color: var(--primary); }
        .nav-menu li i { margin-left: 12px; width: 20px; text-align: center; }
        #sidebar-logout-btn { margin-top: auto; }

        /* Overlay */
        #overlay {
            position: fixed; top: 0; right: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5); z-index: 1999; display: none;
        }
        #overlay.show { display: block; }
        
        /* Main Content */
        #main-content { padding: 20px; }
        .page { display: none; } .page.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Cards */
        .card { background-color: var(--surface); border-radius: 8px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); margin-bottom: 20px; }
        h1, h3, h4 { color: var(--secondary); margin-bottom: 15px; }
        
        /* Tables */
        table { width: 100%; border-collapse: collapse; }
        thead { display: none; }
        tr { display: block; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 5px; padding: 10px; }
        td { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #eee; }
        td:last-child { border-bottom: none; }
        td::before { content: attr(data-label); font-weight: bold; margin-left: 10px; }
        .action-buttons { text-align: left; width: 100%; }
        .action-btn { padding: 8px 12px; border: none; border-radius: 5px; color: white; cursor: pointer; margin: 2px; font-family: 'Tajawal', sans-serif; }
        
        /* Forms */
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 500; text-align: right; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; font-family: 'Tajawal', sans-serif; }
        .btn-success { background-color: var(--success); } .btn-danger { background-color: var(--danger); } .btn-primary { background-color: var(--primary); } .btn-warning { background-color: var(--warning); }
        .btn-info { background-color: var(--info); }
        .dynamic-item-list { list-style: none; padding-right: 0; }
        .dynamic-item-list li { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid var(--light); }
        .withdraw-method-group { display: flex; gap: 10px; margin-bottom: 10px; align-items: center; }
        
        /* New Styles */
        .user-status-banned { background-color: rgba(192, 57, 43, 0.1); border-right: 4px solid var(--danger); }
        .user-status-banned td:first-child::before { content: "ğŸš« " attr(data-label); }
        .settings-grid { display: grid; grid-template-columns: 1fr; gap: 15px; }
        @media (min-width: 768px) { .settings-grid { grid-template-columns: 1fr 1fr; } }
        .setting-card { background-color: var(--surface); border-radius: 8px; padding: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        
        /* Search Box */
        .search-box { margin-bottom: 20px; }
        .search-box input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 5px; }
        
        /* Stats Cards */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .stat-card { background-color: var(--surface); border-radius: 8px; padding: 15px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .stat-value { font-size: 2rem; font-weight: bold; margin: 10px 0; }
        .stat-label { color: var(--dark); font-size: 0.9rem; }
        
        /* User Details */
        .user-details-grid { display: grid; grid-template-columns: 1fr; gap: 15px; }
        @media (min-width: 768px) { .user-details-grid { grid-template-columns: 1fr 1fr; } }
        .user-info-card { background-color: var(--surface); border-radius: 8px; padding: 15px; }
        .user-info-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee; }
        .user-info-item:last-child { border-bottom: none; }
        
        /* Tabs */
        .tabs { display: flex; border-bottom: 1px solid #ddd; margin-bottom: 15px; }
        .tab { padding: 10px 15px; cursor: pointer; border-bottom: 2px solid transparent; }
        .tab.active { border-bottom-color: var(--primary); color: var(--primary); font-weight: bold; }

        /* Reward Type Badges */
        .reward-badge { display: inline-block; padding: 3px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: bold; margin: 0 2px; }
        .reward-ton { background-color: #0088cc; color: white; }
        .reward-rr { background-color: #ff9900; color: white; }
        .reward-points { background-color: #27ae60; color: white; }

        /* Task Completion Stats */
        .completion-stats { display: flex; justify-content: space-between; margin-top: 5px; font-size: 0.85rem; color: var(--dark); }

        @media (min-width: 768px) {
            #app-container { display: flex; }
            #top-bar { display: none; }
            #sidebar { position: static; transform: translateX(0); width: 250px; height: 100vh; }
            #sidebar-header .close-btn { display: none; }
            #main-content { flex-grow: 1; padding: 30px; }
            thead { display: table-header-group; }
            tr { display: table-row; margin-bottom: 0; border: none; padding: 0; }
            td { display: table-cell; padding: 12px; border-bottom: 1px solid #ddd; }
            td::before { display: none; }
            .action-buttons { text-align: right; }
            .stats-grid { grid-template-columns: repeat(4, 1fr); }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="login-page">
        <div class="login-card">
            <h2><i class="fas fa-shield-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
            <div class="form-group">
                <label for="username">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                <input type="text" id="username" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
            </div>
            <div class="form-group">
                <label for="password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                <input type="password" id="password" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            </div>
            <button class="login-btn" id="login-button">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
            <div class="error-message" id="login-error">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©</div>
        </div>
    </div>

    <!-- Admin Panel (Initially Hidden) -->
    <div id="app-container" style="display: none;">
        <aside id="sidebar">
            <div>
                <div id="sidebar-header"><h2><i class="fas fa-shield-alt"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2><span class="close-btn">&times;</span></div>
                <ul class="nav-menu">
                    <li data-page="dashboard" class="active"><i class="fas fa-tachometer-alt"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</li>
                    <li data-page="users"><i class="fas fa-users"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</li>
                    <li data-page="user-search"><i class="fas fa-search"></i> Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…</li>
                    <li data-page="withdrawals"><i class="fas fa-wallet"></i> Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</li>
                    <li data-page="history"><i class="fas fa-history"></i> Ø³Ø¬Ù„ Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª</li>
                    <li data-page="tasks"><i class="fas fa-tasks"></i> Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„Ø±ÙˆØ§Ø¨Ø·</li>
                    <li data-page="codes"><i class="fas fa-ticket-alt"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ÙƒÙˆØ§Ø¯</li>
                    <li data-page="contest"><i class="fas fa-trophy"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</li>
                    <li data-page="settings"><i class="fas fa-cog"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</li>
                    <li data-page="broadcast"><i class="fas fa-bullhorn"></i> Ø§Ù„Ø¨Ø« Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ</li>
                </ul>
            </div>
            <button id="sidebar-logout-btn" class="nav-menu"><i class="fas fa-sign-out-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        </aside>
        
        <div id="overlay"></div>

        <div id="content-wrapper" style="width: 100%;">
            <header id="top-bar">
                <button id="menu-toggle"><i class="fas fa-bars"></i></button>
                <h1 id="page-title">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
                <button id="logout-btn"><i class="fas fa-sign-out-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
            </header>
            <main id="main-content"></main>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const firebaseConfig = {
            apiKey: "AIzaSyC5dwRaz3L-aK7I5CoPkbB31MzXB62lgrU",
            authDomain: "earnmoney124553.firebaseapp.com",
            databaseURL: "https://earnmoney124553-default-rtdb.firebaseio.com",
            projectId: "earnmoney124553",
            storageBucket: "earnmoney124553.firebasestorage.app",
            messagingSenderId: "325528918523",
            appId: "1:325528918523:web:73d84f48a24c1e0cbfd35e",
            measurementId: "G-G1H96Q5XCJ"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        
        const loginPage = document.getElementById('login-page');
        const appContainer = document.getElementById('app-container');
        const mainContent = document.getElementById('main-content');
        const pageTitle = document.getElementById('page-title');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        const loginButton = document.getElementById('login-button');
        const loginError = document.getElementById('login-error');
        const logoutButtons = document.querySelectorAll('#logout-btn, #sidebar-logout-btn');

        // Default admin credentials
        const DEFAULT_ADMIN_USERNAME = "aborabie";
        const DEFAULT_ADMIN_PASSWORD = "KLKFijkj-48@#$lk$Uu";

        // Check if admin credentials exist in Firebase, if not, create default
        const checkAndCreateDefaultAdmin = async () => {
            const adminSnap = await db.ref('admin').once('value');
            if (!adminSnap.exists()) {
                await db.ref('admin').set({
                    username: DEFAULT_ADMIN_USERNAME,
                    password: DEFAULT_ADMIN_PASSWORD
                });
                console.log("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©");
            }
        };

        // Login function
        const login = async (username, password) => {
            try {
                const adminSnap = await db.ref('admin').once('value');
                const adminData = adminSnap.val();
                
                if (adminData && adminData.username === username && adminData.password === password) {
                    // Successful login
                    sessionStorage.setItem('adminLoggedIn', 'true');
                    loginPage.style.display = 'none';
                    appContainer.style.display = 'flex';
                    initAdminPanel();
                    return true;
                } else {
                    // Failed login
                    loginError.style.display = 'block';
                    return false;
                }
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:", error);
                loginError.style.display = 'block';
                return false;
            }
        };

        // Logout function
        const logout = () => {
            sessionStorage.removeItem('adminLoggedIn');
            appContainer.style.display = 'none';
            loginPage.style.display = 'flex';
            // Clear form fields
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            loginError.style.display = 'none';
        };

        // Check if user is already logged in
        const checkLoginStatus = () => {
            if (sessionStorage.getItem('adminLoggedIn') === 'true') {
                loginPage.style.display = 'none';
                appContainer.style.display = 'flex';
                initAdminPanel();
            } else {
                loginPage.style.display = 'flex';
                appContainer.style.display = 'none';
            }
        };

        // Event listeners for login/logout
        loginButton.addEventListener('click', async () => {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                loginError.textContent = 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±';
                loginError.style.display = 'block';
                return;
            }
            
            await login(username, password);
        });

        // Allow login with Enter key
        document.getElementById('password').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                loginButton.click();
            }
        });

        logoutButtons.forEach(button => {
            button.addEventListener('click', logout);
        });

        // Initialize default admin and check login status
        checkAndCreateDefaultAdmin();
        checkLoginStatus();

        // Dashboard
        const renderDashboard = async () => {
            const usersSnap = await db.ref('users').once('value');
            const withdrawalsSnap = await db.ref('withdrawals/pending').once('value');
            const contestSnap = await db.ref('contest/participants').once('value');
            const codesSnap = await db.ref('codes').once('value');
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø­Ø¸ÙˆØ±ÙŠÙ†
            let bannedUsersCount = 0;
            let totalBalance = 0;
            let totalReferrals = 0;
            
            usersSnap.forEach(child => {
                const user = child.val();
                if (user.banned) bannedUsersCount++;
                totalBalance += user.balance || 0;
                totalReferrals += user.referrals || 0;
            });
            
            mainContent.innerHTML = `<div id="dashboard" class="page active">
                <h3>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
                        <div class="stat-value">${usersSnap.numChildren()}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø­Ø¸ÙˆØ±ÙŠÙ†</div>
                        <div class="stat-value">${bannedUsersCount}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</div>
                        <div class="stat-value">${withdrawalsSnap.numChildren()}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±ØµÙŠØ¯</div>
                        <div class="stat-value">${totalBalance.toFixed(4)}</div>
                        <div class="stat-label">TON</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª</div>
                        <div class="stat-value">${totalReferrals}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Ù…Ø´Ø§Ø±ÙƒÙŠÙ† ÙÙŠ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</div>
                        <div class="stat-value">${contestSnap.numChildren()}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù†Ø´Ø·Ø©</div>
                        <div class="stat-value">${codesSnap.numChildren()}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</div>
                        <div class="stat-value">${(totalBalance + totalReferrals * 0.001).toFixed(4)}</div>
                        <div class="stat-label">TON</div>
                    </div>
                </div>
            </div>`;
        };
        
        // Users Management
        const renderUsers = async () => {
            mainContent.innerHTML = '<div class="card"><h3>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†...</h3></div>';
            const snap = await db.ref('users').orderByChild('firstName').once('value'); 
            let tableContent = '';
            
            snap.forEach(child => {
                const user = child.val();
                const isBanned = user.banned || false;
                const statusClass = isBanned ? 'user-status-banned' : '';
                const banButtonText = isBanned ? 'ÙÙƒ Ø§Ù„Ø­Ø¸Ø±' : 'Ø­Ø¸Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…';
                const banButtonClass = isBanned ? 'btn-warning' : 'btn-danger';
                
                tableContent += `<tr class="${statusClass}">
                    <td data-label="Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">${user.firstName || ''} ${user.lastName || ''}<br><small>${user.id}</small>${isBanned ? ' <span style="color:red">ğŸš« Ù…Ø­Ø¸ÙˆØ±</span>' : ''}</td>
                    <td data-label="Ø§Ù„Ø±ØµÙŠØ¯">${(user.balance || 0).toFixed(4)} TON</td>
                    <td data-label="Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª">${user.referrals || 0}</td>
                    <td data-label="Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª">
                        <div class="action-buttons">
                            <button class="action-btn btn-primary" onclick="window.adminActions.addBalance('${user.id}', '${user.firstName}')">Ø¥Ø¶Ø§ÙØ© Ø±ØµÙŠØ¯</button>
                            <button class="action-btn btn-danger" onclick="window.adminActions.removeBalance('${user.id}', '${user.firstName}')">Ø®ØµÙ… Ø±ØµÙŠØ¯</button>
                            <button class="action-btn ${banButtonClass}" onclick="window.adminActions.toggleUserBan('${user.id}', '${user.firstName}', ${isBanned})">${banButtonText}</button>
                            <button class="action-btn btn-info" onclick="window.adminActions.viewUserDetails('${user.id}')">ØªÙØ§ØµÙŠÙ„</button>
                        </div>
                    </td>
                </tr>`;
            });
            
            mainContent.innerHTML = `<div id="users" class="page active">
                <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3>
                <div class="card">
                    <table>
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                                <th>Ø§Ù„Ø±ØµÙŠØ¯</th>
                                <th>Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>${tableContent}</tbody>
                    </table>
                </div>
            </div>`;
        };
        
        // User Search
        const renderUserSearch = () => {
            mainContent.innerHTML = `<div id="user-search" class="page active">
                <h3>Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…</h3>
                <div class="card">
                    <div class="search-box">
                        <input type="text" id="user-search-input" placeholder="Ø£Ø¯Ø®Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (User ID)">
                    </div>
                    <button class="action-btn btn-primary" onclick="window.adminActions.searchUser()">Ø¨Ø­Ø«</button>
                </div>
                <div id="user-search-results"></div>
            </div>`;
        };
        
        // User Details
        const renderUserDetails = async (userId) => {
            const userSnap = await db.ref(`users/${userId}`).once('value');
            const user = userSnap.val();
            
            if (!user) {
                alert('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                return;
            }
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©
            const contestSnap = await db.ref(`contest/participants/${userId}`).once('value');
            const contestData = contestSnap.val() || { points: 0, adsWatched: 0, referrals: 0 };
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠ
            const dailyLoginSnap = await db.ref(`dailyLogin/${userId}`).once('value');
            const dailyLoginData = dailyLoginSnap.val() || { currentStreak: 0, lastLoginDate: null, claimedDays: [] };
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª
            const referralsSnap = await db.ref('users').orderByChild('referredBy').equalTo(userId).once('value');
            const referredUsers = [];
            referralsSnap.forEach(child => {
                referredUsers.push(child.val());
            });
            
            mainContent.innerHTML = `<div id="user-details" class="page active">
                <h3>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${user.firstName || ''} ${user.lastName || ''}</h3>
                <div class="user-details-grid">
                    <div class="user-info-card">
                        <h4>Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h4>
                        <div class="user-info-item">
                            <span>Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</span>
                            <span>${user.id}</span>
                        </div>
                        <div class="user-info-item">
                            <span>Ø§Ù„Ø§Ø³Ù…:</span>
                            <span>${user.firstName || ''} ${user.lastName || ''}</span>
                        </div>
                        <div class="user-info-item">
                            <span>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</span>
                            <span>${user.username || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</span>
                        </div>
                        <div class="user-info-item">
                            <span>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…:</span>
                            <span>${user.joinDate ? new Date(user.joinDate).toLocaleDateString('ar-EG') : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</span>
                        </div>
                        <div class="user-info-item">
                            <span>Ø§Ù„Ø­Ø§Ù„Ø©:</span>
                            <span>${user.banned ? 'ğŸš« Ù…Ø­Ø¸ÙˆØ±' : 'âœ… Ù†Ø´Ø·'}</span>
                        </div>
                    </div>
                    
                    <div class="user-info-card">
                        <h4>Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</h4>
                        <div class="user-info-item">
                            <span>Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ:</span>
                            <span>${(user.balance || 0).toFixed(4)} TON</span>
                        </div>
                        <div class="user-info-item">
                            <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­:</span>
                            <span>${(user.totalEarned || 0).toFixed(4)} TON</span>
                        </div>
                        <div class="user-info-item">
                            <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª:</span>
                            <span>${user.lifetimeAdCount || 0}</span>
                        </div>
                        <div class="user-info-item">
                            <span>Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„ÙŠÙˆÙ…:</span>
                            <span>${user.dailyAdCount || 0}</span>
                        </div>
                        <div class="user-info-item">
                            <span>Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª:</span>
                            <span>${user.referrals || 0}</span>
                        </div>
                    </div>
                    
                    <div class="user-info-card">
                        <h4>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</h4>
                        <div class="user-info-item">
                            <span>Ø§Ù„Ù†Ù‚Ø§Ø·:</span>
                            <span>${contestData.points || 0}</span>
                        </div>
                        <div class="user-info-item">
                            <span>Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©:</span>
                            <span>${contestData.adsWatched || 0}</span>
                        </div>
                        <div class="user-info-item">
                            <span>Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª:</span>
                            <span>${contestData.referrals || 0}</span>
                        </div>
                    </div>
                    
                    <div class="user-info-card">
                        <h4>Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠ</h4>
                        <div class="user-info-item">
                            <span>Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ØªÙˆØ§ØµÙ„:</span>
                            <span>${dailyLoginData.currentStreak || 0} ÙŠÙˆÙ…</span>
                        </div>
                        <div class="user-info-item">
                            <span>Ø¢Ø®Ø± ØªØ³Ø¬ÙŠÙ„:</span>
                            <span>${dailyLoginData.lastLoginDate ? new Date(dailyLoginData.lastLoginDate).toLocaleDateString('ar-EG') : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</span>
                        </div>
                        <div class="user-info-item">
                            <span>Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø·Ø§Ù„ÙØ¨ Ø¨Ù‡Ø§:</span>
                            <span>${dailyLoginData.claimedDays ? dailyLoginData.claimedDays.length : 0}</span>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h4>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø°ÙŠÙ† ØªÙ…Øª Ø¯Ø¹ÙˆØªÙ‡Ù…</h4>
                    ${referredUsers.length > 0 ? 
                        `<table>
                            <thead>
                                <tr>
                                    <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                                    <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…</th>
                                    <th>Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${referredUsers.map(refUser => `
                                    <tr>
                                        <td>${refUser.firstName || ''} ${refUser.lastName || ''}</td>
                                        <td>${refUser.joinDate ? new Date(refUser.joinDate).toLocaleDateString('ar-EG') : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</td>
                                        <td>${(refUser.totalEarned || 0).toFixed(4)} TON</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>` : 
                        '<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ØªÙ…Øª Ø¯Ø¹ÙˆØªÙ‡Ù…</p>'
                    }
                </div>
                
                <div class="action-buttons" style="margin-top: 20px;">
                    <button class="action-btn btn-primary" onclick="window.adminActions.addBalance('${userId}', '${user.firstName}')">Ø¥Ø¶Ø§ÙØ© Ø±ØµÙŠØ¯</button>
                    <button class="action-btn btn-danger" onclick="window.adminActions.removeBalance('${userId}', '${user.firstName}')">Ø®ØµÙ… Ø±ØµÙŠØ¯</button>
                    <button class="action-btn ${user.banned ? 'btn-warning' : 'btn-danger'}" onclick="window.adminActions.toggleUserBan('${userId}', '${user.firstName}', ${user.banned})">${user.banned ? 'ÙÙƒ Ø§Ù„Ø­Ø¸Ø±' : 'Ø­Ø¸Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…'}</button>
                    <button class="action-btn btn-info" onclick="window.adminActions.resetContestPoints('${userId}', '${user.firstName}')">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</button>
                    <button class="action-btn btn-warning" onclick="renderUsers()">Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</button>
                </div>
            </div>`;
        };
        
        // Pending Withdrawals
        const renderWithdrawals = async () => {
            mainContent.innerHTML = '<div class="card"><h3>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</h3></div>';
            const snap = await db.ref('withdrawals/pending').orderByChild('timestamp').once('value'); 
            let tableContent = '';
            let requests = [];
            snap.forEach(child => { requests.push(child.val()); });
            requests.reverse(); // Show newest first
            requests.forEach(req => {
                tableContent += `<tr>
                    <td data-label="Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">${req.userName}<br><small>${new Date(req.timestamp).toLocaleString('ar-EG')}</small></td>
                    <td data-label="Ø§Ù„Ù…Ø¨Ù„Øº"><b>${req.amount.toFixed(4)} TON</b><br><small>${req.method} | ${req.account}</small></td>
                    <td data-label="Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª">
                        <div class="action-buttons">
                            <button class="action-btn btn-success" onclick="window.adminActions.handleWithdrawal('${req.id}', 'approve')">Ù…ÙˆØ§ÙÙ‚Ø©</button>
                            <button class="action-btn btn-danger" onclick="window.adminActions.handleWithdrawal('${req.id}', 'reject')">Ø±ÙØ¶</button>
                        </div>
                    </td>
                </tr>`;
            });
            mainContent.innerHTML = `<div id="withdrawals" class="page active">
                <h3>Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</h3>
                <div class="card">
                    <table>
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… & Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th>Ø§Ù„Ù…Ø¨Ù„Øº & Ø§Ù„ØªÙØ§ØµÙŠÙ„</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>${tableContent || '<tr><td colspan=3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø©</td></tr>'}</tbody>
                    </table>
                </div>
            </div>`;
        };
        
        // Withdrawal History
        const renderWithdrawalHistory = async () => {
            mainContent.innerHTML = '<div class="card"><h3>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„...</h3></div>';
            const completedSnap = await db.ref('withdrawals/completed').orderByChild('timestamp').limitToLast(100).once('value');
            const rejectedSnap = await db.ref('withdrawals/rejected').orderByChild('timestamp').limitToLast(100).once('value');
            let completedRows = '', rejectedRows = '';
            
            let completed = [];
            completedSnap.forEach(child => { completed.push(child.val()); });
            completed.reverse();
            completed.forEach(req => { 
                completedRows += `<tr>
                    <td data-label="Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">${req.userName}</td>
                    <td data-label="Ø§Ù„Ù…Ø¨Ù„Øº">${req.amount.toFixed(4)} TON</td>
                    <td data-label="Ø§Ù„ØªØ§Ø±ÙŠØ®">${new Date(req.timestamp).toLocaleDateString('ar-EG')}</td>
                    <td data-label="Ø§Ù„Ø­Ø§Ù„Ø©">Ù…ÙƒØªÙ…Ù„</td>
                </tr>`; 
            });

            let rejected = [];
            rejectedSnap.forEach(child => { rejected.push(child.val()); });
            rejected.reverse();
            rejected.forEach(req => { 
                rejectedRows += `<tr>
                    <td data-label="Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">${req.userName}</td>
                    <td data-label="Ø§Ù„Ù…Ø¨Ù„Øº">${req.amount.toFixed(4)} TON</td>
                    <td data-label="Ø§Ù„ØªØ§Ø±ÙŠØ®">${new Date(req.timestamp).toLocaleDateString('ar-EG')}</td>
                    <td data-label="Ø§Ù„Ø­Ø§Ù„Ø©">Ù…Ø±ÙÙˆØ¶</td>
                </tr>`; 
            });
            
            mainContent.innerHTML = `
                <div id="history" class="page active">
                    <h3>Ø³Ø¬Ù„ Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª</h3>
                    <div class="card">
                        <h4>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                                    <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                </tr>
                            </thead>
                            <tbody>${completedRows || '<tr><td colspan="4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©.</td></tr>'}</tbody>
                        </table>
                    </div>
                    <div class="card">
                        <h4>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¶Ø©</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                                    <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                </tr>
                            </thead>
                            <tbody>${rejectedRows || '<tr><td colspan="4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø±ÙÙˆØ¶Ø©.</td></tr>'}</tbody>
                        </table>
                    </div>
                </div>`;
        };

        // Tasks Management
        const renderTasks = async () => {
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ù‡Ø§Ù…
            const tasksSnap = await db.ref('config/tasks').once('value');
            const tasksStats = {};
            
            tasksSnap.forEach(child => {
                const task = child.val();
                tasksStats[child.key] = {
                    name: task.name,
                    completions: task.completions || 0
                };
            });
            
            mainContent.innerHTML = `<div id="tasks" class="page active">
                <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„Ø±ÙˆØ§Ø¨Ø·</h3>
                
                <!-- Ù…Ù‡Ø§Ù… Ø§Ù„Ø¨ÙˆØªØ§Øª Ø§Ù„ÙŠØ¯ÙˆÙŠØ© -->
                <div class="card">
                    <h4>Ù…Ù‡Ø§Ù… Ø§Ù„Ø¨ÙˆØªØ§Øª Ø§Ù„ÙŠØ¯ÙˆÙŠØ©</h4>
                    <div class="form-group">
                        <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø©</label>
                        <input id="manual-task-name" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù†Ø¶Ù… Ù„Ù‚Ù†Ø§Ø© Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…">
                    </div>
                    <div class="form-group">
                        <label>ÙˆØµÙ Ø§Ù„Ù…Ù‡Ù…Ø©</label>
                        <textarea id="manual-task-description" placeholder="ÙˆØµÙ ØªÙØµÙŠÙ„ÙŠ Ù„Ù„Ù…Ù‡Ù…Ø©"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù‡Ù…Ø©</label>
                        <input id="manual-task-url" placeholder="https://t.me/yourchannel">
                    </div>
                    <div class="form-group">
                        <label>Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ù‡Ù…Ø© (Ø±Ø§Ø¨Ø·)</label>
                        <input id="manual-task-icon" placeholder="https://example.com/icon.png">
                    </div>
                    <div class="form-group">
                        <label>Ù†ÙˆØ¹ Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©</label>
                        <select id="manual-task-reward-type">
                            <option value="ton">TON</option>
                            <option value="rr">RR</option>
                            <option value="points">Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©</label>
                        <input type="number" step="any" id="manual-task-reward" placeholder="0.001">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø¥ÙƒÙ…Ø§Ù„ (0 = Ù„Ø§ Ù†Ù‡Ø§Ø¦ÙŠ)</label>
                        <input type="number" id="manual-task-max-completions" value="0">
                    </div>
                    <button class="action-btn btn-primary" onclick="window.adminActions.addManualTask()">Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© ÙŠØ¯ÙˆÙŠØ©</button>
                </div>
                
                <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø­Ø§Ù„ÙŠØ© -->
                <div class="card" id="tasks-list">
                    <h4>Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h4>
                    <div id="tasks-table-container">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…...</div>
                </div>
                
                <!-- Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© -->
                <div class="card">
                    <h4>Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©</h4>
                    <div class="form-group"><input id="task-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø© (Ù…Ø«Ø§Ù„: Ø§Ù†Ø¶Ù… Ù„Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…)"></div>
                    <div class="form-group"><input id="task-url" placeholder="Ø§Ù„Ø±Ø§Ø¨Ø·"></div>
                    <div class="form-group"><input id="task-reward" type="number" step="any" placeholder="Ù…Ù‚Ø¯Ø§Ø± Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©"></div>
                    <div class="form-group"><input id="task-icon" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©"></div>
                    <button class="action-btn btn-primary" onclick="window.adminActions.addTask()">Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©</button>
                </div>
                
                <!-- Ø¥Ø¶Ø§ÙØ© Ø±ÙˆØ§Ø¨Ø· -->
                <div class="card" id="links-list"><h4>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·...</h4></div>
                <div class="card">
                    <h4>Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø·/Ø²Ø± Ø¬Ø¯ÙŠØ¯</h4>
                    <div class="form-group"><input id="link-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø²Ø± (Ù…Ø«Ø§Ù„: Ø§Ù„Ù‚Ù†Ø§Ø© Ø§Ù„Ø±Ø³Ù…ÙŠØ©)"></div>
                    <div class="form-group"><input id="link-url" placeholder="Ø§Ù„Ø±Ø§Ø¨Ø·"></div>
                    <div class="form-group"><input id="link-icon" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©"></div>
                    <button class="action-btn btn-primary" onclick="window.adminActions.addLink()">Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø·</button>
                </div>
            </div>`;
            
            await loadTasksWithStats();
            loadDynamicContent('links');
        };

        // Codes Management
        const renderCodes = async () => {
            mainContent.innerHTML = `<div id="codes" class="page active">
                <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ÙƒÙˆØ§Ø¯</h3>
                <div class="card" id="codes-list"><h4>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯...</h4></div>
                <div class="card">
                    <h4>Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ Ø¬Ø¯ÙŠØ¯</h4>
                    <div class="form-group">
                        <label>Ø§Ù„ÙƒÙˆØ¯ (Ø£Ø­Ø±Ù ÙƒØ¨ÙŠØ±Ø© ÙÙ‚Ø·)</label>
                        <input id="code-text" placeholder="Ù…Ø«Ø§Ù„: WELCOME50" style="text-transform: uppercase;">
                    </div>
                    <div class="form-group">
                        <label>Ù†ÙˆØ¹ Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©</label>
                        <select id="code-reward-type">
                            <option value="ton">TON</option>
                            <option value="rr">RR</option>
                            <option value="points">Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©</label>
                        <input id="code-reward-value" type="number" step="any" value="0.001">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… (0 = Ù„Ø§ Ù†Ù‡Ø§Ø¦ÙŠ)</label>
                        <input id="code-max-uses" type="number" value="100">
                    </div>
                    <div class="form-group">
                        <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                        <input id="code-expiry" type="datetime-local">
                    </div>
                    <button class="action-btn btn-primary" onclick="window.adminActions.createCode()">Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯</button>
                </div>
            </div>`;
            await loadCodes();
        };

        // Contest Management
        const renderContest = async () => {
            const contestSnap = await db.ref('contest').once('value');
            const contestData = contestSnap.val() || {};
            
            mainContent.innerHTML = `<div id="contest" class="page active">
                <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</h3>
                <div class="card">
                    <h4>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</h4>
                    <div class="settings-grid">
                        <div class="setting-card">
                            <div class="form-group">
                                <label>ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</label>
                                <input type="datetime-local" id="contest-end-time" value="${contestData.endTime ? new Date(contestData.endTime).toISOString().slice(0, 16) : ''}">
                            </div>
                            <div class="form-group">
                                <label>Ù…Ø¯Ø© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© (Ø£ÙŠØ§Ù…)</label>
                                <input type="number" id="contest-duration" value="${contestData.durationDays || 7}">
                            </div>
                            <button class="action-btn btn-primary" onclick="window.adminActions.updateContestSettings()">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                        </div>
                        <div class="setting-card">
                            <div class="form-group">
                                <label>Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</label>
                                <p>Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</p>
                                <button class="action-btn btn-danger" onclick="window.adminActions.resetContest()">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <h4>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†</h4>
                    <div id="contest-leaderboard"><h4>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†...</h4></div>
                </div>
            </div>`;
            await loadContestLeaderboard();
        };

        // Settings
        const renderSettings = async () => {
            const snap = await db.ref('config').once('value'); 
            const config = snap.val() || {};
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠ
            const dailyLoginSnap = await db.ref('settings/dailyLoginRewards').once('value');
            const dailyLoginRewards = dailyLoginSnap.val() || [0.0001, 0.0002, 0.0004, 0.0008, 0.0016, 0.0032, 0.0064];
            
            mainContent.innerHTML = `<div id="settings" class="page active">
                <h3>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</h3>
                <div class="card">
                    <div class="tabs">
                        <div class="tab active" data-tab="general">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</div>
                        <div class="tab" data-tab="ads">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</div>
                        <div class="tab" data-tab="daily">Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠ</div>
                        <div class="tab" data-tab="withdrawal">Ø§Ù„Ø³Ø­Ø¨</div>
                    </div>
                    
                    <div id="general-tab" class="tab-content active">
                        <div class="settings-grid">
                            <div class="setting-card">
                                <h4>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨ÙˆØª</h4>
                                <div class="form-group">
                                    <label>Ø§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¨ÙˆØª (Ø¨Ø¯ÙˆÙ† @)</label>
                                    <input type="text" id="botUsername" value="${config.botUsername || ''}">
                                </div>
                                <div class="form-group">
                                    <label>ØªÙˆÙƒÙ† Ø¨ÙˆØª Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…</label>
                                    <input type="text" id="botToken" value="${config.botToken || ''}">
                                </div>
                                <div class="form-group">
                                    <label>Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨</label>
                                    <textarea id="welcomeMessage">${config.welcomeMessage || ''}</textarea>
                                </div>
                            </div>
                            
                            <div class="setting-card">
                                <h4>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø­Ø§Ù„Ø©</h4>
                                <div class="form-group">
                                    <label>Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„Ø¥Ø­Ø§Ù„Ø© (TON)</label>
                                    <input type="number" step="any" id="referralBonus" value="${config.referralBonus || 0}">
                                </div>
                                <div class="form-group">
                                    <label>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø¥Ø­Ø§Ù„Ø§Øª Ù„Ù„Ø³Ø­Ø¨</label>
                                    <input type="number" id="minimumWithdrawReferrals" value="${config.minimumWithdrawReferrals || 0}">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="ads-tab" class="tab-content">
                        <div class="settings-grid">
                            <div class="setting-card">
                                <h4>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</h4>
                                <div class="form-group">
                                    <label>Ù…Ø¹Ø±Ù Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</label>
                                    <input type="number" id="adZoneId" value="${config.adZoneId || ''}">
                                </div>
                                <div class="form-group">
                                    <label>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† (TON)</label>
                                    <input type="number" step="any" id="adValue" value="${config.adValue || 0}">
                                </div>
                                <div class="form-group">
                                    <label>Ø§Ù„Ø­Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ Ù„Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</label>
                                    <input type="number" id="dailyAdLimit" value="${config.dailyAdLimit || 0}">
                                </div>
                            </div>
                            
                            <div class="setting-card">
                                <h4>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</h4>
                                <div class="form-group">
                                    <label>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† (Ø«ÙˆØ§Ù†ÙŠ)</label>
                                    <input type="number" id="minAdDuration" value="${config.minAdDuration || 5}">
                                    <small>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„ÙˆÙ‚Øª Ø§Ù„Ø°ÙŠ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ´Ø§Ù‡Ø¯Ù‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„ÙƒØ³Ø¨ Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©</small>
                                </div>
                                <div class="form-group">
                                    <label>Ù…Ù‡Ù„Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† (Ø«ÙˆØ§Ù†ÙŠ)</label>
                                    <input type="number" id="adCooldown" value="${config.adCooldown || 10}">
                                    <small>Ø§Ù„ÙˆÙ‚Øª Ø¨ÙŠÙ† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ</small>
                                </div>
                                <div class="form-group">
                                    <label>Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„Ø§Ø³ØªØ±Ø§Ø­Ø©</label>
                                    <input type="number" id="adsPerBreak" value="${config.adsPerBreak || 0}">
                                </div>
                                <div class="form-group">
                                    <label>Ù…Ø¯Ø© Ø§Ù„Ø§Ø³ØªØ±Ø§Ø­Ø© (Ø¯Ù‚Ø§Ø¦Ù‚)</label>
                                    <input type="number" id="breakDuration" value="${config.breakDuration || 0}">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="daily-tab" class="tab-content">
                        <div class="setting-card">
                            <h4>Ù…ÙƒØ§ÙØ¢Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠ</h4>
                            <p>Ø§Ø¶Ø¨Ø· Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª Ù„ÙƒÙ„ ÙŠÙˆÙ… ÙÙŠ Ø³Ù„Ø³Ù„Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠ</p>
                            <div id="daily-rewards-container">
                                ${dailyLoginRewards.map((reward, index) => `
                                    <div class="form-group" style="display: flex; align-items: center; gap: 10px;">
                                        <label style="min-width: 80px;">Ø§Ù„ÙŠÙˆÙ… ${index + 1}:</label>
                                        <input type="number" step="any" value="${reward}" class="daily-reward-input" data-day="${index}">
                                        <span>TON</span>
                                    </div>
                                `).join('')}
                            </div>
                            <button class="action-btn btn-primary" onclick="window.adminActions.addDailyRewardDay()">+ Ø¥Ø¶Ø§ÙØ© ÙŠÙˆÙ…</button>
                            <button class="action-btn btn-success" onclick="window.adminActions.saveDailyRewards()">Ø­ÙØ¸ Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª</button>
                        </div>
                    </div>
                    
                    <div id="withdrawal-tab" class="tab-content">
                        <div class="setting-card">
                            <h4>Ø·Ø±Ù‚ Ø§Ù„Ø³Ø­Ø¨</h4>
                            <div id="withdraw-methods-container"></div>
                            <button class="action-btn btn-primary" onclick="window.adminActions.addWithdrawMethodField()">+ Ø¥Ø¶Ø§ÙØ© Ø·Ø±ÙŠÙ‚Ø©</button>
                        </div>
                    </div>
                    
                    <hr style="margin: 20px 0;">
                    <button class="action-btn btn-success" style="width:100%; padding:15px;" onclick="window.adminActions.saveSettings()">Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                </div>
            </div>`;
            renderWithdrawMethods(config.withdrawMethods);
            setupSettingsTabs();
        };
        
        // Broadcast
        const renderBroadcast = () => {
             mainContent.innerHTML = `<div id="broadcast" class="page active">
                <h3>Ø§Ù„Ø¨Ø« Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ</h3>
                <div class="card">
                    <p>Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†. <strong>Ù‡Ø§Ù…:</strong> ÙŠØªØ·Ù„Ø¨ Ù‡Ø°Ø§ ÙˆØ¸ÙŠÙØ© Ù…Ù† Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø®Ø§Ø¯Ù… (Ù…Ø«Ù„ Cloud Functions ÙÙŠ Firebase) Ù„Ù„Ø¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.</p>
                    <div class="form-group">
                        <textarea id="broadcast-message" rows="5" placeholder="Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..."></textarea>
                    </div>
                    <button class="action-btn btn-danger" onclick="window.adminActions.sendBroadcast()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø«</button>
                </div>
            </div>`;
        };

        // Helper Functions
        const loadDynamicContent = async (type) => {
            const container = document.getElementById(`${type}-list`);
            const snap = await db.ref(`config/${type}`).once('value');
            let items = [];
            snap.forEach(child => { items.push({ key: child.key, ...child.val() }); });
            items.reverse(); // Show newest first
            
            let content = `<h4>${type === 'tasks' ? 'Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø­Ø§Ù„ÙŠØ©' : 'Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø­Ø§Ù„ÙŠØ©'}</h4>`;
            if (items.length > 0) {
                content += '<ul class="dynamic-item-list">';
                items.forEach(item => {
                    content += `<li>${item.name} <button class="action-btn btn-danger" style="padding: 5px 8px;" onclick="window.adminActions.deleteDynamicItem('${type}', '${item.key}')"><i class="fas fa-trash"></i></button></li>`;
                });
                content += '</ul>';
            } else { content += `<p>Ù„Ø§ ØªÙˆØ¬Ø¯ ${type === 'tasks' ? 'Ù…Ù‡Ø§Ù…' : 'Ø±ÙˆØ§Ø¨Ø·'}.</p>`; }
            container.innerHTML = content;
        };
        
        const loadTasksWithStats = async () => {
            const container = document.getElementById('tasks-table-container');
            const tasksSnap = await db.ref('config/tasks').once('value');
            const manualTasksSnap = await db.ref('manualTasks').once('value');
            
            let tasks = [];
            tasksSnap.forEach(child => {
                tasks.push({ key: child.key, type: 'auto', ...child.val() });
            });
            
            manualTasksSnap.forEach(child => {
                tasks.push({ key: child.key, type: 'manual', ...child.val() });
            });
            
            let content = '';
            if (tasks.length > 0) {
                content += '<table><thead><tr><th>Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø©</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©</th><th>Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„Ø§Øª</th><th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead><tbody>';
                
                tasks.forEach(task => {
                    let rewardBadge = '';
                    if (task.rewardType) {
                        if (task.rewardType === 'ton') rewardBadge = `<span class="reward-badge reward-ton">TON</span>`;
                        else if (task.rewardType === 'rr') rewardBadge = `<span class="reward-badge reward-rr">RR</span>`;
                        else if (task.rewardType === 'points') rewardBadge = `<span class="reward-badge reward-points">Ù†Ù‚Ø§Ø·</span>`;
                    }
                    
                    const rewardValue = task.reward || task.rewardValue || 0;
                    const completions = task.completions || 0;
                    const maxCompletions = task.maxCompletions || 0;
                    
                    content += `<tr>
                        <td>${task.name} ${rewardBadge}</td>
                        <td>${task.type === 'manual' ? 'ÙŠØ¯ÙˆÙŠØ©' : 'ØªÙ„Ù‚Ø§Ø¦ÙŠØ©'}</td>
                        <td>${rewardValue} ${task.rewardType === 'points' ? 'Ù†Ù‚Ø·Ø©' : ''}</td>
                        <td>
                            <div>${completions} Ø¥ÙƒÙ…Ø§Ù„</div>
                            ${maxCompletions > 0 ? 
                                `<div class="completion-stats">
                                    <span>${((completions / maxCompletions) * 100).toFixed(1)}%</span>
                                    <span>${maxCompletions - completions} Ù…ØªØ¨Ù‚ÙŠ</span>
                                </div>` : 
                                '<div class="completion-stats"><span>Ù„Ø§ Ù†Ù‡Ø§Ø¦ÙŠ</span></div>'
                            }
                        </td>
                        <td>
                            <button class="action-btn btn-danger" onclick="window.adminActions.deleteTask('${task.key}', '${task.type}')">Ø­Ø°Ù</button>
                            ${task.type === 'manual' ? 
                                `<button class="action-btn btn-warning" onclick="window.adminActions.editManualTask('${task.key}')">ØªØ¹Ø¯ÙŠÙ„</button>` : 
                                ''
                            }
                        </td>
                    </tr>`;
                });
                
                content += '</tbody></table>';
            } else {
                content = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù….</p>';
            }
            container.innerHTML = content;
        };
        
        const loadCodes = async () => {
            const container = document.getElementById('codes-list');
            const snap = await db.ref('codes').once('value');
            let codes = [];
            snap.forEach(child => { codes.push({ key: child.key, ...child.val() }); });
            
            let content = '<h4>Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h4>';
            if (codes.length > 0) {
                content += '<table><thead><tr><th>Ø§Ù„ÙƒÙˆØ¯</th><th>Ù†ÙˆØ¹ Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th><th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th><th>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead><tbody>';
                codes.forEach(code => {
                    const usedCount = code.usedCount || 0;
                    const maxUses = code.maxUses || 0;
                    const isExpired = code.expires && Date.now() > code.expires;
                    const isMaxed = maxUses > 0 && usedCount >= maxUses;
                    const status = isExpired ? 'Ù…Ù†ØªÙ‡ÙŠ' : isMaxed ? 'Ù…ÙƒØªÙ…Ù„' : 'Ù†Ø´Ø·';
                    
                    let rewardBadge = '';
                    if (code.rewardType) {
                        if (code.rewardType === 'ton') rewardBadge = `<span class="reward-badge reward-ton">TON</span>`;
                        else if (code.rewardType === 'rr') rewardBadge = `<span class="reward-badge reward-rr">RR</span>`;
                        else if (code.rewardType === 'points') rewardBadge = `<span class="reward-badge reward-points">Ù†Ù‚Ø§Ø·</span>`;
                    }
                    
                    content += `<tr>
                        <td>${code.key}</td>
                        <td>${rewardBadge}</td>
                        <td>${code.rewardValue || code.points || 0}</td>
                        <td>${usedCount}/${maxUses > 0 ? maxUses : 'âˆ'}</td>
                        <td>${status}</td>
                        <td>
                            <button class="action-btn btn-danger" onclick="window.adminActions.deleteCode('${code.key}')">Ø­Ø°Ù</button>
                        </td>
                    </tr>`;
                });
                content += '</tbody></table>';
            } else {
                content += '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙƒÙˆØ§Ø¯.</p>';
            }
            container.innerHTML = content;
        };
        
        const loadContestLeaderboard = async () => {
            const container = document.getElementById('contest-leaderboard');
            const snap = await db.ref('contest/participants').orderByChild('points').limitToLast(50).once('value');
            let participants = [];
            snap.forEach(child => { participants.push({ ...child.val(), id: child.key }); });
            participants.reverse(); // Show highest first
            
            let content = '';
            if (participants.length > 0) {
                content += '<table><thead><tr><th>Ø§Ù„ØªØ±ØªÙŠØ¨</th><th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th><th>Ø§Ù„Ù†Ù‚Ø§Ø·</th><th>Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</th><th>Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª</th><th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead><tbody>';
                participants.forEach((participant, index) => {
                    content += `<tr>
                        <td>${index + 1}</td>
                        <td>${participant.userName || participant.id}</td>
                        <td>${participant.points || 0}</td>
                        <td>${participant.adsWatched || 0}</td>
                        <td>${participant.referrals || 0}</td>
                        <td>
                            <button class="action-btn btn-danger" onclick="window.adminActions.removeContestPoints('${participant.id}', '${participant.userName || participant.id}')">Ø­Ø°Ù Ø§Ù„Ù†Ù‚Ø§Ø·</button>
                            <button class="action-btn btn-warning" onclick="window.adminActions.hideFromContest('${participant.id}', '${participant.userName || participant.id}')">Ø¥Ø®ÙØ§Ø¡</button>
                        </td>
                    </tr>`;
                });
                content += '</tbody></table>';
            } else {
                content = '<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙƒÙŠÙ† ÙÙŠ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©.</p>';
            }
            container.innerHTML = content;
        };
        
        const renderWithdrawMethods = (methods) => {
            const container = document.getElementById('withdraw-methods-container'); 
            container.innerHTML = '';
            if (methods) {
                methods.forEach((method, index) => {
                    container.innerHTML += `
                        <div class="withdraw-method-group" data-index="${index}">
                            <input value="${method.name || ''}" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©">
                            <input type="number" step="any" value="${method.min || ''}" placeholder="Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰">
                            <button class="action-btn btn-danger" onclick="this.parentElement.remove()">X</button>
                        </div>`;
                });
            }
        };
        
        const setupSettingsTabs = () => {
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Remove active class from all tabs and contents
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    // Add active class to clicked tab and corresponding content
                    tab.classList.add('active');
                    const tabId = tab.getAttribute('data-tab');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
        };

        // Admin Actions
        window.adminActions = {
            // Ø¥Ø¶Ø§ÙØ© Ø±ØµÙŠØ¯
            addBalance: async (userId, userName) => {
                const amount = prompt(`Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ù„Ù„Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ ${userName}:`);
                if (amount && !isNaN(parseFloat(amount)) && parseFloat(amount) > 0) { 
                    try { 
                        await db.ref(`users/${userId}/balance`).set(firebase.database.ServerValue.increment(parseFloat(amount))); 
                        alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±ØµÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­!'); 
                        renderUsers(); 
                    } catch (e) { 
                        alert('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±ØµÙŠØ¯.'); 
                    } 
                } else {
                    alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­ Ù…ÙˆØ¬Ø¨.');
                }
            },
            
            // Ø®ØµÙ… Ø±ØµÙŠØ¯
            removeBalance: async (userId, userName) => {
                const amount = prompt(`Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ù„Ù„Ø®ØµÙ… Ù…Ù† ${userName}:`);
                if (amount && !isNaN(parseFloat(amount)) && parseFloat(amount) > 0) { 
                    try { 
                        await db.ref(`users/${userId}/balance`).set(firebase.database.ServerValue.increment(-parseFloat(amount))); 
                        alert('ØªÙ… Ø®ØµÙ… Ø§Ù„Ø±ØµÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­!'); 
                        renderUsers(); 
                    } catch (e) { 
                        alert('Ø®Ø·Ø£ ÙÙŠ Ø®ØµÙ… Ø§Ù„Ø±ØµÙŠØ¯.'); 
                    } 
                } else {
                    alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­ Ù…ÙˆØ¬Ø¨.');
                }
            },
            
            // Ø­Ø¸Ø±/ÙÙƒ Ø­Ø¸Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            toggleUserBan: async (userId, userName, isCurrentlyBanned) => {
                const action = isCurrentlyBanned ? 'unban' : 'ban';
                const confirmMessage = isCurrentlyBanned ? 
                    `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ ÙÙƒ Ø­Ø¸Ø± ${userName}?` : 
                    `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ø­Ø¸Ø± ${userName}? Ù„Ù† ÙŠØªÙ…ÙƒÙ† Ù…Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.`;
                
                if (confirm(confirmMessage)) {
                    try {
                        await db.ref(`users/${userId}/banned`).set(!isCurrentlyBanned);
                        alert(`ØªÙ… ${isCurrentlyBanned ? 'ÙÙƒ Ø­Ø¸Ø±' : 'Ø­Ø¸Ø±'} Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­!`);
                        renderUsers();
                    } catch (e) {
                        alert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….');
                    }
                }
            },
            
            // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            viewUserDetails: (userId) => {
                renderUserDetails(userId);
            },
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…
            searchUser: async () => {
                const userId = document.getElementById('user-search-input').value.trim();
                if (!userId) {
                    alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
                    return;
                }
                
                const userSnap = await db.ref(`users/${userId}`).once('value');
                if (!userSnap.exists()) {
                    document.getElementById('user-search-results').innerHTML = '<div class="card"><p>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯</p></div>';
                    return;
                }
                
                renderUserDetails(userId);
            },
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©
            resetContestPoints: async (userId, userName) => {
                if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ù„Ù€ ${userName}?`)) {
                    try {
                        await db.ref(`contest/participants/${userId}`).remove();
                        alert('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø¨Ù†Ø¬Ø§Ø­!');
                        renderUserDetails(userId);
                    } catch (e) {
                        alert('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù‚Ø§Ø·.');
                    }
                }
            },
            
            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨
            handleWithdrawal: async (reqId, action) => {
                const reqRef = db.ref(`withdrawals/pending/${reqId}`); 
                const snap = await reqRef.once('value'); 
                const request = snap.val();
                if (!request) { alert('Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.'); return; }
                if (action === 'reject') { 
                    await db.ref(`users/${request.userId}/balance`).set(firebase.database.ServerValue.increment(request.amount));
                }
                const status = action === 'approve' ? 'completed' : 'rejected';
                await db.ref(`withdrawals/${status}/${reqId}`).set({ ...request, status });
                await reqRef.remove(); 
                alert(`ØªÙ… ${status === 'completed' ? 'Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰' : 'Ø±ÙØ¶'} Ø§Ù„Ø·Ù„Ø¨.`); 
                renderWithdrawals();
            },
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© ÙŠØ¯ÙˆÙŠØ©
            addManualTask: async () => {
                const data = { 
                    name: document.getElementById('manual-task-name').value,
                    description: document.getElementById('manual-task-description').value,
                    url: document.getElementById('manual-task-url').value,
                    icon: document.getElementById('manual-task-icon').value,
                    rewardType: document.getElementById('manual-task-reward-type').value,
                    rewardValue: parseFloat(document.getElementById('manual-task-reward').value),
                    maxCompletions: parseInt(document.getElementById('manual-task-max-completions').value) || 0,
                    completions: 0,
                    createdAt: firebase.database.ServerValue.TIMESTAMP
                };
                
                if (!data.name || !data.url || !data.rewardValue) { 
                    alert('Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø±Ø§Ø¨Ø· ÙˆÙ‚ÙŠÙ…Ø© Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© Ù…Ø·Ù„ÙˆØ¨Ø©.'); 
                    return; 
                }
                
                try {
                    await db.ref('manualTasks').push(data);
                    alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„ÙŠØ¯ÙˆÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!');
                    // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø­Ù‚ÙˆÙ„
                    document.getElementById('manual-task-name').value = '';
                    document.getElementById('manual-task-description').value = '';
                    document.getElementById('manual-task-url').value = '';
                    document.getElementById('manual-task-icon').value = '';
                    document.getElementById('manual-task-reward').value = '';
                    document.getElementById('manual-task-max-completions').value = '0';
                    
                    renderTasks();
                } catch (e) {
                    alert('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø©: ' + e.message);
                }
            },
            
            // ØªØ¹Ø¯ÙŠÙ„ Ù…Ù‡Ù…Ø© ÙŠØ¯ÙˆÙŠØ©
            editManualTask: async (taskId) => {
                const taskSnap = await db.ref(`manualTasks/${taskId}`).once('value');
                const task = taskSnap.val();
                
                if (!task) {
                    alert('Ø§Ù„Ù…Ù‡Ù…Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©');
                    return;
                }
                
                // ÙÙŠ ØªØ·Ø¨ÙŠÙ‚ Ø­Ù‚ÙŠÙ‚ÙŠØŒ ÙŠÙ…ÙƒÙ† ÙØªØ­ Ù†Ù…ÙˆØ°Ø¬ ØªØ¹Ø¯ÙŠÙ„
                const newName = prompt('Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯:', task.name);
                if (newName !== null) {
                    try {
                        await db.ref(`manualTasks/${taskId}/name`).set(newName);
                        alert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­!');
                        renderTasks();
                    } catch (e) {
                        alert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù‡Ù…Ø©: ' + e.message);
                    }
                }
            },
            
            // Ø­Ø°Ù Ù…Ù‡Ù…Ø©
            deleteTask: async (taskId, taskType) => {
                if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‡Ù…Ø©?')) {
                    try {
                        if (taskType === 'manual') {
                            await db.ref(`manualTasks/${taskId}`).remove();
                        } else {
                            await db.ref(`config/tasks/${taskId}`).remove();
                        }
                        alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­!');
                        renderTasks();
                    } catch (e) {
                        alert('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø©.');
                    }
                }
            },
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©
            addTask: async () => {
                const data = { 
                    name: document.getElementById('task-name').value, 
                    url: document.getElementById('task-url').value, 
                    reward: parseFloat(document.getElementById('task-reward').value), 
                    icon: document.getElementById('task-icon').value 
                };
                if (!data.name || !data.url || !data.reward || !data.icon) { 
                    alert('Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù…Ø·Ù„ÙˆØ¨Ø©.'); 
                    return; 
                }
                await db.ref('config/tasks').push(data); 
                alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø©!'); 
                renderTasks();
            },
            
            // Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø·
            addLink: async () => {
                const data = { 
                    name: document.getElementById('link-name').value, 
                    url: document.getElementById('link-url').value, 
                    icon: document.getElementById('link-icon').value 
                };
                if (!data.name || !data.url || !data.icon) { 
                    alert('Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø±Ø§Ø¨Ø· ÙˆØ±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ù…Ø·Ù„ÙˆØ¨Ø©.'); 
                    return; 
                }
                await db.ref('config/links').push(data); 
                alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø§Ø¨Ø·!'); 
                renderTasks();
            },
            
            // Ø­Ø°Ù Ø¹Ù†ØµØ± Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ
            deleteDynamicItem: async (type, key) => {
                if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ØµØ±?')) {
                    await db.ref(`config/${type}/${key}`).remove(); 
                    loadDynamicContent(type);
                }
            },
            
            // Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ Ø¬Ø¯ÙŠØ¯
            createCode: async () => {
                const codeText = document.getElementById('code-text').value.trim().toUpperCase();
                const rewardType = document.getElementById('code-reward-type').value;
                const rewardValue = parseFloat(document.getElementById('code-reward-value').value) || 0;
                const maxUses = parseInt(document.getElementById('code-max-uses').value) || 100;
                const expiry = document.getElementById('code-expiry').value;
                
                if (!codeText) {
                    alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ Ø§Ù„ÙƒÙˆØ¯');
                    return;
                }
                
                if (rewardValue <= 0) {
                    alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù‚ÙŠÙ…Ø© Ù…ÙƒØ§ÙØ£Ø© ØµØ­ÙŠØ­Ø©');
                    return;
                }
                
                const codeData = {
                    rewardType: rewardType,
                    rewardValue: rewardValue,
                    maxUses: maxUses,
                    usedCount: 0,
                    created: firebase.database.ServerValue.TIMESTAMP
                };
                
                if (expiry) {
                    codeData.expires = new Date(expiry).getTime();
                }
                
                try {
                    await db.ref(`codes/${codeText}`).set(codeData);
                    alert('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­!');
                    // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø­Ù‚ÙˆÙ„
                    document.getElementById('code-text').value = '';
                    document.getElementById('code-reward-value').value = '0.001';
                    document.getElementById('code-max-uses').value = '100';
                    document.getElementById('code-expiry').value = '';
                    await loadCodes();
                } catch (e) {
                    alert('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙˆØ¯: ' + e.message);
                }
            },
            
            // Ø­Ø°Ù ÙƒÙˆØ¯
            deleteCode: async (codeText) => {
                if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ¯ ${codeText}?`)) {
                    try {
                        await db.ref(`codes/${codeText}`).remove();
                        alert('ØªÙ… Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­!');
                        await loadCodes();
                    } catch (e) {
                        alert('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ¯.');
                    }
                }
            },
            
            // ØªØ­Ø¯ÙŠØ« Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©
            updateContestSettings: async () => {
                const endTime = document.getElementById('contest-end-time').value;
                const duration = parseInt(document.getElementById('contest-duration').value) || 7;
                
                const contestData = {
                    durationDays: duration
                };
                
                if (endTime) {
                    contestData.endTime = new Date(endTime).getTime();
                }
                
                try {
                    await db.ref('contest').update(contestData);
                    alert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø¨Ù†Ø¬Ø§Ø­!');
                } catch (e) {
                    alert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©: ' + e.message);
                }
            },
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©
            resetContest: async () => {
                if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©.')) {
                    try {
                        await db.ref('contest/participants').remove();
                        alert('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø¨Ù†Ø¬Ø§Ø­!');
                        await loadContestLeaderboard();
                    } catch (e) {
                        alert('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©.');
                    }
                }
            },
            
            // Ø­Ø°Ù Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©
            removeContestPoints: async (userId, userName) => {
                if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ø­Ø°Ù Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ù„Ù€ ${userName}?`)) {
                    try {
                        await db.ref(`contest/participants/${userId}`).remove();
                        alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù†Ù‚Ø§Ø· Ø¨Ù†Ø¬Ø§Ø­!');
                        await loadContestLeaderboard();
                    } catch (e) {
                        alert('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù†Ù‚Ø§Ø·.');
                    }
                }
            },
            
            // Ø¥Ø®ÙØ§Ø¡ Ù…Ù† Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©
            hideFromContest: async (userId, userName) => {
                if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ø¥Ø®ÙØ§Ø¡ ${userName} Ù…Ù† Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©?`)) {
                    try {
                        await db.ref(`contest/participants/${userId}/hidden`).set(true);
                        alert('ØªÙ… Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­!');
                        await loadContestLeaderboard();
                    } catch (e) {
                        alert('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….');
                    }
                }
            },
            
            // Ø¥Ø¶Ø§ÙØ© Ø·Ø±ÙŠÙ‚Ø© Ø³Ø­Ø¨
            addWithdrawMethodField: () => {
                const container = document.getElementById('withdraw-methods-container');
                const index = container.children.length;
                container.innerHTML += `
                    <div class="withdraw-method-group" data-index="${index}">
                        <input placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©">
                        <input type="number" step="any" placeholder="Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰">
                        <button class="action-btn btn-danger" onclick="this.parentElement.remove()">X</button>
                    </div>`;
            },
            
            // Ø¥Ø¶Ø§ÙØ© ÙŠÙˆÙ… Ù„Ù…ÙƒØ§ÙØ¢Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠ
            addDailyRewardDay: () => {
                const container = document.getElementById('daily-rewards-container');
                const dayIndex = container.children.length;
                container.innerHTML += `
                    <div class="form-group" style="display: flex; align-items: center; gap: 10px;">
                        <label style="min-width: 80px;">Ø§Ù„ÙŠÙˆÙ… ${dayIndex + 1}:</label>
                        <input type="number" step="any" value="0.0000" class="daily-reward-input" data-day="${dayIndex}">
                        <span>TON</span>
                    </div>`;
            },
            
            // Ø­ÙØ¸ Ù…ÙƒØ§ÙØ¢Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠ
            saveDailyRewards: async () => {
                const inputs = document.querySelectorAll('.daily-reward-input');
                const rewards = [];
                
                inputs.forEach(input => {
                    rewards.push(parseFloat(input.value) || 0);
                });
                
                try {
                    await db.ref('settings/dailyLoginRewards').set(rewards);
                    alert('ØªÙ… Ø­ÙØ¸ Ù…ÙƒØ§ÙØ¢Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠ Ø¨Ù†Ø¬Ø§Ø­!');
                } catch (e) {
                    alert('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª: ' + e.message);
                }
            },
            
            // Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            saveSettings: async () => {
                const withdrawMethods = [];
                document.querySelectorAll('#withdraw-methods-container .withdraw-method-group').forEach(group => {
                    const inputs = group.querySelectorAll('input');
                    if (inputs[0].value && inputs[1].value) {
                        withdrawMethods.push({ name: inputs[0].value, min: parseFloat(inputs[1].value) });
                    }
                });
                
                const settings = {
                    botUsername: document.getElementById('botUsername').value,
                    botToken: document.getElementById('botToken').value,
                    welcomeMessage: document.getElementById('welcomeMessage').value,
                    adZoneId: parseInt(document.getElementById('adZoneId').value) || 0,
                    adValue: parseFloat(document.getElementById('adValue').value) || 0,
                    dailyAdLimit: parseInt(document.getElementById('dailyAdLimit').value) || 0,
                    adCooldown: parseInt(document.getElementById('adCooldown').value) || 10,
                    minAdDuration: parseInt(document.getElementById('minAdDuration').value) || 5,
                    adsPerBreak: parseInt(document.getElementById('adsPerBreak').value) || 0,
                    breakDuration: parseInt(document.getElementById('breakDuration').value) || 0,
                    referralBonus: parseFloat(document.getElementById('referralBonus').value) || 0,
                    minimumWithdrawReferrals: parseInt(document.getElementById('minimumWithdrawReferrals').value) || 0,
                    withdrawMethods: withdrawMethods
                };
                
                try {
                    await db.ref('config').set(settings);
                    alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!');
                } catch (e) {
                    alert('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª: ' + e.message);
                }
            },
            
            // Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø«
            sendBroadcast: () => {
                const message = document.getElementById('broadcast-message').value;
                if (!message) { alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø³Ø§Ù„Ø©.'); return; }
                alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø«! Ù…Ù„Ø§Ø­Ø¸Ø©: ÙŠØªØ·Ù„Ø¨ Ù‡Ø°Ø§ ØªÙ†ÙÙŠØ°Ù‹Ø§ Ù…Ù† Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø®Ø§Ø¯Ù… Ù„Ø¥Ø±Ø³Ø§Ù„Ù‡ ÙØ¹Ù„ÙŠÙ‹Ø§ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†.');
            }
        };

        // Initialize Admin Panel
        const initAdminPanel = () => {
            renderDashboard();
            document.querySelectorAll('.nav-menu li').forEach(item => {
                item.addEventListener('click', function() {
                    document.querySelectorAll('.nav-menu li').forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    const page = this.getAttribute('data-page');
                    pageTitle.textContent = this.textContent.trim();
                    if (page === 'dashboard') renderDashboard();
                    else if (page === 'users') renderUsers();
                    else if (page === 'user-search') renderUserSearch();
                    else if (page === 'withdrawals') renderWithdrawals();
                    else if (page === 'history') renderWithdrawalHistory();
                    else if (page === 'tasks') renderTasks();
                    else if (page === 'codes') renderCodes();
                    else if (page === 'contest') renderContest();
                    else if (page === 'settings') renderSettings();
                    else if (page === 'broadcast') renderBroadcast();
                    if (window.innerWidth < 768) { sidebar.classList.remove('open'); overlay.classList.remove('show'); }
                });
            });
            
            document.getElementById('menu-toggle').addEventListener('click', () => {
                sidebar.classList.add('open'); overlay.classList.add('show');
            });
            
            document.querySelector('#sidebar .close-btn').addEventListener('click', () => {
                sidebar.classList.remove('open'); overlay.classList.remove('show');
            });
            
            overlay.addEventListener('click', () => {
                sidebar.classList.remove('open'); overlay.classList.remove('show');
            });
        };
    });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Payment Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #4FC3F7;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #4FC3F7;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .control-panel {
            text-align: center;
        }

        .btn {
            padding: 15px 30px;
            font-size: 1.1rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            margin: 10px;
            min-width: 200px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }

        .btn-danger {
            background: linear-gradient(45deg, #f44336, #da190b);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(244, 67, 54, 0.4);
        }

        .btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-active {
            background: #4CAF50;
            box-shadow: 0 0 10px #4CAF50;
        }

        .status-inactive {
            background: #f44336;
        }

        .status-processing {
            background: #FF9800;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .withdrawals-list {
            margin-top: 30px;
        }

        .withdrawal-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .withdrawal-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(5px);
        }

        .withdrawal-info {
            flex: 1;
        }

        .withdrawal-amount {
            font-size: 1.3rem;
            font-weight: bold;
            color: #4FC3F7;
        }

        .withdrawal-details {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 5px;
        }

        .withdrawal-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .status-pending {
            background: rgba(255, 152, 0, 0.3);
            color: #FF9800;
        }

        .status-completed {
            background: rgba(76, 175, 80, 0.3);
            color: #4CAF50;
        }

        .status-failed {
            background: rgba(244, 67, 54, 0.3);
            color: #f44336;
        }

        .auto-payment-log {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
        }

        .log-entry {
            padding: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-family: monospace;
            font-size: 0.9rem;
        }

        .log-success {
            color: #4CAF50;
        }

        .log-error {
            color: #f44336;
        }

        .log-info {
            color: #4FC3F7;
        }

        .settings-panel {
            margin-top: 20px;
        }

        .setting-item {
            margin: 15px 0;
        }

        .setting-item label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .setting-item input {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: #4CAF50;
        }

        .notification.error {
            background: #f44336;
        }

        .notification.info {
            background: #2196F3;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ Auto Payment Dashboard</h1>
            <p>ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ≥ÿ≠Ÿàÿ®ÿßÿ™ ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿäÿ© - FaucetPay</p>
        </div>

        <div class="dashboard">
            <div class="card">
                <h2>üìä Statistics</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="total-processed">0</div>
                        <div class="stat-label">Total Processed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="successful-payments">0</div>
                        <div class="stat-label">Successful</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="failed-payments">0</div>
                        <div class="stat-label">Failed</div>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="total-ton">0.0000</div>
                        <div class="stat-label">Total TON</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="pending-count">0</div>
                        <div class="stat-label">Pending</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="auto-mode">OFF</div>
                        <div class="stat-label">Auto Mode</div>
                    </div>
                </div>
            </div>

            <div class="card control-panel">
                <h2>üéÆ Control Panel</h2>
                <div style="margin: 20px 0;">
                    <span class="status-indicator" id="status-indicator"></span>
                    <span id="status-text">Loading...</span>
                </div>
                
                <button class="btn btn-primary" id="start-auto-btn" onclick="startAutoPayments()">
                    üöÄ Start Auto Payments
                </button>
                
                <button class="btn btn-danger" id="stop-auto-btn" onclick="stopAutoPayments()" disabled>
                    ‚èπÔ∏è Stop Auto Payments
                </button>
                
                <button class="btn btn-primary" id="process-pending-btn" onclick="processPendingWithdrawals()">
                    üîÑ Process Pending Now
                </button>

                <div class="settings-panel">
                    <div class="setting-item">
                        <label for="max-amount">Max Auto Amount (TON):</label>
                        <input type="number" id="max-amount" value="0.001" step="0.0001" min="0.0001">
                    </div>
                    <div class="setting-item">
                        <label for="check-interval">Check Interval (seconds):</label>
                        <input type="number" id="check-interval" value="30" min="10">
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>üìã Recent Withdrawals</h2>
            <div id="withdrawals-container">
                <div class="withdrawal-item">
                    <div class="withdrawal-info">
                        <div class="withdrawal-amount">0.0005 TON</div>
                        <div class="withdrawal-details">user@example.com ‚Ä¢ 2 minutes ago</div>
                    </div>
                    <div class="withdrawal-status status-pending">Pending</div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>üìù Auto Payment Log</h2>
            <div class="auto-payment-log" id="payment-log">
                <div class="log-entry log-info">System started - Ready to process payments</div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        // ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ
        const API_KEY = "21c756eae3ffb458d1fcef45685aacb78b110c179dcea7128c2593e0fc8fdcf0";
        const FAUCETPAY_ENDPOINT = "https://faucetpay.io/api/v1/send";
        
        let isAutoMode = false;
        let checkInterval = null;
        let pendingWithdrawals = [];
        let processedWithdrawals = [];

        // ÿπŸÜÿßÿµÿ± DOM
        const statusIndicator = document.getElementById('status-indicator');
        const statusText = document.getElementById('status-text');
        const startBtn = document.getElementById('start-auto-btn');
        const stopBtn = document.getElementById('stop-auto-btn');
        const processBtn = document.getElementById('process-pending-btn');
        const paymentLog = document.getElementById('payment-log');
        const notification = document.getElementById('notification');

        // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™
        function updateStats() {
            document.getElementById('total-processed').textContent = processedWithdrawals.length;
            document.getElementById('successful-payments').textContent = 
                processedWithdrawals.filter(w => w.status === 'completed').length;
            document.getElementById('failed-payments').textContent = 
                processedWithdrawals.filter(w => w.status === 'failed').length;
            document.getElementById('pending-count').textContent = pendingWithdrawals.length;
            
            const totalTON = processedWithdrawals
                .filter(w => w.status === 'completed')
                .reduce((sum, w) => sum + w.amount, 0);
            document.getElementById('total-ton').textContent = totalTON.toFixed(4);
            
            document.getElementById('auto-mode').textContent = isAutoMode ? 'ON' : 'OFF';
        }

        // ÿ•ÿ∂ÿßŸÅÿ© ÿ≥ÿ¨ŸÑ
        function addLog(message, type = 'info') {
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            paymentLog.appendChild(logEntry);
            paymentLog.scrollTop = paymentLog.scrollHeight;
        }

        // ÿπÿ±ÿ∂ ÿ•ÿ¥ÿπÿßÿ±
        function showNotification(message, type = 'info') {
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿßŸÑŸÜÿ∏ÿßŸÖ
        function updateStatus(status, text) {
            statusIndicator.className = 'status-indicator';
            if (status === 'active') {
                statusIndicator.classList.add('status-active');
            } else if (status === 'inactive') {
                statusIndicator.classList.add('status-inactive');
            } else if (status === 'processing') {
                statusIndicator.classList.add('status-processing');
            }
            statusText.textContent = text;
        }

        // ÿ¨ŸÑÿ® ÿßŸÑÿ≥ÿ≠Ÿàÿ®ÿßÿ™ ÿßŸÑŸÖÿπŸÑŸÇÿ© ŸÖŸÜ Firebase
        async function fetchPendingWithdrawals() {
            try {
                // ŸáŸÜÿß ÿ≥Ÿäÿ™ŸÖ ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ŸÄ Firebase ŸÑÿ¨ŸÑÿ® ÿßŸÑÿ≥ÿ≠Ÿàÿ®ÿßÿ™ ÿßŸÑŸÖÿπŸÑŸÇÿ©
                // Ÿáÿ∞ÿß ŸÖÿ´ÿßŸÑ ŸÖÿ≠ÿßŸÉŸä ŸÑŸÑÿ®ŸäÿßŸÜÿßÿ™
                const mockWithdrawals = [
                    {
                        id: '1',
                        amount: 0.0005,
                        email: 'user1@gmail.com',
                        userName: 'User One',
                        timestamp: Date.now() - 120000
                    },
                    {
                        id: '2', 
                        amount: 0.0008,
                        email: 'user2@gmail.com',
                        userName: 'User Two',
                        timestamp: Date.now() - 300000
                    }
                ];
                
                pendingWithdrawals = mockWithdrawals;
                updateWithdrawalsList();
                updateStats();
                
            } catch (error) {
                addLog(`Error fetching withdrawals: ${error.message}`, 'error');
            }
        }

        // ÿ™ÿ≠ÿØŸäÿ´ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ≥ÿ≠Ÿàÿ®ÿßÿ™
        function updateWithdrawalsList() {
            const container = document.getElementById('withdrawals-container');
            container.innerHTML = '';
            
            pendingWithdrawals.forEach(withdrawal => {
                const item = document.createElement('div');
                item.className = 'withdrawal-item';
                item.innerHTML = `
                    <div class="withdrawal-info">
                        <div class="withdrawal-amount">${withdrawal.amount.toFixed(4)} TON</div>
                        <div class="withdrawal-details">
                            ${withdrawal.email} ‚Ä¢ ${formatTime(withdrawal.timestamp)}
                        </div>
                    </div>
                    <div class="withdrawal-status status-pending">Pending</div>
                `;
                container.appendChild(item);
            });
        }

        // ÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑŸàŸÇÿ™
        function formatTime(timestamp) {
            const now = Date.now();
            const diff = now - timestamp;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            
            if (minutes < 1) return 'Just now';
            if (minutes < 60) return `${minutes} minutes ago`;
            if (hours < 24) return `${hours} hours ago`;
            return new Date(timestamp).toLocaleDateString();
        }

        // ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿØŸÅÿπ ÿπÿ®ÿ± FaucetPay
        async function processPayment(withdrawal) {
            try {
                addLog(`Processing payment: ${withdrawal.amount} TON to ${withdrawal.email}`, 'info');
                updateStatus('processing', `Processing ${withdrawal.amount} TON...`);
                
                const amountSatoshi = Math.floor(withdrawal.amount * 100000000);
                
                const payload = new URLSearchParams({
                    "api_key": API_KEY,
                    "currency": "TON",
                    "amount": amountSatoshi.toString(),
                    "to": withdrawal.email
                });

                const response = await fetch(FAUCETPAY_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: payload
                });

                const result = await response.json();
                
                if (result.status === 200) {
                    addLog(`‚úÖ Payment successful! TX: ${result.payment_id}`, 'success');
                    showNotification(`Payment sent: ${withdrawal.amount} TON`, 'success');
                    
                    return {
                        success: true,
                        transactionId: result.payment_id,
                        withdrawal: withdrawal
                    };
                } else {
                    addLog(`‚ùå Payment failed: ${result.message}`, 'error');
                    showNotification(`Payment failed: ${result.message}`, 'error');
                    
                    return {
                        success: false,
                        error: result.message,
                        withdrawal: withdrawal
                    };
                }
                
            } catch (error) {
                addLog(`‚ùå Payment error: ${error.message}`, 'error');
                showNotification(`Payment error: ${error.message}`, 'error');
                
                return {
                    success: false,
                    error: error.message,
                    withdrawal: withdrawal
                };
            }
        }

        // ŸÖÿπÿßŸÑÿ¨ÿ© ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≥ÿ≠Ÿàÿ®ÿßÿ™ ÿßŸÑŸÖÿπŸÑŸÇÿ©
        async function processAllPendingWithdrawals() {
            const maxAmount = parseFloat(document.getElementById('max-amount').value);
            
            // ÿ™ÿµŸÅŸäÿ© ÿßŸÑÿ≥ÿ≠Ÿàÿ®ÿßÿ™ ÿ≠ÿ≥ÿ® ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿßŸÑÿ£ŸÇÿµŸâ
            const eligibleWithdrawals = pendingWithdrawals.filter(w => w.amount <= maxAmount);
            
            if (eligibleWithdrawals.length === 0) {
                addLog('No eligible withdrawals to process', 'info');
                return;
            }
            
            addLog(`Processing ${eligibleWithdrawals.length} eligible withdrawals...`, 'info');
            
            for (const withdrawal of eligibleWithdrawals) {
                const result = await processPayment(withdrawal);
                
                // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™
                if (result.success) {
                    processedWithdrawals.push({
                        ...withdrawal,
                        status: 'completed',
                        transactionId: result.transactionId,
                        processedAt: Date.now()
                    });
                    
                    // ÿ•ÿ≤ÿßŸÑÿ© ŸÖŸÜ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿπŸÑŸÇÿ©
                    pendingWithdrawals = pendingWithdrawals.filter(w => w.id !== withdrawal.id);
                } else {
                    processedWithdrawals.push({
                        ...withdrawal,
                        status: 'failed',
                        error: result.error,
                        processedAt: Date.now()
                    });
                }
                
                updateStats();
                updateWithdrawalsList();
                
                // ÿßŸÜÿ™ÿ∏ÿßÿ± 2 ÿ´ÿßŸÜŸäÿ© ÿ®ŸäŸÜ ŸÉŸÑ ÿπŸÖŸÑŸäÿ© ÿØŸÅÿπ
                await new Promise(resolve => setTimeout(resolve, 2000));
            }
            
            updateStatus('active', 'Auto payments running');
            addLog('Finished processing all eligible withdrawals', 'info');
        }

        // ÿ®ÿØÿ° ÿßŸÑÿ≥ÿ≠ÿ® ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä
        function startAutoPayments() {
            if (isAutoMode) return;
            
            isAutoMode = true;
            const interval = parseInt(document.getElementById('check-interval').value) * 1000;
            
            startBtn.disabled = true;
            stopBtn.disabled = false;
            
            updateStatus('active', 'Auto payments running');
            addLog('üîÑ Auto payment mode started', 'info');
            showNotification('Auto payments started', 'success');
            
            // ŸÖÿπÿßŸÑÿ¨ÿ© ŸÅŸàÿ±Ÿäÿ© ÿ£ŸàŸÑŸâ
            processAllPendingWithdrawals();
            
            // ÿ∂ÿ®ÿ∑ ÿßŸÑŸÅÿßÿµŸÑ ÿßŸÑÿ≤ŸÖŸÜŸä
            checkInterval = setInterval(async () => {
                await fetchPendingWithdrawals();
                await processAllPendingWithdrawals();
            }, interval);
        }

        // ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿ≥ÿ≠ÿ® ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä
        function stopAutoPayments() {
            if (!isAutoMode) return;
            
            isAutoMode = false;
            clearInterval(checkInterval);
            
            startBtn.disabled = false;
            stopBtn.disabled = true;
            
            updateStatus('inactive', 'Auto payments stopped');
            addLog('‚èπÔ∏è Auto payment mode stopped', 'info');
            showNotification('Auto payments stopped', 'info');
        }

        // ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ≥ÿ≠Ÿàÿ®ÿßÿ™ ÿßŸÑŸÖÿπŸÑŸÇÿ© ŸäÿØŸàŸäÿßŸã
        async function processPendingWithdrawals() {
            updateStatus('processing', 'Processing pending withdrawals...');
            await processAllPendingWithdrawals();
            updateStatus('inactive', 'Ready');
        }

        // ÿßŸÑÿ™ŸáŸäÿ¶ÿ©
        async function init() {
            updateStatus('inactive', 'Loading...');
            addLog('System initialized', 'info');
            
            await fetchPendingWithdrawals();
            updateStats();
            
            updateStatus('inactive', 'Ready to start auto payments');
            
            // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÉŸÑ 30 ÿ´ÿßŸÜŸäÿ©
            setInterval(fetchPendingWithdrawals, 30000);
        }

        // ÿ®ÿØÿ° ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>

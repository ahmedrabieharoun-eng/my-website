<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… DOGS Boss</title>
  <!-- Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†ÙØ³ Ø¥ØµØ¯Ø§Ø±Ø§Øª Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.0/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body class="bg-gray-900 text-white min-h-screen">
  <div class="p-6 max-w-6xl mx-auto">
    <h1 class="text-3xl font-bold mb-4 text-center">âš™ï¸ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… DOGS Boss</h1>

    <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
      <div class="bg-blue-600 p-4 rounded-lg text-center">
        <div class="text-2xl font-bold" id="totalUsers">0</div>
        <div class="text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
      </div>
      <div class="bg-green-600 p-4 rounded-lg text-center">
        <div class="text-2xl font-bold" id="totalEarnings">0 DOGS</div>
        <div class="text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</div>
      </div>
      <div class="bg-purple-600 p-4 rounded-lg text-center">
        <div class="text-2xl font-bold" id="totalReferrals">0</div>
        <div class="text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª</div>
      </div>
    </div>

    <!-- Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¶Ø§ÙØ© -->
    <div class="bg-gray-800 p-4 rounded-lg mb-6">
      <h2 class="text-xl mb-2 font-semibold">â• Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</h2>
      <input id="newKey" placeholder="Ø§Ù„Ù…ÙØªØ§Ø­ (key)" class="p-2 rounded bg-gray-700 text-white w-full mb-2" />
      <textarea id="newValue" placeholder="Ø§Ù„Ù‚ÙŠÙ…Ø© (JSON Ø£Ùˆ Ù†Øµ)" class="p-2 rounded bg-gray-700 text-white w-full mb-2"></textarea>
      <button id="addBtn" class="bg-green-600 px-4 py-2 rounded hover:bg-green-500">Ø¥Ø¶Ø§ÙØ©</button>
    </div>

    <!-- Ù‚Ø³Ù… Ø§Ù„Ø¨Ø­Ø« -->
    <div class="bg-gray-800 p-4 rounded-lg mb-6">
      <h2 class="text-xl mb-2 font-semibold">ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…</h2>
      <div class="flex gap-2">
        <input id="searchInput" placeholder="Ø£Ø¯Ø®Ù„ User ID" class="p-2 rounded bg-gray-700 text-white w-full" type="number" />
        <button id="searchBtn" class="bg-blue-600 px-4 py-2 rounded hover:bg-blue-500">Ø¨Ø­Ø«</button>
      </div>
      <div id="userDetails" class="mt-4 hidden bg-gray-700 p-4 rounded-lg"></div>
    </div>

    <!-- Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
    <div class="bg-gray-800 p-4 rounded-lg shadow-md overflow-auto max-h-[70vh]" id="dataContainer">
      <p class="text-gray-400 text-center">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
    </div>

    <!-- Ø²Ø± ØªÙØ±ÙŠØº Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
    <div class="text-center mt-4">
      <button onclick="clearAllData()" class="bg-red-700 px-4 py-2 rounded hover:bg-red-600">ğŸ—‘ï¸ ØªÙØ±ÙŠØº Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
    </div>
  </div>

  <script>
    // ØªÙƒÙˆÙŠÙ† Firebase Ø¨Ù†ÙØ³ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    const firebaseConfig = {
      apiKey: "AIzaSyAcwYjMSpnOC1_MSFpBzctqiKRmhwLOtY4",
      authDomain: "dogs-boss.firebaseapp.com",
      databaseURL: "https://dogs-boss-default-rtdb.firebaseio.com",
      projectId: "dogs-boss",
      storageBucket: "dogs-boss.firebasestorage.app",
      messagingSenderId: "778183941825",
      appId: "1:778183941825:web:45a96727e1aad043bffe40",
      measurementId: "G-EY15XEGP53"
    };

    // ØªÙ‡ÙŠØ¦Ø© Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const dbRef = firebase.database().ref('/');
    const dataContainer = document.getElementById("dataContainer");

    // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    let totalUsers = 0;
    let totalEarnings = 0;
    let totalReferrals = 0;

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    function updateStats() {
      document.getElementById("totalUsers").textContent = totalUsers;
      document.getElementById("totalEarnings").textContent = totalEarnings.toFixed(0) + " DOGS";
      document.getElementById("totalReferrals").textContent = totalReferrals;
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    dbRef.on('value', (snapshot) => {
      const data = snapshot.val();
      if (!data) {
        dataContainer.innerHTML = "<p class='text-center text-gray-400'>ğŸš« Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</p>";
        return;
      }

      // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
      totalUsers = 0;
      totalEarnings = 0;
      totalReferrals = 0;

      let html = "";
      for (const key in data) {
        if (key === "users") {
          // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
          for (const userId in data[key]) {
            totalUsers++;
            const user = data[key][userId];
            const userEarnings = user.totalEarning || 0;
            const userReferrals = user.referrals || 0;
            
            totalEarnings += parseFloat(userEarnings);
            totalReferrals += parseInt(userReferrals);

            html += `
              <div class="bg-gray-700 p-3 rounded mb-3">
                <div class="flex justify-between items-start">
                  <div>
                    <h3 class="font-bold">ğŸ‘¤ User: ${userId}</h3>
                    <p class="text-sm text-gray-300">ğŸ’° Ø§Ù„Ø±ØµÙŠØ¯: ${userEarnings} DOGS</p>
                    <p class="text-sm text-gray-300">ğŸ‘¥ Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª: ${userReferrals}</p>
                    <p class="text-sm text-gray-300">ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª: ${user.adCount || 0}</p>
                  </div>
                  <div class="flex gap-2">
                    <button onclick="editUser('${userId}')" class="bg-blue-600 px-3 py-1 rounded hover:bg-blue-500 text-sm">ØªØ¹Ø¯ÙŠÙ„</button>
                    <button onclick="deleteUser('${userId}')" class="bg-red-600 px-3 py-1 rounded hover:bg-red-500 text-sm">Ø­Ø°Ù</button>
                  </div>
                </div>
                <textarea id="val-users-${userId}" class="w-full bg-gray-800 text-white p-2 rounded mt-2 text-sm" rows="4">${JSON.stringify(user, null, 2)}</textarea>
              </div>
            `;
          }
        } else {
          // Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø®Ø±Ù‰
          html += `
            <div class="bg-gray-700 p-3 rounded mb-3">
              <h3 class="font-bold">${key}</h3>
              <textarea id="val-${key}" class="w-full bg-gray-800 text-white p-2 rounded mt-1">${JSON.stringify(data[key], null, 2)}</textarea>
              <div class="mt-2 flex gap-2">
                <button onclick="updateData('${key}')" class="bg-blue-600 px-3 py-1 rounded hover:bg-blue-500">ØªØ¹Ø¯ÙŠÙ„</button>
                <button onclick="deleteData('${key}')" class="bg-red-600 px-3 py-1 rounded hover:bg-red-500">Ø­Ø°Ù</button>
              </div>
            </div>
          `;
        }
      }

      dataContainer.innerHTML = html;
      updateStats();
    });

    // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­ÙƒÙ…
    window.updateData = (key) => {
      const newVal = document.getElementById(`val-${key}`).value;
      try {
        const parsedVal = JSON.parse(newVal);
        db.ref(key).update(parsedVal);
        alert("âœ… ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!");
      } catch (e) {
        alert("âš ï¸ ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ JSON ØµØ§Ù„Ø­!");
      }
    };

    window.deleteData = (key) => {
      if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ${key}ØŸ`)) {
        db.ref(key).remove();
      }
    };

    window.editUser = (userId) => {
      const newVal = document.getElementById(`val-users-${userId}`).value;
      try {
        const parsedVal = JSON.parse(newVal);
        db.ref(`users/${userId}`).update(parsedVal);
        alert("âœ… ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­!");
      } catch (e) {
        alert("âš ï¸ ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ JSON ØµØ§Ù„Ø­!");
      }
    };

    window.deleteUser = (userId) => {
      if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${userId}ØŸ`)) {
        db.ref(`users/${userId}`).remove();
      }
    };

    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…
    document.getElementById("searchBtn").addEventListener("click", () => {
      const userId = document.getElementById("searchInput").value.trim();
      if (!userId) return alert("âš ï¸ Ø£Ø¯Ø®Ù„ User ID Ø£ÙˆÙ„Ø§Ù‹!");

      db.ref(`users/${userId}`).once('value')
        .then(snapshot => {
          const userData = snapshot.val();
          const userDetails = document.getElementById("userDetails");
          
          if (!userData) {
            userDetails.innerHTML = "<p class='text-red-400'>âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</p>";
            userDetails.classList.remove("hidden");
            return;
          }

          userDetails.innerHTML = `
            <h3 class="font-bold text-lg mb-2">ğŸ‘¤ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${userId}</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <p><strong>ğŸ’° Ø§Ù„Ø±ØµÙŠØ¯:</strong> ${userData.totalEarning || 0} DOGS</p>
                <p><strong>ğŸ‘¥ Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª:</strong> ${userData.referrals || 0}</p>
                <p><strong>ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª:</strong> ${userData.adCount || 0}</p>
              </div>
              <div>
                <p><strong>ğŸ“… Ø¢Ø®Ø± Ø¥Ø¹Ù„Ø§Ù†:</strong> ${userData.lastAdWatchedDate || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</p>
                <p><strong>ğŸ”§ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©:</strong> ${(userData.completedBonusTasks || []).length}</p>
              </div>
            </div>
            <textarea class="w-full bg-gray-800 text-white p-2 rounded mt-2" rows="6">${JSON.stringify(userData, null, 2)}</textarea>
            <div class="mt-2 flex gap-2">
              <button onclick="editUser('${userId}')" class="bg-blue-600 px-3 py-1 rounded hover:bg-blue-500">ØªØ¹Ø¯ÙŠÙ„</button>
              <button onclick="deleteUser('${userId}')" class="bg-red-600 px-3 py-1 rounded hover:bg-red-500">Ø­Ø°Ù</button>
            </div>
          `;
          userDetails.classList.remove("hidden");
        })
        .catch(error => {
          alert("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø«: " + error.message);
        });
    });

    // Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©
    document.getElementById("addBtn").addEventListener("click", () => {
      const key = document.getElementById("newKey").value.trim();
      const val = document.getElementById("newValue").value.trim();
      if (!key || !val) return alert("âš ï¸ Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…ÙØªØ§Ø­ ÙˆØ§Ù„Ù‚ÙŠÙ…Ø© Ø£ÙˆÙ„Ø§Ù‹!");

      try {
        const parsed = JSON.parse(val);
        db.ref(key).set(parsed);
        alert("âœ… ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­!");
        // ØªÙØ±ÙŠØº Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
        document.getElementById("newKey").value = '';
        document.getElementById("newValue").value = '';
      } catch {
        db.ref(key).set(val);
        alert("âœ… ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© ÙƒÙ†Øµ!");
        // ØªÙØ±ÙŠØº Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
        document.getElementById("newKey").value = '';
        document.getElementById("newValue").value = '';
      }
    });

    // ØªÙØ±ÙŠØº Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    window.clearAllData = () => {
      if (confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!')) {
        db.ref('/').remove()
          .then(() => {
            alert('âœ… ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
          })
          .catch(error => {
            alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message);
          });
      }
    };

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
    dbRef.on('error', (error) => {
      console.error('Firebase Error:', error);
      dataContainer.innerHTML = `
        <div class="bg-red-600 p-4 rounded-lg text-center">
          <p class="font-bold">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
          <p class="text-sm">${error.message}</p>
        </div>
      `;
    });
  </script>
</body>
</html>

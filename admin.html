<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Payment Dashboard</title>
    <!-- Ø¥Ø¶Ø§ÙØ© Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #4FC3F7;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #4FC3F7;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .control-panel {
            text-align: center;
        }

        .btn {
            padding: 15px 30px;
            font-size: 1.1rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            margin: 10px;
            min-width: 200px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }

        .btn-danger {
            background: linear-gradient(45deg, #f44336, #da190b);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(244, 67, 54, 0.4);
        }

        .btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-active {
            background: #4CAF50;
            box-shadow: 0 0 10px #4CAF50;
        }

        .status-inactive {
            background: #f44336;
        }

        .status-processing {
            background: #FF9800;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .withdrawals-list {
            margin-top: 30px;
            max-height: 400px;
            overflow-y: auto;
        }

        .withdrawal-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .withdrawal-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(5px);
        }

        .withdrawal-info {
            flex: 1;
        }

        .withdrawal-amount {
            font-size: 1.3rem;
            font-weight: bold;
            color: #4FC3F7;
        }

        .withdrawal-details {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 5px;
        }

        .withdrawal-user {
            font-weight: bold;
            color: #FFD700;
        }

        .withdrawal-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .status-pending {
            background: rgba(255, 152, 0, 0.3);
            color: #FF9800;
        }

        .status-completed {
            background: rgba(76, 175, 80, 0.3);
            color: #4CAF50;
        }

        .status-failed {
            background: rgba(244, 67, 54, 0.3);
            color: #f44336;
        }

        .auto-payment-log {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
        }

        .log-entry {
            padding: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-family: monospace;
            font-size: 0.9rem;
        }

        .log-success {
            color: #4CAF50;
        }

        .log-error {
            color: #f44336;
        }

        .log-info {
            color: #4FC3F7;
        }

        .settings-panel {
            margin-top: 20px;
        }

        .setting-item {
            margin: 15px 0;
        }

        .setting-item label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .setting-item input {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: #4CAF50;
        }

        .notification.error {
            background: #f44336;
        }

        .notification.info {
            background: #2196F3;
        }

        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .filter-btn {
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-btn.active {
            background: #4FC3F7;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #4FC3F7;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¤– Auto Payment Dashboard</h1>
            <p>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© - Ù…ØªØµÙ„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©</p>
        </div>

        <div class="dashboard">
            <div class="card">
                <h2>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø­ÙŠØ©</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="total-pending">0</div>
                        <div class="stat-label">Ø³Ø­ÙˆØ¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø©</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="successful-payments">0</div>
                        <div class="stat-label">Ù†Ø§Ø¬Ø­Ø©</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="failed-payments">0</div>
                        <div class="stat-label">ÙØ§Ø´Ù„Ø©</div>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="total-ton">0.0000</div>
                        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ TON</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="faucetpay-count">0</div>
                        <div class="stat-label">FaucetPay</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="auto-mode">OFF</div>
                        <div class="stat-label">ÙˆØ¶Ø¹ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</div>
                    </div>
                </div>
            </div>

            <div class="card control-panel">
                <h2>ğŸ® Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
                <div style="margin: 20px 0;">
                    <span class="status-indicator" id="status-indicator"></span>
                    <span id="status-text">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
                </div>
                
                <button class="btn btn-primary" id="start-auto-btn" onclick="startAutoPayments()">
                    ğŸš€ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
                </button>
                
                <button class="btn btn-danger" id="stop-auto-btn" onclick="stopAutoPayments()" disabled>
                    â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
                </button>
                
                <button class="btn btn-primary" id="process-pending-btn" onclick="processPendingWithdrawals()">
                    ğŸ”„ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© Ø§Ù„Ø¢Ù†
                </button>

                <div class="settings-panel">
                    <div class="setting-item">
                        <label for="max-amount">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ (TON):</label>
                        <input type="number" id="max-amount" value="0.001" step="0.0001" min="0.0001">
                    </div>
                    <div class="setting-item">
                        <label for="check-interval">ÙØ§ØµÙ„ Ø§Ù„ÙØ­Øµ (Ø«Ø§Ù†ÙŠØ©):</label>
                        <input type="number" id="check-interval" value="30" min="10">
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>ğŸ“‹ Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© Ù…Ù† Firebase</h2>
            <div class="filters">
                <button class="filter-btn active" onclick="filterWithdrawals('all')">Ø§Ù„ÙƒÙ„</button>
                <button class="filter-btn" onclick="filterWithdrawals('faucetpay')">FaucetPay ÙÙ‚Ø·</button>
                <button class="filter-btn" onclick="filterWithdrawals('small')">ØµØºÙŠØ±Ø© (&lt;0.001)</button>
            </div>
            <div id="withdrawals-container">
                <div class="loading">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
            </div>
        </div>

        <div class="card">
            <h2>ğŸ“ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©</h2>
            <div class="auto-payment-log" id="payment-log">
                <div class="log-entry log-info">ØªÙ… Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù… - Ø¬Ø§Ù‡Ø² Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        // ğŸ”§ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase - Ù†ÙØ³ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
        const firebaseConfig = {
  apiKey: "AIzaSyAk909CcFWn4ZMeBEM1yxRbQbW9w6UNo58",
  authDomain: "earn-money-c3bad.firebaseapp.com",
  databaseURL: "https://earn-money-c3bad-default-rtdb.firebaseio.com",
  projectId: "earn-money-c3bad",
  storageBucket: "earn-money-c3bad.firebasestorage.app",
  messagingSenderId: "1022688566011",
  appId: "1:1022688566011:web:690f6faa19dd3337a2ee5e",
  measurementId: "G-0CH1LBFLH2"
        };

        // ğŸ”‘ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¯ÙØ¹
        const API_KEY = "21c756eae3ffb458d1fcef45685aacb78b110c179dcea7128c2593e0fc8fdcf0";
        const FAUCETPAY_ENDPOINT = "https://faucetpay.io/api/v1/send";
        
        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        let isAutoMode = false;
        let checkInterval = null;
        let pendingWithdrawals = [];
        let processedWithdrawals = [];
        let db;

        // Ø¹Ù†Ø§ØµØ± DOM
        const statusIndicator = document.getElementById('status-indicator');
        const statusText = document.getElementById('status-text');
        const startBtn = document.getElementById('start-auto-btn');
        const stopBtn = document.getElementById('stop-auto-btn');
        const processBtn = document.getElementById('process-pending-btn');
        const paymentLog = document.getElementById('payment-log');
        const notification = document.getElementById('notification');

        // ğŸ”„ ØªÙ‡ÙŠØ¦Ø© Firebase
        function initializeFirebase() {
            try {
                firebase.initializeApp(firebaseConfig);
                db = firebase.database();
                addLog('âœ… ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Firebase Ø¨Ù†Ø¬Ø§Ø­', 'success');
                return true;
            } catch (error) {
                addLog(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Firebase: ${error.message}`, 'error');
                return false;
            }
        }

        // ğŸ“Š ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        function updateStats() {
            const faucetpayPending = pendingWithdrawals.filter(w => w.method === 'FaucetPay').length;
            const smallPending = pendingWithdrawals.filter(w => w.amount <= 0.001).length;
            
            document.getElementById('total-pending').textContent = pendingWithdrawals.length;
            document.getElementById('successful-payments').textContent = 
                processedWithdrawals.filter(w => w.status === 'completed').length;
            document.getElementById('failed-payments').textContent = 
                processedWithdrawals.filter(w => w.status === 'failed').length;
            document.getElementById('faucetpay-count').textContent = faucetpayPending;
            
            const totalTON = processedWithdrawals
                .filter(w => w.status === 'completed')
                .reduce((sum, w) => sum + w.amount, 0);
            document.getElementById('total-ton').textContent = totalTON.toFixed(4);
            
            document.getElementById('auto-mode').textContent = isAutoMode ? 'ON' : 'OFF';
        }

        // ğŸ“ Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„
        function addLog(message, type = 'info') {
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            paymentLog.appendChild(logEntry);
            paymentLog.scrollTop = paymentLog.scrollHeight;
        }

        // ğŸ”” Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø±
        function showNotification(message, type = 'info') {
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
        function updateStatus(status, text) {
            statusIndicator.className = 'status-indicator';
            if (status === 'active') {
                statusIndicator.classList.add('status-active');
            } else if (status === 'inactive') {
                statusIndicator.classList.add('status-inactive');
            } else if (status === 'processing') {
                statusIndicator.classList.add('status-processing');
            }
            statusText.textContent = text;
        }

        // ğŸ“¥ Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© Ù…Ù† Firebase
        async function fetchPendingWithdrawals() {
            try {
                if (!db) {
                    addLog('âŒ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ØªØ§Ø­Ø©', 'error');
                    return;
                }

                const withdrawalsRef = db.ref('withdrawals/pending');
                const snapshot = await withdrawalsRef.once('value');
                const withdrawalsData = snapshot.val();
                
                pendingWithdrawals = [];
                
                if (withdrawalsData) {
                    Object.values(withdrawalsData).forEach(withdrawal => {
                        if (withdrawal.status === 'pending') {
                            pendingWithdrawals.push({
                                id: withdrawal.id,
                                amount: withdrawal.amount,
                                method: withdrawal.method,
                                account: withdrawal.account,
                                userName: withdrawal.userName,
                                username: withdrawal.username,
                                userId: withdrawal.userId,
                                timestamp: withdrawal.timestamp,
                                memo: withdrawal.memo
                            });
                        }
                    });
                    
                    // ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ø£Ù‚Ø¯Ù…
                    pendingWithdrawals.sort((a, b) => a.timestamp - b.timestamp);
                    
                    addLog(`ğŸ“¥ ØªÙ… ØªØ­Ù…ÙŠÙ„ ${pendingWithdrawals.length} Ø³Ø­Ø¨ Ù…Ø¹Ù„Ù‚`, 'info');
                } else {
                    addLog('ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø­ÙˆØ¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø©', 'info');
                }
                
                updateWithdrawalsList();
                updateStats();
                
            } catch (error) {
                addLog(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª: ${error.message}`, 'error');
            }
        }

        // ğŸ¯ ØªØµÙÙŠØ© Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª
        function filterWithdrawals(filterType) {
            // ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØµÙÙŠØ©
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            updateWithdrawalsList(filterType);
        }

        // ğŸ“‹ ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª
        function updateWithdrawalsList(filterType = 'all') {
            const container = document.getElementById('withdrawals-container');
            
            if (pendingWithdrawals.length === 0) {
                container.innerHTML = '<div class="loading">ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø­ÙˆØ¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</div>';
                return;
            }
            
            let filteredWithdrawals = pendingWithdrawals;
            
            if (filterType === 'faucetpay') {
                filteredWithdrawals = pendingWithdrawals.filter(w => w.method === 'FaucetPay');
            } else if (filterType === 'small') {
                filteredWithdrawals = pendingWithdrawals.filter(w => w.amount <= 0.001);
            }
            
            container.innerHTML = '';
            
            filteredWithdrawals.forEach(withdrawal => {
                const item = document.createElement('div');
                item.className = 'withdrawal-item';
                
                const userDisplay = withdrawal.userName || withdrawal.username || `User ${withdrawal.userId}`;
                const isEligible = withdrawal.method === 'FaucetPay' && withdrawal.amount <= 0.001;
                
                item.innerHTML = `
                    <div class="withdrawal-info">
                        <div class="withdrawal-amount">${withdrawal.amount.toFixed(4)} TON</div>
                        <div class="withdrawal-details">
                            <span class="withdrawal-user">${userDisplay}</span> â€¢ 
                            ${withdrawal.account} â€¢ 
                            ${formatTime(withdrawal.timestamp)}
                            ${withdrawal.memo ? ` â€¢ Memo: ${withdrawal.memo}` : ''}
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 0.8rem; opacity: 0.7;">${withdrawal.method}</span>
                        <div class="withdrawal-status status-pending">
                            ${isEligible ? 'ğŸŸ¢ Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ' : 'ğŸŸ¡ ÙŠØ¯ÙˆÙŠ'}
                        </div>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        // â° ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª
        function formatTime(timestamp) {
            if (!timestamp) return 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
            
            const now = Date.now();
            const diff = now - timestamp;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            
            if (minutes < 1) return 'Ø§Ù„Ø¢Ù†';
            if (minutes < 60) return `Ù…Ù†Ø° ${minutes} Ø¯Ù‚ÙŠÙ‚Ø©`;
            if (hours < 24) return `Ù…Ù†Ø° ${hours} Ø³Ø§Ø¹Ø©`;
            if (days < 7) return `Ù…Ù†Ø° ${days} ÙŠÙˆÙ…`;
            
            return new Date(timestamp).toLocaleDateString('ar-EG');
        }

        // ğŸ’° Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± FaucetPay
        async function processPayment(withdrawal) {
            try {
                addLog(`ğŸ”§ Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø©: ${withdrawal.amount} TON Ø¥Ù„Ù‰ ${withdrawal.account}`, 'info');
                updateStatus('processing', `Ø¬Ø§Ø±ÙŠ Ø¯ÙØ¹ ${withdrawal.amount} TON...`);
                
                const amountSatoshi = Math.floor(withdrawal.amount * 100000000);
                
                const payload = new URLSearchParams({
                    "api_key": API_KEY,
                    "currency": "TON",
                    "amount": amountSatoshi.toString(),
                    "to": withdrawal.account
                });

                const response = await fetch(FAUCETPAY_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: payload
                });

                const result = await response.json();
                
                if (result.status === 200) {
                    addLog(`âœ… ØªÙ… Ø§Ù„Ø¯ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­! Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©: ${result.payment_id}`, 'success');
                    showNotification(`ØªÙ… Ø§Ù„Ø¯ÙØ¹: ${withdrawal.amount} TON`, 'success');
                    
                    return {
                        success: true,
                        transactionId: result.payment_id,
                        withdrawal: withdrawal
                    };
                } else {
                    addLog(`âŒ ÙØ´Ù„ Ø§Ù„Ø¯ÙØ¹: ${result.message}`, 'error');
                    showNotification(`ÙØ´Ù„ Ø§Ù„Ø¯ÙØ¹: ${result.message}`, 'error');
                    
                    return {
                        success: false,
                        error: result.message,
                        withdrawal: withdrawal
                    };
                }
                
            } catch (error) {
                addLog(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¯ÙØ¹: ${error.message}`, 'error');
                showNotification(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¯ÙØ¹: ${error.message}`, 'error');
                
                return {
                    success: false,
                    error: error.message,
                    withdrawal: withdrawal
                };
            }
        }

        // ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø­Ø¨ ÙÙŠ Firebase
        async function updateWithdrawalStatus(withdrawalId, status, transactionId = null) {
            try {
                const withdrawalRef = db.ref(`withdrawals/pending/${withdrawalId}`);
                const snapshot = await withdrawalRef.once('value');
                const withdrawalData = snapshot.val();
                
                if (withdrawalData) {
                    // Ù†Ù‚Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©
                    await db.ref(`withdrawals/completed/${withdrawalId}`).set({
                        ...withdrawalData,
                        status: status,
                        transactionId: transactionId,
                        processedAt: Date.now(),
                        processedBy: 'auto_payment_dashboard'
                    });
                    
                    // Ø­Ø°Ù Ù…Ù† Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
                    await withdrawalRef.remove();
                    
                    addLog(`ğŸ“ ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø­Ø¨ ${withdrawalId} Ø¥Ù„Ù‰ ${status}`, 'info');
                    return true;
                }
                
                return false;
            } catch (error) {
                addLog(`âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø­Ø¨: ${error.message}`, 'error');
                return false;
            }
        }

        // ğŸ¯ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
        async function processAllPendingWithdrawals() {
            const maxAmount = parseFloat(document.getElementById('max-amount').value);
            
            // ØªØµÙÙŠØ© Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª Ø§Ù„Ù…Ø¤Ù‡Ù„Ø© Ù„Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
            const eligibleWithdrawals = pendingWithdrawals.filter(w => 
                w.method === 'FaucetPay' && 
                w.amount <= maxAmount
            );
            
            if (eligibleWithdrawals.length === 0) {
                addLog('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø­ÙˆØ¨Ø§Øª Ù…Ø¤Ù‡Ù„Ø© Ù„Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©', 'info');
                return;
            }
            
            addLog(`ğŸ”§ Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© ${eligibleWithdrawals.length} Ø³Ø­Ø¨ Ù…Ø¤Ù‡Ù„...`, 'info');
            
            for (const withdrawal of eligibleWithdrawals) {
                const result = await processPayment(withdrawal);
                
                if (result.success) {
                    // ØªØ­Ø¯ÙŠØ« Firebase
                    await updateWithdrawalStatus(withdrawal.id, 'completed', result.transactionId);
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                    processedWithdrawals.push({
                        ...withdrawal,
                        status: 'completed',
                        transactionId: result.transactionId,
                        processedAt: Date.now()
                    });
                    
                    // Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
                    pendingWithdrawals = pendingWithdrawals.filter(w => w.id !== withdrawal.id);
                } else {
                    // ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„ÙØ´Ù„ØŒ Ù†ØªØ±ÙƒÙ‡Ø§ Ù…Ø¹Ù„Ù‚Ø© Ù„Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ÙŠØ¯ÙˆÙŠØ©
                    processedWithdrawals.push({
                        ...withdrawal,
                        status: 'failed',
                        error: result.error,
                        processedAt: Date.now()
                    });
                }
                
                updateStats();
                updateWithdrawalsList();
                
                // Ø§Ù†ØªØ¸Ø§Ø± 3 Ø«ÙˆØ§Ù†ÙŠ Ø¨ÙŠÙ† ÙƒÙ„ Ø¹Ù…Ù„ÙŠØ© Ø¯ÙØ¹
                await new Promise(resolve => setTimeout(resolve, 3000));
            }
            
            updateStatus('active', 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ');
            addLog('âœ… ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª Ø§Ù„Ù…Ø¤Ù‡Ù„Ø©', 'success');
        }

        // ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        function startAutoPayments() {
            if (isAutoMode) return;
            
            isAutoMode = true;
            const interval = parseInt(document.getElementById('check-interval').value) * 1000;
            
            startBtn.disabled = true;
            stopBtn.disabled = false;
            
            updateStatus('active', 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ');
            addLog('ğŸ”„ ØªÙ… Ø¨Ø¯Ø¡ ÙˆØ¶Ø¹ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ', 'info');
            showNotification('ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ', 'success');
            
            // Ù…Ø¹Ø§Ù„Ø¬Ø© ÙÙˆØ±ÙŠØ© Ø£ÙˆÙ„Ù‰
            processAllPendingWithdrawals();
            
            // Ø¶Ø¨Ø· Ø§Ù„ÙØ§ØµÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ
            checkInterval = setInterval(async () => {
                await fetchPendingWithdrawals();
                await processAllPendingWithdrawals();
            }, interval);
        }

        // â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        function stopAutoPayments() {
            if (!isAutoMode) return;
            
            isAutoMode = false;
            clearInterval(checkInterval);
            
            startBtn.disabled = false;
            stopBtn.disabled = true;
            
            updateStatus('inactive', 'Ù…ØªÙˆÙ‚Ù');
            addLog('â¹ï¸ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù ÙˆØ¶Ø¹ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ', 'info');
            showNotification('ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¯ÙØ¹ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ', 'info');
        }

        // ğŸ”„ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹
        async function processPendingWithdrawals() {
            updateStatus('processing', 'Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©...');
            await processAllPendingWithdrawals();
            updateStatus('inactive', 'Ø¬Ø§Ù‡Ø²');
        }

        // ğŸ¯ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©
        async function init() {
            updateStatus('inactive', 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©...');
            addLog('ğŸ”§ Ø¬Ø§Ø±ÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…...', 'info');
            
            // ØªÙ‡ÙŠØ¦Ø© Firebase
            if (!initializeFirebase()) {
                updateStatus('inactive', 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„');
                return;
            }
            
            // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
            await fetchPendingWithdrawals();
            updateStats();
            
            updateStatus('inactive', 'Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ');
            addLog('âœ… Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„', 'success');
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ„ 20 Ø«Ø§Ù†ÙŠØ©
            setInterval(fetchPendingWithdrawals, 20000);
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>

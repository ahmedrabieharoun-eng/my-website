<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
    <title>GLX Galaxy</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="//libtl.com/sdk.js" data-zone="10058786" data-sdk="show_10058786" async></script>
    <script src="https://ad.gigapub.tech/script?id=4102"></script>
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
    <!-- Ù…ÙƒØªØ¨Ø§Øª CAPTCHA -->
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
    <script src="https://js.hcaptcha.com/1/api.js" async defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root{--primary-green:#a855f7;--deep-Galaxy:#202020;--gold:#d6bcfa;--gold-glow:rgba(168,85,247,0.4);--glass-bg:rgba(32,32,32,0.7);--glass-border:rgba(255,255,255,0.1);--text-color:#ffffff;--text-muted:#b0b0b0;--nav-bg:rgba(40,40,40,0.98);--success-color:#a855f7;}
        *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
        body{font-family:'Outfit',sans-serif;color:var(--text-color);overflow-x:hidden;background-image:url('https://i.ibb.co/RGFp67kJ/121.jpg');background-size:cover;background-position:center;background-attachment:fixed;min-height:100vh;}
        body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background:radial-gradient(circle at center,rgba(50,50,50,0.3)0%,rgba(30,30,30,0.85)100%);z-index:-1;}
        .app-container{padding:20px;padding-bottom:110px;max-width:500px;margin:0 auto;min-height:100vh;display:flex;flex-direction:column;}
        .content-section{display:none;animation:fadeIn 0.4s ease;}
        .content-section.active{display:flex;flex-direction:column;flex:1;}
        @keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
        h1{font-size:26px;font-weight:800;color:#fff;margin-bottom:5px;text-transform:uppercase;letter-spacing:1px;}
        h2{font-size:18px;font-weight:700;margin:20px 0 10px;color:var(--gold);display:flex;align-items:center;gap:8px;}
        p{font-size:13px;color:var(--text-muted);line-height:1.4;}
        .page-header{text-align:center;margin-bottom:20px;padding-top:10px;}
        .card{background:var(--glass-bg);backdrop-filter:blur(15px);-webkit-backdrop-filter:blur(15px);border-radius:24px;padding:20px;margin-bottom:12px;border:1px solid var(--glass-border);box-shadow:0 4px 20px rgba(0,0,0,0.4);}
        .btn{display:flex;align-items:center;justify-content:center;width:100%;padding:16px;border-radius:18px;font-size:16px;font-weight:800;cursor:pointer;border:none;outline:none;gap:8px;text-transform:uppercase;letter-spacing:0.5px;transition:transform 0.1s;}
        .btn:active{transform:scale(0.96);}
        .btn:disabled{opacity:0.5;cursor:not-allowed;filter:grayscale(1);}
        .btn-primary{background:linear-gradient(90deg,#a855f7,#7c3aed);color:#fff;box-shadow:0 0 15px rgba(168,85,247,0.4);}
        .btn-ton{background:linear-gradient(90deg,#0088cc,#0099ff);color:#fff;box-shadow:0 0 15px rgba(0,136,204,0.4);}
        .btn-check{background:linear-gradient(90deg,#a855f7,#7c3aed);color:#fff;box-shadow:0 0 15px rgba(168,85,247,0.4);}
        .btn-action{background:rgba(0,0,0,0.3)!important;backdrop-filter:blur(15px);-webkit-backdrop-filter:blur(15px);border:1px solid rgba(255,255,255,0.1)!important;color:#b0b0b0!important;flex-direction:column;padding:12px;font-size:12px;gap:5px;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,0.2);transition:all 0.3s ease;}
        .btn-action svg{width:24px;height:24px;stroke:#b0b0b0!important;fill:none;stroke-width:2.5;transition:all 0.3s ease;}
        .btn-action:active{background:rgba(0,0,0,0.4)!important;transform:scale(0.98);}
        .hud-container{display:flex;justify-content:space-between;align-items:center;background:rgba(0,0,0,0.5);border-radius:50px;padding:10px 15px;margin-bottom:20px;border:1px solid rgba(255,255,255,0.05);}
        .user-name{font-weight:700;font-size:14px;}
        .user-rank{font-size:10px;color:var(--primary-green);text-transform:uppercase;}
        .hud-avatar{width:50px;height:50px;border-radius:50%;overflow:hidden;border:2px solid var(--primary-green);}
        .hud-avatar img{width:100%;height:100%;object-fit:cover;}
        .hud-balance{display:flex;flex-direction:column;align-items:flex-end;gap:5px;}
        .hud-balance-item{display:flex;align-items:center;gap:5px;font-size:12px;font-weight:600;}
        .hud-glx{color:var(--gold);}
        .hud-ton{color:#0088cc;}
        .main-coin-section{text-align:center;margin:10px 0 30px;position:relative;}
        .main-coin-img{width:160px;height:160px;border-radius:50%;box-shadow:0 0 50px rgba(168,85,247,0.3);animation:float 4s ease-in-out infinite;object-fit:cover;border:4px solid var(--primary-green);}
        @keyframes float{0%{transform:translateY(0px);}50%{transform:translateY(-10px);}100%{transform:translateY(0px);}}
        .balance-display{margin-top:15px;}
        .balance-amount{font-size:48px;font-weight:800;background:linear-gradient(to bottom,#fff,#b3b3b3);-webkit-background-clip:text;-webkit-text-fill-color:transparent;line-height:1;}
        .balance-unit{font-size:16px;color:var(--primary-green);font-weight:700;letter-spacing:2px;}
        .stats-pill{display:inline-flex;align-items:center;gap:15px;background:rgba(255,255,255,0.05);padding:8px 16px;border-radius:20px;margin-top:10px;font-size:12px;font-weight:600;}
        .ton-val{color:var(--primary-green);display:flex;align-items:center;gap:4px;}
        .action-bar{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:25px;}
        .list-card{display:flex;align-items:center;background:rgba(0,0,0,0.3);border-radius:16px;padding:12px;margin-bottom:8px;border:1px solid rgba(255,255,255,0.05);cursor:pointer;}
        .lc-icon{width:42px;height:42px;border-radius:12px;background:rgba(255,255,255,0.05);display:flex;align-items:center;justify-content:center;margin-right:12px;flex-shrink:0;}
        .lc-icon img{width:100%;height:100%;object-fit:cover;border-radius:12px;}
        .lc-content{flex:1;}
        .lc-title{font-size:14px;font-weight:600;margin-bottom:2px;}
        .lc-sub{font-size:11px;color:var(--text-muted);}
        .lc-end{text-align:right;}
        .lc-val{font-weight:700;color:var(--primary-green);font-size:14px;}
        .daily-row{display:flex;overflow-x:auto;gap:8px;padding-bottom:10px;margin-bottom:15px;scrollbar-width:none;}
        .daily-box{min-width:70px;background:rgba(255,255,255,0.05);border-radius:12px;padding:10px 5px;text-align:center;border:1px solid transparent;opacity:0.5;}
        .daily-box.active{opacity:1;border-color:var(--gold);background:rgba(255,215,0,0.1);}
        .daily-box.claimed{opacity:1;background:var(--primary-green);color:#000;}
        
        /* âœ… Ø¥ØµÙ„Ø§Ø­ Ø´ÙƒÙ„ Ù„Ø¹Ø¨Ø© Galaxy Slots */
        .slots-machine {
            background: rgba(0, 0, 0, 0.6);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid var(--primary-green);
            box-shadow: 0 0 25px rgba(168, 85, 247, 0.4);
            text-align: center;
        }
        
        .slots-reels {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
            padding: 10px;
        }
        
        .reel-container {
            position: relative;
            width: 70px;
            height: 70px;
            overflow: hidden;
            border-radius: 12px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid rgba(168, 85, 247, 0.5);
            box-shadow: 0 0 15px rgba(168, 85, 247, 0.3);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .reel {
            display: flex;
            flex-direction: column;
            transition: transform 2s cubic-bezier(0.1, 0, 0.2, 1);
        }
        
        .slot-item {
            width: 70px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
        }
        
        .slots-result {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            padding: 15px;
            margin-top: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }
        
        .payout-table {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
            font-size: 11px;
        }
        
        .payout-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 8px;
            text-align: center;
        }
        
        .jackpot {
            color: #FFD700;
            font-weight: 800;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
        }
        
        .input-wrap{background:rgba(0,0,0,0.4);border-radius:16px;padding:15px;margin-bottom:15px;border:1px solid rgba(255,255,255,0.1);}
        .input-label{font-size:11px;color:var(--text-muted);display:block;margin-bottom:5px;text-transform:uppercase;}
        .custom-input{width:100%;background:transparent;border:none;color:#fff;font-size:16px;font-weight:600;outline:none;font-family:inherit;}
        .cat-select{display:flex;gap:10px;margin-bottom:20px;}
        .cat-opt{flex:1;padding:12px;text-align:center;background:rgba(255,255,255,0.05);border-radius:12px;font-size:12px;cursor:pointer;border:1px solid transparent;}
        .cat-opt.active{background:var(--primary-green);color:#000;border-color:var(--primary-green);font-weight:700;}
        .price-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:15px;}
        .price-opt{padding:10px;background:rgba(255,255,255,0.05);border-radius:10px;text-align:center;cursor:pointer;border:1px solid transparent;}
        .price-opt.active{border-color:var(--gold);background:rgba(255,215,0,0.1);}
        .price-count{font-size:14px;font-weight:700;color:#fff;}
        .price-cost{font-size:10px;color:var(--primary-green);margin-top:2px;}
        .terms-box{background:rgba(0,0,0,0.3);border-radius:16px;padding:15px;height:300px;overflow-y:auto;font-size:12px;color:var(--text-muted);border:1px solid rgba(255,255,255,0.05);line-height:1.6;}
        .terms-box h3{color:#fff;font-size:14px;margin-top:15px;margin-bottom:5px;}
        .terms-box h3:first-child{margin-top:0;}
        .bottom-nav{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);width:90%;max-width:400px;height:65px;background:var(--nav-bg);border-radius:32px;display:flex;justify-content:space-around;align-items:center;box-shadow:0 10px 30px rgba(0,0,0,0.5);z-index:100;border:1px solid rgba(255,255,255,0.1);}
        .nav-item{display:flex;flex-direction:column;align-items:center;color:#666;transition:0.3s;cursor:pointer;position:relative;width:50px;}
        .nav-item svg{width:22px;height:22px;margin-bottom:4px;stroke:currentColor;fill:none;stroke-width:2.5;transition:all 0.3s;}
        .nav-item.active{color:var(--primary-green);transform:translateY(-2px);}
        .nav-item.active svg{stroke:var(--primary-green);filter:drop-shadow(0 0 8px rgba(168,85,247,0.6));}
        .nav-text{font-size:9px;font-weight:700;text-transform:uppercase;}
        .hidden{display:none!important;}
        .leader-tabs{display:flex;background:rgba(0,0,0,0.3);border-radius:50px;padding:4px;margin-bottom:20px;}
        .tab-btn{flex:1;text-align:center;padding:10px;border-radius:50px;font-size:12px;font-weight:700;cursor:pointer;transition:all 0.3s;}
        .tab-btn.active{background:var(--primary-green);color:#000;}
        .withdrawal-type-selector{display:flex;background:rgba(0,0,0,0.3);border-radius:50px;padding:4px;margin-bottom:20px;}
        .withdrawal-type-btn{flex:1;text-align:center;padding:12px;border-radius:50px;font-size:12px;font-weight:700;cursor:pointer;transition:all 0.3s;border:1px solid transparent;}
        .withdrawal-type-btn.active{background:var(--primary-green);color:#000;border-color:var(--primary-green);}
        .info-box{background:rgba(255,179,0,0.1);border:1px solid var(--gold);border-radius:12px;padding:12px;margin-bottom:15px;font-size:11px;line-height:1.5;}
        .info-box.success{background:rgba(39,174,96,0.1);border-color:#27ae60;}
        .info-icon{display:inline-flex;align-items:center;justify-content:center;width:16px;height:16px;margin-right:5px;border-radius:50%;background:var(--gold);color:#000;font-size:10px;font-weight:bold;}
        .info-box.success .info-icon{background:#27ae60;color:#fff;}
        .floating-add-task{position:fixed;bottom:85px;left:50%;transform:translateX(-50%);width:160px!important;min-width:140px!important;max-width:180px!important;background:rgba(168,85,247,0.15)!important;backdrop-filter:blur(15px);-webkit-backdrop-filter:blur(15px);border-radius:18px;padding:10px 16px!important;border:1px solid rgba(168,85,247,0.3);box-shadow:0 4px 20px rgba(168,85,247,0.2);z-index:99;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all 0.3s;}
        .floating-add-task:active{transform:translateX(-50%)scale(0.98);background:rgba(168,85,247,0.25)!important;}
        .floating-add-task:hover{background:rgba(168,85,247,0.2)!important;}
        .floating-add-task-content{display:flex;align-items:center;justify-content:center;gap:6px!important;}
        .floating-add-task-icon{width:30px;height:30px;background:rgba(168,85,247,0.3);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:bold;color:#fff;border:1px solid rgba(168,85,247,0.5);}
        .floating-add-task-text{font-size:13px!important;font-weight:700;color:rgba(255,255,255,0.9);text-transform:uppercase;letter-spacing:0.5px;white-space:nowrap!important;}
        .spins-display{display:flex;align-items:center;justify-content:space-between;background:rgba(255,255,255,0.08);border-radius:15px;padding:12px 15px;margin-bottom:15px;border:1px solid var(--glass-border);}
        .spins-count{font-size:20px;font-weight:800;color:var(--primary-green);}
        .referred-users-list{max-height:300px;overflow-y:auto;margin-top:15px;}
        .referred-user-item{display:flex;align-items:center;padding:10px;background:rgba(255,255,255,0.05);border-radius:12px;margin-bottom:8px;}
        .referred-user-avatar{width:40px;height:40px;border-radius:50%;margin-right:12px;border:2px solid var(--primary-green);}
        .referred-user-info{flex:1;}
        .referred-user-name{font-size:14px;font-weight:600;}
        .referred-user-date{font-size:11px;color:var(--text-muted);}
        .referred-user-status{font-size:10px;padding:2px 8px;border-radius:10px;background:var(--primary-green);color:#000;font-weight:700;}
        .stats-grid{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:20px;}
        .stat-card{background:rgba(168,85,247,0.1);padding:15px;border-radius:12px;text-align:center;border:1px solid rgba(168,85,247,0.3);}
        .stat-value{font-size:24px;font-weight:800;color:var(--primary-green);margin-top:5px;}
        .stat-label{font-size:12px;color:var(--text-muted);}
        .promo-card,.code-channel-card{transition:all 0.3s ease;animation:cardFloat 3s ease-in-out infinite alternate;}
        @keyframes cardFloat{0%{transform:translateY(0);}100%{transform:translateY(-5px);}}
        .code-channel-card:active{transform:scale(0.98);}
        #promo-code-input:focus{box-shadow:0 0 15px rgba(168,85,247,0.4);border-color:#a855f7;}
        .max-btn,.withdraw-max-btn{min-width:60px!important;height:44px!important;padding:10px 15px!important;font-size:12px!important;font-weight:800!important;white-space:nowrap!important;border:2px solid rgba(168,85,247,0.5)!important;background:rgba(168,85,247,0.2)!important;color:white!important;border-radius:12px!important;cursor:pointer!important;}
        @keyframes cupShine{0%{filter:drop-shadow(0 0 5px rgba(255,215,0,0.7));}50%{filter:drop-shadow(0 0 15px rgba(255,215,0,0.9));}100%{filter:drop-shadow(0 0 5px rgba(255,215,0,0.7));}}
        @keyframes pulseArrow{0%{transform:translateY(0);opacity:1;}50%{transform:translateY(-2px);opacity:0.7;}100%{transform:translateY(0);opacity:1;}}
        @media (max-width:480px){.max-btn,.withdraw-max-btn{min-width:50px!important;padding:8px 12px!important;font-size:11px!important;height:42px!important;}.ticket-input,.bet-input{font-size:16px!important;padding:12px!important;height:44px!important;}.coin-bet-controls,.ticket-controls{display:flex!important;align-items:center!important;gap:8px!important;width:100%!important;}.bet-input,.ticket-input{flex:1!important;min-width:0!important;font-size:16px!important;padding:12px!important;height:44px!important;}.app-container{padding:10px;padding-bottom:80px;}.main-coin-img{width:120px;height:120px;}.balance-amount{font-size:36px;}.bottom-nav{width:95%;height:60px;}.nav-text{font-size:8px;}.bottom-nav{width:96%;padding:0 5px;}.nav-item{width:45px;}.nav-text{font-size:7px;}.slots-reels{gap:8px;}.reel-container{width:60px;height:60px;}.slot-item{width:60px;height:60px;font-size:28px;}.floating-add-task{width:140px!important;padding:8px 12px!important;bottom:80px;}.floating-add-task-icon{width:28px;height:28px;font-size:16px;}.floating-add-task-text{font-size:12px!important;}}
        input[type="number"]{-webkit-appearance:none;-moz-appearance:textfield;appearance:none;font-size:18px!important;}
        input[type="number"]::-webkit-inner-spin-button,input[type="number"]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0;}
        .coin-flip-game{background:rgba(0,0,0,0.6);border-radius:20px;padding:20px;margin-bottom:20px;border:2px solid var(--primary-green);box-shadow:0 0 25px rgba(168,85,247,0.4);}
        .coin-bet-controls{display:flex;align-items:center;gap:10px;margin-bottom:20px;}
        .bet-input{flex:1;padding:12px 15px;border-radius:12px;background:rgba(0,0,0,0.3);border:2px solid rgba(168,85,247,0.6);color:white;font-family:inherit;font-size:16px;font-weight:700;text-align:center;outline:none;min-height:44px;}
        .bet-input:focus{box-shadow:0 0 15px rgba(168,85,247,0.6);border-color:#a855f7;}
        .bet-buttons{display:flex;gap:8px;margin-top:15px;}
        .bet-btn{padding:12px 15px;background:rgba(168,85,247,0.2);border:2px solid rgba(168,85,247,0.5);border-radius:10px;color:white;cursor:pointer;font-size:14px;font-weight:700;min-width:65px;text-align:center;flex:1;}
        .bet-btn.active{background:linear-gradient(135deg,#a855f7,#7c3aed);border-color:#a855f7;box-shadow:0 5px 15px rgba(168,85,247,0.4);}
        .coin-container{width:150px;height:150px;margin:0 auto 20px;perspective:1000px;}
        .coin{width:100%;height:100%;position:relative;transform-style:preserve-3d;transform:rotateY(0deg);transition:none;}
        .coin-face{position:absolute;width:100%;height:100%;backface-visibility:hidden;border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 0 20px rgba(0,0,0,0.5);overflow:hidden;}
        .coin-face img{width:100%;height:100%;object-fit:cover;}
        .coin-front{background:linear-gradient(45deg,#a855f7,#7c3aed);transform:rotateY(0deg);}
        .coin-back{background:linear-gradient(45deg,#7c3aed,#a855f7);transform:rotateY(180deg);}
        .gold-side{filter:sepia(1)saturate(2)hue-rotate(10deg)brightness(1.2);}
        @keyframes coinSpin{0%{transform:rotateY(0);}25%{transform:rotateY(180deg)translateY(-20px);}50%{transform:rotateY(360deg)translateY(0);}75%{transform:rotateY(540deg)translateY(-10px);}100%{transform:rotateY(var(--final-rotation,720deg))translateY(0);}}
        .coin-spinning{animation:coinSpin 2.5s cubic-bezier(0.4,2.4,0.8,0.9)forwards;}
        .coin-final{animation:none!important;transform:rotateY(var(--final-rotation,0deg))!important;}
        .game-result{background:rgba(0,0,0,0.8);border-radius:15px;padding:15px;margin-top:20px;text-align:center;}
        .result-text{font-size:18px;font-weight:700;margin-bottom:10px;}
        .win-amount{font-size:24px;font-weight:800;color:#27ae60;}
        .loss-amount{font-size:24px;font-weight:800;color:#e74c3c;}
        .bonus-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:20px;}
        .bonus-game-card{background:var(--glass-bg);backdrop-filter:blur(15px);-webkit-backdrop-filter:blur(15px);border-radius:16px;overflow:hidden;border:1px solid var(--glass-border);cursor:pointer;transition:all 0.3s ease;box-shadow:0 4px 15px rgba(0,0,0,0.3);}
        .bonus-game-card:active{transform:scale(0.97);}
        .game-banner{width:100%;height:120px;object-fit:cover;display:block;}
        .game-content{padding:12px;}
        .game-title{font-size:14px;font-weight:700;color:white;margin-bottom:4px;text-align:center;}
        .game-description{font-size:11px;color:var(--text-muted);text-align:center;line-height:1.3;}
        .game-icon{font-size:20px;margin-bottom:8px;text-align:center;color:var(--primary-green);}
        .side-selection{display:flex;gap:10px;margin-bottom:20px;}
        .side-btn{flex:1;padding:20px 15px;border-radius:15px;background:rgba(255,255,255,0.05);border:2px solid transparent;cursor:pointer;text-align:center;transition:all 0.3s;min-height:140px;display:flex;flex-direction:column;justify-content:center;align-items:center;}
        .side-btn.active{border-color:var(--primary-green);background:rgba(168,85,247,0.2);box-shadow:0 5px 20px rgba(168,85,247,0.3);}
        .side-btn.win{border-color:#27ae60;background:rgba(39,174,96,0.2);}
        .side-btn.lose{border-color:#e74c3c;background:rgba(231,76,60,0.2);}
        .side-icon{font-size:24px;margin-bottom:10px;width:70px;height:70px;display:flex;align-items:center;justify-content:center;}
        .side-name{font-size:16px;font-weight:700;margin-bottom:5px;}
        .side-description{font-size:12px;color:var(--text-muted);text-align:center;}
        .probability-display{display:none!important;}
        .competition-nav-item{position:relative;}
        .competition-nav-icon{position:relative;display:flex;align-items:center;justify-content:center;}
        @keyframes trophyGlow{0%,100%{filter:drop-shadow(0 0 8px rgba(255,215,0,0.7));}50%{filter:drop-shadow(0 0 20px rgba(255,215,0,0.9));}}
        .nav-item.competition-nav-item.active svg{animation:trophyGlow 2s infinite alternate;}
        .nav-item[data-target="withdrawal-history"] svg{filter:drop-shadow(0 0 8px rgba(168,85,247,0.4));animation:none;}
        .galaxy-log-icon{width:40px;height:40px;background:rgba(168,85,247,0.2);border-radius:12px;display:flex;align-items:center;justify-content:center;cursor:pointer;border:1px solid rgba(168,85,247,0.4);transition:all 0.3s;}
        .galaxy-log-icon:hover{transform:scale(1.05);background:rgba(168,85,247,0.3);border-color:#a855f7;}
        .btn-filter{padding:8px 15px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:var(--text-muted);font-size:12px;cursor:pointer;transition:all 0.3s;}
        .btn-filter.active{background:var(--primary-green);color:#000;font-weight:700;border-color:var(--primary-green);}
        .btn-filter.small{padding:5px 10px;font-size:10px;}
        .log-stat-card{background:rgba(0,0,0,0.3);border-radius:12px;padding:12px;text-align:center;border:1px solid rgba(255,255,255,0.1);}
        .log-item{display:flex;align-items:center;padding:12px;background:rgba(255,255,255,0.05);border-radius:12px;margin-bottom:8px;border-left:4px solid transparent;}
        .log-item.earn{border-left-color:#27ae60;background:rgba(39,174,96,0.1);}
        .log-item.spend{border-left-color:#e74c3c;background:rgba(231,76,60,0.1);}
        .log-item.swap{border-left-color:#3498db;background:rgba(52,152,219,0.1);}
        .log-item.withdraw{border-left-color:#9b59b6;background:rgba(155,89,182,0.1);}
        .support-channel-card{background:rgba(255,255,255,0.05);border-radius:12px;padding:15px;margin-bottom:10px;cursor:pointer;transition:all 0.3s;border:1px solid rgba(255,255,255,0.1);}
        .support-channel-card:hover{background:rgba(255,255,255,0.08);transform:translateY(-2px);border-color:rgba(168,85,247,0.4);}
        .withdrawal-overview{text-align:center;margin-bottom:20px;}
        .coin-game-rules{margin-top:25px;padding:20px;background:rgba(0,0,0,0.4);border-radius:15px;border:1px solid rgba(255,255,255,0.1);}
        .coin-game-rules h4{font-size:14px;color:var(--gold);margin-bottom:15px;}
        .coin-game-rules ul{font-size:12px;color:var(--text-muted);padding-left:20px;}
        .coin-game-rules li{margin-bottom:8px;}
        .competition-timer-card{background:linear-gradient(135deg,rgba(168,85,247,0.2),rgba(123,97,255,0.2));border:2px solid rgba(168,85,247,0.3);border-radius:20px;padding:25px;margin-bottom:20px;text-align:center;box-shadow:0 10px 30px rgba(168,85,247,0.2);}
        .countdown-display{font-size:36px;font-weight:800;color:#fff;text-shadow:0 0 15px rgba(168,85,247,0.8);margin-bottom:8px;font-family:'Courier New',monospace;}
        .timer-label{font-size:12px;color:var(--text-muted);text-transform:uppercase;letter-spacing:1px;}
        .status-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:20px;}
        .status-card{background:var(--glass-bg);backdrop-filter:blur(15px);-webkit-backdrop-filter:blur(15px);border-radius:16px;padding:20px;text-align:center;border:1px solid var(--glass-border);}
        .status-icon{font-size:30px;margin-bottom:10px;}
        .status-value{font-size:24px;font-weight:800;color:#fff;margin-bottom:5px;}
        .status-label{font-size:10px;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.5px;}
        
        /* âœ… ØªØ¹Ø¯ÙŠÙ„ Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ØªØ°Ø§ÙƒØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
        .ticket-price-note{background:rgba(168,85,247,0.1);border-radius:12px;padding:15px;margin-bottom:20px;text-align:center;font-size:12px;border:1px solid rgba(168,85,247,0.3);}
        
        .ticket-controls{display:flex;align-items:center;gap:10px;margin-bottom:20px;}
        .ticket-input{flex:1;padding:15px;border-radius:12px;background:rgba(0,0,0,0.3);border:2px solid rgba(168,85,247,0.5);color:white;font-size:18px;font-weight:700;text-align:center;outline:none;min-height:44px;}
        .competition-leaderboard{margin-top:25px;}
        .leaderboard-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;padding-bottom:10px;border-bottom:1px solid rgba(255,255,255,0.1);}
        .previous-winners-card{background:var(--glass-bg);backdrop-filter:blur(15px);-webkit-backdrop-filter:blur(15px);border-radius:16px;padding:20px;margin-top:20px;border:1px solid var(--glass-border);}
        .winner-item{display:flex;align-items:center;padding:12px;background:rgba(255,255,255,0.05);border-radius:12px;margin-bottom:10px;}
        .winner-rank{width:30px;height:30px;background:var(--primary-green);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:800;margin-right:15px;}
        .winner-avatar{width:40px;height:40px;border-radius:50%;margin-right:12px;border:2px solid var(--primary-green);}
        .winner-info{flex:1;}
        .winner-name{font-size:14px;font-weight:600;margin-bottom:2px;}
        .winner-date{font-size:10px;color:var(--text-muted);}
        .winner-prize{font-size:14px;font-weight:700;color:var(--primary-green);}
        .withdraw-max-btn{position:absolute;right:15px;top:50%;transform:translateY(-50%);background:rgba(168,85,247,0.2);border:1px solid rgba(168,85,247,0.5);border-radius:8px;padding:6px 12px;color:white;font-size:10px;cursor:pointer;font-weight:700;z-index:10;}
        .bet-btn.k-style{min-width:55px;padding:10px 12px;font-size:13px;flex:1;}
        .user-withdrawal-item{background:rgba(255,255,255,0.05);border-radius:12px;padding:12px;margin-bottom:8px;border:1px solid rgba(255,255,255,0.1);}
        .withdrawal-status{font-size:10px;padding:3px 10px;border-radius:20px;font-weight:700;}
        .status-completed{background:rgba(39,174,96,0.2);color:#27ae60;}
        .status-pending{background:rgba(255,193,7,0.2);color:#FFC107;}
        .status-rejected{background:rgba(231,76,60,0.2);color:#e74c3c;}
        .masked-email{font-family:'Courier New',monospace;letter-spacing:1px;}
        .competition-rank-card{display:flex;align-items:center;padding:12px;background:rgba(255,255,255,0.05);border-radius:12px;margin-bottom:8px;border:1px solid rgba(255,255,255,0.1);}
        .competition-rank{width:30px;font-weight:800;font-size:14px;text-align:center;margin-right:10px;}
        .rank-1 .competition-rank{color:#27ae60;font-weight:900;}
        .rank-2 .competition-rank{color:#C0C0C0;}
        .rank-3 .competition-rank{color:#CD7F32;}
        .competition-user-avatar{width:36px;height:36px;border-radius:50%;margin-right:12px;border:2px solid var(--primary-green);}
        .competition-user-info{flex:1;}
        .competition-user-name{font-size:13px;font-weight:600;margin-bottom:2px;}
        .competition-ticket-count{font-size:14px;font-weight:700;color:var(--primary-green);}
        .competition-rules-card{background:rgba(0,0,0,0.4);border-radius:16px;padding:20px;margin-bottom:20px;border:1px solid rgba(255,255,255,0.1);}
        .rules-header{display:flex;align-items:center;gap:10px;margin-bottom:15px;color:var(--gold);font-size:16px;font-weight:700;}
        .rules-list{font-size:12px;color:var(--text-muted);line-height:1.6;padding-left:20px;}
        .rules-list li{margin-bottom:8px;}
        .winner-highlight{color:#27ae60;font-weight:700;}
        .loser-note{color:#e74c3c;font-weight:600;}
        .important-note{background:rgba(255,193,7,0.1);border-left:3px solid #FFC107;padding:10px;margin-top:15px;border-radius:5px;font-size:11px;}
        .swap-direction-selector{display:flex;background:rgba(0,0,0,0.3);border-radius:50px;padding:4px;margin-bottom:20px;}
        .swap-direction-btn{flex:1;text-align:center;padding:12px;border-radius:50px;font-size:12px;font-weight:700;cursor:pointer;transition:all 0.3s;border:1px solid transparent;}
        .swap-direction-btn.active{background:var(--primary-green);color:#000;border-color:var(--primary-green);}
        .withdraw-input-with-max{position:relative;}
        .withdraw-input-with-max .custom-input{padding-right:70px;}
        .email-display{font-family:'Courier New',monospace;background:rgba(255,255,255,0.1);padding:15px;border-radius:12px;border:1px solid rgba(255,255,255,0.2);font-size:16px;letter-spacing:2px;color:white;text-align:center;margin-top:10px;}
        .swap-mode-text{font-size:12px;color:var(--text-muted);text-align:center;margin:10px 0;}
        .verification-container{background:var(--glass-bg);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-radius:24px;padding:30px;margin:20px;text-align:center;border:2px solid rgba(168,85,247,0.3);box-shadow:0 10px 40px rgba(0,0,0,0.5);}
        .verification-step{display:flex;align-items:center;justify-content:space-between;background:rgba(0,0,0,0.3);border-radius:12px;padding:15px;margin-bottom:10px;border:1px solid rgba(255,255,255,0.1);transition:all 0.3s ease;}
        .verification-step.active{border-color:var(--primary-green);background:rgba(168,85,247,0.1);}
        .verification-step.completed{border-color:#27ae60;background:rgba(39,174,96,0.1);}
        .verification-step.failed{border-color:#e74c3c;background:rgba(231,76,60,0.1);}
        .step-icon{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:bold;}
        .step-info{flex:1;text-align:left;padding:0 15px;}
        .step-title{font-size:14px;font-weight:600;color:white;margin-bottom:3px;}
        .step-description{font-size:11px;color:var(--text-muted);}
        .step-status{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:18px;}
        .security-message{background:rgba(231,76,60,0.1);border:1px solid rgba(231,76,60,0.3);border-radius:12px;padding:15px;margin:15px 0;color:#e74c3c;font-size:14px;}
        .verification-progress{width:100%;height:8px;background:rgba(255,255,255,0.1);border-radius:4px;margin:20px 0;overflow:hidden;}
        .progress-bar{height:100%;background:linear-gradient(90deg,var(--primary-green),#7c3aed);border-radius:4px;transition:width 0.5s ease;}
        .blocked-container{background:rgba(0,0,0,0.8);border-radius:24px;padding:40px 30px;text-align:center;margin:20px;border:2px solid rgba(231,76,60,0.3);animation:pulse 2s infinite;}
        @keyframes pulse{0%{box-shadow:0 0 0 0 rgba(231,76,60,0.4);}70%{box-shadow:0 0 0 10px rgba(231,76,60,0);}100%{box-shadow:0 0 0 0 rgba(231,76,60,0);}}
        .blocked-icon{font-size:60px;margin-bottom:20px;color:#e74c3c;}
        .blocked-title{font-size:24px;font-weight:800;color:#e74c3c;margin-bottom:15px;}
        .blocked-reason{background:rgba(231,76,60,0.1);border-radius:12px;padding:15px;margin:20px 0;font-size:14px;line-height:1.5;}
        .verification-loading{display:inline-block;width:20px;height:20px;border:3px solid rgba(255,255,255,0.3);border-radius:50%;border-top-color:var(--primary-green);animation:spin 1s ease-in-out infinite;}
        @keyframes spin{to{transform:rotate(360deg);}}
        .ip-display{background:rgba(0,0,0,0.5);padding:10px;border-radius:8px;font-family:'Courier New',monospace;font-size:12px;color:#fff;margin-top:5px;}
        .notification-message{position:fixed;top:100px;left:50%;transform:translateX(-50%);z-index:1000;background:var(--glass-bg);backdrop-filter:blur(20px);border:1px solid var(--glass-border);border-radius:15px;padding:15px 20px;max-width:90%;width:400px;text-align:center;box-shadow:0 5px 20px rgba(0,0,0,0.3);animation:fadeIn 0.3s ease;}
        .notification-success{border-color:#27ae60;background:rgba(39,174,96,0.1);}
        .notification-error{border-color:#e74c3c;background:rgba(231,76,60,0.1);}
        .notification-warning{border-color:#FFC107;background:rgba(255,193,7,0.1);}
        .notification-info{border-color:#3498db;background:rgba(52,152,219,0.1);}
        
        .deposit-processing {animation: processingPulse 1s infinite alternate;}
        @keyframes processingPulse {from {opacity: 0.7;} to {opacity: 1;}}
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        .status-card[style*="grid-column: span 2"] {
            grid-column: span 2 !important;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .status-card[style*="grid-column: span 2"] .status-value {
            font-size: 32px !important;
            margin-bottom: 10px;
            font-weight: 900 !important;
            color: var(--primary-green) !important;
        }

        .status-card[style*="grid-column: span 2"] .status-label {
            font-size: 12px;
            letter-spacing: 1px;
            text-transform: uppercase;
            font-weight: 700;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        .shake-animation {
            animation: shake 0.8s ease-in-out;
        }
        
        /* âœ… Ø£Ù†Ù…Ø§Ø· ØµÙØ­Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ© */
        #global-loading-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a1a, #0a0a0a);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 999999;
            text-align: center;
            padding: 20px;
        }
        
        .loading-logo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin-bottom: 25px;
            border: 4px solid var(--primary-green);
            animation: float 2s ease-in-out infinite;
        }
        
        .loading-title {
            font-size: 32px;
            font-weight: 800;
            color: #fff;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
            background: linear-gradient(90deg, #a855f7, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .loading-subtitle {
            font-size: 14px;
            color: var(--text-muted);
            margin-bottom: 30px;
            max-width: 300px;
            line-height: 1.5;
        }
        
        .loading-progress-container {
            width: 80%;
            max-width: 300px;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-green), #7c3aed);
            border-radius: 3px;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .loading-timer {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 10px;
            font-family: 'Courier New', monospace;
        }
        
        /* âœ… Ø£Ù†Ù…Ø§Ø· Ø²Ø± Ø§Ù„Ø­Ø¸Ø± */
        .btn-blocked {
            background: rgba(231, 76, 60, 0.2) !important;
            border: 1px solid rgba(231, 76, 60, 0.5) !important;
            color: #e74c3c !important;
            cursor: not-allowed !important;
            opacity: 0.7 !important;
        }
        
        /* âœ… ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„ØªØ¬Ø§ÙˆØ¨ Ù…Ø¹ Ø§Ù„Ù‡ÙˆØ§ØªÙ */
        @media (max-width: 480px) {
            .loading-logo {
                width: 100px;
                height: 100px;
            }
            
            .loading-title {
                font-size: 24px;
            }
            
            .loading-subtitle {
                font-size: 12px;
            }
        }
        
        /* âœ… Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø¹Ø·Ù„Ø© */
        .btn-processing {
            background: rgba(128, 128, 128, 0.3) !important;
            border-color: rgba(128, 128, 128, 0.5) !important;
            color: #888 !important;
            cursor: not-allowed !important;
            opacity: 0.7 !important;
        }
        
        /* âœ… Ø£Ù†Ù…Ø§Ø· Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ù‡Ø§Ù… */
        .task-btn-disabled {
            pointer-events: none !important;
            opacity: 0.5 !important;
            filter: grayscale(1) !important;
        }
        
        /* âœ… Ø£Ù†Ù…Ø§Ø· Ù„Ø¹Ø¨Ø© Coin Flip */
        .coin-flip-btn-processing {
            background: linear-gradient(90deg, #666, #888) !important;
            color: #ccc !important;
            cursor: wait !important;
        }
        
        .coin-flip-btn-processing:hover {
            transform: none !important;
        }
        
        /* âœ… Ø£Ù†Ù…Ø§Ø· Ù„Ø¹Ø¨Ø© Coin Flip Ø§Ù„Ù…Ø­Ø³Ù†Ø© */
        .coin-flip-result-details {
            font-size: 12px;
            margin-top: 5px;
            opacity: 0.8;
        }
        
        .net-profit {
            color: #27ae60;
            font-weight: bold;
        }
        
        .net-loss {
            color: #e74c3c;
            font-weight: bold;
        }
        
        /* âœ… Ø£Ù†Ù…Ø§Ø· Ø²Ø± Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ù…Ø¹Ø·Ù„ Ø¨Ø³Ø¨Ø¨ Ø§Ù„Ø­Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ */
        .withdraw-disabled {
            background: rgba(128, 128, 128, 0.3) !important;
            border-color: rgba(128, 128, 128, 0.5) !important;
            color: #aaa !important;
            cursor: not-allowed !important;
            opacity: 0.7 !important;
        }
        
        .daily-limit-reached {
            position: relative;
        }
        
        .daily-limit-reached::after {
            content: "2/2 Daily Limit";
            position: absolute;
            top: -8px;
            right: -8px;
            background: #e74c3c;
            color: white;
            font-size: 9px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: bold;
            z-index: 1;
        }
        
        .withdrawals-counter {
            background: rgba(168, 85, 247, 0.2);
            border-radius: 8px;
            padding: 8px 12px;
            margin-bottom: 15px;
            text-align: center;
            font-size: 12px;
            border: 1px solid rgba(168, 85, 247, 0.3);
        }
        
        .withdrawals-counter .count {
            font-weight: bold;
            color: var(--primary-green);
            font-size: 14px;
        }
        
        .withdrawals-counter .limit-reached {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .withdrawals-counter .reset-time {
            color: #FFC107;
            margin-top: 5px;
            font-size: 10px;
        }
        
        /* ===== Ø£Ù†Ù…Ø§Ø· Ø§Ù„ÙƒØ§Ø¨ØªØ´Ø§ ===== */
        .captcha-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 99999;
            backdrop-filter: blur(15px);
            animation: fadeIn 0.3s ease;
        }

        .captcha-container {
            background: var(--glass-bg);
            backdrop-filter: blur(25px);
            border-radius: 24px;
            padding: 30px;
            border: 2px solid var(--primary-green);
            box-shadow: 0 25px 75px rgba(0, 0, 0, 0.7);
            text-align: center;
            max-width: 420px;
            width: 90%;
            animation: slideUp 0.4s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .captcha-header {
            margin-bottom: 25px;
        }

        .captcha-header h3 {
            font-size: 22px;
            color: #fff;
            margin-bottom: 10px;
            font-weight: 800;
        }

        .captcha-header p {
            font-size: 14px;
            color: var(--text-muted);
            line-height: 1.5;
        }

        .captcha-type-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 20px;
            letter-spacing: 0.5px;
        }

        .captcha-type-cloudflare {
            background: linear-gradient(135deg, #F57C00, #FF9800, #FFB74D);
            color: #000;
            box-shadow: 0 5px 15px rgba(245, 124, 0, 0.3);
        }

        .captcha-type-hcaptcha {
            background: linear-gradient(135deg, #00BCD4, #0097A7, #4DD0E1);
            color: #fff;
            box-shadow: 0 5px 15px rgba(0, 188, 212, 0.3);
        }

        .captcha-widget {
            margin: 25px 0;
            min-height: 120px;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .captcha-widget > div {
            width: 100%;
        }

        .captcha-note {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 20px;
            line-height: 1.6;
            padding: 12px;
            background: rgba(168, 85, 247, 0.1);
            border-radius: 12px;
            border: 1px solid rgba(168, 85, 247, 0.2);
        }

        .captcha-actions {
            display: flex;
            gap: 12px;
            margin-top: 25px;
        }

        .captcha-error {
            background: rgba(231, 76, 60, 0.1);
            border: 1px solid rgba(231, 76, 60, 0.3);
            border-radius: 12px;
            padding: 12px;
            margin: 15px 0;
            font-size: 13px;
            color: #e74c3c;
            display: none;
        }

        .captcha-success {
            background: rgba(39, 174, 96, 0.1);
            border: 1px solid rgba(39, 174, 96, 0.3);
            border-radius: 12px;
            padding: 12px;
            margin: 15px 0;
            font-size: 13px;
            color: #27ae60;
            display: none;
        }

        .captcha-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 12px;
            padding: 10px 15px;
            margin: 15px 0;
            font-size: 12px;
            color: #FFC107;
        }

        .captcha-progress {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
            margin: 15px 0;
        }

        .captcha-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-green), #7c3aed);
            border-radius: 3px;
            width: 0%;
            transition: width 0.3s ease;
        }

        .captcha-timer {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 10px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
<!-- âœ… ØµÙØ­Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ© (10 Ø«ÙˆØ§Ù†Ù) -->
<div id="global-loading-page">
    <img src="https://i.ibb.co/tTkJX1Qy/logo.png" alt="GLX Galaxy" class="loading-logo">
    <h1 class="loading-title">GLX GALAXY</h1>
    <p class="loading-subtitle">Loading your cosmic experience...</p>
    
    <div class="loading-progress-container">
        <div class="loading-progress-bar" id="loading-progress-bar"></div>
    </div>
    
    <div class="loading-timer" id="loading-timer">10 seconds</div>
    
    <div style="margin-top: 30px; font-size: 11px; color: var(--text-muted); max-width: 300px;">
        <i class="fas fa-shield-alt" style="margin-right: 5px;"></i>
        Performing security checks & loading your data
    </div>
</div>

<div id="security-verification" class="verification-container" style="display:none;">
<div style="margin-bottom:25px;"><img src="https://i.ibb.co/tTkJX1Qy/logo.png" alt="GLX Galaxy" style="width:80px;height:80px;border-radius:50%;margin-bottom:15px;border:3px solid var(--primary-green);"><h1 style="font-size:24px;margin-bottom:8px;color:#fff;">GLX Galaxy Security</h1><p style="color:var(--text-muted);font-size:13px;">Secure verification process in progress</p></div>
<div class="verification-progress"><div id="verification-progress-bar" class="progress-bar" style="width:0%"></div></div>
<div id="verification-steps"></div>
<div id="verification-result" style="display:none;margin-top:20px;"></div>
</div>
<div id="blocked-access" class="blocked-container" style="display:none;">
<div class="blocked-icon">ðŸš«</div>
<div class="blocked-title">ACCESS BLOCKED</div>
<div id="blocked-reason" class="blocked-reason"></div>
<p style="color:var(--text-muted);font-size:12px;margin-top:20px;">If you believe this is an error, please contact support.</p>
</div>
<div class="app-container" style="display:none;" id="app-container">
<div class="hud-container">
<div><div class="user-name" id="home-username">Explorer</div><div class="user-rank" id="home-user-level" style="display:none;"></div><div style="display:flex;align-items:center;gap:15px;margin-top:5px;"><div class="stats-pill" style="margin:0;padding:6px 12px;"><span style="color:var(--gold);">GLX:</span><span id="hud-glx-balance" style="color:#fff;font-weight:700;">0</span></div><div class="stats-pill" style="margin:0;padding:6px 12px;"><span style="color:var(--gold);">TON:</span><span id="hud-ton-balance" style="color:#fff;font-weight:700;">0.0000</span></div></div></div>
<div style="display:flex;align-items:center;gap:10px;"><div class="galaxy-log-icon" id="galaxy-log-button"><span style="font-size:20px;">ðŸ“œ</span></div><div class="hud-avatar"><img src="https://i.ibb.co/tTkJX1Qy/logo.png" alt="User"></div></div>
</div>

<main id="home" class="content-section active">
<div class="main-coin-section"><img src="https://i.ibb.co/tTkJX1Qy/logo.png" class="main-coin-img" alt="GLX"><div class="balance-display"><div class="balance-amount" id="total-GLX-balance">0</div><div class="balance-unit">GLX</div></div><div class="stats-pill"><span class="ton-val"><img src="https://i.ibb.co/8DsyHqwK/toncoin-ton-logo.png" style="width:16px;border-radius:50%;"><span id="home-ton-balance">0.0000</span> TON</span><span style="opacity:0.3">|</span><span style="font-size:10px;opacity:0.8;">100K = 0.01 TON</span></div></div>
<div class="action-bar">
<div class="btn btn-action nav-link" data-target="swap-page"><svg viewBox="0 0 24 24"><path d="M7 16V4m0 0L3 8m4-4 4 4m6 0v12m0 0 4-4m-4 4-4-4"/></svg><span>Swap</span></div>
<div class="btn btn-action nav-link" data-target="withdraw"><svg viewBox="0 0 24 24"><path d="M12 5v14m0 0-6-6m6 6 6-6"/></svg><span>Withdraw</span></div>
<div class="btn btn-action nav-link" data-target="user-withdrawals"><svg viewBox="0 0 24 24"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" y1="22" x2="4" y2="15"/></svg><span>My Withdrawals</span></div>
<div class="btn btn-action nav-link" data-target="deposit"><svg viewBox="0 0 24 24"><path d="M12 5v14m0 0-6-6m6 6 6-6" transform="rotate(180,12,12)"/></svg><span>Deposit</span></div>
</div>

<!-- ðŸ”„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Ù‚Ù†Ø§Ù‡ Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ù‚Ø¨Ù„ Ø§Ù„Ø¯Ø¹Ù… -->
<div class="card" style="margin-top:12px;">
    <h2 style="display:flex;align-items:center;gap:8px;">
        <i class="fa-solid fa-bullhorn"></i>Updates & News
    </h2>
    <div class="support-channel-card" onclick="window.open('https://t.me/earnmoney174688','_blank')" style="margin-bottom:10px;">
        <div style="display:flex;align-items:center;gap:12px;">
            <div style="width:50px;height:50px;background:linear-gradient(135deg,#9b59b6,#8e44ad);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:24px;color:white;">
                <i class="fa-solid fa-bell"></i>
            </div>
            <div style="flex:1;">
                <div style="font-size:14px;font-weight:700;color:white;margin-bottom:5px;">Bot Updates & News</div>
                <div style="font-size:11px;color:var(--text-muted);">Latest updates, announcements, and news about the bot</div>
                <div style="font-size:10px;color:#9b59b6;margin-top:5px;">
                    <i class="fa-solid fa-users"></i> @earnmoney174688
                </div>
            </div>
            <div style="color:#9b59b6;font-size:18px;">
                <i class="fa-solid fa-arrow-right"></i>
            </div>
        </div>
    </div>
</div>

<!-- ðŸ”„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Ù‚Ø³Ù… Ø§Ù„Ø¯Ø¹Ù… ÙŠØ£ØªÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø£Ø®Ø¨Ø§Ø± -->
<div class="card" style="margin-top:12px;">
    <h2 style="display:flex;align-items:center;gap:8px;">
        <i class="fa-solid fa-headset"></i>Support & Help
    </h2>
    <div class="support-channel-card" onclick="window.open('https://t.me/aborabie777','_blank')" style="margin-bottom:10px;">
        <div style="display:flex;align-items:center;gap:12px;">
            <div style="width:50px;height:50px;background:linear-gradient(135deg,#3498db,#2980b9);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:24px;color:white;">
                <i class="fa-solid fa-user-gear"></i>
            </div>
            <div style="flex:1;">
                <div style="font-size:14px;font-weight:700;color:white;margin-bottom:5px;">Technical Support</div>
                <div style="font-size:11px;color:var(--text-muted);">Get help with technical issues and account problems</div>
            </div>
            <div style="color:#3498db;font-size:18px;">
                <i class="fa-solid fa-arrow-right"></i>
            </div>
        </div>
    </div>
    <div class="support-channel-card" onclick="window.open('https://t.me/Elsayed_1_Elgohary','_blank')">
        <div style="display:flex;align-items:center;gap:12px;">
            <div style="width:50px;height:50px;background:linear-gradient(135deg,#27ae60,#2ecc71);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:24px;color:white;">
                <i class="fa-solid fa-circle-question"></i>
            </div>
            <div style="flex:1;">
                <div style="font-size:14px;font-weight:700;color:white;margin-bottom:5px;">General Support & FAQ</div>
                <div style="font-size:11px;color:var(--text-muted);">Get answers to common questions and general help</div>
            </div>
            <div style="color:#27ae60;font-size:18px;">
                <i class="fa-solid fa-arrow-right"></i>
            </div>
        </div>
    </div>
</div>
</main>
<main id="galaxy-log-page" class="content-section">
<div class="page-header"><h1>Galaxy Log</h1><p>Complete transaction history</p></div>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:15px;">
<div class="log-stat-card"><div style="font-size:12px;color:var(--text-muted);">Total Earned</div><div style="font-size:18px;font-weight:700;color:#27ae60;" id="total-earned">0 GLX</div></div>
<div class="log-stat-card"><div style="font-size:12px;color:var(--text-muted);">Total Spent</div><div style="font-size:18px;font-weight:700;color:#e74c3c;" id="total-spent">0 GLX</div></div>
</div>
<div id="galaxy-log-filtered-list" style="max-height:500px;overflow-y:auto;"></div>
</main>
<main id="deposit" class="content-section">
<div class="page-header"><h1>Deposit TON</h1><p>Add funds to your account</p></div>
<div class="card">
<div style="text-align:center;margin-bottom:20px;"><div style="font-size:16px;font-weight:700;color:var(--gold);margin-bottom:10px;display:flex;align-items:center;justify-content:center;gap:8px;"><i class="fa-solid fa-arrow-down-to-line" style="color:#27ae60;"></i>Deposit TON</div><div style="font-size:12px;color:var(--text-muted);">Add TON directly to your account</div></div>
<div style="display:flex;justify-content:space-between;align-items:center;background:rgba(0,0,0,0.3);padding:12px;border-radius:12px;margin-bottom:20px;border:1px solid rgba(255,255,255,0.1);"><div><div style="font-size:11px;color:var(--text-muted);">Current Balance</div><div style="font-size:20px;font-weight:700;color:#fff;"><span class="user-ton-balance">0.0000</span> TON</div></div></div>
<div class="input-wrap"><span class="input-label">Deposit Amount (TON)</span><input type="number" id="deposit-amount" class="custom-input" placeholder="0.01" step="0.001" min="0.01" value="0.01"><div style="text-align:right;font-size:10px;color:var(--text-muted);margin-top:5px;">Minimum: 0.01 TON</div></div>
<button class="btn btn-ton" id="deposit-pay-btn" onclick="initiateDeposit()"><img src="https://i.ibb.co/8DsyHqwK/toncoin-ton-logo.png" style="width:20px;border-radius:50%;">Pay with Tonkeeper</button>
<div id="deposit-status" style="display:none;text-align:center;margin-top:15px;"><div id="deposit-status-message" style="font-size:12px;color:var(--text-muted);"></div><button class="btn btn-check" id="check-deposit-btn" onclick="verifyDeposit()" style="margin-top:10px;">Check Payment</button></div>
<div class="info-box" style="background:rgba(52,152,219,0.1);border-color:rgba(52,152,219,0.3);margin-top:15px;"><div style="display:flex;align-items:flex-start;gap:10px;"><div style="color:#3498db;font-size:14px;"><i class="fa-solid fa-circle-info"></i></div><div style="font-size:11px;line-height:1.5;"><strong>Deposit Instructions:</strong><br>1. Enter the TON amount you want to deposit<br>2. Click "Pay with Tonkeeper"<br>3. Confirm the payment in your Tonkeeper wallet<br>4. Click "Check Payment" to verify<br>5. Funds will be added to your account immediately</div></div></div>
</div>
<div class="card" style="margin-top:15px;"><div style="text-align:center;"><div style="font-size:16px;font-weight:700;color:var(--gold);margin-bottom:10px;display:flex;align-items:center;justify-content:center;gap:8px;"><i class="fa-solid fa-headset" style="color:#3498db;"></i>Need Help with Deposit?</div><div style="font-size:12px;color:var(--text-muted);margin-bottom:15px;">If you're having issues with deposit, contact our support team</div><button class="btn btn-ton" onclick="window.open('https://t.me/Elsayed_1_Elgohary','_blank')" style="background:linear-gradient(90deg,#3498db,#2980b9);"><i class="fab fa-telegram"></i>Contact Support</button></div></div>
</main>
<main id="user-withdrawals" class="content-section">
<div class="page-header"><h1>My Withdrawals</h1><p>Track your withdrawal requests</p></div>
<div class="card">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;"><h3 style="color:var(--gold);font-size:14px;">Withdrawal History</h3><div style="display:flex;gap:5px;"><button class="btn-filter small active" onclick="filterUserWithdrawals('all')">All</button><button class="btn-filter small" onclick="filterUserWithdrawals('pending')">Pending</button><button class="btn-filter small" onclick="filterUserWithdrawals('completed')">Completed</button></div></div>
<div id="user-withdrawals-list" style="max-height:400px;overflow-y:auto;display:flex;flex-direction:column-reverse;"></div>
</div>
</main>
<main id="competition" class="content-section">
<div class="page-header"><h1>Daily Competition</h1><p>Win Big with Tickets</p></div>
<div class="competition-timer-card"><div class="countdown-display" id="countdown-timer">24:00:00</div><div class="timer-label">TIME UNTIL NEXT COMPETITION</div></div>
<div class="status-grid">
    <div class="status-card"><div class="status-icon">ðŸ</div><div class="status-value" id="competition-status">ACTIVE</div><div class="status-label">COMPETITION STATUS</div></div>
    <div class="status-card"><div class="status-value" id="prize-pool">0.000 TON</div><div class="status-label">TOTAL PRIZE POOL</div></div>
    <div class="status-card" style="grid-column: span 2;"><div class="status-value" id="total-tickets" style="font-size:32px;">0</div><div class="status-label">TOTAL TICKETS SOLD</div></div>
</div>

<!-- âœ… ØªØ¹Ø¯ÙŠÙ„ Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ØªØ°Ø§ÙƒØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© -->
<div class="ticket-price-note">
    <p>ðŸŽ« <strong>Each ticket = 10,000 GLX = 0.001 TON</strong></p>
    <p style="font-size:11px;margin-top:5px;">Prize Pool = Total Tickets Ã— 0.001 TON</p>
</div>

<div class="competition-rules-card">
<div class="rules-header"><i class="fa-solid fa-circle-info"></i><span>Competition Rules</span></div>
<ul class="rules-list">
<li><span class="winner-highlight">ðŸ† ONLY THE FIRST PLACE WINS!</span> - The user with the most tickets wins the entire prize pool.</li>
<li><span class="loser-note">âŒ ALL OTHER PARTICIPANTS LOSE</span> - Only #1 gets the prize, others get nothing.</li>
<li>ðŸŽ« Each ticket costs <strong>10,000 GLX (0.001 TON)</strong></li>
<li>ðŸ’° Prize Pool = Total Tickets Ã— 0.001 TON</li>
<li>â° Competition runs for 24 hours, followed by 1 hour break</li>
<li>ðŸ“Š Winner is automatically selected after competition ends</li>
</ul>
<div class="important-note"><i class="fa-solid fa-exclamation-triangle"></i><strong>Important:</strong> Buy more tickets to increase your chance of winning! Only #1 position matters.</div>
</div>
<div class="card">
<h3 style="color:var(--gold);margin-bottom:15px;">ðŸŽŸï¸ Buy Competition Tickets</h3>
<div class="ticket-controls"><input type="number" id="ticket-amount" class="ticket-input" placeholder="Enter tickets amount" min="1" value="1"><button class="max-btn" onclick="setMaxTickets()">MAX</button></div>
<div class="price-info">
<div style="display:flex;justify-content:space-between;margin-bottom:10px;font-size:12px;"><span style="color:var(--text-muted);">Tickets:</span><span id="tickets-count-display">1</span></div>
<div style="display:flex;justify-content:space-between;margin-bottom:15px;font-size:12px;"><span style="color:var(--text-muted);">Cost:</span><span id="tickets-cost-display">10,000 GLX</span></div>
</div>
<button class="btn btn-primary" id="buy-tickets-btn" onclick="buyTickets()"><i class="fa-solid fa-ticket"></i>BUY TICKETS</button>
<p id="buy-tickets-status" style="text-align:center;font-size:11px;margin-top:10px;color:var(--text-muted);"></p>
</div>
<div class="competition-leaderboard">
<div class="leaderboard-header"><h3 style="font-size:16px;color:var(--gold);">ðŸ† Top 10 Leaders</h3><span style="font-size:10px;color:var(--text-muted);">Live Ranking</span></div>
<div id="competition-leaderboard-list" style="max-height:300px;overflow-y:auto;padding-bottom:10px;"><p style="text-align:center;padding:20px;color:var(--text-muted);">Loading leaderboard...</p></div>
</div>
<div class="previous-winners-card"><h3 style="font-size:16px;color:var(--gold);margin-bottom:15px;">ðŸ“… Yesterday's Winners</h3><div id="previous-winners-list"><p style="text-align:center;padding:20px;color:var(--text-muted);">No previous winners yet</p></div></div>
</main>
<main id="bonus" class="content-section">
<div class="page-header"><h1>Galaxy Bonus</h1><p>Daily rewards & fun games</p></div>
<div class="bonus-grid">
<div class="bonus-game-card" onclick="openGame('coin-flip')"><img src="https://i.ibb.co/gLT3myT3/Coin-Flip-Game.png" alt="Coin Flip Game" class="game-banner"><div class="game-content"><div class="game-icon">ðŸª™</div><div class="game-title">Coin Flip Game</div><div class="game-description">Heads or Tails? Win 2x your bet!</div></div></div>
<div class="bonus-game-card" onclick="openGame('promo-codes')"><img src="https://i.ibb.co/jnp9cTb/Promo-Codes-Rewards.png" alt="Promo Codes & Rewards" class="game-banner"><div class="game-content"><div class="game-icon">ðŸŽ</div><div class="game-title">Promo Codes</div><div class="game-description">Redeem codes for free rewards</div></div></div>
<div class="bonus-game-card" onclick="openGame('daily-streak')"><img src="https://i.ibb.co/GQQ0BnsT/Daily-Streak.png" alt="Daily Streak" class="game-banner"><div class="game-content"><div class="game-icon">ðŸ“…</div><div class="game-title">Daily Streak</div><div class="game-description">Claim daily rewards up to 7 days</div></div></div>
<div class="bonus-game-card" onclick="openGame('galaxy-slots')"><img src="https://i.ibb.co/204QyBWX/Galaxy-Slots-Game.png" alt="Galaxy Slots Game" class="game-banner"><div class="game-content"><div class="game-icon">ðŸŽ°</div><div class="game-title">Galaxy Slots</div><div class="game-description">Spin the reels & win big jackpots</div></div></div>
</div>
<div id="coin-flip-section" class="card" style="display:none;">
<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:15px;"><h3 style="font-size:14px;color:var(--gold);display:flex;align-items:center;gap:8px;"><i class="fa-solid fa-coins" style="color:#a855f7;"></i>Coin Flip Game</h3><button class="btn btn-action" onclick="closeGame()" style="width:auto;padding:8px 12px;font-size:11px;"><i class="fa-solid fa-arrow-left"></i>Back</button></div>
<div class="probability-display" style="display:none;"><div class="prob-item"><div class="prob-value win-prob">45%</div><div class="prob-label">Win Chance</div></div><div class="prob-item"><div class="prob-value loss-prob">55%</div><div class="prob-label">Loss Chance</div></div></div>
<div class="coin-flip-game">
<div class="coin-bet-controls"><input type="number" id="coin-bet-amount" class="bet-input" placeholder="Enter bet amount" min="1000" value="1000"><button class="max-btn" onclick="setMaxBet()" style="width:auto;padding:12px 15px;">MAX</button></div>
<div class="bet-buttons"><button class="bet-btn k-style active" onclick="setBetAmount(1000)">1k</button><button class="bet-btn k-style" onclick="setBetAmount(5000)">5k</button><button class="bet-btn k-style" onclick="setBetAmount(10000)">10k</button><button class="bet-btn k-style" onclick="setBetAmount(25000)">25k</button></div>
<div class="side-selection">
<div class="side-btn active" id="choose-glx" onclick="chooseSide('glx')"><div class="side-icon"><img src="https://i.ibb.co/tTkJX1Qy/logo.png" style="width:70px;height:70px;border-radius:50%;"></div><div class="side-name">GLX Side</div><div class="side-description">Win 2x if GLX appears</div></div>
<div class="side-btn" id="choose-gold" onclick="chooseSide('gold')"><div class="side-icon"><img src="https://i.ibb.co/tTkJX1Qy/logo.png" style="width:70px;height:70px;border-radius:50%;filter:sepia(1)saturate(2)hue-rotate(10deg)brightness(1.2);"></div><div class="side-name">Gold Side</div><div class="side-description">Win 2x if Gold appears</div></div>
</div>
<div class="coin-container"><div class="coin" id="coin"><div class="coin-face coin-front"><img src="https://i.ibb.co/tTkJX1Qy/logo.png" alt="GLX Coin"></div><div class="coin-face coin-back"><img src="https://i.ibb.co/tTkJX1Qy/logo.png" alt="Gold Coin" class="gold-side"></div></div></div>
<button class="btn btn-primary" id="flip-coin-btn" onclick="flipCoin()"><i class="fa-solid fa-play"></i>FLIP COIN</button>
<div class="game-result" id="coin-game-result" style="display:none;"><div class="result-text" id="coin-result-text"></div><div class="win-amount" id="coin-win-amount"></div><div class="loss-amount" id="coin-loss-amount"></div></div>
<div class="coin-game-rules">
<h4><i class="fa-solid fa-circle-info"></i>Game Rules</h4>
<ul>
<li><strong>Minimum bet:</strong> 1,000 GLX</li>
<li><strong>Choose:</strong> GLX Side or Gold Side</li>
<li><strong>If you win:</strong> Get 2x your bet (net profit: bet amount)</li>
<li><strong>If you lose:</strong> Lose your bet amount</li>
<li><strong>Note:</strong> Bet amount is deducted immediately when you flip</li>
</ul>
</div>
</div>
</div>
<div id="promo-codes-section" class="card" style="display:none;">
<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:15px;"><h3 style="font-size:14px;color:var(--gold);display:flex;align-items:center;gap:8px;"><i class="fa-solid fa-gift" style="color:#a855f7;"></i>Promo Codes & Rewards</h3><button class="btn btn-action" onclick="closeGame()" style="width:auto;padding:8px 12px;font-size:11px;"><i class="fa-solid fa-arrow-left"></i>Back</button></div>
<div class="promo-card" style="background:linear-gradient(135deg,rgba(168,85,247,0.2),rgba(123,97,255,0.2));border-radius:20px;padding:20px;margin-bottom:15px;border:2px solid rgba(168,85,247,0.3);position:relative;overflow:hidden;">
<div style="position:absolute;top:-50px;right:-50px;width:100px;height:100px;background:rgba(168,85,247,0.1);border-radius:50%;"></div>
<div style="position:absolute;bottom:-30px;left:-30px;width:80px;height:80px;background:rgba(123,97,255,0.1);border-radius:50%;"></div>
<div style="position:relative;z-index:2;">
<div style="display:flex;align-items:center;gap:10px;margin-bottom:15px;"><div style="width:50px;height:50px;background:linear-gradient(135deg,#a855f7,#7b61ff);border-radius:15px;display:flex;align-items:center;justify-content:center;font-size:24px;color:white;"><i class="fa-solid fa-key"></i></div><div><div style="font-size:16px;font-weight:800;color:white;">Redeem Code</div><div style="font-size:12px;color:rgba(255,255,255,0.7);">Enter promo code for rewards</div></div></div>
<div style="display:flex;gap:10px;margin-bottom:15px;"><input type="text" id="promo-code-input" placeholder="Enter promo code..." style="flex:1;padding:12px 15px;border-radius:12px;background:rgba(0,0,0,0.3);border:1px solid rgba(168,85,247,0.5);color:white;font-family:inherit;font-size:14px;outline:none;"><button id="redeem-code-btn" style="padding:12px 20px;background:linear-gradient(135deg,#a855f7,#7b61ff);border:none;border-radius:12px;color:white;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:8px;"><i class="fa-solid fa-gift"></i>Redeem</button></div>
<div id="promo-result" style="padding:10px;border-radius:10px;font-size:12px;text-align:center;display:none;"></div>
</div>
</div>
<div class="code-channel-card" style="background:linear-gradient(135deg,rgba(255,193,7,0.2),rgba(255,152,0,0.2));border-radius:20px;padding:20px;border:2px solid rgba(255,193,7,0.3);position:relative;overflow:hidden;cursor:pointer;" onclick="window.open('https://t.me/earnmoney1685','_blank')">
<div style="position:absolute;top:-30px;right:-30px;width:80px;height:80px;background:rgba(255,193,7,0.1);border-radius:50%;"></div>
<div style="position:relative;z-index:2;">
<div style="display:flex;align-items:center;gap:15px;"><div style="width:60px;height:60px;background:linear-gradient(135deg,#FFC107,#FF9800);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:28px;color:white;"><i class="fab fa-telegram"></i></div><div style="flex:1;"><div style="font-size:16px;font-weight:800;color:white;margin-bottom:5px;"><i class="fa-solid fa-bolt" style="color:#FFC107;"></i>Codes Channel</div><div style="font-size:12px;color:rgba(255,255,255,0.8);margin-bottom:8px;">Get exclusive promo codes & daily rewards</div><div style="display:flex;align-items:center;gap:5px;"><span style="font-size:11px;color:#FFC107;font-weight:700;"><i class="fa-solid fa-users"></i>Join Now</span><span style="font-size:11px;color:rgba(255,255,255,0.6);">@earnmoney1685</span></div></div><div style="width:40px;height:40px;background:rgba(255,255,255,0.1);border-radius:50%;display:flex;align-items:center;justify-content:center;color:#FFC107;font-size:18px;"><i class="fa-solid fa-arrow-right"></i></div></div>
</div>
</div>
</div>
<div id="daily-streak-section" class="card" style="display:none;">
<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:15px;"><h3 style="font-size:14px;color:var(--gold);display:flex;align-items:center;gap:8px;"><i class="fa-solid fa-calendar-check" style="color:#a855f7;"></i>Daily Streak</h3><button class="btn btn-action" onclick="closeGame()" style="width:auto;padding:8px 12px;font-size:11px;"><i class="fa-solid fa-arrow-left"></i>Back</button></div>
<div class="daily-row" id="daily-checkin-grid"></div>
<button class="btn btn-primary" id="claim-daily-btn">Claim Bonus</button>
<p id="next-claim-timer" style="text-align:center;font-size:11px;margin-top:8px;opacity:0.7;"></p>
</div>
<div id="galaxy-slots-section" class="card" style="display:none;text-align:center;">
<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:15px;"><h3 style="font-size:14px;color:var(--gold);display:flex;align-items:center;gap:8px;"><i class="fa-solid fa-slot-machine" style="color:#a855f7;"></i>Galaxy Slots Game</h3><button class="btn btn-action" onclick="closeGame()" style="width:auto;padding:8px 12px;font-size:11px;"><i class="fa-solid fa-arrow-left"></i>Back</button></div>
<div class="spins-display">
<div><div style="font-size:12px;color:var(--text-muted);">Available Spins</div><div class="spins-count" id="available-spins">1</div></div>
<button class="btn btn-ton" onclick="getExtraSpin()" style="width:auto;padding:8px 15px;">ðŸŽ¬ Watch Ad for Extra Spin</button>
</div>
<div class="slots-machine">
<div class="slots-reels">
<div class="reel-container"><div class="reel" id="reel1"></div></div>
<div class="reel-container"><div class="reel" id="reel2"></div></div>
<div class="reel-container"><div class="reel" id="reel3"></div></div>
</div>
<div class="slots-result">
<div id="slots-result-text" style="font-size:14px;margin-bottom:10px;">Press SPIN to play!</div>
<div id="slots-win-amount" style="font-size:24px;font-weight:800;color:var(--primary-green);">0 GLX</div>
</div>
</div>
<button class="btn btn-primary" id="slots-spin-btn" style="margin-bottom:15px;">ðŸš€ SPIN NOW</button>
<div class="payout-table">
<div class="payout-item">3x ðŸŒŸ = <span class="jackpot">10000 GLX</span></div>
<div class="payout-item">3x ðŸª = 5000 GLX</div>
<div class="payout-item">3x ðŸ’« = 2500 GLX</div>
<div class="payout-item">3x â­ = 1200 GLX</div>
<div class="payout-item">2x ðŸŒŸ = 700 GLX</div>
<div class="payout-item">Any Match = 500 GLX</div>
</div>
</div>
</main>
<main id="tasks" class="content-section">
<div class="page-header"><h1>Missions</h1><p>Complete tasks to earn GLX</p></div>
<div class="card">
<div style="display:flex;justify-content:space-between;margin-bottom:10px;font-size:12px;font-weight:700;"><span>Daily Ad Limit</span><span style="color:var(--gold);">650 Total</span></div>
<div id="monetag-ad-task" class="list-card" style="background:rgba(255,255,255,0.08);border-color:var(--primary-green);margin-bottom:10px;">
<div class="lc-icon"><img src="https://i.ibb.co/tTkJX1Qy/logo.png" alt="Ad"></div>
<div class="lc-content"><div class="lc-title">Monetag Ad</div><div class="lc-sub"><span id="monetag-count">0</span>/<span id="monetag-limit">50</span></div></div>
<div class="lc-end"><div class="lc-val">+500</div></div>
</div>
<div id="gigapub-ad-task" class="list-card" style="background:rgba(255,255,255,0.08);border-color:var(--primary-green);margin-bottom:10px;">
<div class="lc-icon"><img src="https://i.ibb.co/tTkJX1Qy/logo.png" alt="Ad"></div>
<div class="lc-content"><div class="lc-title">GigaPub Ad</div><div class="lc-sub"><span id="giga-count">0</span>/<span id="giga-limit">300</span></div></div>
<div class="lc-end"><div class="lc-val">+500</div></div>
</div>
<div id="adsgram-ad-task" class="list-card" style="background:rgba(255,255,255,0.08);border-color:var(--primary-green);">
<div class="lc-icon"><img src="https://i.ibb.co/tTkJX1Qy/logo.png" alt="Ad"></div>
<div class="lc-content"><div class="lc-title">AdsGram Ad</div><div class="lc-sub"><span id="adsgram-count">0</span>/<span id="adsgram-limit">300</span></div></div>
<div class="lc-end"><div class="lc-val">+500</div></div>
</div>
</div>

<!-- âœ… Ø­Ø°Ù Ù‚Ø³Ù… Partners Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ - Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ -->
<h2>Community</h2>
<div id="community-tasks-card"><div id="community-tasks-list"></div></div>
</main>
<main id="create-task-page" class="content-section">
<div class="page-header"><h1>Add Mission</h1><p>Promote your channel or bot</p></div>
<div class="card">
<div class="input-wrap"><span class="input-label">Task Name</span><input type="text" id="new-task-name" class="custom-input" placeholder="e.g. Join Galaxy Channel"></div>
<div class="input-wrap"><span class="input-label">Link</span><input type="text" id="new-task-link" class="custom-input" placeholder="https://t.me/..."></div>
<div class="input-label" style="margin-bottom:10px;">Category</div>
<div class="cat-select">
<div class="cat-opt active" onclick="selectCat(this,'channel')">Channel / Group</div>
<div class="cat-opt" onclick="selectCat(this,'bot')">Website / Bot</div>
</div>
<div id="admin-required-msg" style="background:rgba(255,179,0,0.15);border:1px solid #ffb300;border-radius:12px;padding:12px;margin-bottom:20px;font-size:12px;color:#ffb300;display:block;line-height:1.5;"><i class="fa-solid fa-triangle-exclamation" style="margin-right:5px;"></i><strong>Action Required:</strong> You must add <u>@RealEarnBot_bot</u> as an <strong>Admin</strong> in your Channel/Group for tracking to work.</div>
<div class="input-label" style="margin-bottom:10px;">Number of Completions</div>
<div class="price-grid" id="price-options"></div>
<div id="payment-step-1"><button class="btn btn-ton" id="pay-task-btn" onclick="initiatePayment()"><img src="https://i.ibb.co/8DsyHqwK/toncoin-ton-logo.png" style="width:20px;border-radius:50%;">Pay <span id="pay-amount-display">0</span> TON</button></div>
<div id="payment-step-2" style="display:none;text-align:center;"><p style="font-size:12px;margin-bottom:10px;color:#fff;">Payment sent? Verify below:</p><button class="btn btn-check" id="check-payment-btn" onclick="verifyPayment()">Check Payment</button><p id="payment-status-msg" style="font-size:11px;margin-top:8px;color:var(--text-muted);">Waiting for transaction...</p></div>
</div>
<button class="btn btn-action nav-link" data-target="tasks" style="margin-top:10px;">Cancel</button>
</main>
<main id="history" class="content-section">
<div class="page-header"><h1>Ledger</h1><p>Transaction History</p></div>
<div id="full-history-list" style="padding-bottom:20px;"></div>
</main>
<main id="withdrawal-history" class="content-section">
<div class="page-header"><h1>Withdrawal History</h1><p>All completed withdrawals</p></div>
<div class="card" style="margin-top:15px;">
<h2 style="display:flex;align-items:center;gap:8px;"><i class="fa-solid fa-credit-card"></i>Payments Channel</h2>
<div class="support-channel-card" onclick="window.open('https://t.me/earnmoney139482','_blank')">
<div style="display:flex;align-items:center;gap:12px;"><div style="width:50px;height:50px;background:linear-gradient(135deg,#a855f7,#7b61ff);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:24px;color:white;"><i class="fab fa-telegram"></i></div><div style="flex:1;"><div style="font-size:14px;font-weight:700;color:white;margin-bottom:5px;">Payments & Withdrawals Channel</div><div style="font-size:11px;color:var(--text-muted);">Track payments, withdrawals, and transaction updates</div><div style="font-size:10px;color:#ffb300;margin-top:5px;"><i class="fa-solid fa-users"></i> @earnmoney139482</div></div><div style="color:var(--primary-green);font-size:18px;"><i class="fa-solid fa-arrow-right"></i></div></div>
</div>
</div>
<div id="withdrawal-history-list" style="max-height:500px;overflow-y:auto;"></div>
</main>
<main id="swap-page" class="content-section">
<div class="page-header"><h1>Swap Market</h1><p>100K GLX = 0.01 TON</p></div>
<div class="swap-direction-selector">
<div class="swap-direction-btn active" onclick="selectSwapDirection('glx_to_ton')">GLX â†’ TON</div>
<div class="swap-direction-btn" onclick="selectSwapDirection('ton_to_glx')">TON â†’ GLX</div>
</div>
<div class="card">
<div id="glx-to-ton-section">
<div class="input-wrap"><span class="input-label">You Give (GLX)</span><input type="number" id="swap-input-amount" class="custom-input" placeholder="Min 1,000" oninput="calculateSwap()"><div style="text-align:right;font-size:10px;color:var(--text-muted);margin-top:5px;">Max:<span id="swap-max-GLX">0</span><button onclick="setMaxSwap('glx')" style="margin-left:10px;background:var(--primary-green);color:#000;border:none;padding:4px 8px;border-radius:6px;font-size:10px;cursor:pointer;">MAX</button></div></div>
<div class="input-wrap"><span class="input-label">You Get (TON)</span><div style="display:flex;align-items:center;gap:10px;"><img src="https://i.ibb.co/8DsyHqwK/toncoin-ton-logo.png" style="width:24px;"><span id="swap-output-amount" class="custom-input">0.0000000</span></div></div>
<div class="swap-mode-text">Rate: 100,000 GLX = 0.01 TON</div>
</div>
<div id="ton-to-glx-section" style="display:none;">
<div class="input-wrap"><span class="input-label">You Give (TON)</span><input type="number" id="ton-input-amount" class="custom-input" placeholder="Min 0.0001" oninput="calculateSwap()"><div style="text-align:right;font-size:10px;color:var(--text-muted);margin-top:5px;">Max:<span id="swap-max-TON">0.0000</span><button onclick="setMaxSwap('ton')" style="margin-left:10px;background:var(--primary-green);color:#000;border:none;padding:4px 8px;border-radius:6px;font-size:10px;cursor:pointer;">MAX</button></div></div>
<div class="input-wrap"><span class="input-label">You Get (GLX)</span><div style="display:flex;align-items:center;gap:10px;"><img src="https://i.ibb.co/tTkJX1Qy/logo.png" style="width:24px;height:24px;border-radius:50%;"><span id="ton-output-amount" class="custom-input">0</span></div></div>
<div class="swap-mode-text">Rate: 0.01 TON = 100,000 GLX</div>
</div>
<button class="btn btn-primary" id="execute-swap-btn" onclick="executeSwap()">Confirm Swap</button>
</div>
</main>
<main id="withdraw" class="content-section">
<div class="page-header"><h1>Withdraw</h1><p>GLX out to TON Wallet</p></div>
    
<!-- âœ… Ø¥Ø¶Ø§ÙØ© Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„ÙŠÙˆÙ…ÙŠ -->
<div class="withdrawals-counter" id="daily-withdrawals-counter">
    <div>Today's Withdrawals: <span class="count" id="today-withdrawals-count">0</span>/2</div>
    <div class="reset-time" id="withdraw-reset-timer">Resets in: 24h 00m</div>
</div>
    
<div class="withdrawal-type-selector">
<div class="withdrawal-type-btn active" data-type="faucetpay" onclick="selectWithdrawalType('faucetpay')"><i class="fa-solid fa-envelope"></i>FaucetPay</div>
<div class="withdrawal-type-btn" data-type="tonwallet" onclick="selectWithdrawalType('tonwallet')"><i class="fa-solid fa-wallet"></i>TON Wallet</div>
</div>
<div id="faucetpay-form" class="card">
<div class="input-wrap"><span class="input-label">FaucetPay Email Address</span><input type="email" id="faucetpay-email" class="custom-input" placeholder="example@gmail.com" oninput="maskEmail()"><div id="email-preview" class="email-display masked-email" style="display:none;margin-top:8px;font-size:12px;color:#a855f7;font-family:'Courier New',monospace;"></div></div>
<div class="input-wrap withdraw-input-with-max"><span class="input-label">Withdrawal Amount (TON)</span><div style="display:flex;align-items:center;gap:8px;"><input type="number" id="faucetpay-amount" class="custom-input" placeholder="0.0001" step="0.0001" min="0.0001" value="0.0001" style="flex:1;"><button class="max-btn" onclick="setMaxFaucetPay()">MAX</button></div><div style="text-align:right;font-size:10px;color:var(--text-muted);margin-top:5px;">Minimum: 0.0001 TON</div></div>
<div class="info-box"><div style="display:flex;align-items:flex-start;gap:8px;"><div class="info-icon">!</div><div style="font-size:11px;line-height:1.4;"><strong>Important Information:</strong><br>â€¢ Enter the email registered with your FaucetPay account<br>â€¢ Minimum withdrawal: 0.0001 TON<br>â€¢ <span style="color:#27ae60;">âœ… No fees</span> - We cover all transaction costs<br>â€¢ Processing time: Up to 1 minute<br>â€¢ Your email will be partially hidden for privacy</div></div></div>
<button class="btn btn-primary" id="withdraw-faucetpay-btn" onclick="handleFaucetPayWithdraw()"><i class="fa-solid fa-paper-plane"></i>WITHDRAW VIA FAUCETPAY</button>
</div>
<div id="tonwallet-form" class="card" style="display:none;">
<div class="input-wrap"><span class="input-label">TON Wallet Address</span><input type="text" id="ton-wallet-address" class="custom-input" placeholder="UQ... or EQ... or kQ..."><div style="text-align:right;font-size:10px;color:var(--text-muted);margin-top:5px;">Enter your TON wallet address (starts with UQ, EQ, or kQ)</div></div>
<div class="input-wrap"><span class="input-label">Memo (Optional)</span><input type="text" id="ton-memo" class="custom-input" placeholder="For exchange deposits only"><div style="text-align:right;font-size:10px;color:var(--text-muted);margin-top:5px;">Optional: Required by some exchanges for deposits</div></div>
<div class="input-wrap withdraw-input-with-max"><span class="input-label">Withdrawal Amount (TON)</span><div style="display:flex;align-items:center;gap:8px;"><input type="number" id="ton-withdraw-amount" class="custom-input" placeholder="0.05" step="0.01" min="0.05" value="0.05" style="flex:1;"><button class="max-btn" onclick="setMaxTonWallet()">MAX</button></div><div style="text-align:right;font-size:10px;color:var(--text-muted);margin-top:5px;">Minimum: 0.05 TON</div></div>
<div class="info-box success"><div style="display:flex;align-items:flex-start;gap:8px;"><div class="info-icon">âœ“</div><div style="font-size:11px;line-height:1.4;"><strong>Withdrawal Details:</strong><br>â€¢ Minimum withdrawal: 0.05 TON<br>â€¢ <span style="color:#27ae60;">âœ… No fees</span> - We cover all transaction costs<br>â€¢ Processing time: Up to 24 hours<br>â€¢ Memo is only needed for exchange deposits<br>â€¢ Ensure address is correct - transactions are irreversible</div></div></div>
<button class="btn btn-primary" id="withdraw-ton-now-btn" onclick="handleTonWalletWithdraw()"><i class="fa-solid fa-wallet"></i>WITHDRAW TO TON WALLET</button>
</div>
</main>
<main id="leaderboard" class="content-section">
<div class="page-header"><h1>Top Kings</h1><p>The richest in the Galaxy</p></div>
<div class="leader-tabs"><div class="tab-btn active" data-target="invites-leaderboard-list">Invites</div><div class="tab-btn" data-target="earnings-leaderboard-list">Holders</div></div>
<div class="podium-list" id="invites-leaderboard-list"></div>
<div class="podium-list hidden" id="earnings-leaderboard-list"></div>
</main>

<!-- ðŸ”„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: ØªØ­Ø¯ÙŠØ« Ù‚ÙŠÙ…Ø© Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„Ø¥Ø­Ø§Ù„Ø© Ø¥Ù„Ù‰ 100K -->
<main id="referrals" class="content-section">
<div class="page-header"><h1>Referrals</h1><p>Invite friends, earn together</p></div>
<div class="card" style="text-align:center;">
<img src="https://i.ibb.co/tTkJX1Qy/logo.png" style="width:80px;margin-bottom:15px;">
<div style="background:rgba(255,255,255,0.05);padding:10px;border-radius:12px;margin-bottom:20px;"><div style="font-size:12px;color:var(--text-muted);">Total Referrals</div><div style="font-size:24px;font-weight:800;color:#fff;" id="referral-count-display">0</div></div>

<!-- ðŸ”„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: ØªØºÙŠÙŠØ± Ø§Ù„Ù†Øµ Ù…Ù† 10000 Ø¥Ù„Ù‰ 100K -->
<p>Earn <strong>+100K GLX</strong> for every friend.</p>

<div id="referral-link-display" style="background:#000;padding:10px;border-radius:8px;font-family:monospace;font-size:10px;color:#aaa;margin:15px 0;word-break:break-all;">...</div>
<button class="btn btn-primary" id="share-referral-btn">Invite Friends</button>
<button class="btn btn-outline" id="copy-referral-btn" style="margin-top:10px;">Copy Link</button>
</div>
</main>
</div>

<div class="floating-add-task hidden" id="floatingAddTask" onclick="switchTab('create-task-page')">
<div class="floating-add-task-content">
<div class="floating-add-task-icon">+</div>
<div class="floating-add-task-text">Add Task</div>
</div>
</div>

<!-- ÙƒØ§Ø¨ØªØ´Ø§ Ù…ÙˆØ°Ø§Ù„ -->
<div id="captcha-modal" class="captcha-modal" style="display: none;">
    <div class="captcha-container">
        <div class="captcha-header">
            <h3>ðŸ›¡ï¸ Security Verification</h3>
            <p>Complete this verification to continue earning rewards</p>
            <div id="captcha-type-badge" class="captcha-type-badge"></div>
        </div>
        
        <div class="captcha-info">
            <span><i class="fa-solid fa-shield-alt"></i> Anti-Bot Protection</span>
            <span id="ads-until-captcha">Ads until next: 0/10</span>
        </div>
        
        <div class="captcha-progress">
            <div id="captcha-progress-bar" class="captcha-progress-bar"></div>
        </div>
        
        <div id="captcha-error" class="captcha-error"></div>
        <div id="captcha-success" class="captcha-success"></div>
        
        <div class="captcha-widget">
            <!-- Cloudflare Turnstile -->
            <div id="cloudflare-widget" style="display: none;"></div>
            
            <!-- hCaptcha -->
            <div id="hcaptcha-widget" style="display: none;"></div>
        </div>
        
        <div id="captcha-timer" class="captcha-timer"></div>
        
        <p class="captcha-note">
            <i class="fa-solid fa-circle-info"></i> This verification helps prevent automated tools and ensures fair rewards for all users. Required every 10 ads.
        </p>
        
        <div class="captcha-actions">
            <button class="btn btn-action" onclick="cancelCaptcha()">
                <i class="fa-solid fa-xmark"></i> Cancel
            </button>
            <button class="btn btn-primary" id="verify-captcha-btn" onclick="verifyCaptcha()" disabled>
                <i class="fa-solid fa-check"></i> Verify & Continue
            </button>
        </div>
    </div>
</div>

<nav class="bottom-nav">
<div class="nav-item active" data-target="home"><svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path></svg><span class="nav-text">Home</span></div>
<div class="nav-item" data-target="tasks"><svg viewBox="0 0 24 24"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg><span class="nav-text">Tasks</span></div>
<div class="nav-item" data-target="bonus"><svg viewBox="0 0 24 24"><path d="M20 12V8H6a2 2 0 0 1-2-2c0-1.1.9-2 2-2h12v4"/><path d="M4 6v12c0 1.1.9 2 2 2h14v-4"/><path d="M18 12a2 2 0 0 0-2 2c0 1.1.9 2 2 2h4v-4h-4z"/></svg><span class="nav-text">Bonus</span></div>
<div class="nav-item competition-nav-item" data-target="competition">
<div class="competition-nav-icon"><svg viewBox="0 0 32 32" width="28" height="28"><circle cx="16" cy="16" r="14" fill="rgba(255,215,0,0.15)" opacity="0.8"/><path d="M9 13 L16 8 L23 13 L21 21 L11 21 Z" fill="none" stroke="#FFD700" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M16 5 L17.5 10 L22 10 L18.5 13 L19.5 18 L16 15 L12.5 18 L13.5 13 L10 10 L14.5 10 Z" fill="#FFD700" stroke="#FFA500" stroke-width="1.5"/><circle cx="16" cy="16" r="6" fill="none" stroke="#FFD700" stroke-width="1.5" stroke-dasharray="2 2"/><circle cx="16" cy="16" r="8" fill="none" stroke="rgba(255,215,0,0.3)" stroke-width="3"/></svg></div>
<span class="nav-text">Competition</span>
</div>
<div class="nav-item" data-target="referrals"><svg viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg><span class="nav-text">Referrals</span></div>
<div class="nav-item" data-target="withdrawal-history"><svg viewBox="0 0 24 24" style="filter:drop-shadow(0 0 8px rgba(168,85,247,0.4));"><path d="M12 2v20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M8 12l4 4 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><span class="nav-text">Withdrawals</span></div>
</nav>
<script>
// ===== Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ø¨ØªØ´Ø§ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ =====
let captchaConfig = {
    adsBetweenCaptcha: 10,
    currentAdsCount: 0,
    lastCaptchaTime: 0,
    nextCaptchaType: '',
    captchaEnabled: true
};

let captchaData = {
    type: '',
    token: '',
    widgetId: null,
    callback: null,
    isActive: false,
    retryCount: 0
};

// ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙƒØ§Ø¨ØªØ´Ø§
async function loadCaptchaConfig() {
    try {
        const result = await callAPI('getCaptchaConfig');
        if (result.success) {
            captchaConfig = {
                ...captchaConfig,
                ...result.data.config
            };
            
            const savedCount = localStorage.getItem('captchaAdCount');
            captchaConfig.currentAdsCount = savedCount ? parseInt(savedCount) : 0;
            
            updateCaptchaProgress();
            
            console.log("âœ… Captcha config loaded:", captchaConfig);
        }
    } catch (error) {
        console.error("âŒ Error loading captcha config:", error);
    }
}

// Ø²ÙŠØ§Ø¯Ø© Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª
function incrementAdCounter() {
    captchaConfig.currentAdsCount++;
    localStorage.setItem('captchaAdCount', captchaConfig.currentAdsCount.toString());
    updateCaptchaProgress();
    
    return captchaConfig.currentAdsCount >= captchaConfig.adsBetweenCaptcha;
}

// ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
function updateCaptchaProgress() {
    const progressElement = document.getElementById('captcha-progress-bar');
    const counterElement = document.getElementById('ads-until-captcha');
    
    if (progressElement && counterElement) {
        const progress = (captchaConfig.currentAdsCount / captchaConfig.adsBetweenCaptcha) * 100;
        progressElement.style.width = Math.min(progress, 100) + '%';
        
        const adsLeft = Math.max(0, captchaConfig.adsBetweenCaptcha - captchaConfig.currentAdsCount);
        counterElement.textContent = `Ads until next: ${adsLeft}/${captchaConfig.adsBetweenCaptcha}`;
    }
}

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø§Ø¬Ø© Ù„ÙƒØ§Ø¨ØªØ´Ø§
async function checkCaptchaRequirement(adType) {
    try {
        const result = await callAPI('checkCaptchaRequirement', {
            adType: adType,
            currentCount: captchaConfig.currentAdsCount
        });
        
        if (result.success && result.data.requireCaptcha) {
            return {
                requireCaptcha: true,
                captchaType: result.data.captchaType,
                message: result.data.message
            };
        }
    } catch (error) {
        console.error("âŒ Error checking captcha requirement:", error);
    }
    
    return { requireCaptcha: false };
}

// Ø·Ù„Ø¨ Ù†ÙˆØ¹ Ø§Ù„ÙƒØ§Ø¨ØªØ´Ø§ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
async function requestCaptchaType() {
    try {
        const result = await callAPI('getCaptchaType');
        if (result.success) {
            return result.data.captchaType;
        }
    } catch (error) {
        console.error("âŒ Error getting captcha type:", error);
    }
    
    // Ø§Ø®ØªÙŠØ§Ø± Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø¥Ø°Ø§ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„
    return Math.random() > 0.5 ? 'cloudflare' : 'hcaptcha';
}

// Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ§Ø¨ØªØ´Ø§
async function showCaptcha(callback) {
    if (captchaData.isActive) return;
    
    captchaData.callback = callback;
    captchaData.isActive = true;
    captchaData.retryCount = 0;
    
    try {
        captchaData.type = await requestCaptchaType();
        setupCaptchaUI();
        
        await initializeCaptchaWidget();
        
        document.getElementById('captcha-modal').style.display = 'flex';
        startCaptchaTimer(120); // 2 Ø¯Ù‚ÙŠÙ‚Ø©
        
    } catch (error) {
        console.error("âŒ Error showing captcha:", error);
        hideCaptcha();
        if (callback) callback(false, 'Failed to load captcha');
    }
}

// Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ÙƒØ§Ø¨ØªØ´Ø§
function setupCaptchaUI() {
    const badge = document.getElementById('captcha-type-badge');
    const cloudflareWidget = document.getElementById('cloudflare-widget');
    const hcaptchaWidget = document.getElementById('hcaptcha-widget');
    
    cloudflareWidget.style.display = 'none';
    hcaptchaWidget.style.display = 'none';
    cloudflareWidget.innerHTML = '';
    hcaptchaWidget.innerHTML = '';
    
    document.getElementById('captcha-error').style.display = 'none';
    document.getElementById('captcha-success').style.display = 'none';
    document.getElementById('verify-captcha-btn').disabled = true;
    captchaData.token = '';
    
    if (captchaData.type === 'cloudflare') {
        badge.textContent = 'Cloudflare Turnstile';
        badge.className = 'captcha-type-badge captcha-type-cloudflare';
        cloudflareWidget.style.display = 'block';
    } else {
        badge.textContent = 'hCaptcha Security';
        badge.className = 'captcha-type-badge captcha-type-hcaptcha';
        hcaptchaWidget.style.display = 'block';
    }
}

// ØªÙ‡ÙŠØ¦Ø© ÙˆØ¯Ø¬Øª Ø§Ù„ÙƒØ§Ø¨ØªØ´Ø§
async function initializeCaptchaWidget() {
    return new Promise((resolve) => {
        setTimeout(() => {
            if (captchaData.type === 'cloudflare' && window.turnstile) {
                captchaData.widgetId = window.turnstile.render('#cloudflare-widget', {
                    sitekey: '0x4AAAAAACOf6mYyukJx5XVy',
                    theme: 'dark',
                    size: 'normal',
                    callback: function(token) {
                        captchaData.token = token;
                        document.getElementById('verify-captcha-btn').disabled = false;
                        showCaptchaSuccess("âœ… CAPTCHA verified successfully!");
                    },
                    'error-callback': function() {
                        showCaptchaError("âŒ CAPTCHA verification failed. Please try again.");
                    }
                });
                resolve();
            } else if (captchaData.type === 'hcaptcha' && window.hcaptcha) {
                captchaData.widgetId = window.hcaptcha.render('#hcaptcha-widget', {
                    sitekey: 'b34eba88-b91c-4732-95c4-22d09748e630',
                    theme: 'dark',
                    size: 'normal',
                    callback: function(token) {
                        captchaData.token = token;
                        document.getElementById('verify-captcha-btn').disabled = false;
                        showCaptchaSuccess("âœ… CAPTCHA verified successfully!");
                    },
                    'error-callback': function() {
                        showCaptchaError("âŒ CAPTCHA verification failed. Please try again.");
                    }
                });
                resolve();
            } else {
                console.error("âŒ CAPTCHA widget not available:", captchaData.type);
                resolve();
            }
        }, 500);
    });
}

// ØªØ§ÙŠÙ…Ø± Ø§Ù„ÙƒØ§Ø¨ØªØ´Ø§
let captchaTimer = null;
let captchaSeconds = 0;

function startCaptchaTimer(seconds) {
    captchaSeconds = seconds;
    const timerElement = document.getElementById('captcha-timer');
    
    if (captchaTimer) clearInterval(captchaTimer);
    
    captchaTimer = setInterval(() => {
        captchaSeconds--;
        
        if (captchaSeconds <= 0) {
            clearInterval(captchaTimer);
            showCaptchaError("âŒ CAPTCHA expired! Please refresh and try again.");
            document.getElementById('verify-captcha-btn').disabled = true;
        } else {
            const minutes = Math.floor(captchaSeconds / 60);
            const secs = captchaSeconds % 60;
            timerElement.textContent = `Time remaining: ${minutes}:${secs.toString().padStart(2, '0')}`;
        }
    }, 1000);
}

// Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£
function showCaptchaError(message) {
    const errorElement = document.getElementById('captcha-error');
    errorElement.textContent = message;
    errorElement.style.display = 'block';
    setTimeout(() => { errorElement.style.display = 'none'; }, 5000);
}

// Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
function showCaptchaSuccess(message) {
    const successElement = document.getElementById('captcha-success');
    successElement.textContent = message;
    successElement.style.display = 'block';
    setTimeout(() => { successElement.style.display = 'none'; }, 3000);
}

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒØ§Ø¨ØªØ´Ø§
async function verifyCaptcha() {
    if (!captchaData.token) {
        showCaptchaError("âŒ Please complete the CAPTCHA first.");
        return;
    }
    
    const verifyBtn = document.getElementById('verify-captcha-btn');
    const originalText = verifyBtn.innerHTML;
    
    verifyBtn.disabled = true;
    verifyBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verifying...';
    
    try {
        const result = await callAPI('verifyCaptcha', {
            captchaType: captchaData.type,
            captchaToken: captchaData.token
        });
        
        if (result.success) {
            captchaConfig.currentAdsCount = 0;
            localStorage.setItem('captchaAdCount', '0');
            updateCaptchaProgress();
            
            hideCaptcha();
            
            if (captchaData.callback) {
                captchaData.callback(true, result.data.message || 'Captcha verified successfully');
            }
            
            showNotification("âœ… CAPTCHA verified successfully!", "success");
            
        } else {
            captchaData.retryCount++;
            
            if (captchaData.retryCount >= 3) {
                showCaptchaError("âŒ Too many failed attempts. Please refresh the page.");
                setTimeout(hideCaptcha, 3000);
            } else {
                resetCaptchaWidget();
                showCaptchaError("âŒ " + (result.error || 'CAPTCHA verification failed'));
                verifyBtn.disabled = false;
                verifyBtn.innerHTML = originalText;
            }
            
            if (captchaData.callback) {
                captchaData.callback(false, result.error || 'Captcha verification failed');
            }
        }
    } catch (error) {
        console.error("âŒ CAPTCHA verification error:", error);
        showCaptchaError("âŒ Connection error. Please try again.");
        verifyBtn.disabled = false;
        verifyBtn.innerHTML = originalText;
        
        if (captchaData.callback) {
            captchaData.callback(false, 'Connection error');
        }
    }
}

// Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙˆÙŠØ¯ Ø§Ù„ÙƒØ§Ø¨ØªØ´Ø§
function resetCaptchaWidget() {
    captchaData.token = '';
    document.getElementById('verify-captcha-btn').disabled = true;
    
    if (captchaData.type === 'cloudflare' && window.turnstile && captchaData.widgetId) {
        window.turnstile.reset(captchaData.widgetId);
    } else if (captchaData.type === 'hcaptcha' && window.hcaptcha && captchaData.widgetId) {
        window.hcaptcha.reset(captchaData.widgetId);
    }
}

// Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ÙƒØ§Ø¨ØªØ´Ø§
function cancelCaptcha() {
    hideCaptcha();
    if (captchaData.callback) {
        captchaData.callback(false, 'Cancelled by user');
    }
}

// Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙƒØ§Ø¨ØªØ´Ø§
function hideCaptcha() {
    document.getElementById('captcha-modal').style.display = 'none';
    
    if (captchaTimer) {
        clearInterval(captchaTimer);
        captchaTimer = null;
    }
    
    if (captchaData.type === 'cloudflare' && window.turnstile && captchaData.widgetId) {
        window.turnstile.remove(captchaData.widgetId);
    }
    
    captchaData = {
        type: '',
        token: '',
        widgetId: null,
        callback: null,
        isActive: false,
        retryCount: 0
    };
}

// ØªØ¹Ø¯ÙŠÙ„ Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù„Ø¯Ø¹Ù… Ø§Ù„ÙƒØ§Ø¨ØªØ´Ø§
const originalHandleMonetagAd = handleMonetagAd;
const originalHandleGigaAd = handleGigaAd;
const originalHandleAdsgramAd = handleAdsgramAd;

// Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù…Ø¹ Ø§Ù„ÙƒØ§Ø¨ØªØ´Ø§
async function handleMonetagAdWithCaptcha() {
    if (!canClickAd()) {
        showNotification("Please wait 3 seconds before clicking again.", "warning");
        return;
    }
    
    const isAllowed = await checkBeforeAction("watch ad");
    if (!isAllowed) return;
    
    const needsCaptcha = incrementAdCounter();
    const captchaCheck = await checkCaptchaRequirement('monetag');
    
    if (needsCaptcha || (captchaCheck.requireCaptcha && captchaConfig.captchaEnabled)) {
        showCaptcha(async (success, message) => {
            if (success) {
                await originalHandleMonetagAd();
            } else {
                showNotification("âŒ " + (message || 'CAPTCHA verification required'), "error");
            }
        });
    } else {
        await originalHandleMonetagAd();
    }
}

async function handleGigaAdWithCaptcha() {
    if (!canClickAd()) {
        showNotification("Please wait 3 seconds before clicking again.", "warning");
        return;
    }
    
    const isAllowed = await checkBeforeAction("watch ad");
    if (!isAllowed) return;
    
    const needsCaptcha = incrementAdCounter();
    const captchaCheck = await checkCaptchaRequirement('giga');
    
    if (needsCaptcha || (captchaCheck.requireCaptcha && captchaConfig.captchaEnabled)) {
        showCaptcha(async (success, message) => {
            if (success) {
                await originalHandleGigaAd();
            } else {
                showNotification("âŒ " + (message || 'CAPTCHA verification required'), "error");
            }
        });
    } else {
        await originalHandleGigaAd();
    }
}

async function handleAdsgramAdWithCaptcha() {
    if (!canClickAd()) {
        showNotification("Please wait 3 seconds before clicking again.", "warning");
        return;
    }
    
    const isAllowed = await checkBeforeAction("watch ad");
    if (!isAllowed) return;
    
    const needsCaptcha = incrementAdCounter();
    const captchaCheck = await checkCaptchaRequirement('adsgram');
    
    if (needsCaptcha || (captchaCheck.requireCaptcha && captchaConfig.captchaEnabled)) {
        showCaptcha(async (success, message) => {
            if (success) {
                await originalHandleAdsgramAd();
            } else {
                showNotification("âŒ " + (message || 'CAPTCHA verification required'), "error");
            }
        });
    } else {
        await originalHandleAdsgramAd();
    }
}

// Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£ØµÙ„ÙŠØ©
handleMonetagAd = handleMonetagAdWithCaptcha;
handleGigaAd = handleGigaAdWithCaptcha;
handleAdsgramAd = handleAdsgramAdWithCaptcha;

// ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙƒØ§Ø¨ØªØ´Ø§ Ø¹Ù†Ø¯ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©
window.addEventListener('DOMContentLoaded', () => {
    setTimeout(() => {
        loadCaptchaConfig();
    }, 2000);
});

// âœ… 1. Ø¯Ø§Ù„Ø© ØµÙØ­Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ© (10 Ø«ÙˆØ§Ù†Ù)
let loadingProgress = 0;
let loadingSeconds = 10;
let loadingTimerInterval;

function startGlobalLoading() {
    const loadingPage = document.getElementById('global-loading-page');
    const progressBar = document.getElementById('loading-progress-bar');
    const timerElement = document.getElementById('loading-timer');
    
    if (!loadingPage || !progressBar || !timerElement) return;
    
    // Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰
    document.getElementById('security-verification').style.display = 'none';
    document.getElementById('blocked-access').style.display = 'none';
    document.getElementById('app-container').style.display = 'none';
    
    // Ø¥Ø¸Ù‡Ø§Ø± ØµÙØ­Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
    loadingPage.style.display = 'flex';
    
    // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¤Ù‚Øª
    loadingTimerInterval = setInterval(() => {
        loadingSeconds--;
        
        if (loadingSeconds <= 0) {
            loadingSeconds = 0;
            timerElement.textContent = "Complete!";
        } else {
            timerElement.textContent = loadingSeconds + " second" + (loadingSeconds !== 1 ? 's' : '');
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
        loadingProgress = ((10 - loadingSeconds) / 10) * 100;
        progressBar.style.width = loadingProgress + '%';
        
        // Ø¹Ù†Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª
        if (loadingSeconds <= 0) {
            clearInterval(loadingTimerInterval);
            finishLoading();
        }
    }, 1000);
}

// âœ… Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¸Ø± Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
async function checkUserBlockStatus() {
    try {
        const userId = window.Telegram?.WebApp?.initDataUnsafe?.user?.id;
        if (!userId) return null;
        
        const result = await callAPI('checkUserBlocked');
        return result;
    } catch (error) {
        console.error("Block check error:", error);
        return null;
    }
}

// âœ… Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù‚Ø¨Ù„ Ø£ÙŠ Ø¥Ø¬Ø±Ø§Ø¡
async function checkBeforeAction(actionName) {
    const blockCheck = await checkUserBlockStatus();
    if (blockCheck && blockCheck.success === false && blockCheck.error === 'ACCOUNT_BLOCKED') {
        console.log("Account blocked for action:", actionName);
        showNotification("Your account has been blocked.", "error");
        return false;
    }
    return true;
}

// âœ… Ù…ØªØºÙŠØ±Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„ØªÙƒØ±Ø§Ø±
let isCompetitionDataLoaded = false;
let competitionUpdateInterval = null;
let lastLeaderboardUpdate = 0;
const LEADERBOARD_UPDATE_INTERVAL = 60000; // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
let isCompetitionPageVisible = false;

// âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ…
// âœ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ: Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠ ÙÙŠ Ø§Ù„Ù‚Ù†ÙˆØ§Øª - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…ØµØ­Ø­
// âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ…
async function checkMandatorySubscriptions() {
    const userId = window.Telegram?.WebApp?.initDataUnsafe?.user?.id;
    if (!userId) return false;
    
    try {
        const result = await callAPI('checkMandatorySubscriptions', { userId: userId });
        
        console.log("Subscription check result:", result); // Ù„Ù„ØªØµØ­ÙŠØ­
        
        if (result.success && result.data) {
            // âœ… âœ… âœ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ù‡Ù†Ø§: Ø§Ø³ØªØ®Ø¯Ø§Ù… allSubscribed Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† subscribed âœ… âœ… âœ…
            if (result.data.allSubscribed === true) {
                console.log("User is subscribed to all channels");
                return true;
            }
            
            // âœ… âœ… âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ø£ÙŠØ¶Ø§Ù‹ Ù…Ù† subscriptionStatus Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
            if (result.data.subscriptionStatus) {
                const subscriptionStatus = result.data.subscriptionStatus;
                const allSubscribed = Object.values(subscriptionStatus).every(status => status === true);
                if (allSubscribed) {
                    console.log("User is subscribed to all channels (via subscriptionStatus)");
                    return true;
                }
            }
            
            console.log("User is NOT subscribed to all channels:", result.data);
            return false;
        } else if (result.success === false && result.error === 'MANDATORY_SUBSCRIPTION_REQUIRED') {
            console.log("Mandatory subscription required, showing subscription screen");
            return false;
        }
        
        return false;
    } catch (error) {
        console.error("Subscription check error:", error);
        return false;
    }
}

// âœ… Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠ
function showMandatorySubscriptionScreen() {
    const requiredChannels = [
        {
            username: '@earnmoney174688',
            link: 'https://t.me/earnmoney174688',
            name: 'News Channel',
            description: 'Latest updates & announcements'
        },
        {
            username: '@earnmoney1685',
            link: 'https://t.me/earnmoney1685',
            name: 'Codes Channel',
            description: 'Daily promo codes & rewards'
        },
        {
            username: '@earnmoney139482',
            link: 'https://t.me/earnmoney139482',
            name: 'Payments Channel',
            description: 'Track payments & withdrawals'
        },
        {
            username: '@EarnMoneyWithRedone',
            link: 'https://t.me/EarnMoneyWithRedone',
            name: 'Partner Channel',
            description: 'Bot partner channel'
        }
    ];
    
    let channelsHTML = '';
    requiredChannels.forEach(channel => {
        channelsHTML += `<div class="support-channel-card" onclick="window.open('${channel.link}','_blank')" style="margin-bottom:10px;">
            <div style="display:flex;align-items:center;gap:12px;">
                <div style="width:50px;height:50px;background:linear-gradient(135deg,#a855f7,#7c3aed);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:24px;color:white;">
                    <i class="fab fa-telegram"></i>
                </div>
                <div style="flex:1;">
                    <div style="font-size:14px;font-weight:700;color:white;margin-bottom:5px;">${channel.name}</div>
                    <div style="font-size:11px;color:var(--text-muted);margin-bottom:3px;">${channel.description}</div>
                    <div style="font-size:10px;color:#FFC107;">
                        <i class="fa-solid fa-users"></i> ${channel.username}
                    </div>
                </div>
                <div style="color:var(--primary-green);font-size:18px;">
                    <i class="fa-solid fa-external-link-alt"></i>
                </div>
            </div>
        </div>`;
    });
    
    const subscriptionHTML = `
    <div style="padding:20px;max-width:500px;margin:0 auto;min-height:100vh;display:flex;flex-direction:column;justify-content:center;">
        <div class="card" style="text-align:center;">
            <img src="https://i.ibb.co/tTkJX1Qy/logo.png" alt="GLX Galaxy" style="width:80px;height:80px;border-radius:50%;margin-bottom:15px;border:3px solid var(--primary-green);">
            <h1 style="font-size:24px;margin-bottom:8px;color:#fff;">âš ï¸ Subscription Required</h1>
            <p style="color:var(--text-muted);margin-bottom:20px;font-size:14px;">
                You must subscribe to all channels below to access GLX Galaxy
            </p>
            
            <div style="background:rgba(231,76,60,0.1);border:1px solid rgba(231,76,60,0.3);border-radius:12px;padding:12px;margin-bottom:20px;">
                <div style="display:flex;align-items:center;gap:10px;">
                    <div style="color:#e74c3c;font-size:18px;"><i class="fa-solid fa-triangle-exclamation"></i></div>
                    <div style="font-size:12px;color:#e74c3c;">
                        <strong>Important:</strong> Join all channels and stay subscribed to use the bot
                    </div>
                </div>
            </div>
            
            <div style="text-align:left;margin-bottom:25px;">
                <h2 style="font-size:16px;color:var(--gold);margin-bottom:15px;display:flex;align-items:center;gap:8px;">
                    <i class="fa-solid fa-list-check"></i> Required Channels (4)
                </h2>
                ${channelsHTML}
            </div>
            
            <button class="btn btn-primary" onclick="verifySubscriptions()" style="margin-bottom:10px;padding:15px;">
                <i class="fa-solid fa-check-circle"></i> I'VE SUBSCRIBED TO ALL CHANNELS
            </button>
            
            <p style="font-size:11px;color:var(--text-muted);margin-top:15px;">
                After subscribing, click the button above to verify
            </p>
        </div>
    </div>`;
    
    document.getElementById('app-container').innerHTML = subscriptionHTML;
    document.getElementById('app-container').style.display = 'block';
}

// âœ… Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª
async function verifySubscriptions() {
    const userId = window.Telegram?.WebApp?.initDataUnsafe?.user?.id;
    if (!userId) return;
    
    const verifyBtn = document.querySelector('button[onclick="verifySubscriptions()"]');
    if (verifyBtn) {
        verifyBtn.disabled = true;
        verifyBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> VERIFYING...';
    }
    
    showNotification("â³ Verifying your subscriptions...", "info");
    
    try {
        const result = await callAPI('checkMandatorySubscriptions', { userId: userId });
        
        if (result.success && result.data) {
            // âœ… âœ… âœ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ù‡Ù†Ø§ Ø£ÙŠØ¶Ø§Ù‹: Ø§Ø³ØªØ®Ø¯Ø§Ù… allSubscribed Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† subscribed âœ… âœ… âœ…
            if (result.data.allSubscribed === true) {
                showNotification("âœ… All subscriptions verified! Loading app...", "success");
                
                // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
                setTimeout(() => {
                    location.reload();
                }, 2000);
                
            } else {
                const unsubscribedChannels = result.data?.missingChannels || [];
                let errorMessage = "You need to subscribe to all channels:";
                
                unsubscribedChannels.forEach(channel => {
                    errorMessage += `\n- ${channel}`;
                });
                
                showNotification(errorMessage, "error");
                
                if (verifyBtn) {
                    verifyBtn.disabled = false;
                    verifyBtn.innerHTML = '<i class="fa-solid fa-check-circle"></i> I\'VE SUBSCRIBED TO ALL CHANNELS';
                }
            }
        } else {
            showNotification("Error verifying subscriptions. Please try again.", "error");
            
            if (verifyBtn) {
                verifyBtn.disabled = false;
                verifyBtn.innerHTML = '<i class="fa-solid fa-check-circle"></i> I\'VE SUBSCRIBED TO ALL CHANNELS';
            }
        }
    } catch (error) {
        console.error("Verification error:", error);
        showNotification("Error verifying subscriptions. Please try again.", "error");
        
        if (verifyBtn) {
            verifyBtn.disabled = false;
            verifyBtn.innerHTML = '<i class="fa-solid fa-check-circle"></i> I\'VE SUBSCRIBED TO ALL CHANNELS';
        }
    }
}

async function finishLoading() {
    const loadingPage = document.getElementById('global-loading-page');
    
    try {
        // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø£ÙˆÙ„Ø§Ù‹
        const isSubscribed = await checkMandatorySubscriptions();
        
        if (!isSubscribed) {
            if (loadingPage) {
                loadingPage.style.display = 'none';
            }
            showMandatorySubscriptionScreen();
            return;
        }
        
        // âœ… Ø§Ù„Ø³Ù…Ø§Ø­ ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…ÙØªÙˆØ­Ø§Ù‹ Ù…Ù† Ø®Ù„Ø§Ù„ Telegram
        const isTelegramEnv = window.location.hostname.includes('web.telegram.org') || 
                             window.location.hostname.includes('t.me') ||
                             (window.Telegram && window.Telegram.WebApp);
        
        if (!isTelegramEnv) {
            console.log("Not in Telegram environment, but continuing anyway");
            // Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
        }
        
        // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ø³ØªØ®Ø¯Ù… Telegram
        if (window.Telegram?.WebApp?.initDataUnsafe?.user) {
            const tgUser = window.Telegram.WebApp.initDataUnsafe.user;
            
            // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø¸Ø± Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
            const blockCheck = await checkUserBlockStatus();
            
            if (blockCheck && blockCheck.success === false && blockCheck.error === 'ACCOUNT_BLOCKED') {
                const blockedMessage = blockCheck.data?.blockedMessage || 
                                     "Your account has been suspended due to violation of our terms of service.";
                console.log("Account blocked:", blockedMessage);
                showNotification(blockedMessage, "error");
                return;
            }
            
            // âœ… ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
            try {
                const checkResult = await simulateAccountCheck(tgUser.id.toString());
                
                if (checkResult.blocked) {
                    console.log("Account blocked by security check");
                    showNotification("Your account has been suspended.", "error");
                    return;
                }
            } catch (error) {
                console.error("Account check error:", error);
            }
        } else {
            console.log("Telegram user authentication failed");
        }
        
        // âœ… Ø¹Ø±Ø¶ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
        showMainApp();
        
    } catch (error) {
        console.error("Loading error:", error);
        showMainApp();
        showNotification("Loading completed with some limitations.", "warning");
    } finally {
        if (loadingPage) {
            loadingPage.style.display = 'none';
        }
    }
}

// âœ… Ø¯Ø§Ù„Ø© Ù…Ø­Ø§ÙƒØ§Ø© ÙØ­Øµ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
async function simulateAccountCheck(userId) {
    // Ù…Ø­Ø§ÙƒØ§Ø© ØªØ£Ø®ÙŠØ± Ø§Ù„Ø´Ø¨ÙƒØ©
    await new Promise(resolve => setTimeout(resolve, 1000));
    
    // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ø³ØªØ¬Ø§Ø¨Ø© API Ù…Ø¹ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¸Ø±
    return {
        blocked: false, // Ù…Ø¹Ø¸Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ØºÙŠØ± Ù…Ø­Ø¸ÙˆØ±ÙŠÙ†
        status: "active",
        lastLogin: Date.now(),
        isBlocked: false
    };
}

// âœ… ØªØ¹Ø¯ÙŠÙ„ Ø¯Ø§Ù„Ø© callAPI Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø­Ø¸Ø±
const API_URL = "https://silent-block-bedf.ahmedrabieharoun.workers.dev";

async function callAPI(action, data = {}) {
    try {
        const userId = window.Telegram?.WebApp?.initDataUnsafe?.user?.id;
        const response = await fetch(`${API_URL}/api`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-User-ID': userId || '',
                'X-Telegram-Data': window.Telegram?.WebApp?.initData || '',
                'X-Action': action
            },
            body: JSON.stringify({
                action: action,
                data: data,
                userId: userId,
                timestamp: Date.now()
            })
        });
        
        if (!response.ok) {
            throw new Error(`API Error: ${response.status}`);
        }
        
        const result = await response.json();
        
        // âœ… Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø­Ø¸Ø± Ø¨Ø´ÙƒÙ„ Ø®Ø§Øµ
        if (!result.success && result.error && result.error === 'ACCOUNT_BLOCKED') {
            console.log("Account blocked:", result.data?.blockedMessage);
            showNotification("Your account has been blocked.", "error");
            return { success: false, error: 'ACCOUNT_BLOCKED', data: result.data };
        }
        
        if (!result.success && result.error && result.error.includes('Connection error')) {
            console.log("Connection error");
            showNotification("Connection error. Please try again.", "error");
            return { success: false, error: result.error };
        }
        
        // âœ… Ù…Ø¹Ø§Ù„Ø¬Ø© Ø®Ø§ØµØ© Ù„Ø¹Ù…Ù„Ø© Coin Flip
        if (action === 'flipCoin' && result.success) {
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠØ©
            if (!result.data.currentBalance) {
                result.data.currentBalance = result.data.newBalance || result.data.finalBalance;
            }
        }
        
        if (action === 'getCompetitionData' && result.success) {
            if (result.data.competitionData && !result.data.competitionData.userTickets) {
                result.data.competitionData.userTickets = {};
            }
        }
        
        return result;
    } catch (error) {
        console.error('API call failed:', error);
        
        // âœ… ØªØµÙ†ÙŠÙ Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„
        if (error.message && error.message.includes('Connection error') || 
            error.message && error.message.includes('Failed to fetch')) {
            console.log("Connection error occurred");
            showNotification("Connection error. Please try again.", "error");
        } else {
            showNotification("Connection error. Please try again.", "error");
        }
        
        return { success: false, error: error.message };
    }
}

// âœ… Ø¥ØµÙ„Ø§Ø­ Ø¯Ø§Ù„Ø© Ù„Ø¹Ø¨Ø© Coin Flip (ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø¨ÙƒØ±)
async function flipCoin() {
    if (coinGame.isFlipping) return;
    
    const betAmount = coinGame.betAmount;
    const currentBalance = appData.dogsBalance || 0;
    
    if (betAmount < 1000) {
        showNotification("Minimum bet is 1,000 GLX", "warning");
        return;
    }
    
    if (betAmount > currentBalance) {
        showNotification("Insufficient GLX balance", "warning");
        return;
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø¸Ø± Ø£ÙˆÙ„Ø§Ù‹
    const isAllowed = await checkBeforeAction("flip coin");
    if (!isAllowed) return;
    
    // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø²Ø± Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
    const flipButton = document.getElementById('flip-coin-btn');
    if (flipButton) {
        flipButton.disabled = true;
        flipButton.classList.add('coin-flip-btn-processing');
        flipButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> PROCESSING...';
    }
    
    coinGame.isFlipping = true;
    
    try {
        // âœ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ± Ù„Ù„Ø¹Ø¨
        const result = await callAPI('flipCoin', {
            betAmount: betAmount,
            chosenSide: coinGame.chosenSide
        });
        
        if (result.success) {
            const isWin = result.data.isWin;
            const resultSide = result.data.resultSide;
            const winAmount = result.data.winAmount || 0;
            const betAmountNum = result.data.betAmount || betAmount;
            
            // âœ… ØªØ­Ø¯ÙŠØ« appData Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø¬Ø¹Ø© Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
            appData.dogsBalance = result.data.currentBalance;
            
            // âœ… ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            renderUI({ id: window.Telegram?.WebApp?.initDataUnsafe?.user?.id });
            
            // âœ… Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© Ù„Ù„Ø¹Ù…Ù„Ø©
            const coin = document.getElementById('coin');
            if (coin) {
                coin.classList.remove('coin-spinning', 'coin-final');
                coin.style.transition = 'transform 2.5s cubic-bezier(0.4,2.4,0.8,0.9)';
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¯ÙˆØ±Ø§Ù† Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
                const finalRotation = resultSide === 'glx' ? 720 : 900;
                coin.style.setProperty('--final-rotation', finalRotation + 'deg');
                coin.classList.add('coin-spinning');
                
                setTimeout(() => {
                    coin.classList.remove('coin-spinning');
                    coin.classList.add('coin-final');
                    coin.style.transform = `rotateY(${finalRotation}deg)`;
                    
                    // âœ… Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù…Ø¹ ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­/Ø§Ù„Ø®Ø³Ø§Ø±Ø©
                    showCoinFlipResult(isWin, resultSide, betAmountNum, winAmount, finalRotation);
                    
                    // âœ… Ø§Ù„Ø¢Ù† ÙÙ‚Ø· ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ù…ØªØ­Ø±ÙƒØ©
                    if (isWin) {
                        const netProfit = winAmount - betAmountNum;
                        setTimeout(() => {
                            showNotification(`ðŸŽ‰ You won ${winAmount.toLocaleString()} GLX! (Net Profit: +${netProfit.toLocaleString()} GLX)`, "success");
                        }, 500);
                    } else {
                        setTimeout(() => {
                            showNotification(`ðŸ˜¢ You lost ${betAmountNum.toLocaleString()} GLX`, "error");
                        }, 500);
                    }
                    
                }, 2500);
            }
            
        } else {
            if (result.error === 'ACCOUNT_BLOCKED') {
                showNotification("Your account has been blocked.", "error");
            } else {
                showNotification("Error: " + result.error, "error");
            }
        }
    } catch (error) {
        console.error("Coin flip error:", error);
        showNotification("Error flipping coin. Please try again.", "error");
    } finally {
        // âœ… ØªÙ…ÙƒÙŠÙ† Ø§Ù„Ø²Ø± Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
        setTimeout(() => {
            coinGame.isFlipping = false;
            if (flipButton) {
                flipButton.disabled = false;
                flipButton.classList.remove('coin-flip-btn-processing');
                flipButton.innerHTML = '<i class="fa-solid fa-play"></i> FLIP COIN';
            }
        }, 3000);
    }
}

// âœ… ØªØ¹Ø¯ÙŠÙ„ Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù„ØªØ¹ÙƒØ³ ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­/Ø§Ù„Ø®Ø³Ø§Ø±Ø©
function showCoinFlipResult(isWin, resultSide, betAmount, winAmount, finalRotation) {
    const resultElement = document.getElementById('coin-game-result');
    const resultText = document.getElementById('coin-result-text');
    const winAmountElement = document.getElementById('coin-win-amount');
    const lossAmountElement = document.getElementById('coin-loss-amount');
    
    winAmountElement.style.display = 'none';
    lossAmountElement.style.display = 'none';
    
    if (isWin) {
        const netProfit = winAmount - betAmount;
        resultText.innerHTML = `ðŸŽ‰ <strong>YOU WIN!</strong><br>${coinGame.chosenSide.toUpperCase()} appeared!<br><small>Net Profit: <span class="net-profit">+${netProfit.toLocaleString()} GLX</span></small>`;
        resultText.style.color = '#27ae60';
        winAmountElement.innerHTML = `+${winAmount.toLocaleString()} GLX<br><small style="font-size:12px;opacity:0.8;">(Bet: ${betAmount.toLocaleString()} GLX)</small>`;
        winAmountElement.style.display = 'block';
        
        // ØªØ£Ø«ÙŠØ± Ø§Ù„ÙÙˆØ²
        const selectedBtn = coinGame.chosenSide === 'glx' ? document.getElementById('choose-glx') : document.getElementById('choose-gold');
        selectedBtn.classList.add('win');
        selectedBtn.classList.remove('active');
    } else {
        resultText.innerHTML = `ðŸ˜¢ <strong>YOU LOSE</strong><br>${resultSide.toUpperCase()} appeared<br><small>Loss: <span class="net-loss">${betAmount.toLocaleString()} GLX</span></small>`;
        resultText.style.color = '#e74c3c';
        lossAmountElement.textContent = `-${betAmount.toLocaleString()} GLX`;
        lossAmountElement.style.display = 'block';
        
        // ØªØ£Ø«ÙŠØ± Ø§Ù„Ø®Ø³Ø§Ø±Ø©
        const selectedBtn = coinGame.chosenSide === 'glx' ? document.getElementById('choose-glx') : document.getElementById('choose-gold');
        selectedBtn.classList.add('lose');
        selectedBtn.classList.remove('active');
    }
    
    resultElement.style.display = 'block';
}

// âœ… ØªØ¹Ø¯ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø­Ø³Ø§Ø³Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¸Ø± Ø£ÙˆÙ„Ø§Ù‹
async function handleDailyClaim() {
    // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¸Ø± Ø£ÙˆÙ„Ø§Ù‹
    const isAllowed = await checkBeforeAction("claim daily bonus");
    if (!isAllowed) return;
    
    const claimButton = document.getElementById('claim-daily-btn');
    if (!claimButton) return;
    
    // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø²Ø±
    claimButton.disabled = true;
    claimButton.classList.add('btn-processing');
    claimButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> PROCESSING...';
    
    try {
        const result = await callAPI('claimDailyBonus');
        if (result.success) {
            appData.lastDailyClaim = result.data.lastDailyClaim;
            appData.dailyStreak = result.data.dailyStreak;
            appData.dogsBalance = result.data.newBalance;
            
            showNotification(`ðŸŽ‰ Daily bonus claimed! +${result.data.reward} GLX`, "success");
            renderDailyBonusUI();
            renderUI({ id: window.Telegram?.WebApp?.initDataUnsafe?.user?.id });
        } else {
            if (result.error === 'ACCOUNT_BLOCKED') {
                showNotification("Your account has been blocked.", "error");
            } else {
                showNotification("Error: " + result.error, "error");
            }
        }
    } catch (error) {
        console.error("Daily claim error:", error);
        showNotification("Error claiming daily bonus", "error");
    } finally {
        // ØªÙ…ÙƒÙŠÙ† Ø§Ù„Ø²Ø± Ø¨Ø¹Ø¯ 2 Ø«Ø§Ù†ÙŠØ©
        setTimeout(() => {
            if (claimButton) {
                claimButton.disabled = false;
                claimButton.classList.remove('btn-processing');
                claimButton.textContent = "Claim Bonus";
            }
        }, 2000);
    }
}

// âœ… Ø¨Ù‚ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±
const SECURITY_CONFIG = {
    errorStyle: {
        background: 'rgba(231,76,60,0.1)',
        border: '1px solid rgba(231,76,60,0.3)',
        color: '#e74c3c',
        borderRadius: '12px',
        padding: '15px',
        margin: '15px 0'
    },
    warningStyle: {
        background: 'rgba(255,193,7,0.1)',
        border: '1px solid rgba(255,193,7,0.3)',
        color: '#FFC107',
        borderRadius: '12px',
        padding: '15px',
        margin: '15px 0'
    },
    successStyle: {
        background: 'rgba(39,174,96,0.1)',
        border: '1px solid rgba(39,174,96,0.3)',
        color: '#27ae60',
        borderRadius: '12px',
        padding: '15px',
        margin: '15px 0'
    },
    infoStyle: {
        background: 'rgba(52,152,219,0.1)',
        border: '1px solid rgba(52,152,219,0.3)',
        color: '#3498db',
        borderRadius: '12px',
        padding: '15px',
        margin: '15px 0'
    }
};

// ðŸ”„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: ØªØ­Ø¯ÙŠØ« APP_CONFIG Ù„ØªØºÙŠÙŠØ± Ù‚ÙŠÙ…Ø© Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„Ø¥Ø­Ø§Ù„Ø© Ø¥Ù„Ù‰ 100000
const APP_CONFIG = {
    botUsername: 'RealEarnBot_bot',
    botWallet: 'UQB2IqqJtC8NtRgxksq80c_FC8RqShxpGDKA3e4aJFwjvwgv',
    botToken: '7066931017:AAHwuXbgaKHNrHrbf6jaoC8LDk0lSCPimgI',
    defaultSettings: {
        adRewardMonetag: 500, // ØªØºÙŠÙŠØ± Ù…Ù† 1000 Ø¥Ù„Ù‰ 500
        adRewardGiga: 500,    // ØªØºÙŠÙŠØ± Ù…Ù† 2000 Ø¥Ù„Ù‰ 500
        adRewardAdsgram: 500, // ØªØºÙŠÙŠØ± Ù…Ù† 2000 Ø¥Ù„Ù‰ 500
        limitMonetag: 50,
        limitGiga: 300,
        limitAdsgram: 300,
        minTonWithdrawal: 0.05,
        minFaucetPayWithdrawal: 0.0001,
        // ðŸ”„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: ØªØºÙŠÙŠØ± Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„Ø¥Ø­Ø§Ù„Ø© Ù…Ù† 10000 Ø¥Ù„Ù‰ 100000
        referralReward: 100000,
        pricePerClick: 0.0015,
        glxToTonRate: 0.0000001,
        tonToGlxRate: 10000000,
        ticketPrice: 10000, // âœ… ØªØºÙŠÙŠØ± Ù…Ù† 10000 Ø¥Ù„Ù‰ 10000 (10K GLX)
        ticketTonValue: 0.0001, // âœ… ØªØºÙŠÙŠØ± Ù…Ù† 0.001 Ø¥Ù„Ù‰ 0.0001 (0.0001 TON)
        competitionDuration: 24 * 60 * 60 * 1000,
        breakDuration: 60 * 60 * 1000,
        dailyRewards: [2000, 3000, 5000, 7000, 9000, 12000, 15000],
        coinFlipWinChance: 45,
        slotsPayouts: {
            'ðŸŒŸðŸŒŸðŸŒŸ': 10000,
            'ðŸªðŸªðŸª': 5000,
            'ðŸ’«ðŸ’«ðŸ’«': 2500,
            'â­â­â­': 1200,
            'ðŸŒŸðŸŒŸ': 700,
            'default': 500
        },
        promoCodeRewards: 5000,
        dailyWithdrawalLimit: 2 // âœ… Ø¥Ø¶Ø§ÙØ© Ø­Ø¯ Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„ÙŠÙˆÙ…ÙŠ
    }
};

const BOT_USERNAME = APP_CONFIG.botUsername;
const BOT_WALLET = APP_CONFIG.botWallet;
const BOT_TOKEN = APP_CONFIG.botToken;

const firebaseConfig = {
    apiKey: "YOUR_API_KEY_HERE",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
};

let db = null;
try {
    if (firebase && firebase.initializeApp) {
        firebase.initializeApp(firebaseConfig);
        db = firebase.firestore();
        console.log("âœ… Firebase initialized successfully");
    }
} catch (error) {
    console.error("âŒ Firebase initialization error:", error);
}

// âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ…
// âœ… Ù†Ø¸Ø§Ù… Ø¨ØµÙ…Ø© Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ù…Ø­Ø³Ù† ÙˆØ§Ù„Ù…Ø³ØªÙ‚Ù„ Ø¹Ù† Ø§Ù„Ù€ IP
// âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ…
async function generateDeviceFingerprint() {
    const components = [];
    try {
        // âœ… Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù€ IP Ø£Ùˆ Ø§Ù„Ø´Ø¨ÙƒØ©
        // âœ… Ø§Ù„ØªØ±ÙƒÙŠØ² ÙÙ‚Ø· Ø¹Ù„Ù‰ Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ø«Ø§Ø¨ØªØ©
        
        // 1. Ø®ØµØ§Ø¦Øµ Ø§Ù„Ù…ØªØµÙØ­ ÙˆØ§Ù„Ù†Ø¸Ø§Ù…
        components.push(navigator.userAgent);
        components.push(navigator.platform);
        components.push(navigator.language);
        components.push(navigator.languages ? navigator.languages.join(',') : '');
        
        // 2. Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø´Ø§Ø´Ø©
        components.push(`${screen.width}x${screen.height}x${screen.colorDepth}x${screen.pixelDepth}`);
        components.push(`${window.innerWidth}x${window.innerHeight}`);
        
        // 3. Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø¬Ù‡Ø§Ø²
        components.push(navigator.hardwareConcurrency || 'unknown');
        components.push(navigator.deviceMemory || 'unknown');
        components.push('ontouchstart' in window);
        components.push('ondevicemotion' in window);
        
        // 4. Ø®ØµØ§Ø¦Øµ WebGL (ÙØ±ÙŠØ¯Ø© Ù„ÙƒÙ„ Ø¬Ù‡Ø§Ø²)
        if (window.WebGLRenderingContext) {
            const canvas = document.createElement('canvas');
            const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
            if (gl) {
                const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                if (debugInfo) {
                    components.push(gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL));
                    components.push(gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL));
                }
                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø®ØµØ§Ø¦Øµ WebGL Ø§Ù„ÙØ±ÙŠØ¯Ø©
                components.push(gl.getParameter(gl.VERSION));
                components.push(gl.getParameter(gl.SHADING_LANGUAGE_VERSION));
            }
        }
        
        // 5. Ø®ØµØ§Ø¦Øµ Ø§Ù„ØµÙˆØª (Ø¥Ø°Ø§ Ù…ØªØ§Ø­Ø©)
        if (window.AudioContext) {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            components.push(audioContext.sampleRate);
            audioContext.close();
        }
        
        // 6. Ø®ØµØ§Ø¦Øµ Ø§Ù„ØªØ®Ø²ÙŠÙ†
        components.push(navigator.cookieEnabled);
        components.push('localStorage' in window);
        components.push('sessionStorage' in window);
        components.push('indexedDB' in window);
        
        // 7. Ø®ØµØ§Ø¦Øµ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª (Ù…Ù† Ø£Ø¬Ù„ Ø§Ù„ØªÙ†ÙˆÙŠØ¹ ÙÙ‚Ø·)
        const now = new Date();
        components.push(now.getTimezoneOffset());
        components.push(Intl.DateTimeFormat().resolvedOptions().timeZone || 'unknown');
        
        // 8. Ø®ØµØ§Ø¦Øµ Ø¥Ø¶Ø§ÙÙŠØ©
        components.push(navigator.doNotTrack || 'unknown');
        components.push('geolocation' in navigator);
        components.push('mediaDevices' in navigator);
        components.push('bluetooth' in navigator);
        
        // âœ… Ø®Ù„Ø· ÙˆØªØ´ÙÙŠØ± Ø§Ù„Ø¨ØµÙ…Ø©
        const fingerprintString = components.join('|');
        console.log("Raw fingerprint components:", components); // Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„ØªØµØ­ÙŠØ­
        
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© SHA-256 Ù„Ù„ØªØ´ÙÙŠØ±
        const encoder = new TextEncoder();
        const data = encoder.encode(fingerprintString);
        const hashBuffer = await crypto.subtle.digest('SHA-256', data);
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        const fingerprint = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        
        console.log("Generated Device Fingerprint:", fingerprint);
        return fingerprint;
        
    } catch (error) {
        console.error("Error generating fingerprint:", error);
        // Ø¨ØµÙ…Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù…ØªØµÙØ­ ÙÙ‚Ø·
        const fallbackComponents = [
            navigator.userAgent,
            navigator.platform,
            screen.width + 'x' + screen.height,
            navigator.language
        ];
        const fallbackString = fallbackComponents.join('|');
        const fallbackFingerprint = btoa(fallbackString).slice(0, 64);
        return fallbackFingerprint;
    }
}

function showNotification(message, type = 'info', duration = 5000) {
    const notification = document.createElement('div');
    notification.className = `notification-message notification-${type}`;
    notification.innerHTML = `<div style="font-size:14px;font-weight:600;">${message}</div>`;
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.animation = 'fadeOut 0.3s ease';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }, duration);
}

function showStyledMessage(message, type = 'error', containerId = 'app-container') {
    const container = document.getElementById(containerId);
    if (!container) return;
    
    const existingMsg = container.querySelector('.security-message');
    if (existingMsg) existingMsg.remove();
    
    const messageDiv = document.createElement('div');
    messageDiv.className = 'security-message';
    const style = SECURITY_CONFIG[type + 'Style'] || SECURITY_CONFIG.errorStyle;
    Object.assign(messageDiv.style, style);
    
    let icon = 'âŒ';
    if (type === 'warning') icon = 'âš ï¸';
    if (type === 'success') icon = 'âœ…';
    if (type === 'info') icon = 'â„¹ï¸';
    
    messageDiv.innerHTML = `<div style="display:flex;align-items:center;gap:10px;font-size:14px;"><div style="font-size:20px;">${icon}</div><div>${message}</div></div>`;
    container.insertBefore(messageDiv, container.firstChild);
    
    setTimeout(() => {
        if (messageDiv.parentNode) {
            messageDiv.style.opacity = '0';
            messageDiv.style.transition = 'opacity 0.5s';
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.parentNode.removeChild(messageDiv);
                }
            }, 500);
        }
    }, 5000);
    
    return messageDiv;
}

function isTelegramMobileApp() {
    const userAgent = navigator.userAgent.toLowerCase();
    return userAgent.includes('telegram') || userAgent.includes('webview');
}

function isTelegramWeb() {
    const hostname = window.location.hostname;
    return hostname.includes('web.telegram.org') || hostname.includes('t.me') || hostname.includes('telegram.me');
}

function createVerificationStep(stepNumber, title, description, status = 'pending') {
    let icon = 'ðŸ”’';
    let statusIcon = '<div class="verification-loading"></div>';
    let statusClass = '';
    
    if (status === 'completed') {
        icon = 'âœ…';
        statusIcon = 'âœ“';
        statusClass = 'completed';
    } else if (status === 'failed') {
        icon = 'âŒ';
        statusIcon = 'âœ—';
        statusClass = 'failed';
    } else if (status === 'active') {
        icon = 'â³';
        statusClass = 'active';
    }
    
    return `<div class="verification-step ${statusClass}">
                <div class="step-icon">${icon}</div>
                <div class="step-info">
                    <div class="step-title">${title}</div>
                    <div class="step-description">${description}</div>
                </div>
                <div class="step-status">${statusIcon}</div>
            </div>`;
}

async function performSecurityVerification() {
    const stepsContainer = document.getElementById('verification-steps');
    const progressBar = document.getElementById('verification-progress-bar');
    const resultContainer = document.getElementById('verification-result');
    
    stepsContainer.innerHTML = createVerificationStep(1, 'Telegram Check', 'Verifying Telegram environment', 'active');
    progressBar.style.width = '20%';
    
    // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨ÙŠØ¦Ø© Telegram ÙÙ‚Ø·
    const isTelegramWeb = window.location.hostname.includes('web.telegram.org') || 
                         window.location.hostname.includes('t.me');
    const isTelegramWebApp = window.Telegram && window.Telegram.WebApp;
    
    if (!isTelegramWeb && !isTelegramWebApp) {
        console.log("Not in Telegram environment");
        return null;
    }
    
    stepsContainer.innerHTML = createVerificationStep(1, 'Telegram Check', 'Telegram environment verified', 'completed');
    progressBar.style.width = '40%';
    await new Promise(resolve => setTimeout(resolve, 800));
    
    stepsContainer.innerHTML += createVerificationStep(2, 'Device Security', 'Generating device fingerprint', 'active');
    progressBar.style.width = '60%';
    const deviceFingerprint = await generateDeviceFingerprint();
    console.log("Device Fingerprint:", deviceFingerprint);
    
    stepsContainer.innerHTML = createVerificationStep(1, 'Telegram Check', 'Telegram environment verified', 'completed');
    stepsContainer.innerHTML += createVerificationStep(2, 'Device Security', 'Device fingerprint generated', 'completed');
    progressBar.style.width = '80%';
    
    stepsContainer.innerHTML += createVerificationStep(3, 'User Authentication', 'Loading Telegram user data', 'active');
    progressBar.style.width = '100%';
    
    let user = null;
    let isExisting = false;
    
    if (window.Telegram?.WebApp?.initDataUnsafe?.user) {
        const tgUser = window.Telegram.WebApp.initDataUnsafe.user;
        user = {
            id: tgUser.id.toString(),
            first_name: tgUser.first_name,
            last_name: tgUser.last_name || '',
            username: tgUser.username || ''
        };
        isExisting = true;
        user.deviceFingerprint = deviceFingerprint;
        
        stepsContainer.innerHTML = createVerificationStep(1, 'Telegram Check', 'Telegram environment verified', 'completed');
        stepsContainer.innerHTML += createVerificationStep(2, 'Device Security', 'Device fingerprint generated', 'completed');
        stepsContainer.innerHTML += createVerificationStep(3, 'User Authentication', 'Telegram user authenticated', 'completed');
        
        resultContainer.innerHTML = `<div style="background:rgba(39,174,96,0.1);border:1px solid rgba(39,174,96,0.3);border-radius:12px;padding:15px;text-align:center;">
                                        <div style="font-size:20px;margin-bottom:10px;">âœ…</div>
                                        <div style="font-weight:700;color:#27ae60;margin-bottom:5px;">Security Verified</div>
                                        <div style="font-size:12px;color:var(--text-muted);">Welcome, ${user.first_name}!</div>
                                    </div>`;
    } else {
        stepsContainer.innerHTML = createVerificationStep(1, 'Telegram Check', 'Telegram environment verified', 'completed');
        stepsContainer.innerHTML += createVerificationStep(2, 'Device Security', 'Device fingerprint generated', 'completed');
        stepsContainer.innerHTML += createVerificationStep(3, 'User Authentication', 'Telegram user not found', 'failed');
        console.log("Telegram user authentication failed");
        return null;
    }
    
    await new Promise(resolve => setTimeout(resolve, 1500));
    return { user, isExisting, deviceFingerprint };
}

function showBlockedAccess(reason) {
    document.getElementById('security-verification').style.display = 'none';
    document.getElementById('blocked-access').style.display = 'block';
    document.getElementById('blocked-reason').innerHTML = reason;
}

function showMainApp() {
    document.getElementById('global-loading-page').style.display = 'none';
    document.getElementById('security-verification').style.display = 'none';
    document.getElementById('blocked-access').style.display = 'none';
    document.getElementById('app-container').style.display = 'block';
}

// âœ… ØªØ¹Ø¯ÙŠÙ„ Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ØªØ°Ø§ÙƒØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
const GLX_TO_TON_RATE = 0.0000001;
const TON_TO_GLX_RATE = 10000000;
const TICKET_PRICE = 10000; // âœ… ØªØºÙŠÙŠØ± Ù…Ù† 10000 Ø¥Ù„Ù‰ 10000 (10K GLX)
const TICKET_TON_VALUE = 0.001; // âœ… ØªØºÙŠÙŠØ± Ù…Ù† 0.001 Ø¥Ù„Ù‰ 0.0001 (0.0001 TON)
const COMPETITION_DURATION = 24 * 60 * 60 * 1000;
const BREAK_DURATION = 60 * 60 * 1000;
const ADSGRAM_BLOCK_ID = 'int-18879';

let appData = {};
let appSettings = { ...APP_CONFIG.defaultSettings };
let isAdScriptLoaded = false;
let isLeaderboardLoaded = false;
let AdController = null;
let selectedCategory = 'channel';
let selectedCount = 100;
let selectedCost = 0.15;
let currentTaskId = '';
let depositTransactionId = '';
let isSpinning = false;
const slotsSymbols = ['ðŸŒŸ', 'ðŸª', 'ðŸ’«', 'â­', 'ðŸš€', 'ðŸŒŒ'];
const slotsPayouts = {
    'ðŸŒŸðŸŒŸðŸŒŸ': 10000,
    'ðŸªðŸªðŸª': 5000,
    'ðŸ’«ðŸ’«ðŸ’«': 2500,
    'â­â­â­': 1200,
    'ðŸŒŸðŸŒŸ': 700,
    'default': 500
};

let coinGame = {
    isFlipping: false,
    chosenSide: 'glx',
    betAmount: 1000,
    lastFlipResult: null,
    winChance: 45,
    lossChance: 55,
    currentRotation: 0,
    animationId: null
};

let withdrawalType = 'faucetpay';
let swapDirection = 'glx_to_ton';
let countdownInterval = null;
let competitionData = {
    isActive: true,
    startTime: Date.now(),
    endTime: Date.now() + COMPETITION_DURATION,
    totalTickets: 0,
    prizePool: 0,
    userTickets: {},
    winners: []
};

let lastAdClickTime = 0;
const AD_CLICK_DELAY = 3000;

let gigaAdRequired = false;
let gigaAdCallback = null;

// âœ… Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„ÙŠÙˆÙ…ÙŠ
let dailyWithdrawals = {
    count: 0,
    lastReset: Date.now(),
    limit: 2
};

function showGigaAdBeforeAction(actionName, callback) {
    if (typeof window.showGiga === 'function') {
        gigaAdRequired = true;
        gigaAdCallback = callback;
        showNotification(`Please watch an ad to ${actionName}`, "info");
        window.showGiga()
            .then(() => {
                gigaAdRequired = false;
                if (gigaAdCallback) {
                    gigaAdCallback();
                    gigaAdCallback = null;
                }
            })
            .catch(() => {
                showNotification("Ad failed or was skipped", "warning");
                gigaAdRequired = false;
                gigaAdCallback = null;
            });
    } else {
        callback();
    }
}

function protectedDailyClaim() {
    if (gigaAdRequired) {
        showNotification("Please complete the ad first", "warning");
        return;
    }
    showGigaAdBeforeAction("claim daily bonus", handleDailyClaim);
}

async function handlePromoCode() {
    // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¸Ø± Ø£ÙˆÙ„Ø§Ù‹
    const isAllowed = await checkBeforeAction("redeem promo code");
    if (!isAllowed) return;
    
    const codeInput = document.getElementById('promo-code-input');
    const resultDiv = document.getElementById('promo-result');
    const redeemBtn = document.getElementById('redeem-code-btn');
    
    if (!codeInput || !resultDiv || !redeemBtn) return;
    
    const code = codeInput.value.trim().toUpperCase();
    if (!code) {
        showPromoResult('Please enter a promo code', 'error');
        return;
    }
    
    redeemBtn.disabled = true;
    redeemBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Checking...';
    
    const result = await callAPI('redeemPromoCode', { code: code });
    
    if (result.success) {
        const rewardType = result.data.rewardType || 'glx'; // 'glx', 'ton', or 'ticket'
        const reward = result.data.reward;
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ØµÙŠØ¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©
        if (rewardType === 'glx') {
            appData.dogsBalance = result.data.newBalance;
            showPromoResult(`ðŸŽ‰ Success! You got +${reward} GLX`, 'success');
        } else if (rewardType === 'ton') {
            appData.tonBalance = result.data.newTONBalance;
            showPromoResult(`ðŸŽ‰ Success! You got +${reward} TON`, 'success');
        } else if (rewardType === 'ticket') {
            appData.competitionTickets = (appData.competitionTickets || 0) + reward;
            showPromoResult(`ðŸŽ‰ Success! You got +${reward} Competition Ticket(s)`, 'success');
            
            // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©
            if (competitionData && competitionData.userTickets) {
                const userId = window.Telegram?.WebApp?.initDataUnsafe?.user?.id;
                if (userId) {
                    competitionData.userTickets[userId] = (competitionData.userTickets[userId] || 0) + reward;
                    competitionData.totalTickets = (competitionData.totalTickets || 0) + reward;
                    competitionData.prizePool = competitionData.totalTickets * TICKET_TON_VALUE;
                }
            }
        }
        
        codeInput.value = '';
        renderUI({ id: window.Telegram?.WebApp?.initDataUnsafe?.user?.id });
        
        // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙƒØ§ÙØ£Ø© ØªØ°Ø§ÙƒØ±
        if (rewardType === 'ticket') {
            updateCompetitionUI();
        }
    } else {
        if (result.error === 'ACCOUNT_BLOCKED') {
            showNotification("Your account has been blocked.", "error");
        } else {
            showPromoResult('âŒ ' + result.error, 'error');
        }
    }
    
    redeemBtn.disabled = false;
    redeemBtn.innerHTML = '<i class="fa-solid fa-gift"></i> Redeem';
}

function showPromoResult(message, type) {
    const resultDiv = document.getElementById('promo-result');
    if (!resultDiv) return;
    
    resultDiv.textContent = message;
    resultDiv.style.display = 'block';
    
    if (type === 'success') {
        resultDiv.style.background = 'rgba(39,174,96,0.2)';
        resultDiv.style.border = '1px solid rgba(39,174,96,0.5)';
        resultDiv.style.color = '#27ae60';
    } else if (type === 'error') {
        resultDiv.style.background = 'rgba(231,76,60,0.2)';
        resultDiv.style.border = '1px solid rgba(231,76,60,0.5)';
        resultDiv.style.color = '#e74c3c';
    } else {
        resultDiv.style.background = 'rgba(255,193,7,0.2)';
        resultDiv.style.border = '1px solid rgba(255,193,7,0.5)';
        resultDiv.style.color = '#FFC107';
    }
    
    setTimeout(() => {
        resultDiv.style.display = 'none';
    }, 5000);
}

async function fetchAppSettings() {
    if (!db) {
        console.log("Firebase not available, using default settings");
        return appSettings;
    }
    
    try {
        const doc = await db.collection('settings').doc('appSettings').get();
        if (doc.exists) {
            const firebaseSettings = doc.data();
            const updatedSettings = { ...appSettings, ...firebaseSettings };
            console.log("âœ… Settings loaded from Firebase:", updatedSettings);
            return updatedSettings;
        } else {
            console.log("No settings found in Firebase, using defaults");
            return appSettings;
        }
    } catch (error) {
        console.error("Error fetching settings from Firebase:", error);
        return appSettings;
    }
}

async function getUpdatedSettings() {
    const newSettings = await fetchAppSettings();
    appSettings = newSettings;
    return newSettings;
}

// âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ…
// âœ… Ø¯Ø§Ù„Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø­Ø³Ù†Ø© Ù…Ø¹ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨ØµÙ…Ø© Ø§Ù„Ø¬Ù‡Ø§Ø²
// âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ…
async function initializeUser(user, deviceFingerprint) {
    console.log("Initializing user with fingerprint:", deviceFingerprint);
    
    // âœ… Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨ØµÙ…Ø© Ø§Ù„Ø¬Ù‡Ø§Ø² Ø£ÙˆÙ„Ø§Ù‹
    try {
        const fingerprintCheck = await callAPI('checkDeviceFingerprint', {
            deviceFingerprint: deviceFingerprint,
            userId: user.id
        });
        
        if (fingerprintCheck.success) {
            if (fingerprintCheck.data && fingerprintCheck.data.isDuplicate) {
                console.log("Multiple accounts detected from same device");
                showNotification("âŒ This device is already associated with another account. Each device can only have one account.", "error");
                return;
            }
        }
    } catch (error) {
        console.error("Fingerprint check error:", error);
    }
    
    // âœ… Ø§Ù„Ø®Ø·ÙˆØ© 2: ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…
    const result = await callAPI('initializeUser', { 
        user, 
        deviceFingerprint: deviceFingerprint 
    });
    
    if (result.success) {
        appData = result.data.userData || {};
        await getUpdatedSettings();
        
        // âœ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„ÙŠÙˆÙ…ÙŠ
        await loadDailyWithdrawalsData();
        
        renderUI(user);
        renderDailyBonusUI();
        updateAvailableSpins();
        // ðŸ”„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: ØªØºÙŠÙŠØ± Ù‚ÙŠÙ…Ø© Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„Ø¥Ø­Ø§Ù„Ø© Ø¥Ù„Ù‰ 100000
        handleReferral(user);
    } else {
        if (result.error && result.error.includes('banned')) {
            console.log("Account banned");
            return;
        }
        if (result.error && result.error.includes('device_limit')) {
            showNotification("âŒ This device is already associated with another account.", "error");
            return;
        }
        console.error('Error initializing user:', result.error);
    }
}

// âœ… Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„ÙŠÙˆÙ…ÙŠ
async function loadDailyWithdrawalsData() {
    const userId = window.Telegram?.WebApp?.initDataUnsafe?.user?.id;
    if (!userId) return;
    
    try {
        const result = await callAPI('getDailyWithdrawals', { userId: userId });
        if (result.success) {
            dailyWithdrawals = {
                count: result.data.todayWithdrawals || 0,
                lastReset: result.data.lastReset || Date.now(),
                limit: appSettings.dailyWithdrawalLimit || 2
            };
            
            // âœ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯ ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            updateWithdrawalsCounterUI();
            checkWithdrawalLimit();
        }
    } catch (error) {
        console.error("Error loading daily withdrawals:", error);
    }
}

// âœ… Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„ÙŠÙˆÙ…ÙŠ
function updateWithdrawalsCounterUI() {
    const counterElement = document.getElementById('daily-withdrawals-counter');
    const countElement = document.getElementById('today-withdrawals-count');
    const timerElement = document.getElementById('withdraw-reset-timer');
    
    if (!counterElement || !countElement || !timerElement) return;
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø¯
    countElement.textContent = dailyWithdrawals.count;
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¤Ù‚Øª
    updateWithdrawalsResetTimer();
    
    // Ø¥Ø°Ø§ ÙˆØµÙ„ Ù„Ù„Ø­Ø¯
    if (dailyWithdrawals.count >= dailyWithdrawals.limit) {
        counterElement.style.background = 'rgba(231,76,60,0.2)';
        counterElement.style.borderColor = 'rgba(231,76,60,0.3)';
        countElement.style.color = '#e74c3c';
        timerElement.style.color = '#ffb3b3';
    } else {
        counterElement.style.background = 'rgba(168,85,247,0.2)';
        counterElement.style.borderColor = 'rgba(168,85,247,0.3)';
        countElement.style.color = 'var(--primary-green)';
        timerElement.style.color = '#FFC107';
    }
}

// âœ… Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ù…Ø¤Ù‚Øª Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø³Ø­Ø¨
function updateWithdrawalsResetTimer() {
    const timerElement = document.getElementById('withdraw-reset-timer');
    if (!timerElement) return;
    
    const now = Date.now();
    const nextReset = dailyWithdrawals.lastReset + (24 * 60 * 60 * 1000);
    const timeLeft = nextReset - now;
    
    if (timeLeft <= 0) {
        timerElement.textContent = "Resets now!";
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¹Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        resetDailyWithdrawals();
    } else {
        const hours = Math.floor(timeLeft / (1000 * 60 * 60));
        const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
        timerElement.textContent = `Resets in: ${hours}h ${minutes}m`;
    }
}

// âœ… Ø¯Ø§Ù„Ø© Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„ÙŠÙˆÙ…ÙŠ
async function resetDailyWithdrawals() {
    dailyWithdrawals.count = 0;
    dailyWithdrawals.lastReset = Date.now();
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    updateWithdrawalsCounterUI();
    checkWithdrawalLimit();
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³ÙŠØ±ÙØ±
    const userId = window.Telegram?.WebApp?.initDataUnsafe?.user?.id;
    if (userId) {
        try {
            await callAPI('resetDailyWithdrawals', { 
                userId: userId,
                resetTime: dailyWithdrawals.lastReset 
            });
        } catch (error) {
            console.error("Error resetting daily withdrawals:", error);
        }
    }
}

// âœ… Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¯ Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„ÙŠÙˆÙ…ÙŠ
function checkWithdrawalLimit() {
    const faucetpayBtn = document.getElementById('withdraw-faucetpay-btn');
    const tonwalletBtn = document.getElementById('withdraw-ton-now-btn');
    
    const isLimitReached = dailyWithdrawals.count >= dailyWithdrawals.limit;
    
    if (faucetpayBtn) {
        if (isLimitReached) {
            faucetpayBtn.disabled = true;
            faucetpayBtn.classList.add('withdraw-disabled');
            faucetpayBtn.classList.add('daily-limit-reached');
            faucetpayBtn.innerHTML = '<i class="fa-solid fa-ban"></i> DAILY LIMIT REACHED (2/2)';
        } else {
            faucetpayBtn.disabled = false;
            faucetpayBtn.classList.remove('withdraw-disabled');
            faucetpayBtn.classList.remove('daily-limit-reached');
            faucetpayBtn.innerHTML = '<i class="fa-solid fa-paper-plane"></i> WITHDRAW VIA FAUCETPAY';
        }
    }
    
    if (tonwalletBtn) {
        if (isLimitReached) {
            tonwalletBtn.disabled = true;
            tonwalletBtn.classList.add('withdraw-disabled');
            tonwalletBtn.classList.add('daily-limit-reached');
            tonwalletBtn.innerHTML = '<i class="fa-solid fa-ban"></i> DAILY LIMIT REACHED (2/2)';
        } else {
            tonwalletBtn.disabled = false;
            tonwalletBtn.classList.remove('withdraw-disabled');
            tonwalletBtn.classList.remove('daily-limit-reached');
            tonwalletBtn.innerHTML = '<i class="fa-solid fa-wallet"></i> WITHDRAW TO TON WALLET';
        }
    }
    
    return !isLimitReached;
}

// âœ… Ø¯Ø§Ù„Ø© Ø²ÙŠØ§Ø¯Ø© Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„ÙŠÙˆÙ…ÙŠ
async function incrementDailyWithdrawals() {
    dailyWithdrawals.count++;
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    updateWithdrawalsCounterUI();
    checkWithdrawalLimit();
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³ÙŠØ±ÙØ±
    const userId = window.Telegram?.WebApp?.initDataUnsafe?.user?.id;
    if (userId) {
        try {
            await callAPI('incrementDailyWithdrawals', { 
                userId: userId,
                count: dailyWithdrawals.count 
            });
        } catch (error) {
            console.error("Error incrementing daily withdrawals:", error);
        }
    }
}

function initializeApp(user) {
    const fullName = `${user.first_name} ${user.last_name}`.trim();
    document.getElementById('home-username').textContent = fullName;
    document.getElementById('referral-link-display').textContent = `https://t.me/${BOT_USERNAME}?startapp=ref${user.id}`;
    
    if (window.Adsgram) {
        AdController = window.Adsgram.init({ blockId: ADSGRAM_BLOCK_ID });
    }
    
    setupEventListeners(user);
    setupGalaxyLogButton();
    renderCreateTaskUI();
    initSlotsGame();
    initCoinFlipGame();
    initPromoCodes();
    
    setTimeout(() => {
        isAdScriptLoaded = typeof show_10058786 === "function";
    }, 2500);
    
    selectWithdrawalType('faucetpay');
    selectSwapDirection('glx_to_ton');
    
    const ticketInput = document.getElementById('ticket-amount');
    if (ticketInput) {
        ticketInput.addEventListener('input', updateTicketCostDisplay);
        updateTicketCostDisplay();
    }
    
    initializeCompetition();
    loadUserCompetitionData();
    
    // âœ… Ø¨Ø¯Ø¡ Ù…Ø¤Ø´Ø± ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ø­Ø¨
    setInterval(updateWithdrawalsResetTimer, 60000); // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
}

// ðŸ”„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© handleReferral Ù„ØªØºÙŠÙŠØ± Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©
async function handleReferral(user) {
    const tg = window.Telegram?.WebApp;
    const startParam = tg?.initDataUnsafe?.start_param;
    
    if (startParam && startParam.startsWith('ref')) {
        const referrerId = startParam.replace('ref', '');
        if (referrerId && referrerId !== user.id) {
            const result = await callAPI('handleReferral', {
                userId: user.id,
                referrerId: referrerId,
                // ðŸ”„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: ØªØºÙŠÙŠØ± Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„Ø¥Ø­Ø§Ù„Ø© Ù…Ù† 10000 Ø¥Ù„Ù‰ 100000
                rewardAmount: 100000
            });
            
            if (result.success) {
                // ðŸ”„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: ØªØ­Ø¯ÙŠØ« Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ù„ØªØ¹ÙƒØ³ 100K
                showNotification("ðŸŽ‰ Welcome bonus activated! +100K GLX", "success");
            }
        }
    }
}

function renderUI(user) {
    if (!appData) return;
    
    const GLX = Math.floor(appData.dogsBalance || 0);
    const ton = (appData.tonBalance || 0).toFixed(7);
    const userLevel = getLevel(GLX);
    
    document.getElementById('home-user-level').textContent = `Level ${userLevel}`;
    document.getElementById('total-GLX-balance').textContent = GLX.toLocaleString();
    document.getElementById('home-ton-balance').textContent = parseFloat(ton).toFixed(4);
    document.getElementById('swap-max-GLX').textContent = GLX.toLocaleString();
    document.getElementById('swap-max-TON').textContent = parseFloat(ton).toFixed(4);
    
    document.querySelectorAll('.user-ton-balance').forEach(el => {
        el.textContent = parseFloat(ton).toFixed(4);
    });
    
    document.getElementById('referral-count-display').textContent = (appData.referrals || 0);
    
    document.getElementById('hud-glx-balance').textContent = GLX.toLocaleString();
    document.getElementById('hud-ton-balance').textContent = parseFloat(ton).toFixed(4);
    
    const monetagCount = appData.adsMonetag || 0;
    const gigaCount = appData.adsGiga || 0;
    const adsgramCount = appData.adsAdsgram || 0;
    const limitM = appSettings.limitMonetag || 50;
    const limitG = appSettings.limitGiga || 300;
    const limitA = appSettings.limitAdsgram || 300;
    
    document.getElementById('monetag-count').textContent = monetagCount;
    document.getElementById('monetag-limit').textContent = limitM;
    document.getElementById('giga-count').textContent = gigaCount;
    document.getElementById('giga-limit').textContent = limitG;
    document.getElementById('adsgram-count').textContent = adsgramCount;
    document.getElementById('adsgram-limit').textContent = limitA;
    
    if (monetagCount >= limitM) {
        const el = document.getElementById('monetag-ad-task');
        el.style.opacity = '0.5';
        el.style.pointerEvents = 'none';
    }
    
    if (gigaCount >= limitG) {
        const el = document.getElementById('gigapub-ad-task');
        el.style.opacity = '0.5';
        el.style.pointerEvents = 'none';
    }
    
    if (adsgramCount >= limitA) {
        const el = document.getElementById('adsgram-ad-task');
        el.style.opacity = '0.5';
        el.style.pointerEvents = 'none';
    }
    
    fetchAndRenderTasks(user);
    renderHistory(document.getElementById('full-history-list'), 50, user);
    calculateSwap();
}

window.selectSwapDirection = function(direction) {
    swapDirection = direction;
    document.querySelectorAll('.swap-direction-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelectorAll('.swap-direction-btn').forEach(btn => {
        if (btn.textContent.includes(direction === 'glx_to_ton' ? 'GLX â†’ TON' : 'TON â†’ GLX')) {
            btn.classList.add('active');
        }
    });
    
    if (direction === 'glx_to_ton') {
        document.getElementById('glx-to-ton-section').style.display = 'block';
        document.getElementById('ton-to-glx-section').style.display = 'none';
        document.querySelector('.page-header p').textContent = '100K GLX = 0.01 TON';
    } else {
        document.getElementById('glx-to-ton-section').style.display = 'none';
        document.getElementById('ton-to-glx-section').style.display = 'block';
        document.querySelector('.page-header p').textContent = '0.01 TON = 100K GLX';
    }
    
    calculateSwap();
};

window.calculateSwap = function() {
    if (swapDirection === 'glx_to_ton') {
        const GLXInput = parseFloat(document.getElementById('swap-input-amount').value) || 0;
        const tonOutput = GLXInput * GLX_TO_TON_RATE;
        document.getElementById('swap-output-amount').textContent = tonOutput.toFixed(7);
    } else {
        const TONInput = parseFloat(document.getElementById('ton-input-amount').value) || 0;
        const glxOutput = TONInput * TON_TO_GLX_RATE;
        document.getElementById('ton-output-amount').textContent = Math.floor(glxOutput).toLocaleString();
    }
};

window.setMaxSwap = function(type) {
    if (type === 'glx' || swapDirection === 'glx_to_ton') {
        const currentBalance = appData.dogsBalance || 0;
        if (currentBalance < 1000) {
            showNotification("Minimum swap is 1,000 GLX", "warning");
            return;
        }
        document.getElementById('swap-input-amount').value = currentBalance;
        calculateSwap();
    } else {
        const currentBalance = appData.tonBalance || 0;
        if (currentBalance < 0.0001) {
            showNotification("Minimum swap is 0.0001 TON", "warning");
            return;
        }
        document.getElementById('ton-input-amount').value = currentBalance.toFixed(4);
        calculateSwap();
    }
};

window.executeSwap = function() {
    if (swapDirection === 'glx_to_ton') {
        executeGLXtoTONSwap();
    } else {
        executeTONtoGLXSwap();
    }
};

async function executeGLXtoTONSwap() {
    // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¸Ø± Ø£ÙˆÙ„Ø§Ù‹
    const isAllowed = await checkBeforeAction("swap");
    if (!isAllowed) return;
    
    const GLXInput = parseFloat(document.getElementById('swap-input-amount').value) || 0;
    const currentGLX = appData.dogsBalance || 0;
    
    if (GLXInput < 1000) {
        showNotification("Min swap: 1,000 GLX", "warning");
        return;
    }
    
    if (GLXInput > currentGLX) {
        showNotification("Insufficient GLX Balance", "warning");
        return;
    }
    
    const tonValue = GLXInput * GLX_TO_TON_RATE;
    
    if (!confirm(`Swap ${GLXInput.toLocaleString()} GLX for ${tonValue.toFixed(7)} TON?\n\nRate: 100,000 GLX = 0.01 TON`)) return;
    
    const result = await callAPI('executeSwap', {
        type: 'glx_to_ton',
        amount: GLXInput,
        tonValue: tonValue
    });
    
    if (result.success) {
        appData.dogsBalance = result.data.newGLXBalance;
        appData.tonBalance = result.data.newTONBalance;
        showNotification(`Swap Complete!\n\n-${GLXInput.toLocaleString()} GLX\n+${tonValue.toFixed(7)} TON`, "success");
        document.getElementById('swap-input-amount').value = '';
        document.getElementById('swap-output-amount').textContent = '0.0000000';
        switchTab('home');
        renderUI({ id: window.Telegram?.WebApp?.initDataUnsafe?.user?.id });
    } else {
        if (result.error === 'ACCOUNT_BLOCKED') {
            showNotification("Your account has been blocked.", "error");
        } else {
            showNotification("Error: " + result.error, "error");
        }
    }
}

async function executeTONtoGLXSwap() {
    // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¸Ø± Ø£ÙˆÙ„Ø§Ù‹
    const isAllowed = await checkBeforeAction("swap");
    if (!isAllowed) return;
    
    const TONInput = parseFloat(document.getElementById('ton-input-amount').value) || 0;
    const currentTON = appData.tonBalance || 0;
    
    if (TONInput < 0.0001) {
        showNotification("Min swap: 0.0001 TON", "warning");
        return;
    }
    
    if (TONInput > currentTON) {
        showNotification("Insufficient TON Balance", "warning");
        return;
    }
    
    const glxValue = TONInput * TON_TO_GLX_RATE;
    
    if (!confirm(`Swap ${TONInput.toFixed(4)} TON for ${glxValue.toLocaleString()} GLX?\n\nRate: 0.01 TON = 100,000 GLX`)) return;
    
    const result = await callAPI('executeSwap', {
        type: 'ton_to_glx',
        amount: TONInput,
        glxValue: glxValue
    });
    
    if (result.success) {
        appData.tonBalance = result.data.newTONBalance;
        appData.dogsBalance = result.data.newGLXBalance;
        showNotification(`Swap Complete!\n\n-${TONInput.toFixed(4)} TON\n+${glxValue.toLocaleString()} GLX`, "success");
        document.getElementById('ton-input-amount').value = '';
        document.getElementById('ton-output-amount').textContent = '0';
        switchTab('home');
        renderUI({ id: window.Telegram?.WebApp?.initDataUnsafe?.user?.id });
    } else {
        if (result.error === 'ACCOUNT_BLOCKED') {
            showNotification("Your account has been blocked.", "error");
        } else {
            showNotification("Error: " + result.error, "error");
        }
    }
}

window.openGame = function(gameType) {
    document.getElementById('coin-flip-section').style.display = 'none';
    document.getElementById('promo-codes-section').style.display = 'none';
    document.getElementById('daily-streak-section').style.display = 'none';
    document.getElementById('galaxy-slots-section').style.display = 'none';
    
    const grid = document.querySelector('.bonus-grid');
    grid.style.display = 'none';
    
    document.getElementById(gameType + '-section').style.display = 'block';
    
    if (gameType === 'coin-flip') {
        resetCoinFlipGame();
    } else if (gameType === 'galaxy-slots') {
        initSlotsGame();
        updateAvailableSpins();
    } else if (gameType === 'daily-streak') {
        renderDailyBonusUI();
    }
};

window.closeGame = function() {
    document.getElementById('coin-flip-section').style.display = 'none';
    document.getElementById('promo-codes-section').style.display = 'none';
    document.getElementById('daily-streak-section').style.display = 'none';
    document.getElementById('galaxy-slots-section').style.display = 'none';
    
    const grid = document.querySelector('.bonus-grid');
    grid.style.display = 'grid';
};

function setupGalaxyLogButton() {
    const galaxyLogBtn = document.getElementById('galaxy-log-button');
    if (galaxyLogBtn) {
        galaxyLogBtn.addEventListener('click', function() {
            switchTab('galaxy-log-page');
        });
    }
}

async function initializeCompetition() {
    if (isCompetitionDataLoaded) return; // Ù…Ù†Ø¹ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒØ±Ø±
    
    try {
        const result = await callAPI('getCompetitionData');
        if (result.success) {
            competitionData = result.data.competitionData || competitionData;
            isCompetitionDataLoaded = true; // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¹Ù„Ù…
            
            if (!competitionData.isActive) {
                await createNewCompetition();
            } else {
                startCountdown();
                updateCompetitionUI();
                loadPreviousWinners();
            }
        } else {
            if (result.error === 'ACCOUNT_BLOCKED') {
                showNotification("Your account has been blocked.", "error");
                return;
            }
            await createNewCompetition();
        }
    } catch (error) {
        console.error("Error initializing competition:", error);
        await createNewCompetition();
    }
}

async function createNewCompetition() {
    const now = Date.now();
    competitionData = {
        isActive: true,
        breakMode: false,
        startTime: now,
        endTime: now + COMPETITION_DURATION,
        totalTickets: 0,
        prizePool: 0,
        userTickets: {},
        winners: []
    };
    
    await callAPI('createCompetition', {
        startTime: now,
        endTime: now + COMPETITION_DURATION
    });
    
    startCountdown();
    updateCompetitionUI();
}

function updateCompetitionUI() {
    const now = Date.now();
    const userId = window.Telegram?.WebApp?.initDataUnsafe?.user?.id;
    if (!userId) {
        console.error("User ID not found");
        return;
    }
    
    document.getElementById('competition-status').textContent = competitionData.isActive ? 'ACTIVE' : 'ENDED';
    document.getElementById('competition-status').style.color = competitionData.isActive ? '#27ae60' : '#e74c3c';
    
    // âœ… ØªØ­Ø¯ÙŠØ« Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯
    const prizePool = competitionData.totalTickets * TICKET_TON_VALUE;
    document.getElementById('prize-pool').textContent = prizePool.toFixed(4) + ' TON';
    
    document.getElementById('total-tickets').textContent = (competitionData.totalTickets || 0).toLocaleString();
    
    const ticketInput = document.getElementById('ticket-amount');
    if (ticketInput) {
        updateTicketCostDisplay();
    }
    
    const buyBtn = document.getElementById('buy-tickets-btn');
    if (buyBtn) {
        const isBreak = competitionData.breakMode || false;
        buyBtn.disabled = isBreak || !competitionData.isActive;
        buyBtn.style.opacity = isBreak || !competitionData.isActive ? '0.5' : '1';
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ØµÙØ­Ø© Ù…ÙØªÙˆØ­Ø©
    if (isCompetitionPageVisible) {
        updateCompetitionLeaderboard();
    }
}

async function loadUserCompetitionData() {
    const userId = window.Telegram?.WebApp?.initDataUnsafe?.user?.id;
    if (!userId) {
        return;
    }
    
    const result = await callAPI('getUserCompetitionData', { userId: userId });
    if (result.success && result.data) {
        if (result.data.userTickets || result.data.competitionTickets) {
            if (!competitionData.userTickets) {
                competitionData.userTickets = {};
            }
            const ticketsFromAPI = result.data.userTickets || result.data.competitionTickets || 0;
            competitionData.userTickets[userId] = ticketsFromAPI;
            appData.competitionTickets = ticketsFromAPI;
            updateCompetitionUI();
        }
    } else {
        appData.competitionTickets = appData.competitionTickets || 0;
    }
}

function startCountdown() {
    if (countdownInterval) clearInterval(countdownInterval);
    
    const updateTimer = () => {
        const now = Date.now();
        if (competitionData.endTime) {
            let timeRemaining = Math.max(0, competitionData.endTime - now);
            
            if (timeRemaining <= 0 && competitionData.isActive) {
                timeRemaining = 0;
                competitionData.isActive = false;
                setTimeout(() => {
                    createNewCompetition();
                }, BREAK_DURATION);
            }
            
            const hours = Math.floor(timeRemaining / (1000 * 60 * 60));
            const minutes = Math.floor((timeRemaining % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeRemaining % (1000 * 60)) / 1000);
            
            const formattedTime = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            const timerElement = document.getElementById('countdown-timer');
            if (timerElement) {
                timerElement.textContent = formattedTime;
            }
        }
        
        // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¯ÙˆÙ† Ø·Ù„Ø¨Ø§Øª API
        if (isCompetitionPageVisible) {
            updateCompetitionUI();
        }
    };
    
    updateTimer();
    countdownInterval = setInterval(updateTimer, 1000);
}

function updateTicketCostDisplay() {
    const ticketInput = document.getElementById('ticket-amount');
    if (!ticketInput) return;
    
    const tickets = parseInt(ticketInput.value) || 1;
    const cost = tickets * TICKET_PRICE;
    
    document.getElementById('tickets-count-display').textContent = tickets;
    document.getElementById('tickets-cost-display').textContent = cost.toLocaleString() + ' GLX';
}

window.setMaxTickets = function() {
    const currentBalance = appData.dogsBalance || 0;
    const maxTickets = Math.floor(currentBalance / TICKET_PRICE);
    
    if (maxTickets < 1) {
        showNotification("You don't have enough GLX to buy a ticket (10,000 GLX required)", "warning");
        return;
    }
    
    const ticketInput = document.getElementById('ticket-amount');
    ticketInput.value = maxTickets;
    updateTicketCostDisplay();
};

window.buyTickets = async function() {
    const userId = window.Telegram?.WebApp?.initDataUnsafe?.user?.id;
    if (!userId) {
        showNotification("User authentication error. Please restart the bot.", "error");
        return;
    }
    
    // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¸Ø± Ø£ÙˆÙ„Ø§Ù‹
    const isAllowed = await checkBeforeAction("buy tickets");
    if (!isAllowed) return;
    
    const buyBtn = document.getElementById('buy-tickets-btn');
    if (buyBtn.disabled) {
        return;
    }
    
    if (competitionData.breakMode) {
        showNotification("Competition is on break. Please wait for the next round.", "warning");
        return;
    }
    
    if (!competitionData.isActive) {
        showNotification("Competition has ended. Please wait for the next round.", "warning");
        return;
    }
    
    const ticketInput = document.getElementById('ticket-amount');
    const tickets = parseInt(ticketInput.value) || 0;
    
    if (tickets < 1) {
        showNotification("Please enter at least 1 ticket", "warning");
        return;
    }
    
    const totalCost = tickets * TICKET_PRICE;
    const currentBalance = appData.dogsBalance || 0;
    
    if (totalCost > currentBalance) {
        showNotification(`Insufficient GLX balance. You need ${totalCost.toLocaleString()} GLX`, "warning");
        return;
    }
    
    let isConfirming = false;
    if (isConfirming) return;
    isConfirming = true;
    
    const userConfirmed = confirm(`Buy ${tickets} ticket${tickets > 1 ? 's' : ''} for ${totalCost.toLocaleString()} GLX?\n\nEach ticket = 10,000 GLX = 0.001 TON\n\nðŸ† Remember: Only #1 wins, all others lose!`);
    if (!userConfirmed) {
        isConfirming = false;
        return;
    }
    
    buyBtn.disabled = true;
    buyBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
    
    const statusMsg = document.getElementById('buy-tickets-status');
    statusMsg.textContent = "Processing your purchase...";
    statusMsg.style.color = "#FFC107";
    
    try {
        const result = await callAPI('buyTickets', {
            userId: userId,
            tickets: tickets,
            totalCost: totalCost
        });
        
        if (result.success) {
            appData.dogsBalance = result.data.newBalance;
            appData.competitionTickets = (appData.competitionTickets || 0) + tickets;
            
            competitionData = {
                ...competitionData,
                userTickets: result.data.userTickets || competitionData.userTickets,
                totalTickets: result.data.totalTickets || competitionData.totalTickets,
                prizePool: result.data.totalTickets * TICKET_TON_VALUE // âœ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© Ø¨Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯
            };
            
            buyBtn.disabled = false;
            buyBtn.innerHTML = '<i class="fa-solid fa-ticket"></i> BUY TICKETS';
            statusMsg.textContent = `âœ… Successfully purchased ${tickets} ticket${tickets > 1 ? 's' : ''}!`;
            statusMsg.style.color = "#27ae60";
            ticketInput.value = 1;
            updateTicketCostDisplay();
            
            setTimeout(() => {
                statusMsg.textContent = "";
            }, 3000);
            
            renderUI({ id: userId });
            updateCompetitionUI();
        } else {
            if (result.error === 'ACCOUNT_BLOCKED') {
                showNotification("Your account has been blocked.", "error");
            } else {
                throw new Error(result.error || "Unknown error");
            }
        }
    } catch (error) {
        console.error("Ticket purchase error:", error);
        showNotification("Error: " + error.message, "error");
        buyBtn.disabled = false;
        buyBtn.innerHTML = '<i class="fa-solid fa-ticket"></i> BUY TICKETS';
        statusMsg.textContent = "âŒ Error processing purchase";
        statusMsg.style.color = "#e74c3c";
    } finally {
        isConfirming = false;
    }
};

async function updateCompetitionLeaderboard() {
    // ØªØ­Ø¯ÙŠØ« ÙÙ‚Ø· Ø¥Ø°Ø§ Ù…Ø±Øª Ø¯Ù‚ÙŠÙ‚Ø© ÙƒØ§Ù…Ù„Ø© Ù…Ù†Ø° Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«
    const now = Date.now();
    if (now - lastLeaderboardUpdate < LEADERBOARD_UPDATE_INTERVAL) {
        return;
    }
    
    lastLeaderboardUpdate = now;
    
    if (!isCompetitionPageVisible) return;
    
    try {
        const result = await callAPI('getCompetitionLeaderboard');
        if (result.success) {
            const leaderboardContainer = document.getElementById('competition-leaderboard-list');
            const leaderboardData = result.data.leaderboard || [];
            
            if (leaderboardData.length === 0) {
                leaderboardContainer.innerHTML = '<p style="text-align:center;padding:20px;color:var(--text-muted);">No tickets purchased yet</p>';
                return;
            }
            
            leaderboardContainer.innerHTML = '';
            leaderboardData.forEach((entry, index) => {
                const rankClass = index === 0 ? 'rank-1' : index === 1 ? 'rank-2' : index === 2 ? 'rank-3' : '';
                const html = `<div class="competition-rank-card ${rankClass}">
                                <div class="competition-rank">#${index + 1}</div>
                                <img src="${entry.photoUrl || 'https://i.ibb.co/tTkJX1Qy/logo.png'}" class="competition-user-avatar" alt="${entry.name}">
                                <div class="competition-user-info">
                                    <div class="competition-user-name">${entry.name}</div>
                                </div>
                                <div class="competition-ticket-count">${entry.tickets} ticket${entry.tickets !== 1 ? 's' : ''}</div>
                            </div>`;
                leaderboardContainer.insertAdjacentHTML('beforeend', html);
            });
        }
    } catch (error) {
        console.error("Error updating leaderboard:", error);
    }
}

async function loadPreviousWinners() {
    const result = await callAPI('getPreviousWinners');
    if (result.success) {
        const winnersContainer = document.getElementById('previous-winners-list');
        const winners = result.data.winners || [];
        
        if (winners.length === 0) {
            winnersContainer.innerHTML = '<p style="text-align:center;padding:20px;color:var(--text-muted);">No previous winners yet</p>';
            return;
        }
        
        winnersContainer.innerHTML = '';
        winners.forEach(winner => {
            const winnerDate = new Date(winner.timestamp).toLocaleDateString();
            const prizeAmount = winner.prize ? parseFloat(winner.prize).toFixed(4) : '0.0000'; // âœ… ØªØºÙŠÙŠØ± Ø¥Ù„Ù‰ 4 Ø®Ø§Ù†Ø§Øª Ø¹Ø´Ø±ÙŠØ©
            const html = `<div class="winner-item">
                            <div class="winner-rank">ðŸ†</div>
                            <img src="${winner.photoUrl || 'https://i.ibb.co/tTkJX1Qy/logo.png'}" class="winner-avatar" alt="${winner.name}">
                            <div class="winner-info">
                                <div class="winner-name">${winner.name}</div>
                                <div class="winner-date">${winnerDate}</div>
                            </div>
                            <div class="winner-prize">${prizeAmount} TON</div>
                        </div>`;
            winnersContainer.insertAdjacentHTML('beforeend', html);
        });
    }
}

window.maskEmail = function() {
    const emailInput = document.getElementById('faucetpay-email');
    const emailPreview = document.getElementById('email-preview');
    
    if (!emailInput || !emailPreview) return;
    
    const email = emailInput.value.trim();
    if (!email || typeof email !== 'string' || !email.includes('@')) {
        emailPreview.style.display = 'none';
        return;
    }
    
    const [localPart, domain] = email.split('@');
    if (!localPart || !domain) {
        emailPreview.style.display = 'none';
        return;
    }
    
    if (localPart.length > 3) {
        const maskedLocal = localPart.charAt(0) + '*'.repeat(Math.max(3, localPart.length - 2)) + localPart.charAt(localPart.length - 1);
        const maskedEmail = `${maskedLocal}@${domain}`;
        emailPreview.textContent = maskedEmail;
        emailPreview.style.display = 'block';
    } else {
        emailPreview.style.display = 'none';
    }
};

window.setMaxFaucetPay = function() {
    const currentBalance = appData.tonBalance || 0;
    const minAmount = 0.0001;
    
    if (currentBalance < minAmount) {
        showNotification(`Minimum withdrawal is ${minAmount} TON`, "warning");
        return;
    }
    
    document.getElementById('faucetpay-amount').value = currentBalance.toFixed(4);
};

window.setMaxTonWallet = function() {
    const currentBalance = appData.tonBalance || 0;
    const minAmount = 0.05;
    
    if (currentBalance < minAmount) {
        showNotification(`Minimum withdrawal is ${minAmount} TON`, "warning");
        return;
    }
    
    document.getElementById('ton-withdraw-amount').value = currentBalance.toFixed(2);
};

window.renderGalaxyLog = async function() {
    const result = await callAPI('getTransactionHistory');
    if (result.success) {
        const historyData = result.data.history || [];
        
        let totalEarned = 0;
        let totalSpent = 0;
        
        historyData.forEach(item => {
            if (item.type.includes('earn') || item.type === 'referral') {
                totalEarned += parseFloat(item.amount) || 0;
            } else if (item.type.includes('spend') || item.type.includes('loss') || item.type.includes('withdraw')) {
                totalSpent += parseFloat(item.amount) || 0;
            }
        });
        
        document.getElementById('total-earned').textContent = Math.floor(totalEarned).toLocaleString() + ' GLX';
        document.getElementById('total-spent').textContent = Math.floor(totalSpent).toLocaleString() + ' GLX';
        
        const container = document.getElementById('galaxy-log-filtered-list');
        container.innerHTML = '';
        
        historyData.forEach(item => {
            let icon = 'ðŸ“œ';
            let color = '#fff';
            let typeClass = '';
            
            if (item.type.includes('earn') || item.type === 'referral') {
                icon = 'ðŸ’°';
                color = '#27ae60';
                typeClass = 'earn';
            } else if (item.type.includes('spend') || item.type.includes('loss')) {
                icon = 'ðŸ“‰';
                color = '#e74c3c';
                typeClass = 'spend';
            } else if (item.type.includes('swap')) {
                icon = 'ðŸ”„';
                color = '#3498db';
                typeClass = 'swap';
            } else if (item.type.includes('withdraw')) {
                icon = 'ðŸ¦';
                color = '#9b59b6';
                typeClass = 'withdraw';
            }
            
            const amount = item.currency === 'TON' 
                ? parseFloat(item.amount).toFixed(4) + ' TON' 
                : Math.floor(item.amount).toLocaleString() + ' GLX';
            
            const html = `<div class="log-item ${typeClass}">
                            <div style="font-size:20px;margin-right:12px;">${icon}</div>
                            <div style="flex:1;">
                                <div style="font-size:13px;font-weight:600;margin-bottom:2px;">${item.description}</div>
                                <div style="font-size:10px;color:var(--text-muted);">${new Date(item.date).toLocaleString()}</div>
                            </div>
                            <div style="font-size:14px;font-weight:700;color:${color};">${amount}</div>
                        </div>`;
            container.insertAdjacentHTML('beforeend', html);
        });
    }
};

window.filterUserWithdrawals = async function(type) {
    await updateUserWithdrawalsList(type);
};

async function updateUserWithdrawalsStats() {
    const result = await callAPI('getUserWithdrawals');
    if (result.success) {
        const withdrawals = result.data.withdrawals || [];
        await updateUserWithdrawalsList('all', withdrawals);
    }
}

async function updateUserWithdrawalsList(filterType, withdrawalsData) {
    if (!withdrawalsData) {
        const result = await callAPI('getUserWithdrawals');
        if (result.success) {
            withdrawalsData = result.data.withdrawals || [];
        } else {
            withdrawalsData = [];
        }
    }
    
    const container = document.getElementById('user-withdrawals-list');
    container.innerHTML = '';
    
    const filteredWithdrawals = withdrawalsData.filter(withdrawal => {
        if (filterType === 'all') return true;
        if (filterType === 'pending') {
            return withdrawal.status === 'pending' || withdrawal.processed === false;
        }
        if (filterType === 'completed') {
            return withdrawal.status === 'completed' || withdrawal.processed === true;
        }
        return true;
    });
    
    filteredWithdrawals.sort((a, b) => b.timestamp - a.timestamp);
    
    if (filteredWithdrawals.length === 0) {
        container.innerHTML = '<p style="text-align:center;padding:20px;color:var(--text-muted);">No withdrawals found</p>';
        return;
    }
    
    filteredWithdrawals.forEach(withdrawal => {
        const timeAgo = getTimeAgo(withdrawal.timestamp);
        const amount = parseFloat(withdrawal.amount || 0).toFixed(7);
        
        let status = '';
        let statusText = '';
        let statusClass = '';
        
        if (withdrawal.status === 'rejected') {
            status = 'rejected';
            statusText = 'âŒ Rejected';
            statusClass = 'status-rejected';
        } else if (withdrawal.status === 'completed' || withdrawal.processed === true) {
            status = 'completed';
            statusText = 'âœ… Completed';
            statusClass = 'status-completed';
        } else {
            status = 'pending';
            statusText = 'â³ Pending';
            statusClass = 'status-pending';
        }
        
        let maskedAccount = withdrawal.account || '';
        if (withdrawal.method === 'faucetpay' && maskedAccount.includes('@')) {
            const [localPart, domain] = maskedAccount.split('@');
            if (localPart.length > 3) {
                maskedAccount = localPart.charAt(0) + '*'.repeat(Math.max(3, localPart.length - 2)) + localPart.charAt(localPart.length - 1) + '@' + domain;
            }
        } else if (withdrawal.method === 'ton') {
            if (maskedAccount.length > 16) {
                maskedAccount = maskedAccount.substring(0, 8) + '...' + maskedAccount.substring(maskedAccount.length - 4);
            }
        }
        
        const html = `<div class="user-withdrawal-item">
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:5px;">
                            <div style="font-size:12px;font-weight:600;">${withdrawal.method === 'ton' ? 'TON Wallet' : 'FaucetPay'}</div>
                            <div class="withdrawal-status ${statusClass}">${statusText}</div>
                        </div>
                        <div style="font-size:11px;color:var(--text-muted);margin-bottom:5px;" class="masked-email">${maskedAccount}</div>
                        <div style="display:flex;justify-content:space-between;align-items:center;">
                            <div style="font-size:14px;font-weight:700;color:var(--primary-green);">${amount} TON</div>
                            <div style="font-size:9px;color:var(--text-muted);">${timeAgo}</div>
                        </div>
                    </div>`;
        container.insertAdjacentHTML('beforeend', html);
    });
}

function getTimeAgo(timestamp) {
    if (!timestamp) return "Unknown time";
    
    const now = Date.now();
    const diff = now - timestamp;
    const seconds = Math.floor(diff / 1000);
    const minutes = Math.floor(seconds / 60);
    const hours = Math.floor(minutes / 60);
    const days = Math.floor(hours / 24);
    
    if (days > 0) return `${days} day${days > 1 ? 's' : ''} ago`;
    if (hours > 0) return `${hours} hour${hours > 1 ? 's' : ''} ago`;
    if (minutes > 0) return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
    if (seconds > 0) return `${seconds} second${seconds !== 1 ? 's' : ''} ago`;
    return "Just now";
}

window.setMaxBet = function() {
    const currentBalance = appData.dogsBalance || 0;
    const maxBet = Math.floor(currentBalance / 1000) * 1000;
    
    if (maxBet < 1000) {
        showNotification("Minimum bet is 1,000 GLX", "warning");
        return;
    }
    
    document.getElementById('coin-bet-amount').value = maxBet;
    coinGame.betAmount = maxBet;
};

window.setBetAmount = function(amount) {
    coinGame.betAmount = amount;
    document.getElementById('coin-bet-amount').value = amount;
    
    document.querySelectorAll('.bet-btn').forEach(btn => {
        btn.classList.remove('active');
        const btnAmount = parseInt(btn.dataset.amount) || 0;
        if (btnAmount === amount) {
            btn.classList.add('active');
        }
    });
};

window.chooseSide = function(side) {
    coinGame.chosenSide = side;
    
    document.querySelectorAll('.side-btn').forEach(btn => {
        btn.classList.remove('active');
        btn.classList.remove('win');
        btn.classList.remove('lose');
    });
    
    const selectedBtn = side === 'glx' ? document.getElementById('choose-glx') : document.getElementById('choose-gold');
    selectedBtn.classList.add('active');
};

window.verifyDeposit = async function() {
    // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¸Ø± Ø£ÙˆÙ„Ø§Ù‹
    const isAllowed = await checkBeforeAction("verify deposit");
    if (!isAllowed) return;
    
    const btn = document.getElementById('check-deposit-btn');
    const msg = document.getElementById('deposit-status-message');
    if (!btn || !msg) return;
    
    btn.disabled = true;
    btn.textContent = "Processing...";
    btn.classList.add('deposit-processing');
    
    msg.textContent = "â³ Verifying payment on blockchain... This may take up to 30 seconds";
    msg.style.color = "#FFC107";
    
    try {
        await new Promise(resolve => setTimeout(resolve, 30000));
        
        const result = await callAPI('verifyDeposit', { transactionId: depositTransactionId });
        if (result.success) {
            if (result.data && result.data.verified) {
                msg.textContent = `âœ… Payment verified! Your deposit of ${result.data.amount || '0'} TON will be added within 1 hour after manual review.`;
                msg.style.color = "#27ae60";
                
                setTimeout(() => {
                    document.getElementById('deposit-status').style.display = 'none';
                    document.getElementById('deposit-amount').value = "0.01";
                    depositTransactionId = '';
                    renderUI({ id: window.Telegram?.WebApp?.initDataUnsafe?.user?.id });
                }, 5000);
            } else {
                msg.textContent = "Payment not found yet. Please wait 10-30 seconds and try again.";
                msg.style.color = "#e74c3c";
                btn.disabled = false;
                btn.textContent = "Check Again";
            }
        } else {
            if (result.error === 'ACCOUNT_BLOCKED') {
                showNotification("Your account has been blocked.", "error");
            } else {
                msg.textContent = "Error: " + (result.error || "Unknown error");
                msg.style.color = "#e74c3c";
                btn.disabled = false;
                btn.textContent = "Check Again";
            }
        }
    } catch (error) {
        console.error("Deposit verification error:", error);
        msg.textContent = "Connection error. Please try again.";
        msg.style.color = "#e74c3c";
        btn.disabled = false;
        btn.textContent = "Check Again";
    } finally {
        btn.classList.remove('deposit-processing');
    }
};

window.verifyPayment = async function() {
    // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¸Ø± Ø£ÙˆÙ„Ø§Ù‹
    const isAllowed = await checkBeforeAction("verify payment");
    if (!isAllowed) return;
    
    const btn = document.getElementById('check-payment-btn');
    const msg = document.getElementById('payment-status-msg');
    if (!btn || !msg) return;
    
    btn.disabled = true;
    btn.textContent = "Processing...";
    btn.classList.add('deposit-processing');
    
    msg.textContent = "â³ Connecting to TON API... This may take up to 30 seconds";
    msg.style.color = "#ffb300";
    
    try {
        await new Promise(resolve => setTimeout(resolve, 30000));
        
        const result = await callAPI('verifyTaskPayment', { taskId: currentTaskId });
        if (result.success) {
            msg.textContent = "Payment Verified! Activating Mission...";
            msg.style.color = "#a855f7";
            
            showNotification("âœ… Payment verified! Mission will be activated within 1 hour after manual review.", "success");
            
            document.getElementById('payment-step-1').style.display = 'block';
            document.getElementById('payment-step-2').style.display = 'none';
            document.getElementById('new-task-name').value = '';
            document.getElementById('new-task-link').value = '';
            
            btn.disabled = false;
            btn.textContent = "Check Payment";
            
            const userId = window.Telegram?.WebApp?.initDataUnsafe?.user?.id;
            if (userId) {
                fetchAndRenderTasks({ id: userId });
            }
            
            switchTab('tasks');
        } else {
            if (result.error === 'ACCOUNT_BLOCKED') {
                showNotification("Your account has been blocked.", "error");
            } else {
                msg.textContent = "Payment not found yet. Please wait 10s and try again.";
                msg.style.color = "#e74c3c";
                btn.disabled = false;
                btn.textContent = "Check Again";
            }
        }
    } catch (e) {
        console.error(e);
        msg.textContent = "Error checking payment. Try again.";
        btn.disabled = false;
        btn.textContent = "Check Again";
    } finally {
        btn.classList.remove('deposit-processing');
    }
};

function resetCoinFlipGame() {
    const coin = document.getElementById('coin');
    coin.classList.remove('coin-spinning', 'coin-final');
    coin.style.transform = 'rotateY(0deg)';
    coin.style.transition = 'none';
    
    document.getElementById('coin-game-result').style.display = 'none';
    
    document.querySelectorAll('.side-btn').forEach(btn => {
        btn.classList.remove('win', 'lose');
        if (btn.id === 'choose-glx') {
            btn.classList.add('active');
        } else {
            btn.classList.remove('active');
        }
    });
    
    coinGame.isFlipping = false;
    coinGame.chosenSide = 'glx';
    coinGame.betAmount = 1000;
    coinGame.currentRotation = 0;
    document.getElementById('coin-bet-amount').value = 1000;
    
    updateBetButtons();
}

window.initCoinFlipGame = function() {
    resetCoinFlipGame();
};

function updateBetButtons() {
    const amounts = [1000, 5000, 10000, 25000];
    const buttons = document.querySelectorAll('.bet-btn');
    
    buttons.forEach((btn, index) => {
        if (index < amounts.length) {
            btn.textContent = amounts[index] >= 1000 ? (amounts[index] / 1000) + 'k' : amounts[index];
            btn.dataset.amount = amounts[index];
            
            if (amounts[index] === 1000) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        }
    });
}

function initPromoCodes() {
    const redeemBtn = document.getElementById('redeem-code-btn');
    const promoInput = document.getElementById('promo-code-input');
    
    if (redeemBtn) {
        redeemBtn.addEventListener('click', handlePromoCode);
    }
    
    if (promoInput) {
        promoInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                handlePromoCode();
            }
        });
    }
}

window.selectCat = function(el, cat) {
    document.querySelectorAll('.cat-opt').forEach(e => e.classList.remove('active'));
    el.classList.add('active');
    selectedCategory = cat;
    
    const warningEl = document.getElementById('admin-required-msg');
    if (cat === 'channel') {
        warningEl.style.display = 'block';
    } else {
        warningEl.style.display = 'none';
    }
};

function renderCreateTaskUI() {
    const container = document.getElementById('price-options');
    container.innerHTML = '';
    
    const options = [100, 500, 1000, 2000, 5000, 10000];
    options.forEach((opt, idx) => {
        const html = `<div class="price-opt ${idx === 0 ? 'active' : ''}" data-count="${opt}" onclick="selectPrice(this)">
                        <div class="price-count">${opt.toLocaleString()}</div>
                        <div class="price-cost" id="cost-${opt}">Loading...</div>
                    </div>`;
        container.insertAdjacentHTML('beforeend', html);
    });
    
    calculateCost();
}

window.selectPrice = function(el) {
    document.querySelectorAll('.price-opt').forEach(e => e.classList.remove('active'));
    el.classList.add('active');
    selectedCount = parseInt(el.dataset.count);
    calculateCost();
};

function calculateCost() {
    const rate = appSettings.pricePerClick || 0.0015;
    
    document.querySelectorAll('.price-opt').forEach(el => {
        const cnt = parseInt(el.dataset.count);
        const cst = (cnt * rate).toFixed(4);
        const costDiv = el.querySelector('.price-cost');
        if (costDiv) costDiv.textContent = `${cst} TON`;
    });
    
    selectedCost = (selectedCount * rate).toFixed(4);
    document.getElementById('pay-amount-display').textContent = selectedCost;
}

window.initiatePayment = async function() {
    // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¸Ø± Ø£ÙˆÙ„Ø§Ù‹
    const isAllowed = await checkBeforeAction("create task");
    if (!isAllowed) return;
    
    const name = document.getElementById('new-task-name').value.trim();
    const link = document.getElementById('new-task-link').value.trim();
    
    if (!name || !link) {
        showNotification("Please fill all fields.", "warning");
        return;
    }
    
    if (!link.startsWith('http')) {
        showNotification("Invalid link.", "warning");
        return;
    }
    
    currentTaskId = 'task_' + Math.floor(Date.now() / 1000);
    
    const result = await callAPI('createTask', {
        taskId: currentTaskId,
        name: name,
        link: link,
        category: selectedCategory,
        count: selectedCount,
        cost: selectedCost
    });
    
    if (result.success) {
        const nanoTon = Math.floor(selectedCost * 1000000000);
        const paymentUrl = `https://app.tonkeeper.com/transfer/${BOT_WALLET}?amount=${nanoTon}&text=${currentTaskId}`;
        
        if (window.Telegram?.WebApp) {
            window.Telegram.WebApp.openLink(paymentUrl);
        } else {
            window.open(paymentUrl, '_blank');
        }
        
        document.getElementById('payment-step-1').style.display = 'none';
        document.getElementById('payment-step-2').style.display = 'block';
    } else {
        if (result.error === 'ACCOUNT_BLOCKED') {
            showNotification("Your account has been blocked.", "error");
        } else {
            showNotification("Error: " + result.error, "error");
        }
    }
};

function initSlotsGame() {
    for (let i = 1; i <= 3; i++) {
        const reel = document.getElementById(`reel${i}`);
        reel.innerHTML = '';
        for (let j = 0; j < 10; j++) {
            slotsSymbols.forEach(symbol => {
                const item = document.createElement('div');
                item.className = 'slot-item';
                item.textContent = symbol;
                reel.appendChild(item);
            });
        }
    }
    
    document.getElementById('slots-spin-btn').addEventListener('click', handleSlotsSpin);
}

function updateAvailableSpins() {
    const extraSpins = appData.extraSpins || 0;
    document.getElementById('available-spins').textContent = extraSpins;
    
    const spinBtn = document.getElementById('slots-spin-btn');
    if (extraSpins > 0) {
        spinBtn.disabled = false;
        spinBtn.classList.remove('btn-disabled');
        spinBtn.textContent = `ðŸš€ SPIN NOW (${extraSpins} left)`;
    } else {
        spinBtn.disabled = true;
        spinBtn.classList.add('btn-disabled');
        spinBtn.textContent = "ðŸš€ NO SPINS LEFT";
    }
}

async function handleSlotsSpin() {
    if (isSpinning) return;
    
    // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¸Ø± Ø£ÙˆÙ„Ø§Ù‹
    const isAllowed = await checkBeforeAction("spin slots");
    if (!isAllowed) return;
    
    const extraSpins = appData.extraSpins || 0;
    if (extraSpins <= 0) {
        showNotification("You don't have any spins left! Watch an ad to get more spins.", "warning");
        return;
    }
    
    isSpinning = true;
    const spinBtn = document.getElementById('slots-spin-btn');
    const resultText = document.getElementById('slots-result-text');
    const winAmount = document.getElementById('slots-win-amount');
    
    spinBtn.disabled = true;
    resultText.textContent = "Spinning...";
    winAmount.textContent = "0 GLX";
    
    const result = await callAPI('spinSlots');
    if (result.success) {
        const results = result.data.results;
        const winGLX = result.data.winAmount;
        const newBalance = result.data.newBalance;
        const newSpins = result.data.newSpins;
        
        const reelPositions = [0, 0, 0];
        for (let i = 0; i < 3; i++) {
            const targetIndex = slotsSymbols.indexOf(results[i]);
            reelPositions[i] = -((targetIndex + 5) * 70);
        }
        
        const reels = [document.getElementById('reel1'), document.getElementById('reel2'), document.getElementById('reel3')];
        reels.forEach((reel, index) => {
            reel.style.transition = 'transform 2s cubic-bezier(0.1,0,0.2,1)';
            reel.style.transform = `translateY(${reelPositions[index]}px)`;
        });
        
        setTimeout(() => {
            const resultString = results.join('');
            
            if (winGLX > 0) {
                resultText.textContent = `ðŸŽ‰ You won! (${resultString})`;
                winAmount.textContent = `+${winGLX} GLX`;
                appData.dogsBalance = newBalance;
                appData.extraSpins = newSpins;
                
                if (winGLX >= 1000) {
                    setTimeout(() => {
                        showNotification(`ðŸŽŠ JACKPOT! You won ${winGLX} GLX!`, "success");
                    }, 500);
                }
            } else {
                resultText.textContent = `No win this time (${resultString})`;
                winAmount.textContent = "0 GLX";
                appData.extraSpins = newSpins;
            }
            
            setTimeout(() => {
                isSpinning = false;
                updateAvailableSpins();
                renderUI({ id: window.Telegram?.WebApp?.initDataUnsafe?.user?.id });
            }, 1000);
        }, 2000);
    } else {
        if (result.error === 'ACCOUNT_BLOCKED') {
            showNotification("Your account has been blocked.", "error");
        } else {
            showNotification("Error: " + result.error, "error");
        }
        isSpinning = false;
        spinBtn.disabled = false;
    }
}

window.getExtraSpin = async function() {
    // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¸Ø± Ø£ÙˆÙ„Ø§Ù‹
    const isAllowed = await checkBeforeAction("get extra spin");
    if (!isAllowed) return;
    
    if (typeof window.showGiga === 'function') {
        try {
            await window.showGiga();
            const result = await callAPI('addExtraSpin');
            if (result.success) {
                appData.extraSpins = result.data.newSpins;
                showNotification("ðŸŽ‰ You earned an extra spin!", "success");
                updateAvailableSpins();
            }
        } catch (e) {
            console.error("Ad error:", e);
            showNotification("Ad not available.", "warning");
        }
    } else {
        showNotification("Ads system loading...", "info");
    }
};

function renderDailyBonusUI() {
    const container = document.getElementById('daily-checkin-grid');
    container.innerHTML = '';
    
    const streak = appData.dailyStreak || 0;
    const lastClaim = appData.lastDailyClaim || 0;
    const now = Date.now();
    const msInDay = 86400000;
    const canClaim = (now - lastClaim) >= msInDay;
    const rewards = appSettings.dailyRewards || [2000, 3000, 5000, 7000, 9000, 12000, 15000];
    
    for (let i = 0; i < 7; i++) {
        let statusClass = '';
        if (i < streak) statusClass = 'claimed';
        else if (i === streak && canClaim) statusClass = 'active';
        
        const html = `<div class="daily-box ${statusClass}">
                        <div style="font-size:9px;">DAY ${i + 1}</div>
                        <div style="font-weight:700;">+${rewards[i]}</div>
                    </div>`;
        container.insertAdjacentHTML('beforeend', html);
    }
    
    const btn = document.getElementById('claim-daily-btn');
    const timer = document.getElementById('next-claim-timer');
    
    if (canClaim) {
        btn.disabled = false;
        btn.classList.remove('btn-disabled');
        btn.textContent = `Claim +${rewards[streak] || 100}`;
        timer.textContent = "Ready to claim!";
    } else {
        btn.disabled = true;
        btn.classList.add('btn-disabled');
        btn.textContent = "Claimed";
        
        const timeLeft = msInDay - (now - lastClaim);
        const hours = Math.floor(timeLeft / (1000 * 60 * 60));
        const mins = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
        timer.textContent = `Next reward in: ${hours}h ${mins}m`;
    }
}

async function renderHistory(container, limit, user) {
    container.innerHTML = '';
    
    const result = await callAPI('getTransactionHistory', { limit: limit });
    if (result.success) {
        const historyData = result.data.history || [];
        
        if (historyData.length === 0) {
            container.innerHTML = '<p style="text-align:center;padding:20px 0;font-size:12px;color:var(--text-muted);">No logs yet.</p>';
            return;
        }
        
        historyData.forEach(item => {
            const isMinus = item.type.includes('withdraw') || item.type.includes('loss') || item.type.includes('swap_out');
            const sign = isMinus ? '-' : '+';
            const color = isMinus ? '#fff' : 'var(--primary-green)';
            
            let displayAmount = item.amount;
            if (item.currency === 'TON') {
                displayAmount = parseFloat(item.amount).toFixed(7);
            } else {
                displayAmount = Number(item.amount).toLocaleString();
            }
            
            let iconImg = 'https://i.ibb.co/tTkJX1Qy/logo.png';
            const desc = item.description.toLowerCase();
            
            if (item.currency === 'TON') iconImg = 'https://i.ibb.co/8DsyHqwK/toncoin-ton-logo.png';
            else if (desc.includes('ad')) iconImg = 'https://i.ibb.co/tTkJX1Qy/logo.png';
            else if (desc.includes('telegram') || desc.includes('channel') || desc.includes('group')) iconImg = 'https://i.ibb.co/s9YygTBd/20251203-195134.png';
            else if (desc.includes('youtube') || desc.includes('subscribe')) iconImg = 'https://i.ibb.co/CSz6kg9/20251203-200546.png';
            else if (desc.includes('twitter') || desc.includes('follow')) iconImg = 'https://i.ibb.co/60jp6MsF/20251203-200516.png';
            else if (desc.includes('instagram')) iconImg = 'https://img.icons8.com/fluency/96/instagram-new.png';
            else if (desc.includes('coin flip')) iconImg = 'https://i.ibb.co/tTkJX1Qy/logo.png';
            
            const html = `<div class="list-card">
                            <div class="lc-icon"><img src="${iconImg}"></div>
                            <div class="lc-content">
                                <div class="lc-title">${item.description}</div>
                                <div class="lc-sub">${new Date(item.date).toLocaleDateString()}</div>
                            </div>
                            <div class="lc-end">
                                <div class="lc-val" style="color:${color}">${sign}${displayAmount} ${item.currency}</div>
                            </div>
                        </div>`;
        container.insertAdjacentHTML('beforeend', html);
        });
    }
}

async function renderWithdrawalHistory() {
    const result = await callAPI('getWithdrawalHistory');
    if (result.success) {
        const container = document.getElementById('withdrawal-history-list');
        container.innerHTML = '';
        
        const withdrawals = result.data.withdrawals || [];
        if (withdrawals.length === 0) {
            container.innerHTML = '<p style="text-align:center;padding:20px;color:var(--text-muted);">No withdrawals yet.</p>';
            return;
        }
        
        withdrawals.forEach(withdrawal => {
            const timeAgo = getTimeAgo(withdrawal.timestamp);
            const amount = parseFloat(withdrawal.amount || 0).toFixed(7);
            
            let maskedAccount = withdrawal.account || '';
            if (withdrawal.method === 'faucetpay' && maskedAccount.includes('@')) {
                const [localPart, domain] = maskedAccount.split('@');
                if (localPart.length > 3) {
                    maskedAccount = localPart.charAt(0) + '*'.repeat(Math.max(3, localPart.length - 2)) + localPart.charAt(localPart.length - 1) + '@' + domain;
                }
            } else if (withdrawal.method === 'ton') {
                if (maskedAccount.length > 16) {
                    maskedAccount = maskedAccount.substring(0, 8) + '...' + maskedAccount.substring(maskedAccount.length - 4);
                }
            }
            
            const html = `<div class="list-card" style="margin-bottom:8px;">
                            <div class="lc-icon"><img src="${withdrawal.photoUrl || 'https://i.ibb.co/tTkJX1Qy/logo.png'}" style="border-radius:50%;"></div>
                            <div class="lc-content">
                                <div class="lc-title">${withdrawal.name || 'Anonymous'}</div>
                                <div class="lc-sub">${withdrawal.method === 'ton' ? 'TON Wallet: ' + maskedAccount : 'FaucetPay: ' + maskedAccount}</div>
                            </div>
                            <div class="lc-end">
                                <div class="lc-val" style="color:var(--primary-green);">${amount} TON</div>
                                <div class="lc-sub" style="font-size:9px;">${timeAgo}</div>
                            </div>
                        </div>`;
            container.insertAdjacentHTML('beforeend', html);
        });
    }
}

async function initiateDeposit() {
    // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¸Ø± Ø£ÙˆÙ„Ø§Ù‹
    const isAllowed = await checkBeforeAction("make deposit");
    if (!isAllowed) return;
    
    const amount = parseFloat(document.getElementById('deposit-amount').value) || 0.01;
    
    if (amount < 0.01) {
        showNotification("Minimum deposit is 0.01 TON", "warning");
        return;
    }
    
    const userId = window.Telegram?.WebApp?.initDataUnsafe?.user?.id;
    if (!userId) {
        showNotification("User authentication error", "error");
        return;
    }
    
    depositTransactionId = 'deposit_' + Date.now() + '_' + userId;
    const nanoTon = Math.floor(amount * 1000000000);
    const paymentUrl = `https://app.tonkeeper.com/transfer/${BOT_WALLET}?amount=${nanoTon}&text=${depositTransactionId}`;
    
    document.getElementById('deposit-status').style.display = 'block';
    document.getElementById('deposit-status-message').textContent = "Payment link generated. Opening Tonkeeper...";
    document.getElementById('deposit-status-message').style.color = "#FFC107";
    
    if (window.Telegram?.WebApp) {
        window.Telegram.WebApp.openLink(paymentUrl);
    } else {
        window.open(paymentUrl, '_blank');
    }
}

async function verifyTelegramMembership(channelUsername, userId) {
    try {
        const username = channelUsername.replace('@', '');
        const result = await callAPI('verifyTelegramMembership', {
            channelUsername: username,
            userId: userId
        });
        return result.success && result.data.isMember === true;
    } catch (error) {
        console.error('Error verifying Telegram membership:', error);
        return false;
    }
}

async function verifyTaskChannel(taskId, channelUsername) {
    try {
        const username = channelUsername.replace('@', '');
        const result = await callAPI('verifyTaskChannel', {
            taskId: taskId,
            channelUsername: username
        });
        return result;
    } catch (error) {
        console.error('Error verifying task channel:', error);
        return { success: false, error: error.message };
    }
}

function extractChannelUsernameFromLink(link) {
    try {
        if (link.includes('t.me/')) {
            const url = new URL(link);
            const pathParts = url.pathname.split('/');
            const username = pathParts[1];
            if (username && !username.includes('joinchat') && !username.includes('+')) {
                return '@' + username;
            }
        }
        return null;
    } catch (e) {
        console.error('Error parsing link:', e);
        return null;
    }
}

// âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ…
// âœ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Ø¥Ø²Ø§Ù„Ø© Ù‚Ø³Ù… Partners Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ÙˆØ¹Ø±Ø¶ ÙÙ‚Ø· Ù…Ù‡Ø§Ù… Community
// âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ…
async function fetchAndRenderTasks(user) {
    const result = await callAPI('getTasks');
    
    // âœ… Ø¥Ø®ÙØ§Ø¡ Ù‚Ø³Ù… Partners Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ - Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
    const partnersHeader = document.querySelector('h2:contains("Partners")');
    const partnersCard = document.getElementById('partner-tasks-card');
    
    if (partnersHeader) {
        partnersHeader.style.display = 'none';
    }
    if (partnersCard) {
        partnersCard.style.display = 'none';
    }
    
    // âœ… Ø¹Ø±Ø¶ ÙÙ‚Ø· Ù…Ù‡Ø§Ù… Community
    const cCont = document.getElementById('community-tasks-list');
    
    if (result.success) {
        cCont.innerHTML = '';
        
        const tasks = result.data.tasks || [];
        const completedTasks = appData.completedTasks || {};
        
        tasks.forEach(task => {
            if (task.status !== 'active' || (task.remaining !== undefined && task.remaining <= 0)) return;
            
            const isDone = completedTasks[task.id];
            let iconImg = 'https://img.icons8.com/fluency/96/task.png';
            const lt = task.title.toLowerCase();
            const ll = (task.link || '').toLowerCase();
            
            if (lt.includes('bot') || ll.includes('bot') || ll.includes('start=')) {
                iconImg = 'https://i.ibb.co/Myz4Gkmy/Picsart-25-12-10-04-34-59-799.png';
            } else if (lt.includes('telegram') || lt.includes('channel') || lt.includes('group') || lt.includes('join') || ll.includes('t.me')) {
                iconImg = 'https://i.ibb.co/5WZRG8fw/tele.png';
            } else if (lt.includes('youtube') || lt.includes('subscribe')) iconImg = 'https://i.ibb.co/CSz6kg9/20251203-200546.png';
            else if (lt.includes('twitter') || lt.includes('retweet') || lt.includes('follow') || lt.includes('x ')) iconImg = 'https://i.ibb.co/60jp6MsF/20251203-200516.png';
            else if (lt.includes('instagram')) iconImg = 'https://img.icons8.com/fluency/96/instagram-new.png';
            
            const html = `<div class="list-card dynamic-task ${isDone ? 'disabled' : ''}" style="${isDone ? 'opacity:0.5;pointer-events:none;' : ''}" data-id="${task.id}" data-reward="${task.reward}" data-title="${task.title}" data-link="${task.link}" onclick="handleDynamicTask(this)">
                            <div class="lc-icon"><img src="${iconImg}"></div>
                            <div class="lc-content">
                                <div class="lc-title">${task.title}</div>
                                <div class="lc-sub" id="status-${task.id}">${task.description}</div>
                            </div>
                            <div class="lc-end">
                                <div class="lc-val" id="reward-${task.id}">+${task.reward}</div>
                            </div>
                        </div>`;
            
            if (task.category === 'community') {
                cCont.insertAdjacentHTML('beforeend', html);
            }
        });
        
        if (cCont.innerHTML === '') {
            document.getElementById('community-tasks-card').style.display = 'none';
        }
    }
}

function setupEventListeners(user) {
    document.querySelectorAll('.nav-item').forEach(btn => {
        btn.addEventListener('click', () => switchTab(btn.dataset.target));
    });
    
    document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            switchTab(link.dataset.target);
        });
    });
    
    document.getElementById('monetag-ad-task').addEventListener('click', handleMonetagAd);
    document.getElementById('gigapub-ad-task').addEventListener('click', handleGigaAd);
    document.getElementById('adsgram-ad-task').addEventListener('click', handleAdsgramAd);
    
    document.getElementById('share-referral-btn').addEventListener('click', () => {
        const link = document.getElementById('referral-link-display').textContent;
        window.Telegram?.WebApp.openTelegramLink(`https://t.me/share/url?url=${link}&text=Join GLX Galaxy!`);
    });
    
    document.getElementById('copy-referral-btn').addEventListener('click', () => {
        navigator.clipboard.writeText(document.getElementById('referral-link-display').textContent)
            .then(() => {
                showNotification("Copied!", "success");
            });
    });
    
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.podium-list').forEach(l => l.classList.add('hidden'));
            e.target.classList.add('active');
            document.getElementById(e.target.dataset.target).classList.remove('hidden');
        });
    });
    
    document.getElementById('claim-daily-btn').addEventListener('click', protectedDailyClaim);
    document.getElementById('buy-tickets-btn').addEventListener('click', buyTickets);
    document.getElementById('flip-coin-btn').addEventListener('click', flipCoin);
    
    document.getElementById('coin-bet-amount').addEventListener('input', function() {
        const value = parseInt(this.value);
        if (value && value >= 1000) {
            coinGame.betAmount = value;
        }
    });
    
    document.getElementById('floatingAddTask').addEventListener('click', function() {
        switchTab('create-task-page');
    });
    
    document.getElementById('faucetpay-email')?.addEventListener('input', maskEmail);
    
    document.querySelectorAll('.btn-filter').forEach(btn => {
        if (!btn.hasAttribute('data-setup')) {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.btn-filter').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
            });
            btn.setAttribute('data-setup', 'true');
        }
    });
}

function canClickAd() {
    const now = Date.now();
    return (now - lastAdClickTime) >= AD_CLICK_DELAY;
}

async function handleMonetagAd() {
    if (!canClickAd()) {
        showNotification("Please wait 3 seconds before clicking again.", "warning");
        return;
    }
    
    // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¸Ø± Ø£ÙˆÙ„Ø§Ù‹
    const isAllowed = await checkBeforeAction("watch ad");
    if (!isAllowed) return;
    
    await getUpdatedSettings();
    lastAdClickTime = Date.now();
    const limit = appSettings.limitMonetag || 50;
    if ((appData.adsMonetag || 0) >= limit) return;
    
    if (!isAdScriptLoaded) {
        showNotification("Loading ad...", "info");
        return;
    }
    
    try {
        await show_10058786({ ymid: window.Telegram?.WebApp?.initDataUnsafe?.user?.id });
        
        const result = await callAPI('handleAdClick', {
            adType: 'monetag',
            reward: appSettings.adRewardMonetag || 500 // ØªØºÙŠÙŠØ± Ù…Ù† 1000 Ø¥Ù„Ù‰ 500
        });
        
        if (result.success) {
            // âœ… ØªØ­Ø¯ÙŠØ« appData Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø¬Ø¹Ø©
            appData.adsMonetag = result.data.adsMonetag || appData.adsMonetag;
            appData.adsWatched = result.data.adsWatched || appData.adsWatched;
            appData.dogsBalance = result.data.newBalance || appData.dogsBalance;
            
            showNotification(`âœ… +${appSettings.adRewardMonetag || 500} GLX added!`, "success"); // ØªØºÙŠÙŠØ± Ù…Ù† 1000 Ø¥Ù„Ù‰ 500
            renderUI({ id: window.Telegram?.WebApp?.initDataUnsafe?.user?.id });
        }
    } catch (e) {
        showNotification("Ad not ready", "warning");
    }
}

async function handleGigaAd() {
    if (!canClickAd()) {
        showNotification("Please wait 3 seconds before clicking again.", "warning");
        return;
    }
    
    // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¸Ø± Ø£ÙˆÙ„Ø§Ù‹
    const isAllowed = await checkBeforeAction("watch ad");
    if (!isAllowed) return;
    
    await getUpdatedSettings();
    lastAdClickTime = Date.now();
    const limit = appSettings.limitGiga || 300;
    if ((appData.adsGiga || 0) >= limit) return;
    
    if (typeof window.showGiga !== 'function') {
        showNotification("Giga Ads loading...", "info");
        return;
    }
    
    try {
        await window.showGiga();
        
        const result = await callAPI('handleAdClick', {
            adType: 'giga',
            reward: appSettings.adRewardGiga || 500 // ØªØºÙŠÙŠØ± Ù…Ù† 2000 Ø¥Ù„Ù‰ 500
        });
        
        if (result.success) {
            // âœ… ØªØ­Ø¯ÙŠØ« appData Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø¬Ø¹Ø©
            appData.adsGiga = result.data.adsGiga || appData.adsGiga;
            appData.adsWatched = result.data.adsWatched || appData.adsWatched;
            appData.dogsBalance = result.data.newBalance || appData.dogsBalance;
            
            showNotification(`âœ… +${appSettings.adRewardGiga || 500} GLX added!`, "success"); // ØªØºÙŠÙŠØ± Ù…Ù† 2000 Ø¥Ù„Ù‰ 500
            renderUI({ id: window.Telegram?.WebApp?.initDataUnsafe?.user?.id });
        }
    } catch (e) {
        console.error(e);
        showNotification("Ad failed or closed.", "warning");
    }
}

async function handleAdsgramAd() {
    if (!canClickAd()) {
        showNotification("Please wait 3 seconds before clicking again.", "warning");
        return;
    }
    
    // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¸Ø± Ø£ÙˆÙ„Ø§Ù‹
    const isAllowed = await checkBeforeAction("watch ad");
    if (!isAllowed) return;
    
    await getUpdatedSettings();
    lastAdClickTime = Date.now();
    const limit = appSettings.limitAdsgram || 300;
    if ((appData.adsAdsgram || 0) >= limit) return;
    
    if (!AdController) {
        showNotification("AdsGram not initialized", "warning");
        return;
    }
    
    try {
        const result = await AdController.show();
        if (result.done) {
            const apiResult = await callAPI('handleAdClick', {
                adType: 'adsgram',
                reward: appSettings.adRewardAdsgram || 500 // ØªØºÙŠÙŠØ± Ù…Ù† 2000 Ø¥Ù„Ù‰ 500
            });
            
            if (apiResult.success) {
                // âœ… ØªØ­Ø¯ÙŠØ« appData Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø¬Ø¹Ø©
                appData.adsAdsgram = apiResult.data.adsAdsgram || appData.adsAdsgram;
                appData.dogsBalance = apiResult.data.newBalance || appData.dogsBalance;
                
                showNotification(`âœ… +${appSettings.adRewardAdsgram || 500} GLX added!`, "success"); // ØªØºÙŠÙŠØ± Ù…Ù† 2000 Ø¥Ù„Ù‰ 500
                renderUI({ id: window.Telegram?.WebApp?.initDataUnsafe?.user?.id });
            }
        }
    } catch (error) {
        console.error("AdsGram error:", error);
        showNotification("Ad playback error.", "error");
    }
}

window.selectWithdrawalType = function(type) {
    withdrawalType = type;
    document.querySelectorAll('.withdrawal-type-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelector(`.withdrawal-type-btn[data-type="${type}"]`).classList.add('active');
    
    if (type === 'faucetpay') {
        document.getElementById('faucetpay-form').style.display = 'block';
        document.getElementById('tonwallet-form').style.display = 'none';
    } else {
        document.getElementById('faucetpay-form').style.display = 'none';
        document.getElementById('tonwallet-form').style.display = 'block';
    }
};

async function handleFaucetPayWithdraw() {
    // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¸Ø± Ø£ÙˆÙ„Ø§Ù‹
    const isAllowed = await checkBeforeAction("withdraw");
    if (!isAllowed) return;
    
    // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¯ Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„ÙŠÙˆÙ…ÙŠ
    const canWithdraw = checkWithdrawalLimit();
    if (!canWithdraw) {
        showNotification("âš ï¸ Daily withdrawal limit reached! You can make only 2 withdrawals per day. Try again tomorrow.", "warning");
        return;
    }
    
    const email = document.getElementById('faucetpay-email').value.trim();
    const amount = parseFloat(document.getElementById('faucetpay-amount').value);
    const minAmount = appSettings.minFaucetPayWithdrawal || 0.0001;
    const currentBalance = appData.tonBalance || 0;
    
    if (!email || !email.includes('@')) {
        showNotification("Please enter a valid email address.", "warning");
        return;
    }
    
    if (amount < minAmount) {
        showNotification(`Minimum withdrawal is ${minAmount} TON for FaucetPay.`, "warning");
        return;
    }
    
    if (amount >= currentBalance) {
        showNotification(`Insufficient TON balance. You need at least ${(amount + 0.000001).toFixed(6)} TON.`, "warning");
        return;
    }
    
    const [localPart, domain] = email.split('@');
    let maskedEmail = '';
    if (localPart.length > 3) {
        maskedEmail = localPart.charAt(0) + '*'.repeat(Math.max(3, localPart.length - 2)) + localPart.charAt(localPart.length - 1) + '@' + domain;
    } else {
        maskedEmail = '*'.repeat(localPart.length) + '@' + domain;
    }
    
    if (!confirm(`Withdraw ${amount} TON to ${maskedEmail} via FaucetPay?\n\nEmail will be partially hidden for privacy.\n\nToday's withdrawals: ${dailyWithdrawals.count}/2`)) {
        return;
    }
    
    const result = await callAPI('submitWithdrawal', {
        method: 'faucetpay',
        account: email,
        amount: amount,
        maskedAccount: maskedEmail
    });
    
    if (result.success) {
        appData.tonBalance = result.data.newBalance;
        
        // âœ… Ø²ÙŠØ§Ø¯Ø© Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„ÙŠÙˆÙ…ÙŠ
        await incrementDailyWithdrawals();
        
        showNotification(`âœ… Withdrawal request submitted!\n\n${amount} TON will be sent to ${maskedEmail} within 1 minute.\n\nToday's withdrawals: ${dailyWithdrawals.count}/2`, "success");
        document.getElementById('faucetpay-email').value = '';
        document.getElementById('faucetpay-amount').value = minAmount;
        document.getElementById('email-preview').style.display = 'none';
        switchTab('home');
        renderUI({ id: window.Telegram?.WebApp?.initDataUnsafe?.user?.id });
    } else {
        if (result.error === 'ACCOUNT_BLOCKED') {
            showNotification("Your account has been blocked.", "error");
        } else {
            showNotification("Error: " + result.error, "error");
        }
    }
}

async function handleTonWalletWithdraw() {
    // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¸Ø± Ø£ÙˆÙ„Ø§Ù‹
    const isAllowed = await checkBeforeAction("withdraw");
    if (!isAllowed) return;
    
    // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¯ Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„ÙŠÙˆÙ…ÙŠ
    const canWithdraw = checkWithdrawalLimit();
    if (!canWithdraw) {
        showNotification("âš ï¸ Daily withdrawal limit reached! You can make only 2 withdrawals per day. Try again tomorrow.", "warning");
        return;
    }
    
    const address = document.getElementById('ton-wallet-address').value.trim();
    const amount = parseFloat(document.getElementById('ton-withdraw-amount').value);
    const memo = document.getElementById('ton-memo').value.trim();
    const minAmount = appSettings.minTonWithdrawal || 0.05;
    const currentBalance = appData.tonBalance || 0;
    
    if (!address || address.length < 5) {
        showNotification("Please enter a valid TON wallet address.", "warning");
        return;
    }
    
    if (amount < minAmount) {
        showNotification(`Minimum withdrawal is ${minAmount} TON for TON Wallet.`, "warning");
        return;
    }
    
    if (amount >= currentBalance) {
        showNotification(`Insufficient TON balance. You need at least ${(amount + 0.0001).toFixed(4)} TON.`, "warning");
        return;
    }
    
    let shortAddress = address;
    if (address.length > 16) {
        shortAddress = address.substring(0, 8) + '...' + address.substring(address.length - 4);
    }
    
    if (!confirm(`Withdraw ${amount} TON to ${shortAddress}?\n\nAddress: ${shortAddress}\n${memo ? 'Memo: ' + memo + '\n' : ''}\n\nToday's withdrawals: ${dailyWithdrawals.count}/2`)) {
        return;
    }
    
    const result = await callAPI('submitWithdrawal', {
        method: 'ton',
        account: address,
        amount: amount,
        memo: memo || ''
    });
    
    if (result.success) {
        appData.tonBalance = result.data.newBalance;
        
        // âœ… Ø²ÙŠØ§Ø¯Ø© Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„ÙŠÙˆÙ…ÙŠ
        await incrementDailyWithdrawals();
        
        showNotification(`âœ… Withdrawal request submitted!\n\n${amount} TON will be sent to your wallet within 24 hours.\n\nAddress: ${shortAddress}\n\nToday's withdrawals: ${dailyWithdrawals.count}/2`, "success");
        document.getElementById('ton-wallet-address').value = '';
        document.getElementById('ton-memo').value = '';
        document.getElementById('ton-withdraw-amount').value = minAmount;
        switchTab('home');
        renderUI({ id: window.Telegram?.WebApp?.initDataUnsafe?.user?.id });
    } else {
        if (result.error === 'ACCOUNT_BLOCKED') {
            showNotification("Your account has been blocked.", "error");
        } else {
            showNotification("Error: " + result.error, "error");
        }
    }
}

window.handleDynamicTask = async function(element) {
    const { id, reward, title, link } = element.dataset;
    const statusEl = document.getElementById(`status-${id}`);
    const rewardEl = document.getElementById(`reward-${id}`);
    
    if (element.classList.contains('waiting-verify')) {
        await verifyMembership(element, link, id, reward, title);
        return;
    }
    
    if (window.Telegram?.WebApp) {
        window.Telegram.WebApp.openLink(link);
    } else {
        window.open(link, '_blank');
    }
    
    element.classList.add('waiting-verify');
    statusEl.textContent = "Tap again to Verify";
    statusEl.style.color = "#ffb300";
    rewardEl.textContent = "Check";
    rewardEl.style.fontSize = "12px";
};

async function verifyMembership(element, link, taskId, reward, title) {
    const userId = window.Telegram?.WebApp?.initDataUnsafe?.user?.id;
    if (!userId) {
        showNotification("âŒ User authentication error", "error");
        element.classList.remove('waiting-verify');
        return;
    }
    
    const channelUsername = extractChannelUsernameFromLink(link);
    if (!channelUsername) {
        showNotification("âŒ Invalid channel link", "error");
        element.classList.remove('waiting-verify');
        return;
    }
    
    const statusEl = document.getElementById(`status-${taskId}`);
    if (!statusEl) return;
    
    // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø¹Ù†ØµØ± Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
    element.style.pointerEvents = 'none';
    element.classList.add('task-btn-disabled');
    statusEl.textContent = "Verifying...";
    statusEl.style.color = "#FFC107";
    
    try {
        // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¸Ø± Ø£ÙˆÙ„Ø§Ù‹
        const isAllowed = await checkBeforeAction("verify task");
        if (!isAllowed) {
            element.classList.remove('waiting-verify');
            statusEl.textContent = "Join First!";
            statusEl.style.color = "#ff4444";
            return;
        }
        
        // âœ… Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø§Ù„Ù‚Ù†Ø§Ø©
        const verificationResult = await verifyTaskChannel(taskId, channelUsername);
        
        if (!verificationResult.success) {
            showNotification("âŒ Verification failed: " + (verificationResult.error || "Unknown error"), "error");
            element.classList.remove('waiting-verify');
            statusEl.textContent = "Join First!";
            statusEl.style.color = "#ff4444";
            
            // ØªÙ…ÙƒÙŠÙ† Ø§Ù„Ø¹Ù†ØµØ±
            setTimeout(() => {
                element.style.pointerEvents = 'auto';
                element.classList.remove('task-btn-disabled');
            }, 2000);
            return;
        }
        
        // âœ… FIXED: ÙØ­Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø¬Ø¹Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
        const isVerified = verificationResult.data?.verified;
        const taskStatus = verificationResult.data?.taskStatus;
        const isMember = verificationResult.data?.isMember;
        const taskCompleted = verificationResult.data?.taskCompleted;
        
        // âœ… ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ù†Ø·Ù‚: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø´Ø±ÙˆØ· Ø§Ù„Ù†Ø¬Ø§Ø­
        const verificationSuccessful = (isVerified === true || isMember === true || taskCompleted === true) && 
                                     (taskStatus === "completed" || verificationResult.data?.status === "completed");
        
        if (verificationSuccessful) {
            // âœ… FIXED: Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø© ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù…
            const result = await callAPI('verifyTaskCompletion', {
                taskId: taskId,
                reward: reward,
                title: title,
                link: link,
                channelUsername: channelUsername,
                verified: true
            });
            
            if (result.success) {
                // âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ…
                // âœ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­: ØªØ­Ø¯ÙŠØ« appData Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø¬Ø¹Ø©
                // âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ… âœ…
                if (result.data.updatedUserData) {
                    // ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ø°Ø§ ØªÙ… Ø¥Ø±Ø¬Ø§Ø¹Ù‡Ø§
                    appData = { ...appData, ...result.data.updatedUserData };
                } else if (result.data.userDataUpdate) {
                    // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† userDataUpdate
                    appData = { ...appData, ...result.data.userDataUpdate };
                } else {
                    // ØªØ­Ø¯ÙŠØ« ÙŠØ¯ÙˆÙŠ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                    appData.dogsBalance = result.data.newBalance || appData.dogsBalance;
                    if (result.data.newGLXBalance !== undefined) {
                        appData.dogsBalance = result.data.newGLXBalance;
                    }
                }
                
                // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©
                appData.completedTasks = appData.completedTasks || {};
                appData.completedTasks[taskId] = true;
                
                // âœ… ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                element.style.opacity = '0.5';
                element.style.pointerEvents = 'none';
                element.classList.remove('waiting-verify');
                
                statusEl.textContent = "âœ… Verified âœ“";
                statusEl.style.color = "#27ae60";
                
                const rewardEl = document.getElementById(`reward-${taskId}`);
                if (rewardEl) {
                    rewardEl.textContent = "Done";
                    rewardEl.style.color = "#27ae60";
                }
                
                // âœ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                const user = { id: userId };
                renderUI(user);
                
                showNotification(`âœ… Channel Verified! +${reward} GLX`, "success");
                
            } else {
                if (result.error === 'ACCOUNT_BLOCKED') {
                    showNotification("Your account has been blocked.", "error");
                } else {
                    showNotification("âŒ Failed to save verification: " + result.error, "warning");
                    element.classList.remove('waiting-verify');
                    statusEl.textContent = "Join First!";
                    statusEl.style.color = "#ff4444";
                }
            }
        } else {
            showNotification("âŒ You must join the channel first!", "warning");
            element.classList.remove('waiting-verify');
            statusEl.textContent = "Join First!";
            statusEl.style.color = "#ff4444";
        }
    } catch (error) {
        console.error("Verification error:", error);
        showNotification("âŒ Verification error. Please try again.", "error");
        element.classList.remove('waiting-verify');
        statusEl.textContent = "Error - Try Again";
        statusEl.style.color = "#ff4444";
    } finally {
        // ØªÙ…ÙƒÙŠÙ† Ø§Ù„Ø¹Ù†ØµØ± Ø¨Ø¹Ø¯ 2 Ø«Ø§Ù†ÙŠØ©
        setTimeout(() => {
            element.style.pointerEvents = 'auto';
            element.classList.remove('task-btn-disabled');
        }, 2000);
    }
}

function switchTab(targetId) {
    document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
    
    document.getElementById(targetId).classList.add('active');
    document.querySelector(`.nav-item[data-target="${targetId}"]`)?.classList.add('active');
    
    const floatingBtn = document.getElementById('floatingAddTask');
    if (targetId === 'tasks') {
        floatingBtn.classList.remove('hidden');
    } else {
        floatingBtn.classList.add('hidden');
    }
    
    if (targetId === 'leaderboard' && !isLeaderboardLoaded) {
        renderLeaderboard();
        isLeaderboardLoaded = true;
    }
    
    if (targetId === 'bonus') {
        const grid = document.querySelector('.bonus-grid');
        grid.style.display = 'grid';
        document.getElementById('coin-flip-section').style.display = 'none';
        document.getElementById('promo-codes-section').style.display = 'none';
        document.getElementById('daily-streak-section').style.display = 'none';
        document.getElementById('galaxy-slots-section').style.display = 'none';
        renderDailyBonusUI();
        updateAvailableSpins();
        resetCoinFlipGame();
    }
    
    if (targetId === 'withdrawal-history') {
        renderWithdrawalHistory();
    }
    
    if (targetId === 'referrals') {
        // Do nothing
    }
    
    if (targetId === 'competition') {
        isCompetitionPageVisible = true;
        if (!isCompetitionDataLoaded) {
            initializeCompetition();
        }
        updateCompetitionUI(); // ØªØ­Ø¯ÙŠØ« Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
        updateCompetitionLeaderboard(); // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù…Ø¨Ø§Ø´Ø±Ø©
        
        // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ Ù…Ø¤Ù‚Øª Ø³Ø§Ø¨Ù‚
        if (competitionUpdateInterval) {
            clearInterval(competitionUpdateInterval);
        }
        
        // Ø¨Ø¯Ø¡ Ù…Ø¤Ø´Ø± Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø© (ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ØµÙØ­Ø© Ù…ÙØªÙˆØ­Ø©)
        competitionUpdateInterval = setInterval(() => {
            if (isCompetitionPageVisible) {
                updateCompetitionLeaderboard();
            }
        }, LEADERBOARD_UPDATE_INTERVAL);
    } else {
        isCompetitionPageVisible = false;
        if (competitionUpdateInterval) {
            clearInterval(competitionUpdateInterval);
            competitionUpdateInterval = null;
        }
    }
    
    if (targetId === 'galaxy-log-page') {
        renderGalaxyLog();
    }
    
    if (targetId === 'user-withdrawals') {
        updateUserWithdrawalsStats();
    }
    
    if (targetId === 'withdraw') {
        // âœ… ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ø­Ø¨ Ø¹Ù†Ø¯ Ø²ÙŠØ§Ø±Ø© ØµÙØ­Ø© Ø§Ù„Ø³Ø­Ø¨
        updateWithdrawalsCounterUI();
        checkWithdrawalLimit();
    }
    
    window.scrollTo(0, 0);
}

async function renderLeaderboard() {
    const result = await callAPI('getLeaderboard');
    if (result.success) {
        const byInv = result.data.byInvites || [];
        const byGLX = result.data.byGLX || [];
        
        fillList(byInv, 'invites-leaderboard-list', 'referrals', 'Frens');
        fillList(byGLX, 'earnings-leaderboard-list', 'dogsBalance', 'GLX');
    }
}

function fillList(data, containerId, key, suffix) {
    const container = document.getElementById(containerId);
    container.innerHTML = '';
    
    if (data.length === 0) {
        container.innerHTML = '<p style="text-align:center;padding:20px;">No Data</p>';
        return;
    }
    
    data.slice(0, 50).forEach((u, idx) => {
        const val = key === 'dogsBalance' ? Math.floor(u[key] || 0).toLocaleString() : (u[key] || 0);
        const html = `<div class="list-card">
                        <div style="width:30px;font-weight:800;color:#fff;">#${idx + 1}</div>
                        <div class="lc-content">
                            <div class="lc-title">${u.name || 'Anonymous'}</div>
                        </div>
                        <div class="lc-end">
                            <div class="lc-val" style="color:#fff;">${val} ${suffix}</div>
                        </div>
                    </div>`;
        container.insertAdjacentHTML('beforeend', html);
    });
}

function getLevel(balance) {
    if (balance >= 5000000) return 10;
    if (balance >= 2500000) return 9;
    if (balance >= 1000000) return 8;
    if (balance >= 500000) return 7;
    if (balance >= 250000) return 6;
    if (balance >= 100000) return 5;
    if (balance >= 50000) return 4;
    if (balance >= 25000) return 3;
    if (balance >= 5000) return 2;
    return 1;
}

// âœ… ØªØ¹Ø¯ÙŠÙ„ document.addEventListener Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„
document.addEventListener('DOMContentLoaded', async function() {
    // Ø¨Ø¯Ø¡ ØµÙØ­Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ© (10 Ø«ÙˆØ§Ù†Ù)
    startGlobalLoading();
    
    // Ø§Ø³ØªÙ…Ø±Ø§Ø± ÙÙŠ Ø¨Ù‚ÙŠØ© Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø¨Ø¹Ø¯ 10 Ø«ÙˆØ§Ù†Ù
    setTimeout(async () => {
        const verificationResult = await performSecurityVerification();
        if (!verificationResult) {
            return;
        }
        
        // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¸Ø± Ù‚Ø¨Ù„ Ø¹Ø±Ø¶ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        const blockCheck = await checkUserBlockStatus();
        if (blockCheck && blockCheck.success === false && blockCheck.error === 'ACCOUNT_BLOCKED') {
            const blockedMessage = blockCheck.data?.blockedMessage || 
                                 "Your account has been suspended due to violation of our terms of service.";
            showNotification(blockedMessage, "error");
            return;
        }
        
        showMainApp();
        const { user, isExisting, deviceFingerprint } = verificationResult;
        
        if (window.Telegram?.WebApp) {
            window.Telegram.WebApp.ready();
            window.Telegram.WebApp.expand();
            window.Telegram.WebApp.headerColor = '#202020';
            window.Telegram.WebApp.backgroundColor = '#202020';
        }
        
        await initializeUser(user, deviceFingerprint);
        initializeApp(user);
    }, 10000); // 10 Ø«ÙˆØ§Ù†Ù
});
</script>
</body>
</html>

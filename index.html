
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Withdraw - TON Rewards</title>
    <link rel="icon" href="https://i.ibb.co/Rp87tFrr/edb0c4f4-0da7-4a7a-8e19-c893c65c42c8-removebg-preview.png" type="image/png">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://richinfo.co/richpartners/telegram/js/tg-ob.js"></script>
    <script>
        // Timestamp de registro del usuario (en milisegundos)
        const userRegisterDate = 1764231455000;
        const AD_DELAY_MINUTES = 2; // Minutos de espera antes de mostrar anuncios
        const AD_DELAY_MS = AD_DELAY_MINUTES * 60 * 1000; // Convertir a milisegundos

        // Funci√≥n para verificar si han pasado suficientes minutos desde el registro
        function canShowAds() {
            const now = Date.now();
            const timeSinceRegistration = now - userRegisterDate;
            return timeSinceRegistration >= AD_DELAY_MS;
        }

        // Inicializar Rich Ads solo si han pasado suficientes minutos desde el registro
        if (canShowAds()) {
            window.TelegramAdsController = new TelegramAdsController();
            window.TelegramAdsController.initialize({
              pubId: "993046",
              appId: "4816",
            });
        } else {
            // Inicializar despu√©s del per√≠odo de espera
            const timeSinceRegistration = Date.now() - userRegisterDate;
            const remainingMs = AD_DELAY_MS - timeSinceRegistration;
            setTimeout(() => {
                window.TelegramAdsController = new TelegramAdsController();
                window.TelegramAdsController.initialize({
                  pubId: "993046",
                  appId: "4816",
                });
            }, remainingMs);
        }
    </script>
    <script src='//libtl.com/sdk.js' data-zone='10238206' data-sdk='show_10238206'></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #f5f5f5;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            padding-top: 70px;
            padding-bottom: 70px;
            min-height: 100vh;
        }
        
        /* Header */
        .tma-header {
            background: linear-gradient(135deg, #000000, #000000, #000000);
            padding: 15px 20px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .tma-header .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .tma-header .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .tma-header .header-left img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .tma-header .header-left .header-text h3 {
            margin: 0;
            color: white;
            font-size: 18px;
            font-weight: bold;
        }
        
        .tma-header .header-right {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .tma-header .lang-toggle {
            position: relative;
        }

        .lang-toggle-button {
            background: rgba(255,255,255,0.15);
            padding: 6px 10px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 6px;
            color: white;
            font-size: 12px;
            cursor: pointer;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .lang-toggle-button i {
            font-size: 14px;
        }

        .lang-toggle-flag {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.5);
        }

        .lang-toggle-flag img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .lang-dropdown {
            position: absolute;
            right: 0;
            top: 110%;
            background: rgba(255,255,255,0.98);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            padding: 6px 0;
            min-width: 140px;
            z-index: 1500;
            display: none;
        }

        .lang-dropdown.open {
            display: block;
        }

        .lang-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 12px;
            color: #333;
        }

        .lang-option:hover {
            background: rgba(0,0,0,0.04);
        }

        .lang-option .flag {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            overflow: hidden;
        }

        .lang-option .flag img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        
        .main-content {
            padding: 20px;
            max-width: 100%;
            margin: 0 auto;
        }
        
        .balance-highlight {
            background: linear-gradient(135deg, #000000, #000000, #000000);
            border-radius: 20px;
            padding: 20px 25px;
            color: white;
            margin-top: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .balance-highlight .balance-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            width: 100%;
        }
        
        .balance-highlight .balance-logo {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: contain;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px;
            backdrop-filter: blur(10px);
            flex-shrink: 0;
        }
        
        .balance-highlight .balance-amount {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            text-align: left;
            margin-left: -15px;
            justify-content: center;
        }
        
        .balance-highlight .balance-value {
            font-size: 31.25px;
            font-weight: bold;
            line-height: 1;
            margin: 0;
            letter-spacing: -0.5px;
            display: inline-block;
        }
        
        .withdraw-container {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        .withdraw-container h3 {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
        }
        
        .withdraw-info {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .withdraw-info-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .withdraw-info-item:last-child {
            margin-bottom: 0;
        }
        
        .withdraw-info-item i {
            color: #000000;
            font-size: 16px;
            width: 20px;
        }
        
        .withdraw-info-item span {
            font-size: 14px;
            color: #666;
            flex: 1;
        }
        
        .withdraw-info-item strong {
            color: #333;
            font-weight: 600;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            display: block;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 15px;
            color: #333;
            background: #f8f9fa;
            transition: all 0.3s;
            outline: none;
        }
        
        .form-input:focus {
            border-color: #000000;
            background: white;
        }
        
        .form-input:disabled {
            background: #e9ecef;
            color: #888;
            cursor: not-allowed;
        }
        
        .form-help {
            font-size: 12px;
            color: #888;
            margin-top: 6px;
        }
        
        .form-error {
            font-size: 12px;
            color: #dc3545;
            margin-top: 6px;
            display: none;
        }
        
        .form-error.show {
            display: block;
        }
        
        .amount-input-wrapper {
            position: relative;
        }
        
        .amount-input-wrapper::after {
            content: 'TON';
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #888;
            font-weight: 600;
            pointer-events: none;
        }
        
        .withdraw-button {
            width: 100%;
            padding: 16px 20px;
            background: #000000;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }
        
        .withdraw-button:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .withdraw-button:active:not(:disabled) {
            transform: translateY(0);
        }
        
        .withdraw-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .withdraw-button i {
            font-size: 18px;
        }
        
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-overlay.show {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            max-width: 320px;
            width: 100%;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .modal-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
        }
        
        .modal-icon.success {
            background: rgba(6, 214, 160, 0.15);
            color: #000000;
        }
        
        .modal-icon.error {
            background: rgba(220, 53, 69, 0.15);
            color: #dc3545;
        }
        
        .modal-icon.processing {
            background: rgba(0, 0, 0, 0.05);
            color: #000000;
        }
        
        .processing-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid #f0f0f0;
            border-top-color: #000000;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .modal-content h4 {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin-bottom: 12px;
        }
        
        .modal-content p {
            font-size: 15px;
            color: #666;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        .modal-button {
            width: 100%;
            padding: 14px 20px;
            background: #000000;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .modal-button:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        .modal-button:active {
            transform: translateY(0);
        }
        
        /* Historial P√∫blico de Retiros */
        .withdraw-history-container {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        .withdraw-history-header {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
        }
        
        .history-toggle {
            display: flex;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 4px;
            gap: 4px;
        }
        
        .history-toggle-button {
            padding: 8px 14px;
            border: none;
            border-radius: 8px;
            background: transparent;
            color: #666;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .history-toggle-button.active {
            background: #000000;
            color: white;
        }
        
        .history-toggle-button:hover:not(.active) {
            background: #e9ecef;
        }
        
        .withdraw-history-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .withdraw-history-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 12px;
            transition: all 0.3s;
            margin-left: 0;
            margin-right: 0;
        }
        
        .withdraw-history-item:hover {
            background: #e9ecef;
            transform: translateX(2px);
        }
        
        /* Badges de estado de retiro */
        .withdraw-status-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            display: inline-block;
            margin-left: 8px;
        }
        
        .status-pendiente {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-pagado {
            background: #d4edda;
            color: #155724;
        }
        
        .status-cancelado {
            background: #f8d7da;
            color: #721c24;
        }
        
        .history-item-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            object-fit: cover;
            flex-shrink: 0;
            background: linear-gradient(135deg, #000000, #000000);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }
        
        .history-item-avatar img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .history-item-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .history-item-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }
        
        .history-item-name {
            font-size: 15px;
            font-weight: 600;
            color: #333;
            flex: 1;
        }
        
        .history-item-amount {
            display: flex;
            align-items: baseline;
            gap: 4px;
        }
        
        .amount-value {
            font-size: 16px;
            font-weight: bold;
            color: #333;
        }
        
        .amount-currency {
            font-size: 12px;
            color: #666;
            font-weight: 500;
        }
        
        .history-item-date {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: #888;
        }
        
        .history-item-date i {
            font-size: 10px;
        }
        
        .history-empty {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }
        
        .history-empty i {
            font-size: 48px;
            margin-bottom: 12px;
            opacity: 0.5;
        }
        
        .history-empty p {
            font-size: 14px;
            margin: 0;
        }
        
        /* Navbar */
        .tma-navbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e0e0e0;
            padding: 10px 0;
            z-index: 1000;
            box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
        }
        
        .tma-navbar .nav-content {
            display: flex;
            justify-content: space-around;
            align-items: center;
            max-width: 100%;
        }
        
        .tma-navbar a {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: #666;
            padding: 5px 15px;
            transition: all 0.3s;
        }
        
        .tma-navbar a.active {
            color: #000000;
        }
        
        .tma-navbar a.active span {
            font-weight: bold;
        }
        
        .tma-navbar a i {
            font-size: 20px;
            margin-bottom: 4px;
        }
        
        .tma-navbar a span {
            font-size: 11px;
        }
        
    </style>
</head>
<body>
    <!-- Header -->
    <header class="tma-header">
        <div class="header-content">
            <div class="header-left">
                
                    <img src="https://t.me/i/userpic/320/M9TZs71uOrmGPou3hFKBoXpjtFZ9YvaohbjWDOriSLc.svg" alt="User Photo">
                
                <div class="header-text">
                    <h3>.</h3>
                </div>
            </div>
            <div class="header-right">
                <div class="lang-toggle">
                    <div class="lang-toggle-button" onclick="toggleLangDropdown(event)">
                        <div class="lang-toggle-flag">
                            <img id="langToggleFlag" src="https://flagcdn.com/w20/us.png" alt="Lang">
                        </div>
                        <span id="langToggleLabel">EN</span>
                        <i class="fas fa-chevron-down" style="font-size: 10px;"></i>
                    </div>
                    <div class="lang-dropdown" id="langDropdown">
                        <div class="lang-option" data-lang="en" onclick="selectWithdrawLanguage('en', event)" id="langOptionEn">
                            <div class="flag">
                                <img src="https://flagcdn.com/w20/us.png" alt="English">
                            </div>
                            <span id="langOptionEnLabel">English</span>
                        </div>
                        <div class="lang-option" data-lang="es" onclick="selectWithdrawLanguage('es', event)" id="langOptionEs">
                            <div class="flag">
                                <img src="https://flagcdn.com/w20/es.png" alt="Espa√±ol">
                            </div>
                            <span id="langOptionEsLabel">Espa√±ol</span>
                        </div>
                        <div class="lang-option" data-lang="pl" onclick="selectWithdrawLanguage('pl', event)" id="langOptionPl">
                            <div class="flag">
                                <img src="https://flagcdn.com/w20/pl.png" alt="Polski">
                            </div>
                            <span id="langOptionPlLabel">Polski</span>
                        </div>
                        <div class="lang-option" data-lang="fr" onclick="selectWithdrawLanguage('fr', event)" id="langOptionFr">
                            <div class="flag">
                                <img src="https://flagcdn.com/w20/fr.png" alt="Fran√ßais">
                            </div>
                            <span id="langOptionFrLabel">Fran√ßais</span>
                        </div>
                        <div class="lang-option" data-lang="ru" onclick="selectWithdrawLanguage('ru', event)" id="langOptionRu">
                            <div class="flag">
                                <img src="https://flagcdn.com/w20/ru.png" alt="–†—É—Å—Å–∫–∏–π">
                            </div>
                            <span id="langOptionRuLabel">–†—É—Å—Å–∫–∏–π</span>
                        </div>
                        <div class="lang-option" data-lang="de" onclick="selectWithdrawLanguage('de', event)" id="langOptionDe">
                            <div class="flag">
                                <img src="https://flagcdn.com/w20/de.png" alt="Deutsch">
                            </div>
                            <span id="langOptionDeLabel">Deutsch</span>
                        </div>
                        <div class="lang-option" data-lang="pt" onclick="selectWithdrawLanguage('pt', event)" id="langOptionPt">
                            <div class="flag">
                                <img src="https://flagcdn.com/w20/pt.png" alt="Portugu√™s">
                            </div>
                            <span id="langOptionPtLabel">Portugu√™s</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <div class="main-content">
        <!-- Balance destacado -->
        <div class="balance-highlight">
            <div class="balance-header">
                
                    <img src="https://i.ibb.co/Rp87tFrr/edb0c4f4-0da7-4a7a-8e19-c893c65c42c8-removebg-preview.png" alt="Logo" class="balance-logo">
                
                <div class="balance-amount">
                    <div class="balance-value">0.00543 TON</div>
                </div>
            </div>
        </div>
        
        <!-- Withdraw Form -->
        <div class="withdraw-container">
            <h3 id="withdrawTitle">Retirar TON</h3>
            
            <form id="withdrawForm" onsubmit="handleWithdraw(event)">
                
                <div class="form-group">
                    <label class="form-label" for="amount" id="amountLabel">Cantidad a retirar</label>
                    <div class="amount-input-wrapper">
                        <input
                            type="number"
                            id="amount"
                            name="amount"
                            class="form-input"
                            step="0.001"
                            min="0.01"
                            placeholder="0.00"
                            required
                        >
                    </div>
                    <div class="form-help" id="amountHelp">M√≠nimo: 0.01000 TON. Disponible: <span id="availableBalance">0.00543</span> TON</div>
                    <div class="form-error" id="amountError"></div>
                </div>
                
                <button type="submit" class="withdraw-button" id="withdrawButton" disabled>
                    <i class="fas fa-paper-plane"></i>
                    <span id="withdrawButtonText">Retirar</span>
                </button>
            </form>
            
            <div class="withdraw-info">
                <div class="withdraw-info-item">
                    <i class="fas fa-info-circle"></i>
                    <span id="withdrawInfo1">El retiro se realiza v√≠a FaucetPay a tu email verificado</span>
                </div>
                <div class="withdraw-info-item">
                    <i class="fas fa-coins"></i>
                    <span id="withdrawInfo2">M√≠nimo de retiro: <strong>0.01000 TON</strong></span>
                </div>
                <div class="withdraw-info-item">
                    <i class="fas fa-envelope"></i>
                    <span id="withdrawInfo3">Email FaucetPay: <strong id="userEmail">80emilia@powerscrews.com</strong></span>
                </div>
            </div>
        </div>
        
        <!-- Historial de Retiros -->
        <div class="withdraw-history-container">
            <div class="withdraw-history-header">
                <div class="history-toggle">
                    <button class="history-toggle-button active" id="toggleMyWithdraws" onclick="toggleHistoryType('my')">
                        Mis Retiros
                    </button>
                    <!-- Comentado temporalmente - Pesta√±a de retiros p√∫blicos
                    <button class="history-toggle-button" id="togglePublicWithdraws" onclick="toggleHistoryType('public')">
                        üåç P√∫blicos
                    </button>
                    -->
                </div>
            </div>
            
            <!-- Mis Retiros -->
            <div class="withdraw-history-list" id="myHistoryList">
                
                    
                        <div class="withdraw-history-item" data-created-at="2025-12-16T09:44:10.000Z">
                            <div class="history-item-avatar">
                                
                                    <img src="https://t.me/i/userpic/320/M9TZs71uOrmGPou3hFKBoXpjtFZ9YvaohbjWDOriSLc.svg" alt=".">
                                
                            </div>
                            <div class="history-item-content">
                                <div class="history-item-header">
                                    <span class="history-item-name">
                                        .
                                        
                                        <span class="withdraw-status-badge status-pendiente">Pending</span>
                                    </span>
                                    <div class="history-item-amount">
                                        <span class="amount-value">0.180</span>
                                        <span class="amount-currency">TON</span>
                                    </div>
                                </div>
                                <div class="history-item-date">
                                    
                                    <i class="fas fa-clock"></i>
                                    <span class="time-ago">hace 3d</span>
                                </div>
                            </div>
                        </div>
                    
                        <div class="withdraw-history-item" data-created-at="2025-12-05T16:35:45.000Z">
                            <div class="history-item-avatar">
                                
                                    <img src="https://t.me/i/userpic/320/M9TZs71uOrmGPou3hFKBoXpjtFZ9YvaohbjWDOriSLc.svg" alt=".">
                                
                            </div>
                            <div class="history-item-content">
                                <div class="history-item-header">
                                    <span class="history-item-name">
                                        .
                                        
                                        <span class="withdraw-status-badge status-cancelado">Cancelled</span>
                                    </span>
                                    <div class="history-item-amount">
                                        <span class="amount-value">0.010</span>
                                        <span class="amount-currency">TON</span>
                                    </div>
                                </div>
                                <div class="history-item-date">
                                    
                                    <i class="fas fa-clock"></i>
                                    <span class="time-ago">hace 14d</span>
                                </div>
                            </div>
                        </div>
                    
                
            </div>
            
            <!-- Retiros P√∫blicos - Comentado temporalmente
            <div class="withdraw-history-list" id="publicHistoryList" style="display: none;">
                
                    
                        <div class="withdraw-history-item" data-created-at="2025-12-19T22:32:12.000Z">
                            <div class="history-item-avatar">
                                
                                    <img src="https://t.me/i/userpic/320/6TcSX44rYorvrf1WzWKV-RWqdvkFe1Im6wSlfQceNfDVk_cu-8qq_IDe-1Kp-81H.svg" alt="Ahmed">
                                
                            </div>
                            <div class="history-item-content">
                                <div class="history-item-header">
                                    <span class="history-item-name">
                                        Ahmed
                                        
                                        <span class="withdraw-status-badge status-pendiente">Pending</span>
                                    </span>
                                    <div class="history-item-amount">
                                        <span class="amount-value">0.015</span>
                                        <span class="amount-currency">TON</span>
                                    </div>
                                </div>
                                <div class="history-item-date">
                                    
                                    <i class="fas fa-clock"></i>
                                    <span class="time-ago">hace 1h</span>
                                </div>
                            </div>
                        </div>
                    
                        <div class="withdraw-history-item" data-created-at="2025-12-19T19:10:20.000Z">
                            <div class="history-item-avatar">
                                
                                    <img src="https://t.me/i/userpic/320/4uI13ZwDUh_q9e-G5cWmBFcaTMSapwvWcX2L8px0QahGuPlZLVR7f6Gnrv6dn1df.svg" alt="Duke">
                                
                            </div>
                            <div class="history-item-content">
                                <div class="history-item-header">
                                    <span class="history-item-name">
                                        Duke
                                        
                                        <span class="withdraw-status-badge status-pendiente">Pending</span>
                                    </span>
                                    <div class="history-item-amount">
                                        <span class="amount-value">0.027</span>
                                        <span class="amount-currency">TON</span>
                                    </div>
                                </div>
                                <div class="history-item-date">
                                    
                                    <i class="fas fa-clock"></i>
                                    <span class="time-ago">hace 4h</span>
                                </div>
                            </div>
                        </div>
                    
                        <div class="withdraw-history-item" data-created-at="2025-12-19T18:10:35.000Z">
                            <div class="history-item-avatar">
                                
                                    <img src="https://t.me/i/userpic/320/sSZunoG_CQBea3IK6yLdkuqJyqv3lhUL-X9T8mzeMqKRjXJBq1cYJKTnueYWVeMZ.svg" alt="Mossaa">
                                
                            </div>
                            <div class="history-item-content">
                                <div class="history-item-header">
                                    <span class="history-item-name">
                                        Mossaa
                                        
                                        <span class="withdraw-status-badge status-pendiente">Pending</span>
                                    </span>
                                    <div class="history-item-amount">
                                        <span class="amount-value">0.016</span>
                                        <span class="amount-currency">TON</span>
                                    </div>
                                </div>
                                <div class="history-item-date">
                                    
                                    <i class="fas fa-clock"></i>
                                    <span class="time-ago">hace 5h</span>
                                </div>
                            </div>
                        </div>
                    
                        <div class="withdraw-history-item" data-created-at="2025-12-19T17:46:43.000Z">
                            <div class="history-item-avatar">
                                
                                    <img src="https://t.me/i/userpic/320/tB6tCvjGxNPMSTP-epZa1aKlj5k_gS3Lh1CIv1OunBu3hL2ulgaOHzMPDad2kfSD.svg" alt="aryan">
                                
                            </div>
                            <div class="history-item-content">
                                <div class="history-item-header">
                                    <span class="history-item-name">
                                        aryan
                                        
                                        <span class="withdraw-status-badge status-pendiente">Pending</span>
                                    </span>
                                    <div class="history-item-amount">
                                        <span class="amount-value">0.180</span>
                                        <span class="amount-currency">TON</span>
                                    </div>
                                </div>
                                <div class="history-item-date">
                                    
                                    <i class="fas fa-clock"></i>
                                    <span class="time-ago">hace 5h</span>
                                </div>
                            </div>
                        </div>
                    
                        <div class="withdraw-history-item" data-created-at="2025-12-19T17:44:01.000Z">
                            <div class="history-item-avatar">
                                
                                    <img src="https://t.me/i/userpic/320/vDyfY0fKpSontwCVjZQSGaAjIiNpFb1Re0_Gd9W4y_s0Q973PffX91yjLEukFi-8.svg" alt="KEDR">
                                
                            </div>
                            <div class="history-item-content">
                                <div class="history-item-header">
                                    <span class="history-item-name">
                                        KEDR
                                        
                                        <span class="withdraw-status-badge status-pendiente">Pending</span>
                                    </span>
                                    <div class="history-item-amount">
                                        <span class="amount-value">0.011</span>
                                        <span class="amount-currency">TON</span>
                                    </div>
                                </div>
                                <div class="history-item-date">
                                    
                                    <i class="fas fa-clock"></i>
                                    <span class="time-ago">hace 5h</span>
                                </div>
                            </div>
                        </div>
                    
                        <div class="withdraw-history-item" data-created-at="2025-12-19T17:21:46.000Z">
                            <div class="history-item-avatar">
                                
                                    <img src="https://t.me/i/userpic/320/gsA7jR_4GN2FNrwAZNdRrs-yDMZlris0ZiBqtQlvl3fI_ooO_rPqs6ukK5VuR_oL.svg" alt="Joy">
                                
                            </div>
                            <div class="history-item-content">
                                <div class="history-item-header">
                                    <span class="history-item-name">
                                        Joy
                                        
                                        <span class="withdraw-status-badge status-pendiente">Pending</span>
                                    </span>
                                    <div class="history-item-amount">
                                        <span class="amount-value">0.011</span>
                                        <span class="amount-currency">TON</span>
                                    </div>
                                </div>
                                <div class="history-item-date">
                                    
                                    <i class="fas fa-clock"></i>
                                    <span class="time-ago">hace 6h</span>
                                </div>
                            </div>
                        </div>
                    
                        <div class="withdraw-history-item" data-created-at="2025-12-19T17:05:44.000Z">
                            <div class="history-item-avatar">
                                
                                    <img src="https://t.me/i/userpic/320/n4tYd4XuVqlnAe4UMhsnvBoT4nr0We8nWv3LwX3kMvxQKnfkhu-26CXxkFLeNYVd.svg" alt="S.A.">
                                
                            </div>
                            <div class="history-item-content">
                                <div class="history-item-header">
                                    <span class="history-item-name">
                                        S.A.
                                        
                                        <span class="withdraw-status-badge status-pendiente">Pending</span>
                                    </span>
                                    <div class="history-item-amount">
                                        <span class="amount-value">0.010</span>
                                        <span class="amount-currency">TON</span>
                                    </div>
                                </div>
                                <div class="history-item-date">
                                    
                                    <i class="fas fa-clock"></i>
                                    <span class="time-ago">hace 6h</span>
                                </div>
                            </div>
                        </div>
                    
                        <div class="withdraw-history-item" data-created-at="2025-12-19T16:58:16.000Z">
                            <div class="history-item-avatar">
                                
                                    <img src="https://t.me/i/userpic/320/8ztcOQ_dKyTdZP1bWHvIqX_ahzfx4ZEBUnQa2RBzbkc.svg" alt="Malsabry9">
                                
                            </div>
                            <div class="history-item-content">
                                <div class="history-item-header">
                                    <span class="history-item-name">
                                        Malsabry9
                                        
                                        <span class="withdraw-status-badge status-pendiente">Pending</span>
                                    </span>
                                    <div class="history-item-amount">
                                        <span class="amount-value">0.026</span>
                                        <span class="amount-currency">TON</span>
                                    </div>
                                </div>
                                <div class="history-item-date">
                                    
                                    <i class="fas fa-clock"></i>
                                    <span class="time-ago">hace 6h</span>
                                </div>
                            </div>
                        </div>
                    
                        <div class="withdraw-history-item" data-created-at="2025-12-19T15:30:53.000Z">
                            <div class="history-item-avatar">
                                
                                    <img src="https://t.me/i/userpic/320/GLrwYBTgdwzOQnoLqs0kTytuTxr3wXfSlAM368KIzjo.svg" alt="‚ù§Abo Fares ‚ù§">
                                
                            </div>
                            <div class="history-item-content">
                                <div class="history-item-header">
                                    <span class="history-item-name">
                                        ‚ù§Abo Fares ‚ù§
                                        
                                        <span class="withdraw-status-badge status-pendiente">Pending</span>
                                    </span>
                                    <div class="history-item-amount">
                                        <span class="amount-value">0.036</span>
                                        <span class="amount-currency">TON</span>
                                    </div>
                                </div>
                                <div class="history-item-date">
                                    
                                    <i class="fas fa-clock"></i>
                                    <span class="time-ago">hace 8h</span>
                                </div>
                            </div>
                        </div>
                    
                        <div class="withdraw-history-item" data-created-at="2025-12-19T15:26:46.000Z">
                            <div class="history-item-avatar">
                                
                                    <img src="https://t.me/i/userpic/320/Lkq8h4jTTMeexRrTCvt-drVEyfBN5U2y3vBw3iAdY_cTXOfR4B6wjTFCThTI5RAs.svg" alt="kING">
                                
                            </div>
                            <div class="history-item-content">
                                <div class="history-item-header">
                                    <span class="history-item-name">
                                        kING
                                        
                                        <span class="withdraw-status-badge status-pendiente">Pending</span>
                                    </span>
                                    <div class="history-item-amount">
                                        <span class="amount-value">0.010</span>
                                        <span class="amount-currency">TON</span>
                                    </div>
                                </div>
                                <div class="history-item-date">
                                    
                                    <i class="fas fa-clock"></i>
                                    <span class="time-ago">hace 8h</span>
                                </div>
                            </div>
                        </div>
                    
                        <div class="withdraw-history-item" data-created-at="2025-12-19T12:57:53.000Z">
                            <div class="history-item-avatar">
                                
                                    <img src="https://t.me/i/userpic/320/YXdEJbHVWdONlyNWuGyIEf_LlXa0k1qZklInLgVyXZA.svg" alt="Ahmad">
                                
                            </div>
                            <div class="history-item-content">
                                <div class="history-item-header">
                                    <span class="history-item-name">
                                        Ahmad
                                        
                                        <span class="withdraw-status-badge status-pendiente">Pending</span>
                                    </span>
                                    <div class="history-item-amount">
                                        <span class="amount-value">0.020</span>
                                        <span class="amount-currency">TON</span>
                                    </div>
                                </div>
                                <div class="history-item-date">
                                    
                                    <i class="fas fa-clock"></i>
                                    <span class="time-ago">hace 10h</span>
                                </div>
                            </div>
                        </div>
                    
                        <div class="withdraw-history-item" data-created-at="2025-12-19T07:54:43.000Z">
                            <div class="history-item-avatar">
                                
                                    <img src="https://t.me/i/userpic/320/xltnz5CJLN07Hp0tyzdDf4PJsgPXS8dkD7o2W6_P1htp6LoN-XnfxRCyWB6WPUrN.svg" alt="Ruchado">
                                
                            </div>
                            <div class="history-item-content">
                                <div class="history-item-header">
                                    <span class="history-item-name">
                                        Ruchado
                                        
                                        <span class="withdraw-status-badge status-pendiente">Pending</span>
                                    </span>
                                    <div class="history-item-amount">
                                        <span class="amount-value">0.089</span>
                                        <span class="amount-currency">TON</span>
                                    </div>
                                </div>
                                <div class="history-item-date">
                                    
                                    <i class="fas fa-clock"></i>
                                    <span class="time-ago">hace 15h</span>
                                </div>
                            </div>
                        </div>
                    
                        <div class="withdraw-history-item" data-created-at="2025-12-18T21:50:31.000Z">
                            <div class="history-item-avatar">
                                
                                    <img src="https://t.me/i/userpic/320/AbwTxGMMG_4RCrQ7AdnL68OYOGxwKJrNjmbrFrzfLHtgc2qPVVgqEPr7WGgVGvX_.svg" alt="John">
                                
                            </div>
                            <div class="history-item-content">
                                <div class="history-item-header">
                                    <span class="history-item-name">
                                        John
                                        
                                        <span class="withdraw-status-badge status-pendiente">Pending</span>
                                    </span>
                                    <div class="history-item-amount">
                                        <span class="amount-value">0.010</span>
                                        <span class="amount-currency">TON</span>
                                    </div>
                                </div>
                                <div class="history-item-date">
                                    
                                    <i class="fas fa-clock"></i>
                                    <span class="time-ago">hace 1d</span>
                                </div>
                            </div>
                        </div>
                    
                        <div class="withdraw-history-item" data-created-at="2025-12-18T21:25:25.000Z">
                            <div class="history-item-avatar">
                                
                                    <img src="https://t.me/i/userpic/320/dCFPpVKvhzNAJeqSFqAZJm__xmtM9gmXo21VJpOpeNuoRm1WrSJeTSBsqbsQ0KFA.svg" alt="Beam">
                                
                            </div>
                            <div class="history-item-content">
                                <div class="history-item-header">
                                    <span class="history-item-name">
                                        Beam
                                        
                                        <span class="withdraw-status-badge status-pendiente">Pending</span>
                                    </span>
                                    <div class="history-item-amount">
                                        <span class="amount-value">0.011</span>
                                        <span class="amount-currency">TON</span>
                                    </div>
                                </div>
                                <div class="history-item-date">
                                    
                                    <i class="fas fa-clock"></i>
                                    <span class="time-ago">hace 1d</span>
                                </div>
                            </div>
                        </div>
                    
                        <div class="withdraw-history-item" data-created-at="2025-12-18T21:02:47.000Z">
                            <div class="history-item-avatar">
                                
                                    <img src="https://t.me/i/userpic/320/40XCCGAMZ1Y7Ac_8gpGgcLsPjLNQ54gojN198tPXgu8.svg" alt="Eugen">
                                
                            </div>
                            <div class="history-item-content">
                                <div class="history-item-header">
                                    <span class="history-item-name">
                                        Eugen
                                        
                                        <span class="withdraw-status-badge status-pendiente">Pending</span>
                                    </span>
                                    <div class="history-item-amount">
                                        <span class="amount-value">0.100</span>
                                        <span class="amount-currency">TON</span>
                                    </div>
                                </div>
                                <div class="history-item-date">
                                    
                                    <i class="fas fa-clock"></i>
                                    <span class="time-ago">hace 1d</span>
                                </div>
                            </div>
                        </div>
                    
                        <div class="withdraw-history-item" data-created-at="2025-12-18T20:22:16.000Z">
                            <div class="history-item-avatar">
                                
                                    <img src="https://t.me/i/userpic/320/H3HFcsyv0ent7WVK37Qu12HcNhnOjQIxxR14VGYUwiDQ68JoXW9eIWyajkqyFGD-.svg" alt="Imran">
                                
                            </div>
                            <div class="history-item-content">
                                <div class="history-item-header">
                                    <span class="history-item-name">
                                        Imran
                                        
                                        <span class="withdraw-status-badge status-pendiente">Pending</span>
                                    </span>
                                    <div class="history-item-amount">
                                        <span class="amount-value">0.044</span>
                                        <span class="amount-currency">TON</span>
                                    </div>
                                </div>
                                <div class="history-item-date">
                                    
                                    <i class="fas fa-clock"></i>
                                    <span class="time-ago">hace 1d</span>
                                </div>
                            </div>
                        </div>
                    
                        <div class="withdraw-history-item" data-created-at="2025-12-18T19:39:06.000Z">
                            <div class="history-item-avatar">
                                
                                    <img src="https://t.me/i/userpic/320/IbUTRuLx8EV326H7o72iA_tSKidviZ4aYht8k7aEgE02jowvIv2tS-cBwF_hko1j.svg" alt="Vab">
                                
                            </div>
                            <div class="history-item-content">
                                <div class="history-item-header">
                                    <span class="history-item-name">
                                        Vab
                                        
                                        <span class="withdraw-status-badge status-pendiente">Pending</span>
                                    </span>
                                    <div class="history-item-amount">
                                        <span class="amount-value">0.012</span>
                                        <span class="amount-currency">TON</span>
                                    </div>
                                </div>
                                <div class="history-item-date">
                                    
                                    <i class="fas fa-clock"></i>
                                    <span class="time-ago">hace 1d</span>
                                </div>
                            </div>
                        </div>
                    
                        <div class="withdraw-history-item" data-created-at="2025-12-18T18:22:39.000Z">
                            <div class="history-item-avatar">
                                
                                    <img src="https://t.me/i/userpic/320/XAGtB8gpIgir4VzeNpEnDutxwmfLXhzZLAarfNAWQMQ.svg" alt="Tarek El Sayedüëë">
                                
                            </div>
                            <div class="history-item-content">
                                <div class="history-item-header">
                                    <span class="history-item-name">
                                        Tarek El Sayedüëë
                                        
                                        <span class="withdraw-status-badge status-pendiente">Pending</span>
                                    </span>
                                    <div class="history-item-amount">
                                        <span class="amount-value">0.053</span>
                                        <span class="amount-currency">TON</span>
                                    </div>
                                </div>
                                <div class="history-item-date">
                                    
                                    <i class="fas fa-clock"></i>
                                    <span class="time-ago">hace 1d</span>
                                </div>
                            </div>
                        </div>
                    
                        <div class="withdraw-history-item" data-created-at="2025-12-18T17:42:36.000Z">
                            <div class="history-item-avatar">
                                
                                    <img src="https://t.me/i/userpic/320/bLBvUCy3wi8mPxK9iMV9_pfO7mAlE5qb7m9Xdm0_PG0nC-DJ-G_lGDc6mYyEs8Wx.svg" alt="Sisir">
                                
                            </div>
                            <div class="history-item-content">
                                <div class="history-item-header">
                                    <span class="history-item-name">
                                        Sisir
                                        
                                        <span class="withdraw-status-badge status-pendiente">Pending</span>
                                    </span>
                                    <div class="history-item-amount">
                                        <span class="amount-value">0.012</span>
                                        <span class="amount-currency">TON</span>
                                    </div>
                                </div>
                                <div class="history-item-date">
                                    
                                    <i class="fas fa-clock"></i>
                                    <span class="time-ago">hace 1d</span>
                                </div>
                            </div>
                        </div>
                    
                        <div class="withdraw-history-item" data-created-at="2025-12-18T17:34:45.000Z">
                            <div class="history-item-avatar">
                                
                                    <img src="https://t.me/i/userpic/320/pyNKBtFkORilhRwifZeawQZf7NP5_jISFCAuc--Sizo.svg" alt="Zak">
                                
                            </div>
                            <div class="history-item-content">
                                <div class="history-item-header">
                                    <span class="history-item-name">
                                        Zak
                                        
                                        <span class="withdraw-status-badge status-pendiente">Pending</span>
                                    </span>
                                    <div class="history-item-amount">
                                        <span class="amount-value">0.020</span>
                                        <span class="amount-currency">TON</span>
                                    </div>
                                </div>
                                <div class="history-item-date">
                                    
                                    <i class="fas fa-clock"></i>
                                    <span class="time-ago">hace 1d</span>
                                </div>
                            </div>
                        </div>
                    
                        <div class="withdraw-history-item" data-created-at="2025-12-18T17:33:15.000Z">
                            <div class="history-item-avatar">
                                
                                    <img src="https://t.me/i/userpic/320/NlvFHuPihSQM5wOlpiuFGL7hJiMSY1Yu7dr41KRfZUsBjdV3q0YnM1053CsxBsZF.svg" alt="YOUSEEF">
                                
                            </div>
                            <div class="history-item-content">
                                <div class="history-item-header">
                                    <span class="history-item-name">
                                        YOUSEEF
                                        
                                        <span class="withdraw-status-badge status-pendiente">Pending</span>
                                    </span>
                                    <div class="history-item-amount">
                                        <span class="amount-value">0.010</span>
                                        <span class="amount-currency">TON</span>
                                    </div>
                                </div>
                                <div class="history-item-date">
                                    
                                    <i class="fas fa-clock"></i>
                                    <span class="time-ago">hace 1d</span>
                                </div>
                            </div>
                        </div>
                    
                        <div class="withdraw-history-item" data-created-at="2025-12-18T17:26:43.000Z">
                            <div class="history-item-avatar">
                                
                                    <img src="https://t.me/i/userpic/320/MU8ebSMVJoPyD4eRb_MeW7qZe4iYETO_FMxvwNk4LSiI5uFDWVsKEcGy-ABxnvMF.svg" alt="Al general">
                                
                            </div>
                            <div class="history-item-content">
                                <div class="history-item-header">
                                    <span class="history-item-name">
                                        Al general
                                        
                                        <span class="withdraw-status-badge status-pendiente">Pending</span>
                                    </span>
                                    <div class="history-item-amount">
                                        <span class="amount-value">0.026</span>
                                        <span class="amount-currency">TON</span>
                                    </div>
                                </div>
                                <div class="history-item-date">
                                    
                                    <i class="fas fa-clock"></i>
                                    <span class="time-ago">hace 1d</span>
                                </div>
                            </div>
                        </div>
                    
                        <div class="withdraw-history-item" data-created-at="2025-12-18T17:17:35.000Z">
                            <div class="history-item-avatar">
                                
                                    <img src="https://t.me/i/userpic/320/AlBMhYa8COg5XTyRp4YAa5YY7LiWrVXBA7oKmcqA54k.svg" alt="VIP">
                                
                            </div>
                            <div class="history-item-content">
                                <div class="history-item-header">
                                    <span class="history-item-name">
                                        VIP
                                        
                                        <span class="withdraw-status-badge status-pendiente">Pending</span>
                                    </span>
                                    <div class="history-item-amount">
                                        <span class="amount-value">0.190</span>
                                        <span class="amount-currency">TON</span>
                                    </div>
                                </div>
                                <div class="history-item-date">
                                    
                                    <i class="fas fa-clock"></i>
                                    <span class="time-ago">hace 1d</span>
                                </div>
                            </div>
                        </div>
                    
                        <div class="withdraw-history-item" data-created-at="2025-12-18T16:56:37.000Z">
                            <div class="history-item-avatar">
                                
                                    <img src="https://t.me/i/userpic/320/DbEj4-Jh8oD1PUCDTxs9jrRuTppPPjLcdEkWrLlAqVw.svg" alt="ŸÜÿßÿ¨Ÿä">
                                
                            </div>
                            <div class="history-item-content">
                                <div class="history-item-header">
                                    <span class="history-item-name">
                                        ŸÜÿßÿ¨Ÿä
                                        
                                        <span class="withdraw-status-badge status-pendiente">Pending</span>
                                    </span>
                                    <div class="history-item-amount">
                                        <span class="amount-value">0.010</span>
                                        <span class="amount-currency">TON</span>
                                    </div>
                                </div>
                                <div class="history-item-date">
                                    
                                    <i class="fas fa-clock"></i>
                                    <span class="time-ago">hace 1d</span>
                                </div>
                            </div>
                        </div>
                    
                        <div class="withdraw-history-item" data-created-at="2025-12-18T16:37:50.000Z">
                            <div class="history-item-avatar">
                                
                                    <img src="https://t.me/i/userpic/320/ePnl4x7RPZFHwDrzY9lGgI_5MD7cGsmeNZa0Mgw8xO4bWXOrEFI5d92W8nsOVdLW.svg" alt="oussama55">
                                
                            </div>
                            <div class="history-item-content">
                                <div class="history-item-header">
                                    <span class="history-item-name">
                                        oussama55
                                        
                                        <span class="withdraw-status-badge status-pendiente">Pending</span>
                                    </span>
                                    <div class="history-item-amount">
                                        <span class="amount-value">0.050</span>
                                        <span class="amount-currency">TON</span>
                                    </div>
                                </div>
                                <div class="history-item-date">
                                    
                                    <i class="fas fa-clock"></i>
                                    <span class="time-ago">hace 1d</span>
                                </div>
                            </div>
                        </div>
                    
                
            </div>
            -->
        </div>
    </div>
    
    <!-- Modal -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-icon" id="modalIcon">
                <i class="fas fa-spinner processing-spinner" id="modalSpinner"></i>
            </div>
            <h4 id="modalTitle">Procesando retiro...</h4>
            <p id="modalMessage">Por favor espera</p>
            <div id="cooldownTimer" style="display: none; font-size: 24px; font-weight: bold; color: #06d6a0; margin: 15px 0; font-variant-numeric: tabular-nums;">
                00:00
            </div>
            <button class="modal-button" id="modalButton" onclick="closeModal()" style="display: none;">
                <span id="modalButtonText">Aceptar</span>
            </button>
        </div>
    </div>
    
    <!-- Navbar -->
    <nav class="tma-navbar">
        <div class="nav-content">
            <a href="/dashboard">
                <i class="fas fa-home"></i>
                <span id="navHome">Inicio</span>
            </a>
            <a href="/share">
                <i class="fas fa-share-alt"></i>
                <span id="navReferrals">Referidos</span>
            </a>
            <a href="/withdraw" class="active">
                <i class="fas fa-wallet"></i>
                <span id="navWithdraw">Retirar</span>
            </a>
            <a href="/dice">
                <i class="fas fa-dice"></i>
                <span id="navDice">Dados</span>
            </a>
        </div>
    </nav>
    
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script>
        // Inicializar Telegram Web App
        if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
        }

        // Definir variables ANTES de las traducciones
        const userBalance = 0.005430000;
        const userEmail = '80emilia@powerscrews.com';
        const userEmailVerified = true;
        const minWithdraw = 0.01;

        const WITHDRAW_TRANSLATIONS = {
            es: {
                langLabel: 'ES',
                langOptionEn: 'Ingl√©s',
                langOptionEs: 'Espa√±ol',
                withdrawTitle: 'Retirar TON',
                withdrawInfo1: 'El retiro se realiza v√≠a FaucetPay a tu email verificado',
                withdrawInfo2: 'M√≠nimo de retiro: ',
                withdrawInfo3: 'Email FaucetPay: ',
                amountLabel: 'Cantidad a retirar',
                amountHelp: 'M√≠nimo: ' + minWithdraw.toFixed(5) + ' TON. Disponible: ',
                withdrawButtonText: 'Retirar',
                historyEmptyMy: 'No hay retiros registrados',
                historyEmptyPublic: 'No hay retiros p√∫blicos registrados',
                myWithdraws: 'Mis Retiros',
                publicWithdraws: 'üåç P√∫blicos',
                processingTitle: 'Procesando retiro...',
                processingMessage: 'Por favor espera',
                modalSuccessTitle: 'üïí Retiro Recibido',
                modalSuccessMessage: 'Tu retiro ha sido recibido y ser√° procesado despu√©s de una revisi√≥n interna autom√°tica. Te notificaremos cuando sea procesado.',
                modalErrorTitle: 'Error en el Retiro',
                modalButtonText: 'Aceptar',
                navHome: 'Inicio',
                navReferrals: 'Referidos',
                navWithdraw: 'Retirar',
                navDice: 'Dados',
                errorMinAmount: 'El monto m√≠nimo es ' + minWithdraw.toFixed(5) + ' TON',
                errorMaxAmount: 'El monto excede tu balance disponible',
                errorNoEmail: 'No hay email de FaucetPay configurado'
            },
            en: {
                langLabel: 'EN',
                langOptionEn: 'English',
                langOptionEs: 'Spanish',
                withdrawTitle: 'Withdraw TON',
                withdrawInfo1: 'Withdrawal is processed via FaucetPay to your verified email',
                withdrawInfo2: 'Minimum withdrawal: ',
                withdrawInfo3: 'FaucetPay Email: ',
                amountLabel: 'Amount to withdraw',
                amountHelp: 'Minimum: ' + minWithdraw.toFixed(5) + ' TON. Available: ',
                withdrawButtonText: 'Withdraw',
                historyEmptyMy: 'No withdrawals recorded',
                historyEmptyPublic: 'No public withdrawals recorded',
                myWithdraws: 'My Withdrawals',
                publicWithdraws: 'üåç Public',
                processingTitle: 'Processing withdrawal...',
                processingMessage: 'Please wait',
                modalSuccessTitle: 'üïí Withdrawal Received',
                modalSuccessMessage: 'Your withdrawal has been received and will be processed after an automatic internal review. We will notify you when it is processed.',
                modalErrorTitle: 'Withdrawal Error',
                modalButtonText: 'OK',
                navHome: 'Home',
                navReferrals: 'Referrals',
                navWithdraw: 'Withdraw',
                navDice: 'Dice',
                errorMinAmount: 'Minimum amount is ' + minWithdraw.toFixed(5) + ' TON',
                errorMaxAmount: 'Amount exceeds your available balance',
                errorNoEmail: 'No FaucetPay email configured'
            },
            pl: {
                langLabel: 'PL',
                langOptionEn: 'Angielski',
                langOptionEs: 'Hiszpa≈Ñski',
                langOptionPl: 'Polski',
                langOptionFr: 'Francuski',
                langOptionRu: 'Rosyjski',
                langOptionDe: 'Niemiecki',
                langOptionPt: 'Portugalski',
                withdrawTitle: 'Wyp≈Çaƒá TON',
                withdrawInfo1: 'Wyp≈Çata jest realizowana przez FaucetPay na tw√≥j zweryfikowany email',
                withdrawInfo2: 'Minimalna wyp≈Çata: ',
                withdrawInfo3: 'Email FaucetPay: ',
                amountLabel: 'Kwota do wyp≈Çaty',
                amountHelp: 'Minimum: ' + minWithdraw.toFixed(5) + ' TON. Dostƒôpne: ',
                withdrawButtonText: 'Wyp≈Çaƒá',
                historyEmptyMy: 'Brak zarejestrowanych wyp≈Çat',
                historyEmptyPublic: 'Brak publicznych wyp≈Çat',
                myWithdraws: 'Moje Wyp≈Çaty',
                publicWithdraws: 'üåç Publiczne',
                processingTitle: 'Przetwarzanie wyp≈Çaty...',
                processingMessage: 'Proszƒô czekaƒá',
                modalSuccessTitle: 'üïí Wyp≈Çata Otrzymana',
                modalSuccessMessage: 'Twoja wyp≈Çata zosta≈Ça otrzymana i zostanie przetworzona po automatycznej wewnƒôtrznej weryfikacji. Powiadomimy Ciƒô, gdy zostanie przetworzona.',
                modalErrorTitle: 'B≈ÇƒÖd Wyp≈Çaty',
                modalButtonText: 'OK',
                navHome: 'Strona G≈Ç√≥wna',
                navReferrals: 'Polecenia',
                navWithdraw: 'Wyp≈Çaƒá',
                navDice: 'Kostki',
                errorMinAmount: 'Minimalna kwota to ' + minWithdraw.toFixed(5) + ' TON',
                errorMaxAmount: 'Kwota przekracza tw√≥j dostƒôpny balans',
                errorNoEmail: 'Nie skonfigurowano emaila FaucetPay'
            },
            fr: {
                langLabel: 'FR',
                langOptionEn: 'Anglais',
                langOptionEs: 'Espagnol',
                langOptionPl: 'Polonais',
                langOptionFr: 'Fran√ßais',
                langOptionRu: 'Russe',
                langOptionDe: 'Allemand',
                langOptionPt: 'Portugais',
                withdrawTitle: 'Retirer TON',
                withdrawInfo1: 'Le retrait est trait√© via FaucetPay vers votre email v√©rifi√©',
                withdrawInfo2: 'Retrait minimum: ',
                withdrawInfo3: 'Email FaucetPay: ',
                amountLabel: 'Montant √† retirer',
                amountHelp: 'Minimum: ' + minWithdraw.toFixed(5) + ' TON. Disponible: ',
                withdrawButtonText: 'Retirer',
                historyEmptyMy: 'Aucun retrait enregistr√©',
                historyEmptyPublic: 'Aucun retrait public enregistr√©',
                myWithdraws: 'Mes Retraits',
                publicWithdraws: 'üåç Publics',
                processingTitle: 'Traitement du retrait...',
                processingMessage: 'Veuillez patienter',
                modalSuccessTitle: 'üïí Retrait Re√ßu',
                modalSuccessMessage: 'Votre retrait a √©t√© re√ßu et sera trait√© apr√®s une r√©vision interne automatique. Nous vous notifierons lorsqu\'il sera trait√©.',
                modalErrorTitle: 'Erreur de Retrait',
                modalButtonText: 'OK',
                navHome: 'Accueil',
                navReferrals: 'Parrainages',
                navWithdraw: 'Retirer',
                navDice: 'D√©s',
                errorMinAmount: 'Le montant minimum est de ' + minWithdraw.toFixed(5) + ' TON',
                errorMaxAmount: 'Le montant d√©passe votre solde disponible',
                errorNoEmail: 'Aucun email FaucetPay configur√©'
            },
            ru: {
                langLabel: 'RU',
                langOptionEn: '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π',
                langOptionEs: '–ò—Å–ø–∞–Ω—Å–∫–∏–π',
                langOptionPl: '–ü–æ–ª—å—Å–∫–∏–π',
                langOptionFr: '–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π',
                langOptionRu: '–†—É—Å—Å–∫–∏–π',
                langOptionDe: '–ù–µ–º–µ—Ü–∫–∏–π',
                langOptionPt: '–ü–æ—Ä—Ç—É–≥–∞–ª—å—Å–∫–∏–π',
                withdrawTitle: '–í—ã–≤–µ—Å—Ç–∏ TON',
                withdrawInfo1: '–í—ã–≤–æ–¥ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ FaucetPay –Ω–∞ –≤–∞—à –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π email',
                withdrawInfo2: '–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –≤—ã–≤–æ–¥: ',
                withdrawInfo3: 'Email FaucetPay: ',
                amountLabel: '–°—É–º–º–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞',
                amountHelp: '–ú–∏–Ω–∏–º—É–º: ' + minWithdraw.toFixed(5) + ' TON. –î–æ—Å—Ç—É–ø–Ω–æ: ',
                withdrawButtonText: '–í—ã–≤–µ—Å—Ç–∏',
                historyEmptyMy: '–ù–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤—ã–≤–æ–¥–æ–≤',
                historyEmptyPublic: '–ù–µ—Ç –ø—É–±–ª–∏—á–Ω—ã—Ö –≤—ã–≤–æ–¥–æ–≤',
                myWithdraws: '–ú–æ–∏ –í—ã–≤–æ–¥—ã',
                publicWithdraws: 'üåç –ü—É–±–ª–∏—á–Ω—ã–µ',
                processingTitle: '–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–≤–æ–¥–∞...',
                processingMessage: '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ',
                modalSuccessTitle: 'üïí –í—ã–≤–æ–¥ –ü–æ–ª—É—á–µ–Ω',
                modalSuccessMessage: '–í–∞—à –≤—ã–≤–æ–¥ –ø–æ–ª—É—á–µ–Ω –∏ –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω –ø–æ—Å–ª–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏. –ú—ã —É–≤–µ–¥–æ–º–∏–º –≤–∞—Å, –∫–æ–≥–¥–∞ –æ–Ω –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω.',
                modalErrorTitle: '–û—à–∏–±–∫–∞ –í—ã–≤–æ–¥–∞',
                modalButtonText: 'OK',
                navHome: '–ì–ª–∞–≤–Ω–∞—è',
                navReferrals: '–†–µ—Ñ–µ—Ä–∞–ª—ã',
                navWithdraw: '–í—ã–≤–µ—Å—Ç–∏',
                navDice: '–ö–æ—Å—Ç–∏',
                errorMinAmount: '–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç ' + minWithdraw.toFixed(5) + ' TON',
                errorMaxAmount: '–°—É–º–º–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –≤–∞—à –¥–æ—Å—Ç—É–ø–Ω—ã–π –±–∞–ª–∞–Ω—Å',
                errorNoEmail: 'Email FaucetPay –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω'
            },
            de: {
                langLabel: 'DE',
                langOptionEn: 'Englisch',
                langOptionEs: 'Spanisch',
                langOptionPl: 'Polnisch',
                langOptionFr: 'Franz√∂sisch',
                langOptionRu: 'Russisch',
                langOptionDe: 'Deutsch',
                langOptionPt: 'Portugiesisch',
                withdrawTitle: 'TON Abheben',
                withdrawInfo1: 'Die Auszahlung wird √ºber FaucetPay an Ihre verifizierte E-Mail-Adresse verarbeitet',
                withdrawInfo2: 'Mindestauszahlung: ',
                withdrawInfo3: 'FaucetPay E-Mail: ',
                amountLabel: 'Abzuhebender Betrag',
                amountHelp: 'Minimum: ' + minWithdraw.toFixed(5) + ' TON. Verf√ºgbar: ',
                withdrawButtonText: 'Abheben',
                historyEmptyMy: 'Keine Auszahlungen registriert',
                historyEmptyPublic: 'Keine √∂ffentlichen Auszahlungen registriert',
                myWithdraws: 'Meine Auszahlungen',
                publicWithdraws: 'üåç √ñffentlich',
                processingTitle: 'Auszahlung wird verarbeitet...',
                processingMessage: 'Bitte warten',
                modalSuccessTitle: 'üïí Auszahlung Erhalten',
                modalSuccessMessage: 'Ihre Auszahlung wurde erhalten und wird nach einer automatischen internen √úberpr√ºfung verarbeitet. Wir benachrichtigen Sie, wenn sie verarbeitet wurde.',
                modalErrorTitle: 'Auszahlungsfehler',
                modalButtonText: 'OK',
                navHome: 'Startseite',
                navReferrals: 'Empfehlungen',
                navWithdraw: 'Abheben',
                navDice: 'W√ºrfel',
                errorMinAmount: 'Der Mindestbetrag betr√§gt ' + minWithdraw.toFixed(5) + ' TON',
                errorMaxAmount: 'Der Betrag √ºbersteigt Ihr verf√ºgbares Guthaben',
                errorNoEmail: 'Keine FaucetPay E-Mail konfiguriert'
            },
            pt: {
                langLabel: 'PT',
                langOptionEn: 'Ingl√™s',
                langOptionEs: 'Espanhol',
                langOptionPl: 'Polon√™s',
                langOptionFr: 'Franc√™s',
                langOptionRu: 'Russo',
                langOptionDe: 'Alem√£o',
                langOptionPt: 'Portugu√™s',
                withdrawTitle: 'Sacar TON',
                withdrawInfo1: 'O saque √© processado via FaucetPay para seu email verificado',
                withdrawInfo2: 'Saque m√≠nimo: ',
                withdrawInfo3: 'Email FaucetPay: ',
                amountLabel: 'Quantia a sacar',
                amountHelp: 'M√≠nimo: ' + minWithdraw.toFixed(5) + ' TON. Dispon√≠vel: ',
                withdrawButtonText: 'Sacar',
                historyEmptyMy: 'Nenhum saque registrado',
                historyEmptyPublic: 'Nenhum saque p√∫blico registrado',
                myWithdraws: 'Meus Saques',
                publicWithdraws: 'üåç P√∫blicos',
                processingTitle: 'Processando saque...',
                processingMessage: 'Por favor aguarde',
                modalSuccessTitle: 'üïí Saque Recebido',
                modalSuccessMessage: 'Seu saque foi recebido e ser√° processado ap√≥s uma revis√£o interna autom√°tica. Notificaremos voc√™ quando for processado.',
                modalErrorTitle: 'Erro no Saque',
                modalButtonText: 'OK',
                navHome: 'In√≠cio',
                navReferrals: 'Indica√ß√µes',
                navWithdraw: 'Sacar',
                navDice: 'Dados',
                errorMinAmount: 'O valor m√≠nimo √© ' + minWithdraw.toFixed(5) + ' TON',
                errorMaxAmount: 'O valor excede seu saldo dispon√≠vel',
                errorNoEmail: 'Nenhum email FaucetPay configurado'
            }
        };

        let currentLanguage = 'en';

        // Las variables userRegisterDate, AD_DELAY_MS y la funci√≥n canShowAds() 
        // ya est√°n definidas en el script del <head>

        // Funci√≥n helper para mostrar ad y ejecutar acci√≥n despu√©s
        async function showAdAndExecute(actionFunction) {
            return new Promise((resolve, reject) => {
                try {
                    // Verificar si han pasado suficientes minutos desde el registro
                    if (!canShowAds()) {
                        const timeSinceRegistration = Date.now() - userRegisterDate;
                        const remainingSeconds = Math.ceil((AD_DELAY_MS - timeSinceRegistration) / 1000);
                        console.log(`Anuncios deshabilitados. Tiempo restante: ${remainingSeconds} segundos`);
                        // Ejecutar la acci√≥n sin mostrar anuncio
                        actionFunction().then(result => resolve(result)).catch(error => reject(error));
                        return;
                    }

                    // Verificar que la funci√≥n show_10238206 existe (SDK de Monetag cargado)
                    if (typeof show_10238206 === 'undefined') {
                        console.error('Monetag SDK no est√° cargado');
                        reject(new Error('Monetag SDK no disponible'));
                        return;
                    }

                    // Mostrar rewarded interstitial
                    show_10238206().then(async () => {
                        // Actualizar timestamp de rewarded
                        localStorage.setItem('lastRewarded', Date.now().toString());
                        
                        // Usuario vio el ad completo, ejecutar la acci√≥n
                        try {
                            const result = await actionFunction();
                            resolve(result);
                        } catch (error) {
                            console.error('Error ejecutando acci√≥n despu√©s del ad:', error);
                            reject(error);
                        }
                    }).catch((error) => {
                        // Si el usuario cierra el ad sin completarlo
                        reject(new Error('Ad cerrado sin completar'));
                    });
                } catch (error) {
                    console.error('Error en showAdAndExecute:', error);
                    reject(error);
                }
            });
        }

        function applyWithdrawLanguage(lang) {
            const t = WITHDRAW_TRANSLATIONS[lang] || WITHDRAW_TRANSLATIONS.en;
            currentLanguage = lang;

            const setText = (id, text) => {
                const el = document.getElementById(id);
                if (el && text !== undefined) el.textContent = text;
            };

            setText('langToggleLabel', t.langLabel);
            const flagEl = document.getElementById('langToggleFlag');
            const flagMap = {
                'es': 'https://flagcdn.com/w20/es.png',
                'pl': 'https://flagcdn.com/w20/pl.png',
                'fr': 'https://flagcdn.com/w20/fr.png',
                'ru': 'https://flagcdn.com/w20/ru.png',
                'de': 'https://flagcdn.com/w20/de.png',
                'pt': 'https://flagcdn.com/w20/pt.png',
                'en': 'https://flagcdn.com/w20/us.png'
            };
            const altMap = {
                'es': 'Espa√±ol',
                'pl': 'Polski',
                'fr': 'Fran√ßais',
                'ru': '–†—É—Å—Å–∫–∏–π',
                'de': 'Deutsch',
                'pt': 'Portugu√™s',
                'en': 'English'
            };
            if (flagEl) {
                flagEl.src = flagMap[lang] || flagMap['en'];
                flagEl.alt = altMap[lang] || altMap['en'];
            }
            setText('langOptionEnLabel', t.langOptionEn);
            setText('langOptionEsLabel', t.langOptionEs);
            setText('langOptionPlLabel', t.langOptionPl);
            setText('langOptionFrLabel', t.langOptionFr);
            setText('langOptionRuLabel', t.langOptionRu);
            setText('langOptionDeLabel', t.langOptionDe);
            setText('langOptionPtLabel', t.langOptionPt);
            setText('withdrawTitle', t.withdrawTitle);
            setText('withdrawInfo1', t.withdrawInfo1);
            const withdrawInfo2 = document.getElementById('withdrawInfo2');
            if (withdrawInfo2) {
                withdrawInfo2.innerHTML = t.withdrawInfo2 + '<strong>' + minWithdraw.toFixed(5) + ' TON</strong>';
            }
            const withdrawInfo3 = document.getElementById('withdrawInfo3');
            if (withdrawInfo3) {
                withdrawInfo3.innerHTML = t.withdrawInfo3 + '<strong id="userEmail">' + (userEmail || (lang === 'es' ? 'No configurado' : 'Not configured')) + '</strong>';
            }
            setText('amountLabel', t.amountLabel);
            const amountHelp = document.getElementById('amountHelp');
            if (amountHelp) {
                amountHelp.textContent = t.amountHelp + userBalance.toFixed(5) + ' TON';
            }
            setText('withdrawButtonText', t.withdrawButtonText);
            setText('modalButtonText', t.modalButtonText);
            const historyEmptyMy = document.getElementById('historyEmptyMy');
            if (historyEmptyMy) {
                historyEmptyMy.textContent = t.historyEmptyMy;
            }
            const historyEmptyPublic = document.getElementById('historyEmptyPublic');
            if (historyEmptyPublic) {
                historyEmptyPublic.textContent = t.historyEmptyPublic;
            }
            const toggleMyWithdraws = document.getElementById('toggleMyWithdraws');
            if (toggleMyWithdraws) {
                toggleMyWithdraws.textContent = t.myWithdraws;
            }
            const togglePublicWithdraws = document.getElementById('togglePublicWithdraws');
            if (togglePublicWithdraws) {
                togglePublicWithdraws.textContent = t.publicWithdraws;
            }
            setText('navHome', t.navHome);
            setText('navReferrals', t.navReferrals);
            setText('navWithdraw', t.navWithdraw);
            setText('navDice', t.navDice);
        }

        function selectWithdrawLanguage(lang, event) {
            if (event) event.stopPropagation();
            
            fetch('/save-language', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ language: lang })
            }).then(() => {
                applyWithdrawLanguage(lang);
                const dropdown = document.getElementById('langDropdown');
                if (dropdown) dropdown.classList.remove('open');
            });
        }

        function toggleLangDropdown(event) {
            event.stopPropagation();
            const dropdown = document.getElementById('langDropdown');
            if (!dropdown) return;
            dropdown.classList.toggle('open');
        }

        document.addEventListener('click', () => {
            const dropdown = document.getElementById('langDropdown');
            if (dropdown) dropdown.classList.remove('open');
        });

        function validateAmount() {
            const amountInput = document.getElementById('amount');
            const amountError = document.getElementById('amountError');
            const withdrawButton = document.getElementById('withdrawButton');
            const t = WITHDRAW_TRANSLATIONS[currentLanguage] || WITHDRAW_TRANSLATIONS.en;
            
            const amount = parseFloat(amountInput.value);
            
            // Limpiar errores
            amountError.classList.remove('show');
            amountError.textContent = '';
            
            // Validaciones
            if (!amountInput.value || amount === 0) {
                withdrawButton.disabled = true;
                return;
            }
            
            if (amount < minWithdraw) {
                amountError.textContent = t.errorMinAmount;
                amountError.classList.add('show');
                withdrawButton.disabled = true;
                return;
            }
            
            if (amount > userBalance) {
                amountError.textContent = t.errorMaxAmount;
                amountError.classList.add('show');
                withdrawButton.disabled = true;
                return;
            }
            
            if (!userEmail) {
                amountError.textContent = t.errorNoEmail;
                amountError.classList.add('show');
                withdrawButton.disabled = true;
                return;
            }
            
            // Todo v√°lido
            withdrawButton.disabled = false;
        }

        // Variables para el temporizador de cooldown
        let cooldownInterval = null;
        let currentCooldownSeconds = 0;
        let shouldReloadOnClose = false; // Flag para indicar si se debe recargar al cerrar

        function showModal(type, title, message, showButton = false, timeRemaining = null, reloadOnClose = false) {
            shouldReloadOnClose = reloadOnClose;
            const modalOverlay = document.getElementById('modalOverlay');
            const modalIcon = document.getElementById('modalIcon');
            const modalSpinner = document.getElementById('modalSpinner');
            const modalTitle = document.getElementById('modalTitle');
            const modalMessage = document.getElementById('modalMessage');
            const modalButton = document.getElementById('modalButton');
            const cooldownTimer = document.getElementById('cooldownTimer');
            
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            
            // Limpiar interval anterior si existe
            if (cooldownInterval) {
                clearInterval(cooldownInterval);
                cooldownInterval = null;
            }
            
            // Limpiar clases anteriores
            modalIcon.className = 'modal-icon';
            
            if (type === 'processing') {
                modalIcon.classList.add('processing');
                modalIcon.innerHTML = '<div class="processing-spinner"></div>';
                modalButton.style.display = 'none';
                if (cooldownTimer) cooldownTimer.style.display = 'none';
            } else if (type === 'success') {
                modalIcon.classList.add('success');
                modalIcon.innerHTML = '<i class="fas fa-check-circle"></i>';
                modalButton.style.display = showButton ? 'block' : 'none';
                if (cooldownTimer) cooldownTimer.style.display = 'none';
            } else if (type === 'error') {
                modalIcon.classList.add('error');
                modalIcon.innerHTML = '<i class="fas fa-times-circle"></i>';
                modalButton.style.display = showButton ? 'block' : 'none';
                
                // Mostrar timer si hay tiempo restante
                if (timeRemaining !== null && timeRemaining > 0 && cooldownTimer) {
                    currentCooldownSeconds = timeRemaining;
                    cooldownTimer.style.display = 'block';
                    updateCooldownTimer();
                    cooldownInterval = setInterval(() => {
                        currentCooldownSeconds--;
                        if (currentCooldownSeconds <= 0) {
                            clearInterval(cooldownInterval);
                            cooldownInterval = null;
                            if (cooldownTimer) cooldownTimer.style.display = 'none';
                        } else {
                            updateCooldownTimer();
                        }
                    }, 1000);
                } else {
                    if (cooldownTimer) cooldownTimer.style.display = 'none';
                }
            }
            
            modalOverlay.classList.add('show');
        }
        
        function updateCooldownTimer() {
            const cooldownTimer = document.getElementById('cooldownTimer');
            if (cooldownTimer && currentCooldownSeconds > 0) {
                const minutes = Math.floor(currentCooldownSeconds / 60);
                const seconds = currentCooldownSeconds % 60;
                cooldownTimer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }
        
        function closeModal(event) {
            if (event) {
                event.stopPropagation();
            }
            // Limpiar interval del timer si existe
            if (cooldownInterval) {
                clearInterval(cooldownInterval);
                cooldownInterval = null;
            }
            const modalOverlay = document.getElementById('modalOverlay');
            modalOverlay.classList.remove('show');
            
            // Recargar p√°gina si el flag est√° activo
            if (shouldReloadOnClose) {
                shouldReloadOnClose = false;
                setTimeout(() => {
                    window.location.reload();
                }, 300); // Peque√±o delay para que la animaci√≥n de cierre se complete
            }
        }

        async function handleWithdraw(event) {
            event.preventDefault();
            
            const amountInput = document.getElementById('amount');
            const amount = parseFloat(amountInput.value);
            const t = WITHDRAW_TRANSLATIONS[currentLanguage] || WITHDRAW_TRANSLATIONS.en;
            
            // Validaciones adicionales
            if (!userEmail) {
                showModal('error', t.modalErrorTitle, t.errorNoEmail, true);
                return;
            }
            
            if (amount < minWithdraw) {
                showModal('error', t.modalErrorTitle, t.errorMinAmount, true);
                return;
            }
            
            if (amount > userBalance) {
                showModal('error', t.modalErrorTitle, t.errorMaxAmount, true);
                return;
            }
            
            // Mostrar modal de procesamiento
            showModal('processing', t.processingTitle, t.processingMessage);
            
            // Asegurarse de que el amount se env√≠e como n√∫mero con precisi√≥n correcta
            const amountToSend = parseFloat(amount.toFixed(5));
            
            console.log('Frontend - Amount input value:', amountInput.value);
            console.log('Frontend - Amount parsed:', amount);
            console.log('Frontend - Amount to send (fixed):', amountToSend);
            
            try {
                // Mostrar ad y luego procesar retiro
                showModal('processing', t.processingTitle, currentLanguage === 'es' ? 'Mostrando anuncio...' : 'Showing ad...');
                
                const finalData = await showAdAndExecute(async () => {
                    // Usuario vio el ad completo, procesar retiro
                    const response = await fetch('/withdraw-ton', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            amount: amountToSend,
                            email: userEmailVerified && userEmail ? userEmail : document.getElementById('withdrawEmail')?.value || userEmail
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    return await response.json();
                });
                
                if (finalData.success) {
                    showModal('success', t.modalSuccessTitle, t.modalSuccessMessage, true, null, true);
                } else {
                    const errorMsg = finalData.message || (currentLanguage === 'es' ? 'Error al procesar el retiro' : 'Error processing withdrawal');
                    const timeRemaining = finalData.timeRemaining || null;
                    showModal('error', t.modalErrorTitle, errorMsg, true, timeRemaining);
                }
            } catch (error) {
                console.error('Error:', error);
                
                // Si el usuario cerr√≥ el ad sin completarlo
                if (error.message && error.message.includes('cerrado')) {
                    const cancelMsg = currentLanguage === 'es' ? 'Debes ver el anuncio completo para procesar el retiro' : 'You must watch the ad completely to process the withdrawal';
                    showModal('error', t.modalErrorTitle, cancelMsg, true);
                } else {
                    const errorMsg = error.message || (currentLanguage === 'es' ? 'Error al procesar el retiro' : 'Error processing withdrawal');
                    showModal('error', t.modalErrorTitle, errorMsg, true);
                }
            }
        }

        // Aplicar idioma inicial
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                applyWithdrawLanguage(currentLanguage);
            });
        } else {
            applyWithdrawLanguage(currentLanguage);
        }
        
        // Validar input inicial
        document.getElementById('amount').addEventListener('input', validateAmount);

        // Funci√≥n para formatear tiempo relativo
        function formatTimeAgo(dateString) {
            const withdrawDate = new Date(dateString);
            const now = new Date();
            const diffMs = now - withdrawDate;
            const diffSeconds = Math.floor(diffMs / 1000);
            const diffMinutes = Math.floor(diffSeconds / 60);
            const diffHours = Math.floor(diffMinutes / 60);
            const diffDays = Math.floor(diffHours / 24);
            
            if (diffDays > 0) {
                return diffDays === 1 ? 'hace 1d' : `hace ${diffDays}d`;
            } else if (diffHours > 0) {
                return diffHours === 1 ? 'hace 1h' : `hace ${diffHours}h`;
            } else if (diffMinutes > 0) {
                return diffMinutes === 1 ? 'hace 1 min' : `hace ${diffMinutes} min`;
            } else {
                return diffSeconds < 60 ? `hace ${diffSeconds}s` : 'hace 24s';
            }
        }

        // Actualizar tiempos en tiempo real
        function updateTimeAgo() {
            const activeList = document.querySelector('.withdraw-history-list:not([style*="display: none"])');
            if (!activeList) return;
            
            const historyItems = activeList.querySelectorAll('.withdraw-history-item');
            
            historyItems.forEach((item) => {
                const timeElement = item.querySelector('.time-ago');
                const dateAttr = item.getAttribute('data-created-at');
                if (timeElement && dateAttr) {
                    timeElement.textContent = formatTimeAgo(dateAttr);
                }
            });
        }

        // Funci√≥n para alternar entre retiros personales y p√∫blicos
        function toggleHistoryType(type) {
            const myList = document.getElementById('myHistoryList');
            const publicList = document.getElementById('publicHistoryList');
            const myButton = document.getElementById('toggleMyWithdraws');
            const publicButton = document.getElementById('togglePublicWithdraws');
            
            if (type === 'my') {
                myList.style.display = 'flex';
                publicList.style.display = 'none';
                myButton.classList.add('active');
                publicButton.classList.remove('active');
            } else {
                myList.style.display = 'none';
                publicList.style.display = 'flex';
                myButton.classList.remove('active');
                publicButton.classList.add('active');
            }
            
            // Actualizar tiempos despu√©s de cambiar
            setTimeout(updateTimeAgo, 100);
        }

        // Actualizar cada segundo si hay elementos
        const myHistoryItems = document.querySelectorAll('#myHistoryList .withdraw-history-item');
        const publicHistoryItems = document.querySelectorAll('#publicHistoryList .withdraw-history-item');
        
        if (myHistoryItems.length > 0 || publicHistoryItems.length > 0) {
            // Actualizar inmediatamente
            updateTimeAgo();
            // Actualizar cada segundo
            setInterval(updateTimeAgo, 1000);
        }
    </script>
    
    <!-- Smart Interstitial System -->
    <script>
        (function() {
            // Funci√≥n para verificar y mostrar intersticial inteligente
            function showSmartInterstitial() {
                const now = Date.now();
                const sessionStart = parseInt(localStorage.getItem('sessionStart') || now);
                const lastInterstitial = parseInt(localStorage.getItem('lastInterstitial') || 0);
                const lastRewarded = parseInt(localStorage.getItem('lastRewarded') || 0);
                const firstInterstitialToday = parseInt(localStorage.getItem('firstInterstitialToday') || 0);
                const interstitialCount = parseInt(localStorage.getItem('interstitialCount') || 0);
                const onlyRewardedUntil = parseInt(localStorage.getItem('onlyRewardedUntil') || 0);
                
                // Constantes de tiempo
                const fourMinutes = 4 * 60 * 1000;      // 4 minutos en ms
                const twentyMinutes = 20 * 60 * 1000;     // 20 minutos en ms
                const threeHours = 3 * 60 * 60 * 1000;   // 3 horas en ms
                const tenSeconds = 10 * 1000;            // 10 segundos en ms
                const twentyFourHours = 24 * 60 * 60 * 1000; // 24 horas en ms
                const sessionTimeout = 5 * 60 * 1000;    // 5 minutos - si pas√≥ m√°s tiempo, es nueva sesi√≥n
                
                // Resetear contador si pasaron 24h desde el primer intersticial del d√≠a
                if (firstInterstitialToday > 0 && (now - firstInterstitialToday) >= twentyFourHours) {
                    localStorage.setItem('interstitialCount', '0');
                    localStorage.setItem('firstInterstitialToday', '0');
                }
                
                const currentCount = interstitialCount;
                
                // Verificar si est√° en modo "solo rewarded" (lleg√≥ a 25 intersticiales)
                if (onlyRewardedUntil > now) {
                    // Est√° en modo solo rewarded, no mostrar intersticial
                    return false;
                }
                
                // Si lleg√≥ a 25, activar modo "solo rewarded" por 3 horas
                if (currentCount >= 25) {
                    localStorage.setItem('onlyRewardedUntil', (now + threeHours).toString());
                    return false;
                }
                
                // Verificar 10 segundos iniciales desde la carga de sesi√≥n
                if (now - sessionStart < tenSeconds) {
                    return false;
                }
                
                // Verificar intervalo de 4 minutos desde √∫ltimo intersticial
                if (lastInterstitial > 0 && (now - lastInterstitial) < fourMinutes) {
                    return false;
                }
                
                // Verificar intervalo de rewarded (no mostrar intersticial si se mostr√≥ rewarded hace menos de 20 min)
                if (lastRewarded > 0 && (now - lastRewarded) < twentyMinutes) {
                    return false;
                }
                
                // Todas las condiciones cumplidas, mostrar intersticial
                if (typeof show_10238206 === 'function') {
                    show_10238206({
                        type: 'inApp',
                        inAppSettings: {
                            frequency: 1,
                            capping: 0.1,
                            interval: 240,
                            timeout: 1,
                            everyPage: false
                        }
                    }).then(() => {
                        // Actualizar despu√©s de mostrar exitosamente
                        const updateTime = Date.now();
                        localStorage.setItem('lastInterstitial', updateTime.toString());
                        
                        // Si es el primer intersticial del d√≠a, guardar timestamp
                        if (firstInterstitialToday === 0 || (updateTime - firstInterstitialToday) >= twentyFourHours) {
                            localStorage.setItem('firstInterstitialToday', updateTime.toString());
                            localStorage.setItem('interstitialCount', '1');
                        } else {
                            // Incrementar contador
                            localStorage.setItem('interstitialCount', (currentCount + 1).toString());
                        }
                    }).catch(() => {
                        // Si falla, no actualizar contadores
                    });
                    return true;
                }
                
                return false;
            }
            
            // Inicializar o resetear sesi√≥n al cargar
            const existingSessionStart = parseInt(localStorage.getItem('sessionStart') || 0);
            const now = Date.now();
            
            // Si no existe sessionStart o pasaron m√°s de 5 minutos, es una nueva sesi√≥n
            if (!existingSessionStart || (now - existingSessionStart) > (5 * 60 * 1000)) {
                localStorage.setItem('sessionStart', now.toString());
            }
            
            // Mostrar intersticial al cambiar de vista (con 1 segundo de delay)
            setTimeout(() => {
                showSmartInterstitial();
            }, 1000);
            
        })();
    </script>
</body>
</html>

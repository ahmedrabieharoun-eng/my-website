<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ÙƒØ³Ø¨ Ù…Ù† Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª - Ù…Ø«Ø§Ù„</title>
  <style>
    body { font-family: Arial, sans-serif; direction: rtl; padding: 20px; }
    .card { border: 1px solid #ddd; padding: 16px; border-radius: 8px; max-width:600px; margin:auto; box-shadow: 0 2px 6px rgba(0,0,0,0.05); }
    button { padding: 10px 16px; font-size: 16px; cursor: pointer; border-radius: 6px; }
    #status { margin-top: 12px; }
  </style>
  <!-- Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ù‚Ø¯Ù… -->
  <script src="https://ad.gigapub.tech/script?id=4102"></script>
</head>
<body>
  <div class="card">
    <h2>ÙƒØ³Ø¨ Ù†Ù‚Ø§Ø· Ø¨Ù…Ø´Ø§Ù‡Ø¯Ø© Ø¥Ø¹Ù„Ø§Ù†</h2>
    <p>Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ù„Ø¹Ø±Ø¶ Ø¥Ø¹Ù„Ø§Ù† ÙˆÙƒØ³Ø¨ Ù…ÙƒØ§ÙØ£Ø©. (Ù…Ø«Ø§Ù„ ØªØ¹Ù„ÙŠÙ…ÙŠ)</p>

    <label for="userid">Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (ØªØ¬Ø±ÙŠØ¨ÙŠ):</label><br/>
    <input id="userid" value="user_123" style="padding:8px;margin:8px 0;width:100%;" />

    <button id="watchBtn">Ø´Ø§Ù‡Ø¯ Ø¥Ø¹Ù„Ø§Ù† ÙˆØ§ÙƒØ³Ø¨</button>

    <div id="status"></div>
    <div id="balance" style="margin-top:10px;font-weight:bold;">Ø§Ù„Ø±ØµÙŠØ¯: <span id="balVal">0</span> Ù†Ù‚Ø·Ø©</div>
  </div>

  <script>
    // ØªÙ‡ÙŠØ¦Ø© Ø±ØµÙŠØ¯ Ù…Ø­Ù„ÙŠ Ù„ØªØ¬Ø±Ø¨Ø©
    let balance = Number(localStorage.getItem('demo_balance') || 0);
    document.getElementById('balVal').textContent = balance;

    const statusEl = document.getElementById('status');
    const watchBtn = document.getElementById('watchBtn');

    function setStatus(txt, isError=false) {
      statusEl.textContent = txt;
      statusEl.style.color = isError ? 'crimson' : 'green';
    }

    // Ø§Ù„Ø­Ø¯ Ù…Ù† Ø§Ù„Ø¶ØºØ· Ø§Ù„Ù…ØªÙƒØ±Ø± Ù„Ù…Ù†Ø¹ Ø¥Ø³Ø§Ø¡Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©
    let lastClickedAt = 0;
    watchBtn.addEventListener('click', async () => {
      const now = Date.now();
      if (now - lastClickedAt < 3000) {
        setStatus('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ù†ØªØ¸Ø± Ù„Ø­Ø¸Ø© Ù‚Ø¨Ù„ Ù…Ø­Ø§ÙˆÙ„Ø© Ø£Ø®Ø±Ù‰.', true);
        return;
      }
      lastClickedAt = now;

      // ØªØ£ÙƒØ¯ Ø£Ù† Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø¬Ø§Ù‡Ø²Ø©
      if (!window.showGiga || typeof window.showGiga !== 'function') {
        setStatus('Ù…ÙƒÙˆÙ‘Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ØºÙŠØ± Ø¬Ø§Ù‡Ø² Ø­Ø§Ù„ÙŠØ§Ù‹.', true);
        return;
      }

      setStatus('Ø¬Ø§Ø±Ù ÙØªØ­ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†...');

      try {
        // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ showGiga â€” Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ù…ÙØ²ÙˆÙ‘ÙØ¯Ø© Ù…Ù† Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ø°ÙŠ Ø£Ø±Ø³Ù„ØªÙÙ‡
        const result = await window.showGiga();
        // Ù‡Ù†Ø§ Ù†ÙÙØªØ±Ø¶ Ø£Ù† result ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø«Ù„ { rewarded: true, rewardAmount: 10, adId: '...'}
        // Ù„ÙƒÙ† Ù„Ø£Ù† ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…ÙˆÙØ± Ù‚Ø¯ ØªØ®ØªÙ„ÙØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„ÙØ¹Ù„ÙŠØ©
        console.log('showGiga result:', result);

        // ØªØ­Ù‚Ù‚ Ø£Ø³Ø§Ø³ÙŠ ÙÙŠ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù‚Ø¨Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø·Ø§Ù„Ø¨Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…
        if (!result || !result.rewarded) {
          setStatus('Ù„Ù… ØªÙÙ…Ù†Ø­ Ù…ÙƒØ§ÙØ£Ø© Ù…Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†.', true);
          return;
        }

        const rewardAmount = result.rewardAmount || 10; // Ù‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¥Ù† Ù„Ù… ØªÙØ¹Ø·Ù
        const adId = result.adId || null;
        const userId = document.getElementById('userid').value || 'anonymous';

        setStatus('ØªÙ…Øª Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† â€” Ø¥Ø±Ø³Ø§Ù„ Ù…Ø·Ø§Ù„Ø¨Ø© Ù„Ù„Ù…ØµØ§Ø¯Ù‚Ø©...');

        // Ø£Ø±Ø³Ù„ Ù…Ø·Ø§Ù„Ø¨Ø© Ù„Ù„Ù…Ø®Ø¯Ù… Ù„Ù„ØªØ­Ù‚Ù‚ ÙˆØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© (Ø§Ù†Ø¸Ø± Ø§Ù„Ø®Ø§Ø¯Ù… Ø£Ø¯Ù†Ø§Ù‡)
        const resp = await fetch('/claim-reward', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            userId,
            rewardAmount,
            adId,
            providerPayload: result // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯ Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ù…Ø²ÙˆØ¯ Ù„ÙŠØªØ­Ù‚Ù‚ Ø§Ù„Ø®Ø§Ø¯Ù…
          })
        });

        const json = await resp.json();
        if (!resp.ok) {
          setStatus('ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…: ' + (json?.message || resp.statusText), true);
          return;
        }

        // Ù†Ø¬Ø§Ø­: Ø­Ø¯Ù‘Ø« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        balance += Number(json.grantedAmount || rewardAmount);
        localStorage.setItem('demo_balance', balance);
        document.getElementById('balVal').textContent = balance;
        setStatus('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© ğŸ‰ â€” ' + (json.grantedAmount || rewardAmount) + ' Ù†Ù‚Ø·Ø©');
      } catch (e) {
        console.error(e);
        setStatus('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø£Ùˆ Ø§Ù„Ù…Ø·Ø§Ù„Ø¨Ø© Ø¨Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©.', true);
      }
    });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
    <title>GLX Galaxy</title>
    
    <!-- ŸÖŸÉÿ™ÿ®ÿßÿ™ ÿßŸÑÿ∑ÿ±ŸÅ ÿßŸÑÿ´ÿßŸÑÿ´ -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="//libtl.com/sdk.js" data-zone="10286382" data-sdk="show_10286382" async></script>
    <script src="https://ad.gigapub.tech/script?id=4102"></script>
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        :root {
            --primary-green: #a855f7; --deep-Galaxy: #202020; --gold: #d6bcfa; --gold-glow: rgba(168,85,247,0.4);
            --glass-bg: rgba(32,32,32,0.7); --glass-border: rgba(255,255,255,0.1); --text-color: #ffffff;
            --text-muted: #b0b0b0; --nav-bg: rgba(40,40,40,0.98); --success-color: #a855f7;
        }
        *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
        body{font-family:'Outfit',sans-serif;color:var(--text-color);overflow-x:hidden;background-image:url('https://i.ibb.co/RGFp67kJ/121.jpg');background-size:cover;background-position:center;background-attachment:fixed;min-height:100vh;}
        body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background:radial-gradient(circle at center,rgba(50,50,50,0.3) 0%,rgba(30,30,30,0.85) 100%);z-index:-1;}
        .app-container{padding:20px;padding-bottom:110px;max-width:500px;margin:0 auto;min-height:100vh;display:flex;flex-direction:column;}
        .content-section{display:none;animation:fadeIn 0.4s ease;}
        .content-section.active{display:flex;flex-direction:column;flex:1;}
        @keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
        h1{font-size:26px;font-weight:800;color:#fff;margin-bottom:5px;text-transform:uppercase;letter-spacing:1px;}
        h2{font-size:18px;font-weight:700;margin:20px 0 10px;color:var(--gold);display:flex;align-items:center;gap:8px;}
        p{font-size:13px;color:var(--text-muted);line-height:1.4;}
        .page-header{text-align:center;margin-bottom:20px;padding-top:10px;}
        .card{background:var(--glass-bg);backdrop-filter:blur(15px);-webkit-backdrop-filter:blur(15px);border-radius:24px;padding:20px;margin-bottom:12px;border:1px solid var(--glass-border);box-shadow:0 4px 20px rgba(0,0,0,0.4);}
        .btn{display:flex;align-items:center;justify-content:center;width:100%;padding:16px;border-radius:18px;font-size:16px;font-weight:800;cursor:pointer;border:none;outline:none;gap:8px;text-transform:uppercase;letter-spacing:0.5px;transition:transform 0.1s;}
        .btn:active{transform:scale(0.96);}
        .btn:disabled{opacity:0.5;cursor:not-allowed;filter:grayscale(1);}
        .btn-primary{background:linear-gradient(90deg,#a855f7,#7c3aed);color:#fff;box-shadow:0 0 15px rgba(168,85,247,0.4);}
        .btn-ton{background:linear-gradient(90deg,#0088cc,#0099ff);color:#fff;box-shadow:0 0 15px rgba(0,136,204,0.4);}
        .btn-check{background:linear-gradient(90deg,#a855f7,#7c3aed);color:#fff;box-shadow:0 0 15px rgba(168,85,247,0.4);}
        .btn-action{background:rgba(0,0,0,0.3)!important;backdrop-filter:blur(15px);-webkit-backdrop-filter:blur(15px);border:1px solid rgba(255,255,255,0.1)!important;color:#b0b0b0!important;flex-direction:column;padding:12px;font-size:12px;gap:5px;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,0.2);transition:all 0.3s ease;}
        .btn-action svg{width:24px;height:24px;stroke:#b0b0b0!important;fill:none;stroke-width:2.5;transition:all 0.3s ease;}
        .btn-action:active{background:rgba(0,0,0,0.4)!important;transform:scale(0.98);}
        .hud-container{display:flex;justify-content:space-between;align-items:center;background:rgba(0,0,0,0.5);border-radius:50px;padding:10px 15px;margin-bottom:20px;border:1px solid rgba(255,255,255,0.05);}
        .user-name{font-weight:700;font-size:14px;}
        .user-rank{font-size:10px;color:var(--primary-green);text-transform:uppercase;}
        .hud-avatar{width:50px;height:50px;border-radius:50%;overflow:hidden;border:2px solid var(--primary-green);}
        .hud-avatar img{width:100%;height:100%;object-fit:cover;}
        .hud-balance{display:flex;flex-direction:column;align-items:flex-end;gap:5px;}
        .hud-balance-item{display:flex;align-items:center;gap:5px;font-size:12px;font-weight:600;}
        .hud-glx{color:var(--gold);}
        .hud-ton{color:#0088cc;}
        .main-coin-section{text-align:center;margin:10px 0 30px;position:relative;}
        .main-coin-img{width:160px;height:160px;border-radius:50%;box-shadow:0 0 50px rgba(168,85,247,0.3);animation:float 4s ease-in-out infinite;object-fit:cover;border:4px solid var(--primary-green);}
        @keyframes float{0%{transform:translateY(0px);}50%{transform:translateY(-10px);}100%{transform:translateY(0px);}}
        .balance-display{margin-top:15px;}
        .balance-amount{font-size:48px;font-weight:800;background:linear-gradient(to bottom,#fff,#b3b3b3);-webkit-background-clip:text;-webkit-text-fill-color:transparent;line-height:1;}
        .balance-unit{font-size:16px;color:var(--primary-green);font-weight:700;letter-spacing:2px;}
        .stats-pill{display:inline-flex;align-items:center;gap:15px;background:rgba(255,255,255,0.05);padding:8px 16px;border-radius:20px;margin-top:10px;font-size:12px;font-weight:600;}
        .ton-val{color:var(--primary-green);display:flex;align-items:center;gap:4px;}
        .action-bar{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:25px;}
        .list-card{display:flex;align-items:center;background:rgba(0,0,0,0.3);border-radius:16px;padding:12px;margin-bottom:8px;border:1px solid rgba(255,255,255,0.05);cursor:pointer;}
        .lc-icon{width:42px;height:42px;border-radius:12px;background:rgba(255,255,255,0.05);display:flex;align-items:center;justify-content:center;margin-right:12px;flex-shrink:0;}
        .lc-icon img{width:100%;height:100%;object-fit:cover;border-radius:12px;}
        .lc-content{flex:1;}
        .lc-title{font-size:14px;font-weight:600;margin-bottom:2px;}
        .lc-sub{font-size:11px;color:var(--text-muted);}
        .lc-end{text-align:right;}
        .lc-val{font-weight:700;color:var(--primary-green);font-size:14px;}
        .daily-row{display:flex;overflow-x:auto;gap:8px;padding-bottom:10px;margin-bottom:15px;scrollbar-width:none;}
        .daily-box{min-width:70px;background:rgba(255,255,255,0.05);border-radius:12px;padding:10px 5px;text-align:center;border:1px solid transparent;opacity:0.5;}
        .daily-box.active{opacity:1;border-color:var(--gold);background:rgba(255,215,0,0.1);}
        .daily-box.claimed{opacity:1;background:var(--primary-green);color:#000;}
        .input-wrap{background:rgba(0,0,0,0.4);border-radius:16px;padding:15px;margin-bottom:15px;border:1px solid rgba(255,255,255,0.1);}
        .input-label{font-size:11px;color:var(--text-muted);display:block;margin-bottom:5px;text-transform:uppercase;}
        .custom-input{width:100%;background:transparent;border:none;color:#fff;font-size:16px;font-weight:600;outline:none;font-family:inherit;}
        .cat-select{display:flex;gap:10px;margin-bottom:20px;}
        .cat-opt{flex:1;padding:12px;text-align:center;background:rgba(255,255,255,0.05);border-radius:12px;font-size:12px;cursor:pointer;border:1px solid transparent;}
        .cat-opt.active{background:var(--primary-green);color:#000;border-color:var(--primary-green);font-weight:700;}
        .price-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:15px;}
        .price-opt{padding:10px;background:rgba(255,255,255,0.05);border-radius:10px;text-align:center;cursor:pointer;border:1px solid transparent;}
        .price-opt.active{border-color:var(--gold);background:rgba(255,215,0,0.1);}
        .price-count{font-size:14px;font-weight:700;color:#fff;}
        .price-cost{font-size:10px;color:var(--primary-green);margin-top:2px;}
        .terms-box{background:rgba(0,0,0,0.3);border-radius:16px;padding:15px;height:300px;overflow-y:auto;font-size:12px;color:var(--text-muted);border:1px solid rgba(255,255,255,0.05);line-height:1.6;}
        .terms-box h3{color:#fff;font-size:14px;margin-top:15px;margin-bottom:5px;}
        .terms-box h3:first-child{margin-top:0;}
        .bottom-nav{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);width:90%;max-width:400px;height:65px;background:var(--nav-bg);border-radius:32px;display:flex;justify-content:space-around;align-items:center;box-shadow:0 10px 30px rgba(0,0,0,0.5);z-index:100;border:1px solid rgba(255,255,255,0.1);}
        .nav-item{display:flex;flex-direction:column;align-items:center;color:#666;transition:0.3s;cursor:pointer;position:relative;width:50px;}
        .nav-item svg{width:22px;height:22px;margin-bottom:4px;stroke:currentColor;fill:none;stroke-width:2.5;transition:all 0.3s;}
        .nav-item.active{color:var(--primary-green);transform:translateY(-2px);}
        .nav-item.active svg{stroke:var(--primary-green);filter:drop-shadow(0 0 8px rgba(168,85,247,0.6));}
        .nav-text{font-size:9px;font-weight:700;text-transform:uppercase;}
        .hidden{display:none!important;}
        .leader-tabs{display:flex;background:rgba(0,0,0,0.3);border-radius:50px;padding:4px;margin-bottom:20px;}
        .tab-btn{flex:1;text-align:center;padding:10px;border-radius:50px;font-size:12px;font-weight:700;cursor:pointer;transition:all 0.3s;}
        .tab-btn.active{background:var(--primary-green);color:#000;}
        .withdrawal-type-selector{display:flex;background:rgba(0,0,0,0.3);border-radius:50px;padding:4px;margin-bottom:20px;}
        .withdrawal-type-btn{flex:1;text-align:center;padding:12px;border-radius:50px;font-size:12px;font-weight:700;cursor:pointer;transition:all 0.3s;border:1px solid transparent;}
        .withdrawal-type-btn.active{background:var(--primary-green);color:#000;border-color:var(--primary-green);}
        .info-box{background:rgba(255,179,0,0.1);border:1px solid var(--gold);border-radius:12px;padding:12px;margin-bottom:15px;font-size:11px;line-height:1.5;}
        .info-box.success{background:rgba(39,174,96,0.1);border-color:#27ae60;}
        .info-icon{display:inline-flex;align-items:center;justify-content:center;width:16px;height:16px;margin-right:5px;border-radius:50%;background:var(--gold);color:#000;font-size:10px;font-weight:bold;}
        .info-box.success .info-icon{background:#27ae60;color:#fff;}
        .floating-add-task{position:fixed;bottom:85px;left:50%;transform:translateX(-50%);width:auto!important;min-width:180px!important;max-width:250px!important;background:var(--glass-bg);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-radius:20px;padding:12px 20px!important;border:1px solid var(--primary-green);box-shadow:0 5px 30px rgba(168,85,247,0.3);z-index:99;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all 0.3s;}
        .floating-add-task:active{transform:translateX(-50%) scale(0.98);}
        .floating-add-task-content{display:flex;align-items:center;justify-content:center;gap:8px!important;}
        .floating-add-task-icon{width:36px;height:36px;background:var(--primary-green);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:bold;color:#000;}
        .floating-add-task-text{font-size:14px!important;font-weight:700;color:#fff;text-transform:uppercase;letter-spacing:0.5px;white-space:nowrap!important;}
        .spins-display{display:flex;align-items:center;justify-content:space-between;background:rgba(255,255,255,0.08);border-radius:15px;padding:12px 15px;margin-bottom:15px;border:1px solid var(--glass-border);}
        .spins-count{font-size:20px;font-weight:800;color:var(--primary-green);}
        .referred-users-list{max-height:300px;overflow-y:auto;margin-top:15px;}
        .referred-user-item{display:flex;align-items:center;padding:10px;background:rgba(255,255,255,0.05);border-radius:12px;margin-bottom:8px;}
        .referred-user-avatar{width:40px;height:40px;border-radius:50%;margin-right:12px;border:2px solid var(--primary-green);}
        .referred-user-info{flex:1;}
        .referred-user-name{font-size:14px;font-weight:600;}
        .referred-user-date{font-size:11px;color:var(--text-muted);}
        .referred-user-status{font-size:10px;padding:2px 8px;border-radius:10px;background:var(--primary-green);color:#000;font-weight:700;}
        .stats-grid{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:20px;}
        .stat-card{background:rgba(168,85,247,0.1);padding:15px;border-radius:12px;text-align:center;border:1px solid rgba(168,85,247,0.3);}
        .stat-value{font-size:24px;font-weight:800;color:var(--primary-green);margin-top:5px;}
        .stat-label{font-size:12px;color:var(--text-muted);}
        .promo-card,.code-channel-card{transition:all 0.3s ease;animation:cardFloat 3s ease-in-out infinite alternate;}
        @keyframes cardFloat{0%{transform:translateY(0);}100%{transform:translateY(-5px);}}
        .code-channel-card:active{transform:scale(0.98);}
        #promo-code-input:focus{box-shadow:0 0 15px rgba(168,85,247,0.4);border-color:#a855f7;}
        .max-btn,.withdraw-max-btn{min-width:60px!important;height:44px!important;padding:10px 15px!important;font-size:12px!important;font-weight:800!important;white-space:nowrap!important;border:2px solid rgba(168,85,247,0.5)!important;background:rgba(168,85,247,0.2)!important;color:white!important;border-radius:12px!important;cursor:pointer!important;}
        input[type="number"]{-webkit-appearance:none;-moz-appearance:textfield;appearance:none;font-size:18px!important;}
        input[type="number"]::-webkit-inner-spin-button,input[type="number"]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0;}
        .bonus-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:20px;}
        .bonus-game-card{background:var(--glass-bg);backdrop-filter:blur(15px);-webkit-backdrop-filter:blur(15px);border-radius:16px;overflow:hidden;border:1px solid var(--glass-border);cursor:pointer;transition:all 0.3s ease;box-shadow:0 4px 15px rgba(0,0,0,0.3);}
        .bonus-game-card:active{transform:scale(0.97);}
        .game-banner{width:100%;height:120px;object-fit:cover;display:block;}
        .game-content{padding:12px;}
        .game-title{font-size:14px;font-weight:700;color:white;margin-bottom:4px;text-align:center;}
        .game-description{font-size:11px;color:var(--text-muted);text-align:center;line-height:1.3;}
        .game-icon{font-size:20px;margin-bottom:8px;text-align:center;color:var(--primary-green);}
        .swap-direction-selector{display:flex;background:rgba(0,0,0,0.3);border-radius:50px;padding:4px;margin-bottom:20px;}
        .swap-direction-btn{flex:1;text-align:center;padding:12px;border-radius:50px;font-size:12px;font-weight:700;cursor:pointer;transition:all 0.3s;border:1px solid transparent;}
        .swap-direction-btn.active{background:var(--primary-green);color:#000;border-color:var(--primary-green);}
        .withdraw-input-with-max{position:relative;}
        .withdraw-input-with-max .custom-input{padding-right:70px;}
        .email-display{font-family:'Courier New',monospace;background:rgba(255,255,255,0.1);padding:15px;border-radius:12px;border:1px solid rgba(255,255,255,0.2);font-size:16px;letter-spacing:2px;color:white;text-align:center;margin-top:10px;}
        .swap-mode-text{font-size:12px;color:var(--text-muted);text-align:center;margin:10px 0;}
        .verification-container{background:var(--glass-bg);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-radius:24px;padding:30px;margin:20px;text-align:center;border:2px solid rgba(168,85,247,0.3);box-shadow:0 10px 40px rgba(0,0,0,0.5);}
        .verification-step{display:flex;align-items:center;justify-content:space-between;background:rgba(0,0,0,0.3);border-radius:12px;padding:15px;margin-bottom:10px;border:1px solid rgba(255,255,255,0.1);transition:all 0.3s ease;}
        .verification-step.active{border-color:var(--primary-green);background:rgba(168,85,247,0.1);}
        .verification-step.completed{border-color:#27ae60;background:rgba(39,174,96,0.1);}
        .verification-step.failed{border-color:#e74c3c;background:rgba(231,76,60,0.1);}
        .step-icon{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:bold;}
        .step-info{flex:1;text-align:left;padding:0 15px;}
        .step-title{font-size:14px;font-weight:600;color:white;margin-bottom:3px;}
        .step-description{font-size:11px;color:var(--text-muted);}
        .step-status{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:18px;}
        .security-message{background:rgba(231,76,60,0.1);border:1px solid rgba(231,76,60,0.3);border-radius:12px;padding:15px;margin:15px 0;color:#e74c3c;font-size:14px;}
        .verification-progress{width:100%;height:8px;background:rgba(255,255,255,0.1);border-radius:4px;margin:20px 0;overflow:hidden;}
        .progress-bar{height:100%;background:linear-gradient(90deg,var(--primary-green),#7c3aed);border-radius:4px;transition:width 0.5s ease;}
        .blocked-container{background:rgba(0,0,0,0.8);border-radius:24px;padding:40px 30px;text-align:center;margin:20px;border:2px solid rgba(231,76,60,0.3);animation:pulse 2s infinite;}
        @keyframes pulse{0%{box-shadow:0 0 0 0 rgba(231,76,60,0.4);}70%{box-shadow:0 0 0 10px rgba(231,76,60,0);}100%{box-shadow:0 0 0 0 rgba(231,76,60,0);}}
        .blocked-icon{font-size:60px;margin-bottom:20px;color:#e74c3c;}
        .blocked-title{font-size:24px;font-weight:800;color:#e74c3c;margin-bottom:15px;}
        .blocked-reason{background:rgba(231,76,60,0.1);border-radius:12px;padding:15px;margin:20px 0;font-size:14px;line-height:1.5;}
        .verification-loading{display:inline-block;width:20px;height:20px;border:3px solid rgba(255,255,255,0.3);border-radius:50%;border-top-color:var(--primary-green);animation:spin 1s ease-in-out infinite;}
        @keyframes spin{to{transform:rotate(360deg);}}
        .ip-display{background:rgba(0,0,0,0.5);padding:10px;border-radius:8px;font-family:'Courier New',monospace;font-size:12px;color:#fff;margin-top:5px;}
        .competition-timer-card{background:linear-gradient(135deg,rgba(168,85,247,0.2),rgba(123,97,255,0.2));border:2px solid rgba(168,85,247,0.3);border-radius:20px;padding:25px;margin-bottom:20px;text-align:center;box-shadow:0 10px 30px rgba(168,85,247,0.2);}
        .countdown-display{font-size:36px;font-weight:800;color:#fff;text-shadow:0 0 15px rgba(168,85,247,0.8);margin-bottom:8px;font-family:'Courier New',monospace;}
        .timer-label{font-size:12px;color:var(--text-muted);text-transform:uppercase;letter-spacing:1px;}
        .status-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:20px;}
        .status-card{background:var(--glass-bg);backdrop-filter:blur(15px);-webkit-backdrop-filter:blur(15px);border-radius:16px;padding:20px;text-align:center;border:1px solid var(--glass-border);}
        .status-icon{font-size:30px;margin-bottom:10px;}
        .status-value{font-size:24px;font-weight:800;color:#fff;margin-bottom:5px;}
        .status-label{font-size:10px;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.5px;}
        .ticket-price-note{background:rgba(168,85,247,0.1);border-radius:12px;padding:15px;margin-bottom:20px;text-align:center;font-size:12px;border:1px solid rgba(168,85,247,0.3);}
        .ticket-controls{display:flex;align-items:center;gap:10px;margin-bottom:20px;}
        .ticket-input{flex:1;padding:15px;border-radius:12px;background:rgba(0,0,0,0.3);border:2px solid rgba(168,85,247,0.5);color:white;font-size:18px;font-weight:700;text-align:center;outline:none;min-height:44px;}
        .competition-leaderboard{margin-top:25px;}
        .leaderboard-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;padding-bottom:10px;border-bottom:1px solid rgba(255,255,255,0.1);}
        .competition-rules-card{background:rgba(0,0,0,0.4);border-radius:16px;padding:20px;margin-bottom:20px;border:1px solid rgba(255,255,255,0.1);}
        .rules-header{display:flex;align-items:center;gap:10px;margin-bottom:15px;color:var(--gold);font-size:16px;font-weight:700;}
        .rules-list{font-size:12px;color:var(--text-muted);line-height:1.6;padding-left:20px;}
        .rules-list li{margin-bottom:8px;}
        .winner-highlight{color:#27ae60;font-weight:700;}
        .loser-note{color:#e74c3c;font-weight:600;}
        .important-note{background:rgba(255,193,7,0.1);border-left:3px solid #FFC107;padding:10px;margin-top:15px;border-radius:5px;font-size:11px;}
        .competition-rank-card{display:flex;align-items:center;padding:12px;background:rgba(255,255,255,0.05);border-radius:12px;margin-bottom:8px;border:1px solid rgba(255,255,255,0.1);}
        .competition-rank{width:30px;font-weight:800;font-size:14px;text-align:center;margin-right:10px;}
        .rank-1 .competition-rank{color:#27ae60;font-weight:900;}
        .rank-2 .competition-rank{color:#C0C0C0;}
        .rank-3 .competition-rank{color:#CD7F32;}
        .competition-user-avatar{width:36px;height:36px;border-radius:50%;margin-right:12px;border:2px solid var(--primary-green);}
        .competition-user-info{flex:1;}
        .competition-user-name{font-size:13px;font-weight:600;margin-bottom:2px;}
        .competition-ticket-count{font-size:14px;font-weight:700;color:var(--primary-green);}
        .winner-item{display:flex;align-items:center;padding:12px;background:rgba(255,255,255,0.05);border-radius:12px;margin-bottom:10px;}
        .winner-rank{width:30px;height:30px;background:var(--primary-green);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:800;margin-right:15px;}
        .winner-avatar{width:40px;height:40px;border-radius:50%;margin-right:12px;border:2px solid var(--primary-green);}
        .winner-info{flex:1;}
        .winner-name{font-size:14px;font-weight:600;margin-bottom:2px;}
        .winner-date{font-size:10px;color:var(--text-muted);}
        .winner-prize{font-size:14px;font-weight:700;color:var(--primary-green);}
        .user-withdrawal-item{background:rgba(255,255,255,0.05);border-radius:12px;padding:12px;margin-bottom:8px;border:1px solid rgba(255,255,255,0.1);}
        .withdrawal-status{font-size:10px;padding:3px 10px;border-radius:20px;font-weight:700;}
        .status-completed{background:rgba(39,174,96,0.2);color:#27ae60;}
        .status-pending{background:rgba(255,193,7,0.2);color:#FFC107;}
        .status-rejected{background:rgba(231,76,60,0.2);color:#e74c3c;}
        .masked-email{font-family:'Courier New',monospace;letter-spacing:1px;}
        .log-item{display:flex;align-items:center;padding:12px;background:rgba(255,255,255,0.05);border-radius:12px;margin-bottom:8px;border-left:4px solid transparent;}
        .log-item.earn{border-left-color:#27ae60;background:rgba(39,174,96,0.1);}
        .log-item.spend{border-left-color:#e74c3c;background:rgba(231,76,60,0.1);}
        .log-item.swap{border-left-color:#3498db;background:rgba(52,152,219,0.1);}
        .log-item.withdraw{border-left-color:#9b59b6;background:rgba(155,89,182,0.1);}
        .slots-machine{background:rgba(0,0,0,0.6);border-radius:20px;padding:20px;margin-bottom:20px;border:2px solid var(--primary-green);box-shadow:0 0 25px rgba(168,85,247,0.4);}
        .slots-reels{display:flex;justify-content:space-around;margin:20px 0;gap:10px;}
        .reel-container{position:relative;width:80px;height:80px;overflow:hidden;border-radius:15px;background:rgba(0,0,0,0.7);border:2px solid rgba(255,255,255,0.2);}
        .reel{display:flex;flex-direction:column;transition:transform 2s cubic-bezier(0.1,0,0.2,1);}
        .slot-item{width:80px;height:80px;display:flex;align-items:center;justify-content:center;font-size:40px;}
        .slots-result{background:rgba(0,0,0,0.8);border-radius:15px;padding:15px;margin-top:20px;border:1px solid rgba(255,255,255,0.1);text-align:center;}
        .payout-table{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:15px;font-size:11px;}
        .payout-item{background:rgba(255,255,255,0.05);border-radius:8px;padding:8px;text-align:center;}
        .jackpot{color:#FFD700;font-weight:800;text-shadow:0 0 10px rgba(255,215,0,0.8);}
        .coin-flip-game{background:rgba(0,0,0,0.6);border-radius:20px;padding:20px;margin-bottom:20px;border:2px solid var(--primary-green);box-shadow:0 0 25px rgba(168,85,247,0.4);}
        .coin-bet-controls{display:flex;align-items:center;gap:10px;margin-bottom:20px;}
        .bet-input{flex:1;padding:12px 15px;border-radius:12px;background:rgba(0,0,0,0.3);border:2px solid rgba(168,85,247,0.6);color:white;font-family:inherit;font-size:16px;font-weight:700;text-align:center;outline:none;min-height:44px;}
        .bet-input:focus{box-shadow:0 0 15px rgba(168,85,247,0.6);border-color:#a855f7;}
        .bet-buttons{display:flex;gap:8px;margin-top:15px;}
        .bet-btn{padding:12px 15px;background:rgba(168,85,247,0.2);border:2px solid rgba(168,85,247,0.5);border-radius:10px;color:white;cursor:pointer;font-size:14px;font-weight:700;min-width:65px;text-align:center;flex:1;}
        .bet-btn.active{background:linear-gradient(135deg,#a855f7,#7c3aed);border-color:#a855f7;box-shadow:0 5px 15px rgba(168,85,247,0.4);}
        .coin-container{width:150px;height:150px;margin:0 auto 20px;perspective:1000px;}
        .coin{width:100%;height:100%;position:relative;transform-style:preserve-3d;transform:rotateY(0deg);transition:none;}
        .coin-face{position:absolute;width:100%;height:100%;backface-visibility:hidden;border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 0 20px rgba(0,0,0,0.5);overflow:hidden;}
        .coin-face img{width:100%;height:100%;object-fit:cover;}
        .coin-front{background:linear-gradient(45deg,#a855f7,#7c3aed);transform:rotateY(0deg);}
        .coin-back{background:linear-gradient(45deg,#7c3aed,#a855f7);transform:rotateY(180deg);}
        .gold-side{filter:sepia(1) saturate(2) hue-rotate(10deg) brightness(1.2);}
        @keyframes coinSpin{0%{transform:rotateY(0);}25%{transform:rotateY(180deg) translateY(-20px);}50%{transform:rotateY(360deg) translateY(0);}75%{transform:rotateY(540deg) translateY(-10px);}100%{transform:rotateY(var(--final-rotation,720deg)) translateY(0);}}
        .coin-spinning{animation:coinSpin 2.5s cubic-bezier(0.4,2.4,0.8,0.9) forwards;}
        .coin-final{animation:none!important;transform:rotateY(var(--final-rotation,0deg))!important;}
        .game-result{background:rgba(0,0,0,0.8);border-radius:15px;padding:15px;margin-top:20px;text-align:center;}
        .result-text{font-size:18px;font-weight:700;margin-bottom:10px;}
        .win-amount{font-size:24px;font-weight:800;color:#27ae60;}
        .loss-amount{font-size:24px;font-weight:800;color:#e74c3c;}
        .side-selection{display:flex;gap:10px;margin-bottom:20px;}
        .side-btn{flex:1;padding:20px 15px;border-radius:15px;background:rgba(255,255,255,0.05);border:2px solid transparent;cursor:pointer;text-align:center;transition:all 0.3s;min-height:140px;display:flex;flex-direction:column;justify-content:center;align-items:center;}
        .side-btn.active{border-color:var(--primary-green);background:rgba(168,85,247,0.2);box-shadow:0 5px 20px rgba(168,85,247,0.3);}
        .side-btn.win{border-color:#27ae60;background:rgba(39,174,96,0.2);}
        .side-btn.lose{border-color:#e74c3c;background:rgba(231,76,60,0.2);}
        .side-icon{font-size:24px;margin-bottom:10px;width:70px;height:70px;display:flex;align-items:center;justify-content:center;}
        .side-name{font-size:16px;font-weight:700;margin-bottom:5px;}
        .side-description{font-size:12px;color:var(--text-muted);text-align:center;}
        .support-channel-card{background:rgba(255,255,255,0.05);border-radius:12px;padding:15px;margin-bottom:10px;cursor:pointer;transition:all 0.3s;border:1px solid rgba(255,255,255,0.1);}
        .support-channel-card:hover{background:rgba(255,255,255,0.08);transform:translateY(-2px);border-color:rgba(168,85,247,0.4);}
        .notification-area{position:fixed;top:100px;left:50%;transform:translateX(-50%);width:90%;max-width:400px;z-index:1000;}
        .notification{background:var(--glass-bg);backdrop-filter:blur(15px);-webkit-backdrop-filter:blur(15px);border-radius:12px;padding:12px 15px;margin-bottom:8px;border:1px solid rgba(255,255,255,0.1);animation:slideIn 0.3s ease;}
        @keyframes slideIn{from{transform:translateY(-20px);opacity:0;}to{transform:translateY(0);opacity:1;}}
        @keyframes slideOut{from{transform:translateY(0);opacity:1;}to{transform:translateY(-20px);opacity:0;}}
        @media (max-width:480px){
            .app-container{padding:10px;padding-bottom:80px;}
            .main-coin-img{width:120px;height:120px;}
            .balance-amount{font-size:36px;}
            .bottom-nav{width:95%;height:60px;}
            .nav-text{font-size:8px;}
        }
    </style>
</head>
<body>
    <script>
        (function(){
            if(!window.Telegram?.WebApp?.initData){
                const ua=navigator.userAgent.toLowerCase();
                const isBrowser=/chrome|firefox|safari|edge|opera|mobile/.test(ua);
                const isTelegram=ua.includes('telegram')||ua.includes('tweb');
                if(isBrowser&&!isTelegram){
                    document.open();
                    document.write(`<!DOCTYPE html><html><head><title>Access Blocked - GLX Galaxy</title><style>body{margin:0;padding:20px;background:#000;color:#fff;font-family:system-ui,-apple-system,sans-serif;display:flex;justify-content:center;align-items:center;min-height:100vh;text-align:center;}.container{max-width:500px;padding:30px;background:rgba(255,68,68,0.1);border:2px solid #f44;border-radius:20px;}h1{color:#f44;margin-bottom:20px;}.telegram-button{display:inline-block;margin-top:20px;padding:15px 30px;background:#0088cc;color:white;text-decoration:none;border-radius:10px;font-weight:bold;}</style></head><body><div class="container"><h1>üö´ Access Restricted</h1><p>This application only works inside the <strong>Telegram mobile app</strong>.</p><p>Please open this link in Telegram on your mobile device.</p><a href="https://t.me/GLXGalaxyBot" class="telegram-button">Open in Telegram</a></div></body></html>`);
                    document.close();throw new Error('Browser access blocked');
                }
            }
        })();
    </script>
    
    <div id="security-verification" class="verification-container">
        <div style="margin-bottom:25px;">
            <img src="https://i.ibb.co/tTkJX1Qy/logo.png" alt="GLX Galaxy" style="width:80px;height:80px;border-radius:50%;margin-bottom:15px;border:3px solid var(--primary-green);">
            <h1 style="font-size:24px;margin-bottom:8px;color:#fff;">GLX Galaxy Security</h1>
            <p style="color:var(--text-muted);font-size:13px;">Secure verification in progress</p>
        </div>
        <div class="verification-progress">
            <div id="verification-progress-bar" class="progress-bar" style="width:0%"></div>
        </div>
        <div id="verification-steps"></div>
        <div id="verification-result" style="display:none;margin-top:20px;"></div>
    </div>
    
    <div id="blocked-access" class="blocked-container" style="display:none;">
        <div class="blocked-icon">üö´</div>
        <div class="blocked-title">ACCESS BLOCKED</div>
        <div id="blocked-reason" class="blocked-reason"></div>
    </div>
    
    <div class="notification-area" id="notification-area"></div>
    
    <div class="app-container" style="display:none;" id="app-container">
        <div class="hud-container">
            <div>
                <div class="user-name" id="home-username">Explorer</div>
                <div style="display:flex;align-items:center;gap:15px;margin-top:5px;">
                    <div class="stats-pill" style="margin:0;padding:6px 12px;">
                        <span style="color:var(--gold);">GLX:</span>
                        <span id="hud-glx-balance" style="color:#fff;font-weight:700;">0</span>
                    </div>
                    <div class="stats-pill" style="margin:0;padding:6px 12px;">
                        <span style="color:var(--gold);">TON:</span>
                        <span id="hud-ton-balance" style="color:#fff;font-weight:700;">0.0000</span>
                    </div>
                </div>
            </div>
            <div style="display:flex;align-items:center;gap:10px;">
                <div class="galaxy-log-icon" id="galaxy-log-button">
                    <span style="font-size:20px;">üìú</span>
                </div>
                <div class="hud-avatar">
                    <img src="https://i.ibb.co/tTkJX1Qy/logo.png" alt="User">
                </div>
            </div>
        </div>
        
        <main id="home" class="content-section active">
            <div class="main-coin-section">
                <img src="https://i.ibb.co/tTkJX1Qy/logo.png" class="main-coin-img" alt="GLX">
                <div class="balance-display">
                    <div class="balance-amount" id="total-GLX-balance">0</div>
                    <div class="balance-unit">GLX</div>
                </div>
                <div class="stats-pill">
                    <span class="ton-val">
                        <img src="https://i.ibb.co/8DsyHqwK/toncoin-ton-logo.png" style="width:16px;border-radius:50%;">
                        <span id="home-ton-balance">0.0000</span> TON
                    </span>
                    <span style="opacity:0.3">|</span>
                    <span style="font-size:10px;opacity:0.8;">100K = 0.01 TON</span>
                </div>
            </div>
            
            <div class="action-bar">
                <div class="btn btn-action nav-link" data-target="swap-page">
                    <svg viewBox="0 0 24 24"><path d="M7 16V4m0 0L3 8m4-4 4 4m6 0v12m0 0 4-4m-4 4-4-4"/></svg>
                    <span>Swap</span>
                </div>
                <div class="btn btn-action nav-link" data-target="withdraw">
                    <svg viewBox="0 0 24 24"><path d="M12 5v14m0 0-6-6m6 6 6-6"/></svg>
                    <span>Withdraw</span>
                </div>
                <div class="btn btn-action nav-link" data-target="user-withdrawals">
                    <svg viewBox="0 0 24 24"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" y1="22" x2="4" y2="15"/></svg>
                    <span>My Withdrawals</span>
                </div>
                <div class="btn btn-action nav-link" data-target="deposit">
                    <svg viewBox="0 0 24 24"><path d="M12 5v14m0 0-6-6m6 6 6-6" transform="rotate(180,12,12)"/></svg>
                    <span>Deposit</span>
                </div>
            </div>
            
            <div class="card" style="margin-top:15px;">
                <h2><i class="fa-solid fa-credit-card"></i>Payments Channel</h2>
                <div class="support-channel-card" onclick="window.open('https://t.me/earnmoney139482','_blank')">
                    <div style="display:flex;align-items:center;gap:12px;">
                        <div style="width:50px;height:50px;background:linear-gradient(135deg,#a855f7,#7b61ff);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:24px;color:white;">
                            <i class="fab fa-telegram"></i>
                        </div>
                        <div style="flex:1;">
                            <div style="font-size:14px;font-weight:700;color:white;margin-bottom:5px;">Payments & Withdrawals</div>
                            <div style="font-size:11px;color:var(--text-muted);">Track payments and withdrawals</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card" style="margin-top:12px;">
                <h2><i class="fa-solid fa-headset"></i>Support & Help</h2>
                <div class="support-channel-card" onclick="window.open('https://t.me/aborabie777','_blank')" style="margin-bottom:10px;">
                    <div style="display:flex;align-items:center;gap:12px;">
                        <div style="width:50px;height:50px;background:linear-gradient(135deg,#3498db,#2980b9);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:24px;color:white;">
                            <i class="fa-solid fa-user-gear"></i>
                        </div>
                        <div style="flex:1;">
                            <div style="font-size:14px;font-weight:700;color:white;margin-bottom:5px;">Technical Support</div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        <main id="galaxy-log-page" class="content-section">
            <div class="page-header">
                <h1>Galaxy Log</h1>
                <p>Transaction history</p>
            </div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:15px;">
                <div class="log-stat-card">
                    <div style="font-size:12px;color:var(--text-muted);">Total Earned</div>
                    <div style="font-size:18px;font-weight:700;color:#27ae60;" id="total-earned">0 GLX</div>
                </div>
                <div class="log-stat-card">
                    <div style="font-size:12px;color:var(--text-muted);">Total Spent</div>
                    <div style="font-size:18px;font-weight:700;color:#e74c3c;" id="total-spent">0 GLX</div>
                </div>
            </div>
            <div id="galaxy-log-filtered-list" style="max-height:500px;overflow-y:auto;"></div>
        </main>
        
        <main id="deposit" class="content-section">
            <div class="page-header">
                <h1>Deposit TON</h1>
                <p>Contact support for instructions</p>
            </div>
            <div class="card" style="text-align:center;padding:30px;">
                <div style="margin-bottom:25px;">
                    <div style="width:80px;height:80px;background:linear-gradient(135deg,#3498db,#2980b9);border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 15px;font-size:32px;color:white;">
                        <i class="fa-solid fa-wallet"></i>
                    </div>
                    <h3 style="color:var(--gold);margin-bottom:10px;">Deposit Disabled</h3>
                    <p style="color:var(--text-muted);font-size:13px;">Contact support for assistance</p>
                </div>
                <button class="btn btn-ton" onclick="window.open('https://t.me/aborabie777','_blank')">
                    <i class="fa-solid fa-headset"></i> Contact Support
                </button>
            </div>
        </main>
        
        <main id="user-withdrawals" class="content-section">
            <div class="page-header">
                <h1>My Withdrawals</h1>
                <p>Track your withdrawal requests</p>
            </div>
            <div class="card">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;">
                    <h3 style="color:var(--gold);font-size:14px;">Withdrawal History</h3>
                    <div style="display:flex;gap:5px;">
                        <button class="btn-filter small active" onclick="filterUserWithdrawals('all')">All</button>
                        <button class="btn-filter small" onclick="filterUserWithdrawals('pending')">Pending</button>
                        <button class="btn-filter small" onclick="filterUserWithdrawals('completed')">Completed</button>
                    </div>
                </div>
                <div id="user-withdrawals-list" style="max-height:400px;overflow-y:auto;display:flex;flex-direction:column-reverse;"></div>
            </div>
        </main>
        
        <main id="competition" class="content-section">
            <div class="page-header">
                <h1>Daily Competition</h1>
                <p>Win Big with Tickets</p>
            </div>
            <div class="competition-timer-card">
                <div class="countdown-display" id="countdown-timer">24:00:00</div>
                <div class="timer-label">TIME UNTIL NEXT COMPETITION</div>
            </div>
            <div class="status-grid">
                <div class="status-card">
                    <div class="status-icon">üèÅ</div>
                    <div class="status-value" id="competition-status">ACTIVE</div>
                    <div class="status-label">COMPETITION STATUS</div>
                </div>
                <div class="status-card">
                    <div class="status-value" id="prize-pool">0.000 TON</div>
                    <div class="status-label">TOTAL PRIZE POOL</div>
                </div>
                <div class="status-card">
                    <div class="status-value" id="user-tickets">0</div>
                    <div class="status-label">YOUR TICKETS</div>
                </div>
                <div class="status-card">
                    <div class="status-value" id="total-tickets">0</div>
                    <div class="status-label">TOTAL TICKETS</div>
                </div>
            </div>
            <div class="ticket-price-note">
                <p>üé´ <strong>Each ticket = 10,000 GLX = 0.001 TON</strong></p>
            </div>
            <div class="competition-rules-card">
                <div class="rules-header">
                    <i class="fa-solid fa-circle-info"></i>
                    <span>Competition Rules</span>
                </div>
                <ul class="rules-list">
                    <li><span class="winner-highlight">üèÜ ONLY THE FIRST PLACE WINS!</span></li>
                    <li><span class="loser-note">‚ùå ALL OTHER PARTICIPANTS LOSE</span></li>
                    <li>üé´ Each ticket costs <strong>10,000 GLX (0.001 TON)</strong></li>
                    <li>üí∞ Prize Pool = Total Tickets √ó 0.001 TON</li>
                </ul>
            </div>
            <div class="card">
                <h3 style="color:var(--gold);margin-bottom:15px;">üéüÔ∏è Buy Tickets</h3>
                <div class="ticket-controls">
                    <input type="number" id="ticket-amount" class="ticket-input" placeholder="Enter tickets amount" min="1" value="1">
                    <button class="max-btn" onclick="setMaxTickets()">MAX</button>
                </div>
                <div class="price-info">
                    <div style="display:flex;justify-content:space-between;margin-bottom:10px;font-size:12px;">
                        <span style="color:var(--text-muted);">Tickets:</span>
                        <span id="tickets-count-display">1</span>
                    </div>
                    <div style="display:flex;justify-content:space-between;margin-bottom:15px;font-size:12px;">
                        <span style="color:var(--text-muted);">Cost:</span>
                        <span id="tickets-cost-display">10,000 GLX</span>
                    </div>
                </div>
                <button class="btn btn-primary" id="buy-tickets-btn" onclick="buyTickets()">
                    <i class="fa-solid fa-ticket"></i> BUY TICKETS
                </button>
            </div>
            <div class="competition-leaderboard">
                <div class="leaderboard-header">
                    <h3 style="font-size:16px;color:var(--gold);">üèÜ Top 10 Leaders</h3>
                </div>
                <div id="competition-leaderboard-list" style="max-height:300px;overflow-y:auto;padding-bottom:10px;">
                    <p style="text-align:center;padding:20px;color:var(--text-muted);">Loading...</p>
                </div>
            </div>
        </main>
        
        <main id="bonus" class="content-section">
            <div class="page-header">
                <h1>Galaxy Bonus</h1>
                <p>Daily rewards & fun games</p>
            </div>
            <div class="bonus-grid">
                <div class="bonus-game-card" onclick="openGame('coin-flip')">
                    <img src="https://i.ibb.co/gLT3myT3/Coin-Flip-Game.png" alt="Coin Flip Game" class="game-banner">
                    <div class="game-content">
                        <div class="game-icon">ü™ô</div>
                        <div class="game-title">Coin Flip</div>
                    </div>
                </div>
                <div class="bonus-game-card" onclick="openGame('promo-codes')">
                    <img src="https://i.ibb.co/jnp9cTb/Promo-Codes-Rewards.png" alt="Promo Codes" class="game-banner">
                    <div class="game-content">
                        <div class="game-icon">üéÅ</div>
                        <div class="game-title">Promo Codes</div>
                    </div>
                </div>
                <div class="bonus-game-card" onclick="openGame('daily-streak')">
                    <img src="https://i.ibb.co/GQQ0BnsT/Daily-Streak.png" alt="Daily Streak" class="game-banner">
                    <div class="game-content">
                        <div class="game-icon">üìÖ</div>
                        <div class="game-title">Daily Streak</div>
                    </div>
                </div>
                <div class="bonus-game-card" onclick="openGame('galaxy-slots')">
                    <img src="https://i.ibb.co/204QyBWX/Galaxy-Slots-Game.png" alt="Galaxy Slots" class="game-banner">
                    <div class="game-content">
                        <div class="game-icon">üé∞</div>
                        <div class="game-title">Galaxy Slots</div>
                    </div>
                </div>
            </div>
            
            <div id="coin-flip-section" class="card" style="display:none;">
                <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:15px;">
                    <h3 style="font-size:14px;color:var(--gold);"><i class="fa-solid fa-coins"></i> Coin Flip</h3>
                    <button class="btn btn-action" onclick="closeGame()" style="width:auto;padding:8px 12px;font-size:11px;">
                        <i class="fa-solid fa-arrow-left"></i> Back
                    </button>
                </div>
                <div class="coin-flip-game">
                    <div class="coin-bet-controls">
                        <input type="number" id="coin-bet-amount" class="bet-input" placeholder="Enter bet amount" min="1000" value="1000">
                        <button class="max-btn" onclick="setMaxBet()" style="width:auto;padding:12px 15px;">MAX</button>
                    </div>
                    <div class="bet-buttons">
                        <button class="bet-btn k-style active" onclick="setBetAmount(1000)">1k</button>
                        <button class="bet-btn k-style" onclick="setBetAmount(5000)">5k</button>
                        <button class="bet-btn k-style" onclick="setBetAmount(10000)">10k</button>
                    </div>
                    <div class="side-selection">
                        <div class="side-btn active" id="choose-glx" onclick="chooseSide('glx')">
                            <div class="side-icon">
                                <img src="https://i.ibb.co/tTkJX1Qy/logo.png" style="width:70px;height:70px;border-radius:50%;">
                            </div>
                            <div class="side-name">GLX Side</div>
                        </div>
                        <div class="side-btn" id="choose-gold" onclick="chooseSide('gold')">
                            <div class="side-icon">
                                <img src="https://i.ibb.co/tTkJX1Qy/logo.png" style="width:70px;height:70px;border-radius:50%;filter:sepia(1) saturate(2) hue-rotate(10deg) brightness(1.2);">
                            </div>
                            <div class="side-name">Gold Side</div>
                        </div>
                    </div>
                    <div class="coin-container">
                        <div class="coin" id="coin">
                            <div class="coin-face coin-front">
                                <img src="https://i.ibb.co/tTkJX1Qy/logo.png" alt="GLX Coin">
                            </div>
                            <div class="coin-face coin-back">
                                <img src="https://i.ibb.co/tTkJX1Qy/logo.png" alt="Gold Coin" class="gold-side">
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-primary" id="flip-coin-btn" onclick="flipCoin()">
                        <i class="fa-solid fa-play"></i> FLIP COIN
                    </button>
                    <div class="game-result" id="coin-game-result" style="display:none;">
                        <div class="result-text" id="coin-result-text"></div>
                        <div class="win-amount" id="coin-win-amount"></div>
                        <div class="loss-amount" id="coin-loss-amount"></div>
                    </div>
                </div>
            </div>
            
            <div id="promo-codes-section" class="card" style="display:none;">
                <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:15px;">
                    <h3 style="font-size:14px;color:var(--gold);"><i class="fa-solid fa-gift"></i> Promo Codes</h3>
                    <button class="btn btn-action" onclick="closeGame()" style="width:auto;padding:8px 12px;font-size:11px;">
                        <i class="fa-solid fa-arrow-left"></i> Back
                    </button>
                </div>
                <div class="promo-card" style="background:linear-gradient(135deg,rgba(168,85,247,0.2),rgba(123,97,255,0.2));border-radius:20px;padding:20px;margin-bottom:15px;border:2px solid rgba(168,85,247,0.3);">
                    <div style="display:flex;align-items:center;gap:10px;margin-bottom:15px;">
                        <div style="width:50px;height:50px;background:linear-gradient(135deg,#a855f7,#7b61ff);border-radius:15px;display:flex;align-items:center;justify-content:center;font-size:24px;color:white;">
                            <i class="fa-solid fa-key"></i>
                        </div>
                        <div>
                            <div style="font-size:16px;font-weight:800;color:white;">Redeem Code</div>
                            <div style="font-size:12px;color:rgba(255,255,255,0.7);">Enter promo code</div>
                        </div>
                    </div>
                    <div style="display:flex;gap:10px;margin-bottom:15px;">
                        <input type="text" id="promo-code-input" placeholder="Enter promo code..." style="flex:1;padding:12px 15px;border-radius:12px;background:rgba(0,0,0,0.3);border:1px solid rgba(168,85,247,0.5);color:white;font-family:inherit;font-size:14px;outline:none;">
                        <button id="redeem-code-btn" style="padding:12px 20px;background:linear-gradient(135deg,#a855f7,#7b61ff);border:none;border-radius:12px;color:white;font-weight:700;cursor:pointer;">
                            <i class="fa-solid fa-gift"></i> Redeem
                        </button>
                    </div>
                    <div id="promo-result" style="padding:10px;border-radius:10px;font-size:12px;text-align:center;display:none;"></div>
                </div>
                <div class="code-channel-card" style="background:linear-gradient(135deg,rgba(255,193,7,0.2),rgba(255,152,0,0.2));border-radius:20px;padding:20px;border:2px solid rgba(255,193,7,0.3);cursor:pointer;" onclick="window.open('https://t.me/earnmoney1685','_blank')">
                    <div style="display:flex;align-items:center;gap:15px;">
                        <div style="width:60px;height:60px;background:linear-gradient(135deg,#FFC107,#FF9800);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:28px;color:white;">
                            <i class="fab fa-telegram"></i>
                        </div>
                        <div style="flex:1;">
                            <div style="font-size:16px;font-weight:800;color:white;margin-bottom:5px;">
                                <i class="fa-solid fa-bolt" style="color:#FFC107;"></i> Codes Channel
                            </div>
                            <div style="font-size:12px;color:rgba(255,255,255,0.8);">Get exclusive promo codes</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="daily-streak-section" class="card" style="display:none;">
                <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:15px;">
                    <h3 style="font-size:14px;color:var(--gold);"><i class="fa-solid fa-calendar-check"></i> Daily Streak</h3>
                    <button class="btn btn-action" onclick="closeGame()" style="width:auto;padding:8px 12px;font-size:11px;">
                        <i class="fa-solid fa-arrow-left"></i> Back
                    </button>
                </div>
                <div class="daily-row" id="daily-checkin-grid"></div>
                <button class="btn btn-primary" id="claim-daily-btn">Claim Bonus</button>
            </div>
            
            <div id="galaxy-slots-section" class="card" style="display:none;text-align:center;">
                <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:15px;">
                    <h3 style="font-size:14px;color:var(--gold);"><i class="fa-solid fa-slot-machine"></i> Galaxy Slots</h3>
                    <button class="btn btn-action" onclick="closeGame()" style="width:auto;padding:8px 12px;font-size:11px;">
                        <i class="fa-solid fa-arrow-left"></i> Back
                    </button>
                </div>
                <div class="spins-display">
                    <div>
                        <div style="font-size:12px;color:var(--text-muted);">Available Spins</div>
                        <div class="spins-count" id="available-spins">1</div>
                    </div>
                </div>
                <div class="slots-machine">
                    <div class="slots-reels">
                        <div class="reel-container">
                            <div class="reel" id="reel1"></div>
                        </div>
                        <div class="reel-container">
                            <div class="reel" id="reel2"></div>
                        </div>
                        <div class="reel-container">
                            <div class="reel" id="reel3"></div>
                        </div>
                    </div>
                    <div class="slots-result">
                        <div id="slots-result-text" style="font-size:14px;margin-bottom:10px;">Press SPIN to play!</div>
                        <div id="slots-win-amount" style="font-size:24px;font-weight:800;color:var(--primary-green);">0 GLX</div>
                    </div>
                </div>
                <button class="btn btn-primary" id="slots-spin-btn" style="margin-bottom:15px;">üöÄ SPIN NOW</button>
            </div>
        </main>
        
        <main id="tasks" class="content-section">
            <div class="page-header">
                <h1>Missions</h1>
                <p>Complete tasks to earn GLX</p>
            </div>
            <div class="card">
                <div id="monetag-ad-task" class="list-card">
                    <div class="lc-icon"><img src="https://i.ibb.co/tTkJX1Qy/logo.png" alt="Ad"></div>
                    <div class="lc-content">
                        <div class="lc-title">Monetag Ad</div>
                        <div class="lc-sub"><span id="monetag-count">0</span> / <span id="monetag-limit">50</span></div>
                    </div>
                    <div class="lc-end">
                        <div class="lc-val">+1000</div>
                    </div>
                </div>
                <div id="gigapub-ad-task" class="list-card">
                    <div class="lc-icon"><img src="https://i.ibb.co/tTkJX1Qy/logo.png" alt="Ad"></div>
                    <div class="lc-content">
                        <div class="lc-title">GigaPub Ad</div>
                        <div class="lc-sub"><span id="giga-count">0</span> / <span id="giga-limit">300</span></div>
                    </div>
                    <div class="lc-end">
                        <div class="lc-val">+2000</div>
                    </div>
                </div>
                <div id="adsgram-ad-task" class="list-card">
                    <div class="lc-icon"><img src="https://i.ibb.co/tTkJX1Qy/logo.png" alt="Ad"></div>
                    <div class="lc-content">
                        <div class="lc-title">AdsGram Ad</div>
                        <div class="lc-sub"><span id="adsgram-count">0</span> / <span id="adsgram-limit">300</span></div>
                    </div>
                    <div class="lc-end">
                        <div class="lc-val">+2000</div>
                    </div>
                </div>
            </div>
            <h2>Partners</h2>
            <div id="partner-tasks-card">
                <div id="partner-tasks-list"></div>
            </div>
        </main>
        
        <main id="create-task-page" class="content-section">
            <div class="page-header">
                <h1>Add Mission</h1>
                <p>Promote your channel or bot</p>
            </div>
            <div class="card">
                <div class="input-wrap">
                    <span class="input-label">Task Name</span>
                    <input type="text" id="new-task-name" class="custom-input" placeholder="e.g. Join Channel">
                </div>
                <div class="input-wrap">
                    <span class="input-label">Link</span>
                    <input type="text" id="new-task-link" class="custom-input" placeholder="https://t.me/...">
                </div>
                <div class="input-label" style="margin-bottom:10px;">Category</div>
                <div class="cat-select">
                    <div class="cat-opt active" onclick="selectCat(this,'channel')">Channel</div>
                    <div class="cat-opt" onclick="selectCat(this,'bot')">Bot</div>
                </div>
                <div class="input-label" style="margin-bottom:10px;">Number of Completions</div>
                <div class="price-grid" id="price-options"></div>
                <button class="btn btn-ton" id="pay-task-btn" onclick="initiatePayment()">
                    <img src="https://i.ibb.co/8DsyHqwK/toncoin-ton-logo.png" style="width:20px;border-radius:50%;">Pay <span id="pay-amount-display">0</span> TON
                </button>
            </div>
        </main>
        
        <main id="withdrawal-history" class="content-section">
            <div class="page-header">
                <h1>Withdrawal History</h1>
                <p>All completed withdrawals</p>
            </div>
            <div id="withdrawal-history-list" style="padding:10px;"></div>
        </main>
        
        <main id="swap-page" class="content-section">
            <div class="page-header">
                <h1>Swap Market</h1>
                <p>100K GLX = 0.01 TON</p>
            </div>
            <div class="swap-direction-selector">
                <div class="swap-direction-btn active" onclick="selectSwapDirection('glx_to_ton')">GLX ‚Üí TON</div>
                <div class="swap-direction-btn" onclick="selectSwapDirection('ton_to_glx')">TON ‚Üí GLX</div>
            </div>
            <div class="card">
                <div id="glx-to-ton-section">
                    <div class="input-wrap">
                        <span class="input-label">You Give (GLX)</span>
                        <input type="number" id="swap-input-amount" class="custom-input" placeholder="Min 1,000" oninput="calculateSwap()">
                        <button onclick="setMaxSwap('glx')" style="margin-left:10px;background:var(--primary-green);color:#000;border:none;padding:4px 8px;border-radius:6px;font-size:10px;cursor:pointer;">MAX</button>
                    </div>
                    <div class="input-wrap">
                        <span class="input-label">You Get (TON)</span>
                        <div style="display:flex;align-items:center;gap:10px;">
                            <img src="https://i.ibb.co/8DsyHqwK/toncoin-ton-logo.png" style="width:24px;">
                            <span id="swap-output-amount" class="custom-input">0.0000000</span>
                        </div>
                    </div>
                </div>
                <div id="ton-to-glx-section" style="display:none;">
                    <div class="input-wrap">
                        <span class="input-label">You Give (TON)</span>
                        <input type="number" id="ton-input-amount" class="custom-input" placeholder="Min 0.0001" oninput="calculateSwap()">
                        <button onclick="setMaxSwap('ton')" style="margin-left:10px;background:var(--primary-green);color:#000;border:none;padding:4px 8px;border-radius:6px;font-size:10px;cursor:pointer;">MAX</button>
                    </div>
                    <div class="input-wrap">
                        <span class="input-label">You Get (GLX)</span>
                        <div style="display:flex;align-items:center;gap:10px;">
                            <img src="https://i.ibb.co/tTkJX1Qy/logo.png" style="width:24px;height:24px;border-radius:50%;">
                            <span id="ton-output-amount" class="custom-input">0</span>
                        </div>
                    </div>
                </div>
                <button class="btn btn-primary" id="execute-swap-btn" onclick="executeSwap()">Confirm Swap</button>
            </div>
        </main>
        
        <main id="withdraw" class="content-section">
            <div class="page-header">
                <h1>Withdraw</h1>
                <p>GLX out to TON Wallet</p>
            </div>
            <div class="withdrawal-type-selector">
                <div class="withdrawal-type-btn active" data-type="faucetpay" onclick="selectWithdrawalType('faucetpay')">
                    <i class="fa-solid fa-envelope"></i> FaucetPay
                </div>
                <div class="withdrawal-type-btn" data-type="tonwallet" onclick="selectWithdrawalType('tonwallet')">
                    <i class="fa-solid fa-wallet"></i> TON Wallet
                </div>
            </div>
            <div id="faucetpay-form" class="card">
                <div class="input-wrap">
                    <span class="input-label">FaucetPay Email</span>
                    <input type="email" id="faucetpay-email" class="custom-input" placeholder="example@gmail.com">
                </div>
                <div class="input-wrap withdraw-input-with-max">
                    <span class="input-label">Withdrawal Amount (TON)</span>
                    <div style="display:flex;align-items:center;gap:8px;">
                        <input type="number" id="faucetpay-amount" class="custom-input" placeholder="0.0001" step="0.0001" min="0.0001" value="0.0001" style="flex:1;">
                        <button class="max-btn" onclick="setMaxFaucetPay()">MAX</button>
                    </div>
                </div>
                <button class="btn btn-primary" id="withdraw-faucetpay-btn" onclick="handleFaucetPayWithdraw()">
                    <i class="fa-solid fa-paper-plane"></i> WITHDRAW
                </button>
            </div>
            <div id="tonwallet-form" class="card" style="display:none;">
                <div class="input-wrap">
                    <span class="input-label">TON Wallet Address</span>
                    <input type="text" id="ton-wallet-address" class="custom-input" placeholder="UQ... or EQ... or kQ...">
                </div>
                <div class="input-wrap withdraw-input-with-max">
                    <span class="input-label">Withdrawal Amount (TON)</span>
                    <div style="display:flex;align-items:center;gap:8px;">
                        <input type="number" id="ton-withdraw-amount" class="custom-input" placeholder="0.05" step="0.01" min="0.05" value="0.05" style="flex:1;">
                        <button class="max-btn" onclick="setMaxTonWallet()">MAX</button>
                    </div>
                </div>
                <button class="btn btn-primary" id="withdraw-ton-now-btn" onclick="handleTonWalletWithdraw()">
                    <i class="fa-solid fa-wallet"></i> WITHDRAW
                </button>
            </div>
        </main>
    </div>
    
    <div class="floating-add-task hidden" id="floatingAddTask" onclick="switchTab('create-task-page')">
        <div class="floating-add-task-content">
            <div class="floating-add-task-icon">+</div>
            <div class="floating-add-task-text">Add Task</div>
        </div>
    </div>
    
    <nav class="bottom-nav">
        <div class="nav-item active" data-target="home">
            <svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path></svg>
            <span class="nav-text">Home</span>
        </div>
        <div class="nav-item" data-target="tasks">
            <svg viewBox="0 0 24 24"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>
            <span class="nav-text">Tasks</span>
        </div>
        <div class="nav-item" data-target="bonus">
            <svg viewBox="0 0 24 24"><path d="M20 12V8H6a2 2 0 0 1-2-2c0-1.1.9-2 2-2h12v4"/><path d="M4 6v12c0 1.1.9 2 2 2h14v-4"/><path d="M18 12a2 2 0 0 0-2 2c0 1.1.9 2 2 2h4v-4h-4z"/></svg>
            <span class="nav-text">Bonus</span>
        </div>
        <div class="nav-item competition-nav-item" data-target="competition">
            <svg viewBox="0 0 32 32" width="28" height="28">
                <circle cx="16" cy="16" r="14" fill="rgba(255,215,0,0.15)" opacity="0.8"/>
                <path d="M9 13 L16 8 L23 13 L21 21 L11 21 Z" fill="none" stroke="#FFD700" stroke-width="2"/>
            </svg>
            <span class="nav-text">Competition</span>
        </div>
        <div class="nav-item" data-target="referrals">
            <svg viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
            <span class="nav-text">Referrals</span>
        </div>
    </nav>
    
    <script>
        const API_URL="https://silent-block-bedf.ahmedrabieharoun.workers.dev";
        const BOT_USERNAME='CashJungleBot';
        const GLX_TO_TON_RATE=0.0000001;
        const TON_TO_GLX_RATE=10000000;
        const TICKET_PRICE=10000;
        const TICKET_TON_VALUE=0.001;
        const COMPETITION_DURATION=24*60*60*1000;
        const ADSGRAM_BLOCK_ID='int-18879';
        
        let appData={};
        let appSettings={
            adRewardMonetag:1000,adRewardGiga:2000,adRewardAdsgram:2000,
            limitMonetag:50,limitGiga:300,limitAdsgram:300,
            minTonWithdrawal:0.05,minFaucetPayWithdrawal:0.0001,
            referralReward:500,pricePerClick:0.0015
        };
        
        let isAdScriptLoaded=false;
        let isLeaderboardLoaded=false;
        let AdController=null;
        let selectedCategory='channel';
        let selectedCount=100;
        let selectedCost=0.15;
        let currentTaskId='';
        let isSpinning=false;
        const slotsSymbols=['üåü','ü™ê','üí´','‚≠ê','üöÄ','üåå'];
        const slotsPayouts={'üåüüåüüåü':10000,'ü™êü™êü™ê':5000,'üí´üí´üí´':2500,'‚≠ê‚≠ê‚≠ê':1200,'üåüüåü':700,'default':500};
        
        let coinGame={isFlipping:false,chosenSide:'glx',betAmount:1000,lastFlipResult:null};
        let withdrawalType='faucetpay';
        let swapDirection='glx_to_ton';
        let competitionInterval=null;
        let countdownInterval=null;
        let competitionData={isActive:true,startTime:Date.now(),endTime:Date.now()+COMPETITION_DURATION,totalTickets:0,prizePool:0,userTickets:0,winners:[]};
        let lastAdClickTime=0;
        const AD_CLICK_DELAY=3000;
        let currentDepositAmount=0;
        let currentDepositMemo='';
        let depositCheckInterval=null;
        
        async function callAPI(action,data={}){
            try{
                const response=await fetch(`${API_URL}/api`,{
                    method:'POST',
                    headers:{'Content-Type':'application/json','X-User-ID':window.Telegram?.WebApp?.initDataUnsafe?.user?.id||'','X-Telegram-Data':window.Telegram?.WebApp?.initData||'','X-Action':action},
                    body:JSON.stringify({action:action,data:data,timestamp:Date.now()})
                });
                if(!response.ok)throw new Error(`API Error: ${response.status}`);
                return await response.json();
            }catch(error){
                console.error('API call failed:',error);
                showNotification("Connection error. Please try again.","error");
                return{success:false,error:error.message};
            }
        }
        
        function showNotification(message,type="info"){
            const area=document.getElementById('notification-area');
            if(!area)return;
            const colors={error:'#e74c3c',success:'#27ae60',warning:'#ffb300',info:'#3498db'};
            const icon={error:'‚ùå',success:'‚úÖ',warning:'‚ö†Ô∏è',info:'‚ÑπÔ∏è'};
            const notification=document.createElement('div');
            notification.className='notification';
            notification.style.borderLeft=`4px solid ${colors[type]}`;
            notification.innerHTML=`<div style="display:flex;align-items:center;gap:10px;">
                <div style="font-size:16px;">${icon[type]}</div>
                <div style="font-size:13px;">${message}</div>
            </div>`;
            area.appendChild(notification);
            setTimeout(()=>{notification.style.animation='slideOut 0.3s ease';setTimeout(()=>notification.remove(),300);},5000);
        }
        
        async function performSecurityVerification(){
            const stepsContainer=document.getElementById('verification-steps');
            const progressBar=document.getElementById('verification-progress-bar');
            const resultContainer=document.getElementById('verification-result');
            stepsContainer.innerHTML='';
            progressBar.style.width='20%';
            
            if(!window.Telegram?.WebApp?.initData){
                const userAgent=navigator.userAgent.toLowerCase();
                const isMobileBrowser=/chrome|safari|firefox|edge|opera/.test(userAgent);
                let errorMessage='‚ùå Unauthorized access. ';
                if(isMobileBrowser)errorMessage+='This bot only works inside the Telegram mobile app.';
                else errorMessage+='Please open this bot in Telegram mobile app.';
                document.getElementById('security-verification').style.display='none';
                document.getElementById('blocked-access').style.display='block';
                document.getElementById('blocked-reason').innerHTML=errorMessage;
                return false;
            }
            
            const tgUser=window.Telegram?.WebApp?.initDataUnsafe?.user;
            if(!tgUser){
                document.getElementById('security-verification').style.display='none';
                document.getElementById('blocked-access').style.display='block';
                document.getElementById('blocked-reason').innerHTML='‚ùå Unable to verify Telegram user.';
                return false;
            }
            
            progressBar.style.width='100%';
            resultContainer.innerHTML=`<div style="background:rgba(39,174,96,0.1);border:1px solid rgba(39,174,96,0.3);border-radius:12px;padding:15px;text-align:center;">
                <div style="font-size:20px;margin-bottom:10px;">‚úÖ</div>
                <div style="font-weight:700;color:#27ae60;margin-bottom:5px;">Welcome!</div>
            </div>`;
            await new Promise(resolve=>setTimeout(resolve,1500));
            return{user:tgUser,isExisting:true};
        }
        
        function showMainApp(){
            document.getElementById('security-verification').style.display='none';
            document.getElementById('blocked-access').style.display='none';
            document.getElementById('app-container').style.display='block';
        }
        
        document.addEventListener('DOMContentLoaded',async function(){
            const verificationResult=await performSecurityVerification();
            if(!verificationResult)return;
            showMainApp();
            const{user,isExisting}=verificationResult;
            if(window.Telegram?.WebApp){
                window.Telegram.WebApp.ready();
                window.Telegram.WebApp.expand();
                window.Telegram.WebApp.headerColor='#202020';
                window.Telegram.WebApp.backgroundColor='#202020';
            }
            await initializeUser(user);
            initializeApp(user);
        });
        
        async function initializeUser(user){
            const result=await callAPI('initializeUser',{user});
            if(result.success){
                appData=result.data.userData||{};
                if(result.data.settings)appSettings=result.data.settings;
                renderUI(user);
                renderDailyBonusUI();
                updateAvailableSpins();
                handleReferral(user);
            }else console.error('Error initializing user:',result.error);
        }
        
        function initializeApp(user){
            const fullName=`${user.first_name} ${user.last_name}`.trim();
            document.getElementById('home-username').textContent=fullName;
            if(window.Adsgram)AdController=window.Adsgram.init({blockId:ADSGRAM_BLOCK_ID});
            setupEventListeners(user);
            setupGalaxyLogButton();
            renderCreateTaskUI();
            initSlotsGame();
            initCoinFlipGame();
            initPromoCodes();
            initializeCompetition();
            setTimeout(()=>{isAdScriptLoaded=typeof show_10286382==="function";},2500);
            selectWithdrawalType('faucetpay');
            selectSwapDirection('glx_to_ton');
            const ticketInput=document.getElementById('ticket-amount');
            if(ticketInput){ticketInput.addEventListener('input',updateTicketCostDisplay);updateTicketCostDisplay();}
        }
        
        async function handleReferral(user){
            const tg=window.Telegram?.WebApp;
            const startParam=tg?.initDataUnsafe?.start_param;
            if(startParam&&startParam.startsWith('ref')){
                const referrerId=startParam.replace('ref','');
                if(referrerId&&referrerId!==user.id)await callAPI('handleReferral',{userId:user.id,referrerId:referrerId});
            }
        }
        
        function getLevel(balance){
            if(balance>=5000000)return 10;
            if(balance>=2500000)return 9;
            if(balance>=1000000)return 8;
            if(balance>=500000)return 7;
            if(balance>=250000)return 6;
            if(balance>=100000)return 5;
            if(balance>=50000)return 4;
            if(balance>=25000)return 3;
            if(balance>=5000)return 2;
            return 1;
        }
        
        function renderUI(user){
            if(!appData)return;
            const GLX=Math.floor(appData.dogsBalance||0);
            const ton=(appData.tonBalance||0).toFixed(7);
            document.getElementById('total-GLX-balance').textContent=GLX.toLocaleString();
            document.getElementById('home-ton-balance').textContent=parseFloat(ton).toFixed(4);
            document.getElementById('swap-max-GLX').textContent=GLX.toLocaleString();
            document.getElementById('swap-max-TON').textContent=parseFloat(ton).toFixed(4);
            document.querySelectorAll('.user-ton-balance').forEach(el=>{el.textContent=parseFloat(ton).toFixed(4);});
            document.getElementById('hud-glx-balance').textContent=GLX.toLocaleString();
            document.getElementById('hud-ton-balance').textContent=parseFloat(ton).toFixed(4);
            const monetagCount=appData.adsMonetag||0;
            const gigaCount=appData.adsGiga||0;
            const adsgramCount=appData.adsAdsgram||0;
            const limitM=appSettings.limitMonetag||50;
            const limitG=appSettings.limitGiga||300;
            const limitA=appSettings.limitAdsgram||300;
            document.getElementById('monetag-count').textContent=monetagCount;
            document.getElementById('monetag-limit').textContent=limitM;
            document.getElementById('giga-count').textContent=gigaCount;
            document.getElementById('giga-limit').textContent=limitG;
            document.getElementById('adsgram-count').textContent=adsgramCount;
            document.getElementById('adsgram-limit').textContent=limitA;
            if(monetagCount>=limitM){const el=document.getElementById('monetag-ad-task');el.style.opacity='0.5';el.style.pointerEvents='none';}
            if(gigaCount>=limitG){const el=document.getElementById('gigapub-ad-task');el.style.opacity='0.5';el.style.pointerEvents='none';}
            if(adsgramCount>=limitA){const el=document.getElementById('adsgram-ad-task');el.style.opacity='0.5';el.style.pointerEvents='none';}
            fetchAndRenderTasks(user);
            calculateSwap();
        }
        
        window.selectSwapDirection=function(direction){
            swapDirection=direction;
            document.querySelectorAll('.swap-direction-btn').forEach(btn=>btn.classList.remove('active'));
            document.querySelectorAll('.swap-direction-btn').forEach(btn=>{if(btn.textContent.includes(direction==='glx_to_ton'?'GLX ‚Üí TON':'TON ‚Üí GLX'))btn.classList.add('active');});
            if(direction==='glx_to_ton'){
                document.getElementById('glx-to-ton-section').style.display='block';
                document.getElementById('ton-to-glx-section').style.display='none';
            }else{
                document.getElementById('glx-to-ton-section').style.display='none';
                document.getElementById('ton-to-glx-section').style.display='block';
            }
            calculateSwap();
        };
        
        window.calculateSwap=function(){
            if(swapDirection==='glx_to_ton'){
                const GLXInput=parseFloat(document.getElementById('swap-input-amount').value)||0;
                const tonOutput=GLXInput*GLX_TO_TON_RATE;
                document.getElementById('swap-output-amount').textContent=tonOutput.toFixed(7);
            }else{
                const TONInput=parseFloat(document.getElementById('ton-input-amount').value)||0;
                const glxOutput=TONInput*TON_TO_GLX_RATE;
                document.getElementById('ton-output-amount').textContent=Math.floor(glxOutput).toLocaleString();
            }
        };
        
        window.setMaxSwap=function(type){
            if(type==='glx'||swapDirection==='glx_to_ton'){
                const currentBalance=appData.dogsBalance||0;
                if(currentBalance<1000){showNotification("Minimum swap is 1,000 GLX","warning");return;}
                document.getElementById('swap-input-amount').value=currentBalance;
                calculateSwap();
            }else{
                const currentBalance=appData.tonBalance||0;
                if(currentBalance<0.0001){showNotification("Minimum swap is 0.0001 TON","warning");return;}
                document.getElementById('ton-input-amount').value=currentBalance.toFixed(4);
                calculateSwap();
            }
        };
        
        window.executeSwap=function(){
            if(swapDirection==='glx_to_ton')executeGLXtoTONSwap();
            else executeTONtoGLXSwap();
        };
        
        async function executeGLXtoTONSwap(){
            const GLXInput=parseFloat(document.getElementById('swap-input-amount').value)||0;
            const currentGLX=appData.dogsBalance||0;
            if(GLXInput<1000){showNotification("Min swap: 1,000 GLX","warning");return;}
            if(GLXInput>currentGLX){showNotification("Insufficient GLX Balance","warning");return;}
            const tonValue=GLXInput*GLX_TO_TON_RATE;
            if(!confirm(`Swap ${GLXInput.toLocaleString()} GLX for ${tonValue.toFixed(7)} TON?`))return;
            const result=await callAPI('executeSwap',{type:'glx_to_ton',amount:GLXInput,tonValue:tonValue});
            if(result.success){
                appData.dogsBalance=result.data.newGLXBalance;
                appData.tonBalance=result.data.newTONBalance;
                showNotification(`Swap Complete!\n+${tonValue.toFixed(7)} TON`,"success");
                document.getElementById('swap-input-amount').value='';
                document.getElementById('swap-output-amount').textContent='0.0000000';
                switchTab('home');
                renderUI({id:window.Telegram?.WebApp?.initDataUnsafe?.user?.id});
            }else showNotification("Error: "+result.error,"error");
        }
        
        async function executeTONtoGLXSwap(){
            const TONInput=parseFloat(document.getElementById('ton-input-amount').value)||0;
            const currentTON=appData.tonBalance||0;
            if(TONInput<0.0001){showNotification("Min swap: 0.0001 TON","warning");return;}
            if(TONInput>currentTON){showNotification("Insufficient TON Balance","warning");return;}
            const glxValue=TONInput*TON_TO_GLX_RATE;
            if(!confirm(`Swap ${TONInput.toFixed(4)} TON for ${glxValue.toLocaleString()} GLX?`))return;
            const result=await callAPI('executeSwap',{type:'ton_to_glx',amount:TONInput,glxValue:glxValue});
            if(result.success){
                appData.tonBalance=result.data.newTONBalance;
                appData.dogsBalance=result.data.newGLXBalance;
                showNotification(`Swap Complete!\n+${glxValue.toLocaleString()} GLX`,"success");
                document.getElementById('ton-input-amount').value='';
                document.getElementById('ton-output-amount').textContent='0';
                switchTab('home');
                renderUI({id:window.Telegram?.WebApp?.initDataUnsafe?.user?.id});
            }else showNotification("Error: "+result.error,"error");
        }
        
        window.openGame=function(gameType){
            document.getElementById('coin-flip-section').style.display='none';
            document.getElementById('promo-codes-section').style.display='none';
            document.getElementById('daily-streak-section').style.display='none';
            document.getElementById('galaxy-slots-section').style.display='none';
            const grid=document.querySelector('.bonus-grid');
            grid.style.display='none';
            document.getElementById(gameType+'-section').style.display='block';
            if(gameType==='coin-flip')resetCoinFlipGame();
            else if(gameType==='galaxy-slots'){initSlotsGame();updateAvailableSpins();}
            else if(gameType==='daily-streak')renderDailyBonusUI();
        };
        
        window.closeGame=function(){
            document.getElementById('coin-flip-section').style.display='none';
            document.getElementById('promo-codes-section').style.display='none';
            document.getElementById('daily-streak-section').style.display='none';
            document.getElementById('galaxy-slots-section').style.display='none';
            const grid=document.querySelector('.bonus-grid');
            grid.style.display='grid';
        };
        
        function setupGalaxyLogButton(){
            const galaxyLogBtn=document.getElementById('galaxy-log-button');
            if(galaxyLogBtn)galaxyLogBtn.addEventListener('click',function(){switchTab('galaxy-log-page');});
        }
        
        function initializeCompetition(){
            updateCompetitionUI();
            loadPreviousWinners();
        }
        
        async function updateCompetitionUI(){
            const result=await callAPI('getCompetitionData');
            if(result.success){
                competitionData=result.data.competitionData||competitionData;
                const now=Date.now();
                const isBreak=competitionData.breakMode||false;
                if(isBreak){
                    document.getElementById('competition-status').textContent='BREAK';
                    document.getElementById('competition-status').style.color='#FFC107';
                }else{
                    document.getElementById('competition-status').textContent=competitionData.isActive?'ACTIVE':'ENDED';
                    document.getElementById('competition-status').style.color=competitionData.isActive?'#27ae60':'#e74c3c';
                }
                document.getElementById('prize-pool').textContent=competitionData.prizePool?competitionData.prizePool.toFixed(3)+' TON':'0.000 TON';
                document.getElementById('total-tickets').textContent=competitionData.totalTickets||0;
                let userTicketsValue=0;
                if(typeof competitionData.userTickets==='object')userTicketsValue=competitionData.userTickets[window.Telegram?.WebApp?.initDataUnsafe?.user?.id]||0;
                else userTicketsValue=parseInt(competitionData.userTickets)||0;
                document.getElementById('user-tickets').textContent=userTicketsValue;
                const ticketInput=document.getElementById('ticket-amount');
                if(ticketInput)updateTicketCostDisplay();
                const buyBtn=document.getElementById('buy-tickets-btn');
                if(buyBtn){buyBtn.disabled=isBreak||!competitionData.isActive;buyBtn.style.opacity=isBreak||!competitionData.isActive?'0.5':'1';}
                updateCompetitionLeaderboard();
                startCountdown();
            }
        }
        
        function startCountdown(){
            if(countdownInterval)clearInterval(countdownInterval);
            countdownInterval=setInterval(()=>{
                const now=Date.now();
                let timeRemaining=0;
                let isBreak=competitionData.breakMode||false;
                if(isBreak)timeRemaining=Math.max(0,competitionData.breakEndTime-now);
                else timeRemaining=Math.max(0,competitionData.endTime-now);
                if(timeRemaining<=0){
                    updateCompetitionUI();
                    return;
                }
                const hours=Math.floor(timeRemaining/(1000*60*60));
                const minutes=Math.floor((timeRemaining%(1000*60*60))/(1000*60));
                const seconds=Math.floor((timeRemaining%(1000*60))/1000);
                const formattedTime=`${hours.toString().padStart(2,'0')}:${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
                document.getElementById('countdown-timer').textContent=formattedTime;
            },1000);
        }
        
        function updateTicketCostDisplay(){
            const ticketInput=document.getElementById('ticket-amount');
            if(!ticketInput)return;
            const tickets=parseInt(ticketInput.value)||1;
            const cost=tickets*TICKET_PRICE;
            document.getElementById('tickets-count-display').textContent=tickets;
            document.getElementById('tickets-cost-display').textContent=cost.toLocaleString()+' GLX';
        }
        
        window.setMaxTickets=function(){
            const currentBalance=appData.dogsBalance||0;
            const maxTickets=Math.floor(currentBalance/TICKET_PRICE);
            if(maxTickets<1){showNotification("You need 10,000 GLX for a ticket","warning");return;}
            const ticketInput=document.getElementById('ticket-amount');
            ticketInput.value=maxTickets;
            updateTicketCostDisplay();
        };
        
        window.buyTickets=async function(){
            if(competitionData.breakMode){showNotification("Competition is on break","warning");return;}
            if(!competitionData.isActive){showNotification("Competition has ended","warning");return;}
            const ticketInput=document.getElementById('ticket-amount');
            const tickets=parseInt(ticketInput.value)||0;
            if(tickets<1){showNotification("Enter at least 1 ticket","warning");return;}
            const totalCost=tickets*TICKET_PRICE;
            const currentBalance=appData.dogsBalance||0;
            if(totalCost>currentBalance){showNotification(`Need ${totalCost.toLocaleString()} GLX`,"warning");return;}
            if(!confirm(`Buy ${tickets} ticket${tickets>1?'s':''} for ${totalCost.toLocaleString()} GLX?`))return;
            const buyBtn=document.getElementById('buy-tickets-btn');
            buyBtn.disabled=true;
            buyBtn.innerHTML='<i class="fas fa-spinner fa-spin"></i> Processing...';
            const result=await callAPI('buyTickets',{tickets:tickets,totalCost:totalCost});
            if(result.success){
                appData.dogsBalance=result.data.newBalance;
                competitionData.userTickets=result.data.userTickets;
                competitionData.totalTickets=result.data.totalTickets;
                competitionData.prizePool=result.data.prizePool;
                buyBtn.disabled=false;
                buyBtn.innerHTML='<i class="fa-solid fa-ticket"></i> BUY TICKETS';
                showNotification(`Purchased ${tickets} ticket${tickets>1?'s':''}!`,"success");
                ticketInput.value=1;
                updateTicketCostDisplay();
                renderUI({id:window.Telegram?.WebApp?.initDataUnsafe?.user?.id});
                updateCompetitionUI();
            }else{showNotification("Error: "+result.error,"error");buyBtn.disabled=false;buyBtn.innerHTML='<i class="fa-solid fa-ticket"></i> BUY TICKETS';}
        };
        
        async function updateCompetitionLeaderboard(){
            const result=await callAPI('getCompetitionLeaderboard');
            if(result.success){
                const leaderboardContainer=document.getElementById('competition-leaderboard-list');
                const leaderboardData=result.data.leaderboard||[];
                if(leaderboardData.length===0){
                    leaderboardContainer.innerHTML='<p style="text-align:center;padding:20px;color:var(--text-muted);">No tickets purchased</p>';
                    return;
                }
                leaderboardContainer.innerHTML='';
                leaderboardData.forEach((entry,index)=>{
                    const rankClass=index===0?'rank-1':index===1?'rank-2':index===2?'rank-3':'';
                    const html=`<div class="competition-rank-card ${rankClass}">
                        <div class="competition-rank">#${index+1}</div>
                        <img src="${entry.photoUrl||'https://i.ibb.co/tTkJX1Qy/logo.png'}" class="competition-user-avatar" alt="${entry.name}">
                        <div class="competition-user-info">
                            <div class="competition-user-name">${entry.name}</div>
                        </div>
                        <div class="competition-ticket-count">${entry.tickets} ticket${entry.tickets!==1?'s':''}</div>
                    </div>`;
                    leaderboardContainer.insertAdjacentHTML('beforeend',html);
                });
            }
        }
        
        async function loadPreviousWinners(){}
        
        window.renderGalaxyLog=async function(){
            const result=await callAPI('getTransactionHistory');
            if(result.success){
                const historyData=result.data.history||[];
                let totalEarned=0;
                let totalSpent=0;
                historyData.forEach(item=>{
                    if(item.type.includes('earn')||item.type==='referral')totalEarned+=parseFloat(item.amount)||0;
                    else if(item.type.includes('spend')||item.type.includes('loss')||item.type.includes('withdraw'))totalSpent+=parseFloat(item.amount)||0;
                });
                document.getElementById('total-earned').textContent=Math.floor(totalEarned).toLocaleString()+' GLX';
                document.getElementById('total-spent').textContent=Math.floor(totalSpent).toLocaleString()+' GLX';
                const container=document.getElementById('galaxy-log-filtered-list');
                container.innerHTML='';
                historyData.forEach(item=>{
                    let icon='üìú',color='#fff',typeClass='';
                    if(item.type.includes('earn')||item.type==='referral'){icon='üí∞';color='#27ae60';typeClass='earn';}
                    else if(item.type.includes('spend')||item.type.includes('loss')){icon='üìâ';color='#e74c3c';typeClass='spend';}
                    else if(item.type.includes('swap')){icon='üîÑ';color='#3498db';typeClass='swap';}
                    else if(item.type.includes('withdraw')){icon='üè¶';color='#9b59b6';typeClass='withdraw';}
                    const amount=item.currency==='TON'?parseFloat(item.amount).toFixed(4)+' TON':Math.floor(item.amount).toLocaleString()+' GLX';
                    const html=`<div class="log-item ${typeClass}">
                        <div style="font-size:20px;margin-right:12px;">${icon}</div>
                        <div style="flex:1;">
                            <div style="font-size:13px;font-weight:600;margin-bottom:2px;">${item.description}</div>
                            <div style="font-size:10px;color:var(--text-muted);">${new Date(item.date).toLocaleString()}</div>
                        </div>
                        <div style="font-size:14px;font-weight:700;color:${color};">${amount}</div>
                    </div>`;
                    container.insertAdjacentHTML('beforeend',html);
                });
            }
        };
        
        window.filterUserWithdrawals=async function(type){
            await updateUserWithdrawalsList(type);
        };
        
        async function updateUserWithdrawalsList(filterType){
            const result=await callAPI('getUserWithdrawals');
            if(result.success){
                const withdrawals=result.data.withdrawals||[];
                const container=document.getElementById('user-withdrawals-list');
                container.innerHTML='';
                const filteredWithdrawals=withdrawals.filter(withdrawal=>{
                    if(filterType==='all')return true;
                    if(filterType==='pending')return withdrawal.status==='pending'||withdrawal.processed===false;
                    if(filterType==='completed')return withdrawal.status==='completed'||withdrawal.processed===true;
                    return true;
                });
                filteredWithdrawals.sort((a,b)=>b.timestamp-a.timestamp);
                if(filteredWithdrawals.length===0){
                    container.innerHTML='<p style="text-align:center;padding:20px;color:var(--text-muted);">No withdrawals</p>';
                    return;
                }
                filteredWithdrawals.forEach(withdrawal=>{
                    const timeAgo=getTimeAgo(withdrawal.timestamp);
                    const amount=parseFloat(withdrawal.amount||0).toFixed(7);
                    let status='',statusText='',statusClass='';
                    if(withdrawal.status==='rejected'){status='rejected';statusText='‚ùå Rejected';statusClass='status-rejected';}
                    else if(withdrawal.status==='completed'||withdrawal.processed===true){status='completed';statusText='‚úÖ Completed';statusClass='status-completed';}
                    else{status='pending';statusText='‚è≥ Pending';statusClass='status-pending';}
                    let maskedAccount=withdrawal.account||'';
                    if(withdrawal.method==='faucetpay'&&maskedAccount.includes('@')){
                        const[localPart,domain]=maskedAccount.split('@');
                        if(localPart.length>3)maskedAccount=localPart.charAt(0)+'*'.repeat(Math.max(3,localPart.length-2))+localPart.charAt(localPart.length-1)+'@'+domain;
                    }else if(withdrawal.method==='ton'&&maskedAccount.length>16)maskedAccount=maskedAccount.substring(0,8)+'...'+maskedAccount.substring(maskedAccount.length-4);
                    const html=`<div class="user-withdrawal-item">
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:5px;">
                            <div style="font-size:12px;font-weight:600;">${withdrawal.method==='ton'?'TON Wallet':'FaucetPay'}</div>
                            <div class="withdrawal-status ${statusClass}">${statusText}</div>
                        </div>
                        <div style="font-size:11px;color:var(--text-muted);margin-bottom:5px;" class="masked-email">${maskedAccount}</div>
                        <div style="display:flex;justify-content:space-between;align-items:center;">
                            <div style="font-size:14px;font-weight:700;color:var(--primary-green);">${amount} TON</div>
                            <div style="font-size:9px;color:var(--text-muted);">${timeAgo}</div>
                        </div>
                    </div>`;
                    container.insertAdjacentHTML('beforeend',html);
                });
            }
        }
        
        function getTimeAgo(timestamp){
            if(!timestamp)return"Unknown time";
            const now=Date.now();
            const diff=now-timestamp;
            const seconds=Math.floor(diff/1000);
            const minutes=Math.floor(seconds/60);
            const hours=Math.floor(minutes/60);
            const days=Math.floor(hours/24);
            if(days>0)return`${days} day${days>1?'s':''} ago`;
            if(hours>0)return`${hours} hour${hours>1?'s':''} ago`;
            if(minutes>0)return`${minutes} minute${minutes>1?'s':''} ago`;
            if(seconds>0)return`${seconds} second${seconds!==1?'s':''} ago`;
            return"Just now";
        }
        
        window.setMaxBet=function(){
            const currentBalance=appData.dogsBalance||0;
            const maxBet=Math.floor(currentBalance/1000)*1000;
            if(maxBet<1000){showNotification("Minimum bet is 1,000 GLX","warning");return;}
            document.getElementById('coin-bet-amount').value=maxBet;
            coinGame.betAmount=maxBet;
        };
        
        window.setBetAmount=function(amount){
            coinGame.betAmount=amount;
            document.getElementById('coin-bet-amount').value=amount;
            document.querySelectorAll('.bet-btn').forEach(btn=>{
                btn.classList.remove('active');
                const btnAmount=parseInt(btn.dataset.amount)||0;
                if(btnAmount===amount)btn.classList.add('active');
            });
        };
        
        window.chooseSide=function(side){
            coinGame.chosenSide=side;
            document.querySelectorAll('.side-btn').forEach(btn=>{btn.classList.remove('active');btn.classList.remove('win');btn.classList.remove('lose');});
            const selectedBtn=side==='glx'?document.getElementById('choose-glx'):document.getElementById('choose-gold');
            selectedBtn.classList.add('active');
        };
        
        window.flipCoin=async function(){
            if(coinGame.isFlipping)return;
            const inputElement=document.getElementById('coin-bet-amount');
            const inputAmount=parseInt(inputElement.value);
            if(!inputAmount||inputAmount<1000){showNotification("Minimum bet is 1,000 GLX","warning");return;}
            const currentBalance=appData.dogsBalance||0;
            if(inputAmount>currentBalance){showNotification("Insufficient GLX balance!","warning");return;}
            coinGame.betAmount=inputAmount;
            coinGame.isFlipping=true;
            const coin=document.getElementById('coin');
            coin.classList.remove('coin-spinning','coin-final');
            coin.style.transform='rotateY(0deg)';
            coin.style.transition='none';
            const resultElement=document.getElementById('coin-game-result');
            resultElement.style.display='none';
            document.querySelectorAll('.bet-btn').forEach(btn=>{btn.style.opacity='0.5';btn.style.pointerEvents='none';});
            document.querySelectorAll('.side-btn').forEach(btn=>{btn.classList.remove('win','lose');});
            const result=await callAPI('flipCoin',{betAmount:inputAmount,chosenSide:coinGame.chosenSide});
            if(result.success){
                coinGame.isFlipping=false;
                const flipBtn=document.getElementById('flip-coin-btn');
                flipBtn.disabled=true;
                flipBtn.innerHTML='<i class="fas fa-spinner fa-spin"></i> FLIPPING...';
                setTimeout(()=>{
                    const isWin=result.data.isWin;
                    const resultSide=result.data.resultSide;
                    const winAmount=result.data.winAmount||0;
                    let finalRotation=0;
                    if(resultSide==='glx')finalRotation=720+(Math.floor(Math.random()*4)*360);
                    else finalRotation=720+180+(Math.floor(Math.random()*4)*360);
                    coin.style.setProperty('--final-rotation',`${finalRotation}deg`);
                    coin.classList.add('coin-spinning');
                    setTimeout(()=>{
                        coin.classList.remove('coin-spinning');
                        coin.classList.add('coin-final');
                        showCoinFlipResult(isWin,resultSide,inputAmount,winAmount,finalRotation);
                        flipBtn.disabled=false;
                        flipBtn.innerHTML='<i class="fa-solid fa-play"></i> FLIP COIN';
                        document.querySelectorAll('.bet-btn').forEach(btn=>{btn.style.opacity='1';btn.style.pointerEvents='auto';});
                        coinGame.lastFlipResult=resultSide;
                        coinGame.currentRotation=finalRotation%360;
                        setTimeout(()=>{renderUI({id:window.Telegram?.WebApp?.initDataUnsafe?.user?.id});},500);
                    },2500);
                },100);
            }else{showNotification("Error: "+result.error,"error");coinGame.isFlipping=false;const flipBtn=document.getElementById('flip-coin-btn');flipBtn.disabled=false;flipBtn.innerHTML='<i class="fa-solid fa-play"></i> FLIP COIN';document.querySelectorAll('.bet-btn').forEach(btn=>{btn.style.opacity='1';btn.style.pointerEvents='auto';});}
        };
        
        function showCoinFlipResult(isWin,resultSide,betAmount,winAmount,finalRotation){
            const resultElement=document.getElementById('coin-game-result');
            const resultText=document.getElementById('coin-result-text');
            const winAmountElement=document.getElementById('coin-win-amount');
            const lossAmountElement=document.getElementById('coin-loss-amount');
            winAmountElement.style.display='none';
            lossAmountElement.style.display='none';
            if(isWin){
                resultText.innerHTML=`üéâ <strong>YOU WIN!</strong><br>${coinGame.chosenSide.toUpperCase()} appeared!`;
                resultText.style.color='#27ae60';
                winAmountElement.textContent=`+${winAmount.toLocaleString()} GLX`;
                winAmountElement.style.display='block';
                const selectedBtn=coinGame.chosenSide==='glx'?document.getElementById('choose-glx'):document.getElementById('choose-gold');
                selectedBtn.classList.add('win');
                selectedBtn.classList.remove('active');
                if(winAmount>=5000)setTimeout(()=>{showNotification(`BIG WIN! ${winAmount.toLocaleString()} GLX!`,"success");},500);
            }else{
                const lossAmount=betAmount;
                resultText.innerHTML=`üò¢ <strong>YOU LOSE</strong><br>${resultSide.toUpperCase()} appeared`;
                resultText.style.color='#e74c3c';
                lossAmountElement.textContent=`-${lossAmount.toLocaleString()} GLX`;
                lossAmountElement.style.display='block';
                const selectedBtn=coinGame.chosenSide==='glx'?document.getElementById('choose-glx'):document.getElementById('choose-gold');
                selectedBtn.classList.add('lose');
                selectedBtn.classList.remove('active');
            }
            resultElement.style.display='block';
            const coin=document.getElementById('coin');
            setTimeout(()=>{coin.style.transform=`rotateY(${finalRotation}deg)`;},100);
        }
        
        function resetCoinFlipGame(){
            const coin=document.getElementById('coin');
            coin.classList.remove('coin-spinning','coin-final');
            coin.style.transform='rotateY(0deg)';
            coin.style.transition='none';
            document.getElementById('coin-game-result').style.display='none';
            document.querySelectorAll('.side-btn').forEach(btn=>{
                btn.classList.remove('win','lose');
                if(btn.id==='choose-glx')btn.classList.add('active');
                else btn.classList.remove('active');
            });
            coinGame.isFlipping=false;
            coinGame.chosenSide='glx';
            coinGame.betAmount=1000;
            coinGame.currentRotation=0;
            document.getElementById('coin-bet-amount').value=1000;
            updateBetButtons();
        }
        
        window.initCoinFlipGame=function(){resetCoinFlipGame();};
        
        function updateBetButtons(){
            const amounts=[1000,5000,10000,25000];
            const buttons=document.querySelectorAll('.bet-btn');
            buttons.forEach((btn,index)=>{
                if(index<amounts.length){
                    btn.textContent=amounts[index]>=1000?(amounts[index]/1000)+'k':amounts[index];
                    btn.dataset.amount=amounts[index];
                    if(amounts[index]===1000)btn.classList.add('active');
                    else btn.classList.remove('active');
                }
            });
        }
        
        function initPromoCodes(){
            const redeemBtn=document.getElementById('redeem-code-btn');
            const promoInput=document.getElementById('promo-code-input');
            if(redeemBtn)redeemBtn.addEventListener('click',handlePromoCode);
            if(promoInput)promoInput.addEventListener('keypress',function(e){if(e.key==='Enter')handlePromoCode();});
        }
        
        async function handlePromoCode(){
            const codeInput=document.getElementById('promo-code-input');
            const resultDiv=document.getElementById('promo-result');
            const redeemBtn=document.getElementById('redeem-code-btn');
            if(!codeInput||!resultDiv||!redeemBtn)return;
            const code=codeInput.value.trim().toUpperCase();
            if(!code){showPromoResult('Enter a promo code','error');return;}
            redeemBtn.disabled=true;
            redeemBtn.innerHTML='<i class="fas fa-spinner fa-spin"></i> Checking...';
            const result=await callAPI('redeemPromoCode',{code:code});
            if(result.success){
                const reward=result.data.reward;
                appData.dogsBalance=result.data.newBalance;
                showPromoResult(`Success! +${reward} GLX`,'success');
                codeInput.value='';
                renderUI({id:window.Telegram?.WebApp?.initDataUnsafe?.user?.id});
            }else showPromoResult('‚ùå '+result.error,'error');
            redeemBtn.disabled=false;
            redeemBtn.innerHTML='<i class="fa-solid fa-gift"></i> Redeem';
        }
        
        function showPromoResult(message,type){
            const resultDiv=document.getElementById('promo-result');
            if(!resultDiv)return;
            resultDiv.textContent=message;
            resultDiv.style.display='block';
            if(type==='success'){resultDiv.style.background='rgba(39,174,96,0.2)';resultDiv.style.border='1px solid rgba(39,174,96,0.5)';resultDiv.style.color='#27ae60';}
            else if(type==='error'){resultDiv.style.background='rgba(231,76,60,0.2)';resultDiv.style.border='1px solid rgba(231,76,60,0.5)';resultDiv.style.color='#e74c3c';}
            else{resultDiv.style.background='rgba(255,193,7,0.2)';resultDiv.style.border='1px solid rgba(255,193,7,0.5)';resultDiv.style.color='#FFC107';}
            setTimeout(()=>{resultDiv.style.display='none';},5000);
        }
        
        window.selectCat=function(el,cat){
            document.querySelectorAll('.cat-opt').forEach(e=>e.classList.remove('active'));
            el.classList.add('active');
            selectedCategory=cat;
        };
        
        function renderCreateTaskUI(){
            const container=document.getElementById('price-options');
            container.innerHTML='';
            const options=[100,500,1000,2000,5000,10000];
            options.forEach((opt,idx)=>{
                const html=`<div class="price-opt ${idx===0?'active':''}" data-count="${opt}" onclick="selectPrice(this)">
                    <div class="price-count">${opt.toLocaleString()}</div>
                    <div class="price-cost" id="cost-${opt}">Loading...</div>
                </div>`;
                container.insertAdjacentHTML('beforeend',html);
            });
            calculateCost();
        }
        
        window.selectPrice=function(el){
            document.querySelectorAll('.price-opt').forEach(e=>e.classList.remove('active'));
            el.classList.add('active');
            selectedCount=parseInt(el.dataset.count);
            calculateCost();
        };
        
        function calculateCost(){
            const rate=appSettings.pricePerClick||0.0015;
            document.querySelectorAll('.price-opt').forEach(el=>{
                const cnt=parseInt(el.dataset.count);
                const cst=(cnt*rate).toFixed(4);
                const costDiv=el.querySelector('.price-cost');
                if(costDiv)costDiv.textContent=`${cst} TON`;
            });
            selectedCost=(selectedCount*rate).toFixed(4);
            document.getElementById('pay-amount-display').textContent=selectedCost;
        }
        
        window.initiatePayment=async function(){
            const name=document.getElementById('new-task-name').value.trim();
            const link=document.getElementById('new-task-link').value.trim();
            if(!name||!link){showNotification("Fill all fields","warning");return;}
            if(!link.startsWith('http')){showNotification("Invalid link","warning");return;}
            currentTaskId='task_'+Math.floor(Date.now()/1000);
            const result=await callAPI('createTask',{taskId:currentTaskId,name:name,link:link,category:selectedCategory,count:selectedCount,cost:selectedCost});
            if(result.success){
                const nanoTon=Math.floor(selectedCost*1000000000);
                const paymentUrl=`https://app.tonkeeper.com/transfer/UQCg1DjKHH1_guXQ0TFmkvj09igxYwEJGfKPijLaHyOHIPTX?amount=${nanoTon}&text=${currentTaskId}`;
                if(window.Telegram?.WebApp)window.Telegram.WebApp.openLink(paymentUrl);
                else window.open(paymentUrl,'_blank');
                showNotification("Payment initiated","info");
            }else showNotification("Error: "+result.error,"error");
        };
        
        function initSlotsGame(){
            for(let i=1;i<=3;i++){
                const reel=document.getElementById(`reel${i}`);
                reel.innerHTML='';
                for(let j=0;j<10;j++){
                    slotsSymbols.forEach(symbol=>{
                        const item=document.createElement('div');
                        item.className='slot-item';
                        item.textContent=symbol;
                        reel.appendChild(item);
                    });
                }
            }
            document.getElementById('slots-spin-btn').addEventListener('click',handleSlotsSpin);
        }
        
        function updateAvailableSpins(){
            const extraSpins=appData.extraSpins||0;
            document.getElementById('available-spins').textContent=extraSpins;
            const spinBtn=document.getElementById('slots-spin-btn');
            if(extraSpins>0){spinBtn.disabled=false;spinBtn.classList.remove('btn-disabled');spinBtn.textContent=`üöÄ SPIN NOW (${extraSpins} left)`;}
            else{spinBtn.disabled=true;spinBtn.classList.add('btn-disabled');spinBtn.textContent="üöÄ NO SPINS";}
        }
        
        async function handleSlotsSpin(){
            if(isSpinning)return;
            const extraSpins=appData.extraSpins||0;
            if(extraSpins<=0){showNotification("No spins left!","warning");return;}
            isSpinning=true;
            const spinBtn=document.getElementById('slots-spin-btn');
            const resultText=document.getElementById('slots-result-text');
            const winAmount=document.getElementById('slots-win-amount');
            spinBtn.disabled=true;
            resultText.textContent="Spinning...";
            winAmount.textContent="0 GLX";
            const result=await callAPI('spinSlots');
            if(result.success){
                const results=result.data.results;
                const winGLX=result.data.winAmount;
                const newBalance=result.data.newBalance;
                const newSpins=result.data.newSpins;
                const reelPositions=[0,0,0];
                for(let i=0;i<3;i++){
                    const targetIndex=slotsSymbols.indexOf(results[i]);
                    reelPositions[i]=-((targetIndex+5)*80);
                }
                const reels=[document.getElementById('reel1'),document.getElementById('reel2'),document.getElementById('reel3')];
                reels.forEach((reel,index)=>{reel.style.transition='transform 2s cubic-bezier(0.1,0,0.2,1)';reel.style.transform=`translateY(${reelPositions[index]}px)`;});
                setTimeout(()=>{
                    const resultString=results.join('');
                    if(winGLX>0){
                        resultText.textContent=`üéâ You won! (${resultString})`;
                        winAmount.textContent=`+${winGLX} GLX`;
                        appData.dogsBalance=newBalance;
                        appData.extraSpins=newSpins;
                        if(winGLX>=1000)setTimeout(()=>{showNotification(`JACKPOT! ${winGLX} GLX!`,"success");},500);
                    }else{
                        resultText.textContent=`No win (${resultString})`;
                        winAmount.textContent="0 GLX";
                        appData.extraSpins=newSpins;
                    }
                    setTimeout(()=>{
                        isSpinning=false;
                        updateAvailableSpins();
                        renderUI({id:window.Telegram?.WebApp?.initDataUnsafe?.user?.id});
                    },1000);
                },2000);
            }else{showNotification("Error: "+result.error,"error");isSpinning=false;spinBtn.disabled=false;}
        }
        
        function renderDailyBonusUI(){
            const container=document.getElementById('daily-checkin-grid');
            container.innerHTML='';
            const streak=appData.dailyStreak||0;
            const lastClaim=appData.lastDailyClaim||0;
            const now=Date.now();
            const msInDay=86400000;
            const canClaim=(now-lastClaim)>=msInDay;
            const rewards=[2000,3000,5000,7000,9000,12000,15000];
            for(let i=0;i<7;i++){
                let statusClass='';
                if(i<streak)statusClass='claimed';
                else if(i===streak&&canClaim)statusClass='active';
                const html=`<div class="daily-box ${statusClass}">
                    <div style="font-size:9px;">DAY ${i+1}</div>
                    <div style="font-weight:700;">+${rewards[i]}</div>
                </div>`;
                container.insertAdjacentHTML('beforeend',html);
            }
            const btn=document.getElementById('claim-daily-btn');
            if(canClaim){btn.disabled=false;btn.classList.remove('btn-disabled');btn.textContent=`Claim +${rewards[streak]||100}`;}
            else{btn.disabled=true;btn.classList.add('btn-disabled');btn.textContent="Claimed";}
        }
        
        async function handleDailyClaim(){
            const result=await callAPI('claimDailyBonus');
            if(result.success){
                appData.lastDailyClaim=result.data.lastDailyClaim;
                appData.dailyStreak=result.data.dailyStreak;
                appData.dogsBalance=result.data.newBalance;
                showNotification(`Daily bonus! +${result.data.reward} GLX`,"success");
                renderDailyBonusUI();
                renderUI({id:window.Telegram?.WebApp?.initDataUnsafe?.user?.id});
            }else showNotification("Error: "+result.error,"error");
        }
        
        async function fetchAndRenderTasks(user){
            const result=await callAPI('getTasks');
            if(result.success){
                const pCont=document.getElementById('partner-tasks-list');
                pCont.innerHTML='';
                const tasks=result.data.tasks||[];
                const completedTasks=appData.completedTasks||{};
                tasks.forEach(task=>{
                    if(task.status!=='active')return;
                    const isDone=completedTasks[task.id];
                    let iconImg='https://img.icons8.com/fluency/96/task.png';
                    const lt=task.title.toLowerCase();
                    const ll=(task.link||'').toLowerCase();
                    if(lt.includes('bot')||ll.includes('bot')||ll.includes('start='))iconImg='https://i.ibb.co/Myz4Gkmy/Picsart-25-12-10-04-34-59-799.png';
                    else if(lt.includes('telegram')||lt.includes('channel')||lt.includes('group')||lt.includes('join')||ll.includes('t.me'))iconImg='https://i.ibb.co/5WZRG8fw/tele.png';
                    else if(lt.includes('youtube')||lt.includes('subscribe'))iconImg='https://i.ibb.co/CSz6kg9/20251203-200546.png';
                    else if(lt.includes('twitter')||lt.includes('retweet')||lt.includes('follow')||lt.includes('x '))iconImg='https://i.ibb.co/60jp6MsF/20251203-200516.png';
                    const html=`<div class="list-card dynamic-task ${isDone?'disabled':''}" 
                        style="${isDone?'opacity:0.5;pointer-events:none;':''}" 
                        data-id="${task.id}" 
                        data-reward="${task.reward}" 
                        data-title="${task.title}" 
                        data-link="${task.link}" 
                        onclick="handleDynamicTask(this)">
                        <div class="lc-icon"><img src="${iconImg}"></div>
                        <div class="lc-content">
                            <div class="lc-title">${task.title}</div>
                            <div class="lc-sub" id="status-${task.id}">${task.description}</div>
                        </div>
                        <div class="lc-end">
                            <div class="lc-val" id="reward-${task.id}">+${task.reward}</div>
                        </div>
                    </div>`;
                    pCont.insertAdjacentHTML('beforeend',html);
                });
            }
        }
        
        function setupEventListeners(user){
            document.querySelectorAll('.nav-item').forEach(btn=>{btn.addEventListener('click',()=>switchTab(btn.dataset.target));});
            document.querySelectorAll('.nav-link').forEach(link=>{link.addEventListener('click',(e)=>{e.preventDefault();switchTab(link.dataset.target);});});
            document.getElementById('monetag-ad-task').addEventListener('click',handleMonetagAd);
            document.getElementById('gigapub-ad-task').addEventListener('click',handleGigaAd);
            document.getElementById('adsgram-ad-task').addEventListener('click',handleAdsgramAd);
            document.getElementById('claim-daily-btn').addEventListener('click',handleDailyClaim);
            document.getElementById('coin-bet-amount').addEventListener('input',function(){
                const value=parseInt(this.value);
                if(value&&value>=1000)coinGame.betAmount=value;
            });
            document.getElementById('floatingAddTask').addEventListener('click',function(){switchTab('create-task-page');});
        }
        
        function canClickAd(){
            const now=Date.now();
            return(now-lastAdClickTime)>=AD_CLICK_DELAY;
        }
        
        async function handleMonetagAd(){
            if(!canClickAd()){showNotification("Wait 3 seconds","warning");return;}
            lastAdClickTime=Date.now();
            const limit=appSettings.limitMonetag||50;
            if((appData.adsMonetag||0)>=limit)return;
            if(!isAdScriptLoaded){showNotification("Loading ad...","info");return;}
            try{
                await show_10286382({ymid:window.Telegram?.WebApp?.initDataUnsafe?.user?.id});
                const result=await callAPI('handleAdClick',{adType:'monetag',reward:appSettings.adRewardMonetag||1000});
                if(result.success){
                    appData.adsMonetag=result.data.adsMonetag;
                    appData.adsWatched=result.data.adsWatched;
                    appData.dogsBalance=result.data.newBalance;
                    showNotification(`+${appSettings.adRewardMonetag||1000} GLX!`,"success");
                    renderUI({id:window.Telegram?.WebApp?.initDataUnsafe?.user?.id});
                }
            }catch(e){showNotification("Ad not ready","warning");}
        }
        
        async function handleGigaAd(){
            if(!canClickAd()){showNotification("Wait 3 seconds","warning");return;}
            lastAdClickTime=Date.now();
            const limit=appSettings.limitGiga||300;
            if((appData.adsGiga||0)>=limit)return;
            if(typeof window.showGiga!=='function'){showNotification("Loading...","info");return;}
            try{
                await window.showGiga();
                const result=await callAPI('handleAdClick',{adType:'giga',reward:appSettings.adRewardGiga||2000});
                if(result.success){
                    appData.adsGiga=result.data.adsGiga;
                    appData.adsWatched=result.data.adsWatched;
                    appData.dogsBalance=result.data.newBalance;
                    showNotification(`+${appSettings.adRewardGiga||2000} GLX!`,"success");
                    renderUI({id:window.Telegram?.WebApp?.initDataUnsafe?.user?.id});
                }
            }catch(e){showNotification("Ad failed","warning");}
        }
        
        async function handleAdsgramAd(){
            if(!canClickAd()){showNotification("Wait 3 seconds","warning");return;}
            lastAdClickTime=Date.now();
            const limit=appSettings.limitAdsgram||300;
            if((appData.adsAdsgram||0)>=limit)return;
            if(!AdController){showNotification("AdsGram error","warning");return;}
            try{
                const result=await AdController.show();
                if(result.done){
                    const apiResult=await callAPI('handleAdClick',{adType:'adsgram',reward:appSettings.adRewardAdsgram||2000});
                    if(apiResult.success){
                        appData.adsAdsgram=apiResult.data.adsAdsgram;
                        appData.dogsBalance=apiResult.data.newBalance;
                        showNotification(`+${appSettings.adRewardAdsgram||2000} GLX!`,"success");
                        renderUI({id:window.Telegram?.WebApp?.initDataUnsafe?.user?.id});
                    }
                }
            }catch(error){showNotification("Ad error","error");}
        }
        
        window.selectWithdrawalType=function(type){
            withdrawalType=type;
            document.querySelectorAll('.withdrawal-type-btn').forEach(btn=>btn.classList.remove('active'));
            document.querySelector(`.withdrawal-type-btn[data-type="${type}"]`).classList.add('active');
            if(type==='faucetpay'){
                document.getElementById('faucetpay-form').style.display='block';
                document.getElementById('tonwallet-form').style.display='none';
            }else{
                document.getElementById('faucetpay-form').style.display='none';
                document.getElementById('tonwallet-form').style.display='block';
            }
        };
        
        async function handleFaucetPayWithdraw(){
            const email=document.getElementById('faucetpay-email').value.trim();
            const amount=parseFloat(document.getElementById('faucetpay-amount').value);
            const minAmount=appSettings.minFaucetPayWithdrawal||0.0001;
            const currentBalance=appData.tonBalance||0;
            if(!email||!email.includes('@')){showNotification("Valid email required","warning");return;}
            if(amount<minAmount){showNotification(`Minimum: ${minAmount} TON`,"warning");return;}
            if(amount>currentBalance){showNotification("Insufficient TON","warning");return;}
            const[localPart,domain]=email.split('@');
            let maskedEmail='';
            if(localPart.length>3)maskedEmail=localPart.charAt(0)+'*'.repeat(Math.max(3,localPart.length-2))+localPart.charAt(localPart.length-1)+'@'+domain;
            else maskedEmail='*'.repeat(localPart.length)+'@'+domain;
            if(!confirm(`Withdraw ${amount} TON to ${maskedEmail}?`))return;
            const result=await callAPI('submitWithdrawal',{method:'faucetpay',account:email,amount:amount,maskedAccount:maskedEmail});
            if(result.success){
                appData.tonBalance=result.data.newBalance;
                showNotification(`Withdrawal submitted!`,"success");
                document.getElementById('faucetpay-email').value='';
                document.getElementById('faucetpay-amount').value=minAmount;
                switchTab('home');
                renderUI({id:window.Telegram?.WebApp?.initDataUnsafe?.user?.id});
            }else showNotification("Error: "+result.error,"error");
        }
        
        async function handleTonWalletWithdraw(){
            const address=document.getElementById('ton-wallet-address').value.trim();
            const amount=parseFloat(document.getElementById('ton-withdraw-amount').value);
            const minAmount=appSettings.minTonWithdrawal||0.05;
            const currentBalance=appData.tonBalance||0;
            if(!address||address.length<5){showNotification("Valid address required","warning");return;}
            if(amount<minAmount){showNotification(`Minimum: ${minAmount} TON`,"warning");return;}
            if(amount>currentBalance){showNotification("Insufficient TON","warning");return;}
            let shortAddress=address;
            if(address.length>16)shortAddress=address.substring(0,8)+'...'+address.substring(address.length-4);
            if(!confirm(`Withdraw ${amount} TON to ${shortAddress}?`))return;
            const result=await callAPI('submitWithdrawal',{method:'ton',account:address,amount:amount});
            if(result.success){
                appData.tonBalance=result.data.newBalance;
                showNotification(`Withdrawal submitted!`,"success");
                document.getElementById('ton-wallet-address').value='';
                document.getElementById('ton-withdraw-amount').value=minAmount;
                switchTab('home');
                renderUI({id:window.Telegram?.WebApp?.initDataUnsafe?.user?.id});
            }else showNotification("Error: "+result.error,"error");
        }
        
        window.handleDynamicTask=async function(element){
            const{id,reward,title,link}=element.dataset;
            const statusEl=document.getElementById(`status-${id}`);
            const rewardEl=document.getElementById(`reward-${id}`);
            if(element.classList.contains('waiting-verify')){
                await verifyMembership(element,link,id,reward,title);
                return;
            }
            if(window.Telegram?.WebApp)window.Telegram.WebApp.openLink(link);
            else window.open(link,'_blank');
            element.classList.add('waiting-verify');
            statusEl.textContent="Tap again to Verify";
            statusEl.style.color="#ffb300";
            rewardEl.textContent="Check";
        };
        
        async function verifyMembership(element,link,taskId,reward,title){
            const result=await callAPI('verifyTaskCompletion',{taskId:taskId,reward:reward,title:title,link:link});
            if(result.success){
                appData.dogsBalance=result.data.newBalance;
                element.style.opacity='0.5';
                element.style.pointerEvents='none';
                document.getElementById(`status-${taskId}`).textContent="Completed";
                document.getElementById(`status-${taskId}`).style.color="#a855f7";
                document.getElementById(`reward-${taskId}`).textContent="Done";
                showNotification(`Task Completed! +${reward} GLX`,"success");
                renderUI({id:window.Telegram?.WebApp?.initDataUnsafe?.user?.id});
            }else{
                showNotification("‚ùå "+result.error,"warning");
                element.classList.remove('waiting-verify');
                const statusEl=document.getElementById(`status-${taskId}`);
                statusEl.textContent="Join First!";
                statusEl.style.color="#ff4444";
            }
        }
        
        function switchTab(targetId){
            document.querySelectorAll('.content-section').forEach(s=>s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(b=>b.classList.remove('active'));
            document.getElementById(targetId).classList.add('active');
            document.querySelector(`.nav-item[data-target="${targetId}"]`)?.classList.add('active');
            const floatingBtn=document.getElementById('floatingAddTask');
            if(targetId==='tasks')floatingBtn.classList.remove('hidden');
            else floatingBtn.classList.add('hidden');
            if(targetId==='bonus'){
                const grid=document.querySelector('.bonus-grid');
                grid.style.display='grid';
                document.getElementById('coin-flip-section').style.display='none';
                document.getElementById('promo-codes-section').style.display='none';
                document.getElementById('daily-streak-section').style.display='none';
                document.getElementById('galaxy-slots-section').style.display='none';
                renderDailyBonusUI();
                updateAvailableSpins();
                resetCoinFlipGame();
            }
            if(targetId==='competition')updateCompetitionUI();
            if(targetId==='galaxy-log-page')renderGalaxyLog();
            if(targetId==='user-withdrawals')updateUserWithdrawalsList('all');
            window.scrollTo(0,0);
        }
    </script>
</body>
</html>

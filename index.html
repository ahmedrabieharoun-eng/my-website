<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
    <title>Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ø¯Ø¬Ø§Ø¬ - Chicken Farm</title>
    
    <!-- âœ… Ù…ÙƒØªØ¨Ø© Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
    
    <!-- âœ… Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        /* Ø£Ù†Ù…Ø§Ø· Ø§Ù„ØµÙØ­Ø© */
        :root{
            --primary-green:#a855f7;
            --deep-Galaxy:#202020;
            --gold:#d6bcfa;
            --gold-glow:rgba(168,85,247,0.4);
            --glass-bg:rgba(32,32,32,0.7);
            --glass-border:rgba(255,255,255,0.1);
            --text-color:#ffffff;
            --text-muted:#b0b0b0;
            --nav-bg:rgba(40,40,40,0.98);
            --success-color:#a855f7;
        }
        
        *{
            margin:0;
            padding:0;
            box-sizing:border-box;
            -webkit-tap-highlight-color:transparent;
        }
        
        body{
            font-family:'Outfit', sans-serif;
            color:var(--text-color);
            overflow-x:hidden;
            background-image:url('https://i.ibb.co/RGFp67kJ/121.jpg');
            background-size:cover;
            background-position:center;
            background-attachment:fixed;
            min-height:100vh;
        }
        
        body::before{
            content:'';
            position:fixed;
            top:0;
            left:0;
            width:100%;
            height:100%;
            background:radial-gradient(circle at center,rgba(50,50,50,0.3)0%,rgba(30,30,30,0.85)100%);
            z-index:-1;
        }
        
        /* âœ… Ø£Ù†Ù…Ø§Ø· Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        .app-container{
            padding:20px;
            padding-bottom:110px;
            max-width:500px;
            margin:0 auto;
            min-height:100vh;
            display:flex;
            flex-direction:column;
        }
        
        .content-section{
            display:none;
            animation:fadeIn 0.4s ease;
            flex-direction:column;
            flex:1;
        }
        
        .content-section.active{
            display:flex;
        }
        
        @keyframes fadeIn{
            from{opacity:0;transform:translateY(10px);}
            to{opacity:1;transform:translateY(0);}
        }
        
        .page-header{
            text-align:center;
            margin-bottom:20px;
            padding-top:10px;
        }
        
        h1{
            font-size:26px;
            font-weight:800;
            color:#fff;
            margin-bottom:5px;
            text-transform:uppercase;
            letter-spacing:1px;
        }
        
        h2{
            font-size:18px;
            font-weight:700;
            margin:20px 0 10px;
            color:var(--gold);
            display:flex;
            align-items:center;
            gap:8px;
        }
        
        p{
            font-size:13px;
            color:var(--text-muted);
            line-height:1.4;
        }
        
        .card{
            background:var(--glass-bg);
            backdrop-filter:blur(15px);
            -webkit-backdrop-filter:blur(15px);
            border-radius:24px;
            padding:20px;
            margin-bottom:12px;
            border:1px solid var(--glass-border);
            box-shadow:0 4px 20px rgba(0,0,0,0.4);
        }
        
        /* âœ… Ø¥Ø­ØµØ§Ø¡Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© */
        .stats-grid{
            display:grid;
            grid-template-columns:repeat(2, 1fr);
            gap:15px;
            margin-bottom:20px;
        }
        
        .stat-card{
            background:rgba(168,85,247,0.1);
            padding:15px;
            border-radius:12px;
            text-align:center;
            border:1px solid rgba(168,85,247,0.3);
        }
        
        .stat-value{
            font-size:24px;
            font-weight:800;
            color:var(--primary-green);
            margin-top:5px;
        }
        
        .stat-label{
            font-size:12px;
            color:var(--text-muted);
        }
        
        /* âœ… Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù„Ø¹Ø¨Ø© */
        .btn{
            display:flex;
            align-items:center;
            justify-content:center;
            width:100%;
            padding:16px;
            border-radius:18px;
            font-size:16px;
            font-weight:800;
            cursor:pointer;
            border:none;
            outline:none;
            gap:8px;
            text-transform:uppercase;
            letter-spacing:0.5px;
            transition:transform 0.1s;
            margin-bottom:10px;
        }
        
        .btn:active{
            transform:scale(0.96);
        }
        
        .btn:disabled{
            opacity:0.5;
            cursor:not-allowed;
            filter:grayscale(1);
        }
        
        .btn-primary{
            background:linear-gradient(90deg,#a855f7,#7c3aed);
            color:#fff;
            box-shadow:0 0 15px rgba(168,85,247,0.4);
        }
        
        .btn-action{
            background:rgba(0,0,0,0.3)!important;
            backdrop-filter:blur(15px);
            -webkit-backdrop-filter:blur(15px);
            border:1px solid rgba(255,255,255,0.1)!important;
            color:#b0b0b0!important;
            flex-direction:column;
            padding:12px;
            font-size:12px;
            gap:5px;
            border-radius:12px;
            box-shadow:0 4px 15px rgba(0,0,0,0.2);
            transition:all 0.3s ease;
        }
        
        /* âœ… Ù…ØªØ¬Ø± Ø§Ù„Ø¯Ø¬Ø§Ø¬ */
        .shop-item{
            display:flex;
            align-items:center;
            background:rgba(0,0,0,0.3);
            border-radius:16px;
            padding:12px;
            margin-bottom:8px;
            border:1px solid rgba(255,255,255,0.05);
        }
        
        .shop-icon{
            width:42px;
            height:42px;
            border-radius:12px;
            background:rgba(255,255,255,0.05);
            display:flex;
            align-items:center;
            justify-content:center;
            margin-right:12px;
            flex-shrink:0;
            font-size:20px;
        }
        
        .shop-content{
            flex:1;
        }
        
        .shop-title{
            font-size:14px;
            font-weight:600;
            margin-bottom:2px;
        }
        
        .shop-description{
            font-size:11px;
            color:var(--text-muted);
        }
        
        .shop-price{
            text-align:right;
            font-weight:700;
            color:var(--primary-green);
            font-size:14px;
        }
        
        /* âœ… Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© */
        .hud-container{
            display:flex;
            justify-content:space-between;
            align-items:center;
            background:rgba(0,0,0,0.5);
            border-radius:50px;
            padding:10px 15px;
            margin-bottom:20px;
            border:1px solid rgba(255,255,255,0.05);
        }
        
        .user-name{
            font-weight:700;
            font-size:14px;
        }
        
        .hud-avatar{
            width:50px;
            height:50px;
            border-radius:50%;
            overflow:hidden;
            border:2px solid var(--primary-green);
        }
        
        .hud-avatar img{
            width:100%;
            height:100%;
            object-fit:cover;
        }
        
        /* âœ… Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø³ÙÙ„ÙŠ */
        .bottom-nav{
            position:fixed;
            bottom:20px;
            left:50%;
            transform:translateX(-50%);
            width:90%;
            max-width:400px;
            height:65px;
            background:var(--nav-bg);
            border-radius:32px;
            display:flex;
            justify-content:space-around;
            align-items:center;
            box-shadow:0 10px 30px rgba(0,0,0,0.5);
            z-index:100;
            border:1px solid rgba(255,255,255,0.1);
        }
        
        .nav-item{
            display:flex;
            flex-direction:column;
            align-items:center;
            color:#666;
            transition:0.3s;
            cursor:pointer;
            position:relative;
            width:50px;
        }
        
        .nav-item svg{
            width:22px;
            height:22px;
            margin-bottom:4px;
            stroke:currentColor;
            fill:none;
            stroke-width:2.5;
            transition:all 0.3s;
        }
        
        .nav-item.active{
            color:var(--primary-green);
            transform:translateY(-2px);
        }
        
        .nav-item.active svg{
            stroke:var(--primary-green);
            filter:drop-shadow(0 0 8px rgba(168,85,247,0.6));
        }
        
        .nav-text{
            font-size:9px;
            font-weight:700;
            text-transform:uppercase;
        }
        
        /* âœ… ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù‡ÙˆØ§ØªÙ */
        @media (max-width:480px){
            .app-container{
                padding:10px;
                padding-bottom:80px;
            }
            
            .stats-grid{
                grid-template-columns:repeat(2, 1fr);
                gap:10px;
            }
            
            .stat-card{
                padding:12px;
            }
            
            .stat-value{
                font-size:20px;
            }
            
            .bottom-nav{
                width:95%;
                height:60px;
            }
            
            .nav-text{
                font-size:8px;
            }
        }
        
        /* âœ… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */
        .notification-message{
            position:fixed;
            top:100px;
            left:50%;
            transform:translateX(-50%);
            z-index:1000;
            background:var(--glass-bg);
            backdrop-filter:blur(20px);
            border:1px solid var(--glass-border);
            border-radius:15px;
            padding:15px 20px;
            max-width:90%;
            width:400px;
            text-align:center;
            box-shadow:0 5px 20px rgba(0,0,0,0.3);
            animation:fadeIn 0.3s ease;
        }
        
        .notification-success{
            border-color:#27ae60;
            background:rgba(39,174,96,0.1);
        }
        
        .notification-error{
            border-color:#e74c3c;
            background:rgba(231,76,60,0.1);
        }
        
        .notification-warning{
            border-color:#FFC107;
            background:rgba(255,193,7,0.1);
        }
        
        .notification-info{
            border-color:#3498db;
            background:rgba(52,152,219,0.1);
        }
        
        @keyframes fadeOut{
            from{opacity:1;}
            to{opacity:0;}
        }
        
        /* âœ… ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¹Ø§Ù…Ø© */
        .hidden{
            display:none!important;
        }
    </style>
</head>
<body>
<!-- âœ… ØµÙØ­Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ© -->
<div id="global-loading-page">
    <img src="https://i.ibb.co/tTkJX1Qy/logo.png" alt="Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ø¯Ø¬Ø§Ø¬" class="loading-logo">
    <h1 class="loading-title">ğŸ” Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ø¯Ø¬Ø§Ø¬</h1>
    <p class="loading-subtitle">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ...</p>
    
    <div class="loading-progress-container">
        <div class="loading-progress-bar" id="loading-progress-bar"></div>
    </div>
    
    <div class="loading-timer" id="loading-timer">5 seconds</div>
    
    <div style="margin-top:30px;font-size:11px;color:var(--text-muted);max-width:300px;">
        <i class="fas fa-shield-alt" style="margin-right:5px;"></i>
        Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø²Ø±Ø¹Ø©
    </div>
</div>

<!-- âœ… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
<div class="app-container" style="display:none;" id="app-container">
    <!-- Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© -->
    <div class="hud-container">
        <div>
            <div class="user-name" id="home-username">Ù…Ø²Ø§Ø±Ø¹</div>
            <div style="display:flex;align-items:center;gap:15px;margin-top:5px;">
                <div class="stats-pill" style="margin:0;padding:6px 12px;">
                    <span style="color:var(--gold);">ğŸ’°:</span>
                    <span id="hud-glx-balance" style="color:#fff;font-weight:700;">0</span>
                </div>
            </div>
        </div>
        <div class="hud-avatar">
            <img src="https://i.ibb.co/tTkJX1Qy/logo.png" alt="User">
        </div>
    </div>
    
    <!-- Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© - Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ø¯Ø¬Ø§Ø¬ -->
    <main id="home" class="content-section active">
        <div class="page-header">
            <h1>ğŸ” Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ø¯Ø¬Ø§Ø¬</h1>
            <p>Ø¥Ø²Ø±Ø¹ØŒ Ø§Ø¬Ù…Ø¹ØŒ ÙˆØ§Ø±Ø¨Ø­!</p>
        </div>
        
        <!-- Ø¥Ø­ØµØ§Ø¡Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">ğŸ’° Ø§Ù„Ø±ØµÙŠØ¯</div>
                <div class="stat-value" id="balance">0</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-label">ğŸ” Ø§Ù„Ø¯Ø¬Ø§Ø¬</div>
                <div class="stat-value" id="chickens">0</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-label">ğŸ¥š Ø§Ù„Ø¨ÙŠØ¶</div>
                <div class="stat-value" id="eggs">0</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-label">âš¡ Ø§Ù„Ø¥Ù†ØªØ§Ø¬/Ø³Ø§Ø¹Ø©</div>
                <div class="stat-value" id="production">0</div>
            </div>
        </div>
        
        <!-- Ù…ØªØ¬Ø± Ø§Ù„Ø¯Ø¬Ø§Ø¬ -->
        <div class="card" style="margin-bottom:15px;">
            <h3 style="color:var(--gold);margin-bottom:15px;display:flex;align-items:center;gap:8px;">
                <i class="fa-solid fa-store"></i> Ù…ØªØ¬Ø± Ø§Ù„Ø¯Ø¬Ø§Ø¬
            </h3>
            
            <div class="shop-item" onclick="buyChicken('basic')">
                <div class="shop-icon">ğŸ”</div>
                <div class="shop-content">
                    <div class="shop-title">Ø¯Ø¬Ø§Ø¬Ø© Ø¹Ø§Ø¯ÙŠØ©</div>
                    <div class="shop-description">ØªÙ†ØªØ¬ 1 Ø¨ÙŠØ¶Ø©/Ø³Ø§Ø¹Ø©</div>
                </div>
                <div class="shop-price">100</div>
            </div>
            
            <div class="shop-item" onclick="buyChicken('golden')">
                <div class="shop-icon">ğŸ“</div>
                <div class="shop-content">
                    <div class="shop-title">Ø¯Ø¬Ø§Ø¬Ø© Ø°Ù‡Ø¨ÙŠØ©</div>
                    <div class="shop-description">ØªÙ†ØªØ¬ 3 Ø¨ÙŠØ¶Ø§Øª/Ø³Ø§Ø¹Ø©</div>
                </div>
                <div class="shop-price">300</div>
            </div>
            
            <div class="shop-item" onclick="buyChicken('diamond')">
                <div class="shop-icon">ğŸ’</div>
                <div class="shop-content">
                    <div class="shop-title">Ø¯Ø¬Ø§Ø¬Ø© Ù…Ø§Ø³ÙŠØ©</div>
                    <div class="shop-description">ØªÙ†ØªØ¬ 10 Ø¨ÙŠØ¶Ø§Øª/Ø³Ø§Ø¹Ø©</div>
                </div>
                <div class="shop-price">1000</div>
            </div>
        </div>
        
        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->
        <div class="card">
            <h3 style="color:var(--gold);margin-bottom:15px;display:flex;align-items:center;gap:8px;">
                <i class="fa-solid fa-play"></i> Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª
            </h3>
            
            <button class="btn btn-primary" onclick="collectEggs()">
                <i class="fa-solid fa-egg"></i> Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ¶
            </button>
            
            <button class="btn btn-action" onclick="sellEggs()">
                <i class="fa-solid fa-coins"></i> Ø¨ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ¶
            </button>
            
            <button class="btn btn-action" onclick="convertEggs()">
                <i class="fa-solid fa-exchange-alt"></i> ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ¶ Ù„Ø¯Ø¬Ø§Ø¬
            </button>
        </div>
        
        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© -->
        <div class="card" style="margin-top:10px;">
            <h3 style="color:var(--gold);margin-bottom:10px;display:flex;align-items:center;gap:8px;">
                <i class="fa-solid fa-circle-info"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
            </h3>
            <p style="font-size:11px;color:var(--text-muted);line-height:1.5;">
                â€¢ ÙƒÙ„ Ø¯Ø¬Ø§Ø¬Ø© ØªÙ†ØªØ¬ Ø¨ÙŠØ¶Ù‹Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ø¹ Ù…Ø±ÙˆØ± Ø§Ù„ÙˆÙ‚Øª<br>
                â€¢ ÙŠÙ…ÙƒÙ†Ùƒ Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ¶ ÙŠØ¯ÙˆÙŠÙ‹Ø§ ÙƒÙ„ 5 Ø¯Ù‚Ø§Ø¦Ù‚<br>
                â€¢ Ø¨ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ¶ Ù„ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…Ù„Ø©<br>
                â€¢ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ù…Ù„Ø© Ù„Ø´Ø±Ø§Ø¡ Ø¯Ø¬Ø§Ø¬ Ø£ÙƒØ«Ø±<br>
                â€¢ ÙƒÙ„Ù…Ø§ Ø²Ø§Ø¯ Ø¹Ø¯Ø¯ Ø§Ù„Ø¯Ø¬Ø§Ø¬ØŒ Ø²Ø§Ø¯ Ø¥Ù†ØªØ§Ø¬Ùƒ!
            </p>
        </div>
    </main>
    
    <!-- ØµÙØ­Ø© Ø§Ù„Ø³ÙˆÙ‚ -->
    <main id="market" class="content-section">
        <div class="page-header">
            <h1>ğŸª Ø§Ù„Ø³ÙˆÙ‚</h1>
            <p>Ø¨ÙŠØ¹ ÙˆØ´Ø±Ø§Ø¡ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</p>
        </div>
        
        <div class="card">
            <h3 style="color:var(--gold);margin-bottom:15px;display:flex;align-items:center;gap:8px;">
                <i class="fa-solid fa-chart-line"></i> Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø³ÙˆÙ‚
            </h3>
            
            <div class="shop-item">
                <div class="shop-icon">ğŸ¥š</div>
                <div class="shop-content">
                    <div class="shop-title">Ø¨ÙŠØ¶Ø© ÙˆØ§Ø­Ø¯Ø©</div>
                    <div class="shop-description">Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
                </div>
                <div class="shop-price" id="egg-price">5</div>
            </div>
            
            <div class="shop-item">
                <div class="shop-icon">ğŸ”</div>
                <div class="shop-content">
                    <div class="shop-title">Ø¯Ø¬Ø§Ø¬Ø© Ø¹Ø§Ø¯ÙŠØ©</div>
                    <div class="shop-description">Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡</div>
                </div>
                <div class="shop-price">100</div>
            </div>
            
            <button class="btn btn-primary" onclick="sellAllEggs()" style="margin-top:15px;">
                <i class="fa-solid fa-money-bill-wave"></i> Ø¨ÙŠØ¹ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ¶
            </button>
        </div>
        
        <div class="card" style="margin-top:15px;">
            <h3 style="color:var(--gold);margin-bottom:15px;display:flex;align-items:center;gap:8px;">
                <i class="fa-solid fa-history"></i> ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª
            </h3>
            <div id="transaction-history" style="max-height:200px;overflow-y:auto;">
                <p style="text-align:center;padding:20px;color:var(--text-muted);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¨Ø¹Ø¯</p>
            </div>
        </div>
    </main>
</div>

<!-- Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø³ÙÙ„ÙŠ -->
<nav class="bottom-nav">
    <div class="nav-item active" data-target="home">
        <svg viewBox="0 0 24 24">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
        </svg>
        <span class="nav-text">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
    </div>
    <div class="nav-item" data-target="market">
        <svg viewBox="0 0 24 24">
            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
        </svg>
        <span class="nav-text">Ø§Ù„Ø³ÙˆÙ‚</span>
    </div>
</nav>

<script>
// âœ… Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
const API_URL = "https://silent-block-bedf.ahmedrabieharoun.workers.dev";
let gameState = {
    balance: 1000,
    chickens: 0,
    eggs: 0,
    production: 0,
    lastCollectTime: Date.now(),
    transactions: []
};

// âœ… Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
function showNotification(message, type = 'info', duration = 3000) {
    const notification = document.createElement('div');
    notification.className = `notification-message notification-${type}`;
    notification.innerHTML = `<div style="font-size:14px;font-weight:600;">${message}</div>`;
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.animation = 'fadeOut 0.3s ease';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }, duration);
}

// âœ… Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª
function switchTab(tabId) {
    document.querySelectorAll('.content-section').forEach(section => {
        section.classList.remove('active');
    });
    
    document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
    });
    
    document.getElementById(tabId).classList.add('active');
    document.querySelector(`.nav-item[data-target="${tabId}"]`).classList.add('active');
    
    if (tabId === 'market') {
        updateMarketPage();
    }
}

// âœ… Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©
async function loadGame() {
    try {
        const result = await callAPI('getGameState');
        if (result.success) {
            gameState = result.data;
            updateGameUI();
        }
    } catch (error) {
        console.error("Error loading game:", error);
    }
}

// âœ… Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
function updateGameUI() {
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¡Ø§Øª
    document.getElementById('balance').textContent = gameState.balance;
    document.getElementById('chickens').textContent = gameState.chickens;
    document.getElementById('eggs').textContent = gameState.eggs;
    document.getElementById('production').textContent = gameState.production || 0;
    
    // ØªØ­Ø¯ÙŠØ« Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø©
    document.getElementById('hud-glx-balance').textContent = gameState.balance;
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨ÙŠØ¶ Ø§Ù„Ù…ØªØ§Ø­ Ù„Ù„Ø¬Ù…Ø¹
    const now = Date.now();
    const timeDiff = now - gameState.lastCollectTime;
    const hoursPassed = timeDiff / (1000 * 60 * 60);
    const eggsProduced = Math.floor(gameState.production * hoursPassed);
    
    if (eggsProduced > 0) {
        showNotification(`âš ï¸ Ù„Ø¯ÙŠÙƒ ${eggsProduced} Ø¨ÙŠØ¶Ø© Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø¬Ù…Ø¹!`, 'warning');
    }
}

// âœ… Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« ØµÙØ­Ø© Ø§Ù„Ø³ÙˆÙ‚
function updateMarketPage() {
    document.getElementById('egg-price').textContent = '5';
    const historyContainer = document.getElementById('transaction-history');
    
    if (gameState.transactions && gameState.transactions.length > 0) {
        historyContainer.innerHTML = '';
        gameState.transactions.slice(-10).reverse().forEach(transaction => {
            const transactionEl = document.createElement('div');
            transactionEl.className = 'shop-item';
            transactionEl.style.padding = '8px';
            transactionEl.style.marginBottom = '5px';
            transactionEl.style.fontSize = '11px';
            
            const typeIcon = transaction.type === 'sell' ? 'ğŸ’°' : 'ğŸ”';
            transactionEl.innerHTML = `
                <div style="display:flex;justify-content:space-between;align-items:center;width:100%;">
                    <div style="display:flex;align-items:center;gap:8px;">
                        <div>${typeIcon}</div>
                        <div>${transaction.description}</div>
                    </div>
                    <div style="color:var(--primary-green);font-weight:bold;">${transaction.amount}</div>
                </div>
            `;
            historyContainer.appendChild(transactionEl);
        });
    }
}

// âœ… Ø¯Ø§Ù„Ø© Ø´Ø±Ø§Ø¡ Ø¯Ø¬Ø§Ø¬
async function buyChicken(type) {
    const prices = {
        'basic': 100,
        'golden': 300,
        'diamond': 1000
    };
    
    const productions = {
        'basic': 1,
        'golden': 3,
        'diamond': 10
    };
    
    const price = prices[type];
    const production = productions[type];
    
    if (gameState.balance < price) {
        showNotification("âŒ Ø±ØµÙŠØ¯Ùƒ ØºÙŠØ± ÙƒØ§ÙÙŠ!", 'error');
        return;
    }
    
    const result = await callAPI('buyChicken', {
        type: type,
        price: price,
        production: production
    });
    
    if (result.success) {
        gameState = result.data;
        updateGameUI();
        
        const chickenNames = {
            'basic': 'Ø¹Ø§Ø¯ÙŠØ©',
            'golden': 'Ø°Ù‡Ø¨ÙŠØ©',
            'diamond': 'Ù…Ø§Ø³ÙŠØ©'
        };
        
        showNotification(`âœ… ØªÙ… Ø´Ø±Ø§Ø¡ Ø¯Ø¬Ø§Ø¬Ø© ${chickenNames[type]} Ø¨Ù†Ø¬Ø§Ø­!`, 'success');
    } else {
        showNotification("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: " + result.error, 'error');
    }
}

// âœ… Ø¯Ø§Ù„Ø© Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ¶
async function collectEggs() {
    const now = Date.now();
    const timeDiff = now - gameState.lastCollectTime;
    const hoursPassed = timeDiff / (1000 * 60 * 60);
    const eggsProduced = Math.floor(gameState.production * hoursPassed);
    
    if (eggsProduced <= 0) {
        showNotification("â³ Ù„Ù… ÙŠØªÙ… Ø¥Ù†ØªØ§Ø¬ Ø¨ÙŠØ¶ ÙƒØ§ÙÙŠ Ø¨Ø¹Ø¯!", 'warning');
        return;
    }
    
    const result = await callAPI('collectEggs', {
        eggsProduced: eggsProduced
    });
    
    if (result.success) {
        gameState = result.data;
        updateGameUI();
        showNotification(`âœ… ØªÙ… Ø¬Ù…Ø¹ ${eggsProduced} Ø¨ÙŠØ¶Ø©!`, 'success');
    } else {
        showNotification("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: " + result.error, 'error');
    }
}

// âœ… Ø¯Ø§Ù„Ø© Ø¨ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ¶
async function sellEggs() {
    if (gameState.eggs <= 0) {
        showNotification("âŒ Ù„Ø§ ØªÙ…ØªÙ„Ùƒ Ø¨ÙŠØ¶Ù‹Ø§ Ù„Ù„Ø¨ÙŠØ¹!", 'error');
        return;
    }
    
    const eggPrice = 5;
    const totalPrice = gameState.eggs * eggPrice;
    
    const result = await callAPI('sellEggs', {
        eggs: gameState.eggs,
        price: totalPrice
    });
    
    if (result.success) {
        gameState = result.data;
        updateGameUI();
        showNotification(`ğŸ’° ØªÙ… Ø¨ÙŠØ¹ ${gameState.lastSoldEggs || 0} Ø¨ÙŠØ¶Ø© Ø¨Ù€ ${totalPrice} Ø¹Ù…Ù„Ø©!`, 'success');
    } else {
        showNotification("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: " + result.error, 'error');
    }
}

// âœ… Ø¯Ø§Ù„Ø© Ø¨ÙŠØ¹ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ¶
async function sellAllEggs() {
    if (gameState.eggs <= 0) {
        showNotification("âŒ Ù„Ø§ ØªÙ…ØªÙ„Ùƒ Ø¨ÙŠØ¶Ù‹Ø§ Ù„Ù„Ø¨ÙŠØ¹!", 'error');
        return;
    }
    
    const eggPrice = 5;
    const totalPrice = gameState.eggs * eggPrice;
    
    if (!confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¨ÙŠØ¹ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ¶ (${gameState.eggs} Ø¨ÙŠØ¶Ø©) Ø¨Ù€ ${totalPrice} Ø¹Ù…Ù„Ø©ØŸ`)) {
        return;
    }
    
    const result = await callAPI('sellEggs', {
        eggs: gameState.eggs,
        price: totalPrice
    });
    
    if (result.success) {
        gameState = result.data;
        updateGameUI();
        showNotification(`ğŸ’° ØªÙ… Ø¨ÙŠØ¹ ${gameState.lastSoldEggs || 0} Ø¨ÙŠØ¶Ø© Ø¨Ù€ ${totalPrice} Ø¹Ù…Ù„Ø©!`, 'success');
        updateMarketPage();
    } else {
        showNotification("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: " + result.error, 'error');
    }
}

// âœ… Ø¯Ø§Ù„Ø© ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ¶ Ù„Ø¯Ø¬Ø§Ø¬
async function convertEggs() {
    if (gameState.eggs < 100) {
        showNotification("âŒ ØªØ­ØªØ§Ø¬ 100 Ø¨ÙŠØ¶Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„ØªØ­ÙˆÙŠÙ„Ù‡Ø§ Ù„Ø¯Ø¬Ø§Ø¬Ø©!", 'error');
        return;
    }
    
    const eggsNeeded = 100;
    const chickensToAdd = Math.floor(gameState.eggs / eggsNeeded);
    
    if (!confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ­ÙˆÙŠÙ„ ${chickensToAdd * eggsNeeded} Ø¨ÙŠØ¶Ø© Ù„Ù€ ${chickensToAdd} Ø¯Ø¬Ø§Ø¬Ø©ØŸ`)) {
        return;
    }
    
    const result = await callAPI('convertEggs', {
        eggs: chickensToAdd * eggsNeeded,
        chickens: chickensToAdd
    });
    
    if (result.success) {
        gameState = result.data;
        updateGameUI();
        showNotification(`âœ… ØªÙ… ØªØ­ÙˆÙŠÙ„ ${chickensToAdd * eggsNeeded} Ø¨ÙŠØ¶Ø© Ù„Ù€ ${chickensToAdd} Ø¯Ø¬Ø§Ø¬Ø©!`, 'success');
    } else {
        showNotification("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: " + result.error, 'error');
    }
}

// âœ… Ø¯Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±
async function callAPI(action, data = {}) {
    try {
        const userId = window.Telegram?.WebApp?.initDataUnsafe?.user?.id || 'guest';
        const response = await fetch(`${API_URL}/api`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-User-ID': userId,
                'X-Action': action
            },
            body: JSON.stringify({
                action: action,
                data: data,
                userId: userId,
                timestamp: Date.now()
            })
        });
        
        if (!response.ok) {
            throw new Error(`API Error: ${response.status}`);
        }
        
        return await response.json();
    } catch (error) {
        console.error('API call failed:', error);
        showNotification("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.", "error");
        return { success: false, error: error.message };
    }
}

// âœ… Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
function startGlobalLoading() {
    const loadingPage = document.getElementById('global-loading-page');
    const progressBar = document.getElementById('loading-progress-bar');
    const timerElement = document.getElementById('loading-timer');
    
    if (!loadingPage || !progressBar || !timerElement) return;
    
    // Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰
    document.getElementById('app-container').style.display = 'none';
    
    // Ø¥Ø¸Ù‡Ø§Ø± ØµÙØ­Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
    loadingPage.style.display = 'flex';
    
    let loadingSeconds = 5;
    let loadingProgress = 0;
    
    const loadingTimerInterval = setInterval(() => {
        loadingSeconds--;
        
        if (loadingSeconds <= 0) {
            loadingSeconds = 0;
            timerElement.textContent = "Ø¬Ø§Ù‡Ø²!";
        } else {
            timerElement.textContent = loadingSeconds + " Ø«Ø§Ù†ÙŠØ©";
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
        loadingProgress = ((5 - loadingSeconds) / 5) * 100;
        progressBar.style.width = loadingProgress + '%';
        
        // Ø¹Ù†Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª
        if (loadingSeconds <= 0) {
            clearInterval(loadingTimerInterval);
            finishLoading();
        }
    }, 1000);
}

// âœ… Ø¯Ø§Ù„Ø© Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„
async function finishLoading() {
    const loadingPage = document.getElementById('global-loading-page');
    
    try {
        // âœ… Ø¹Ø±Ø¶ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
        document.getElementById('app-container').style.display = 'block';
        
        // âœ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
        await loadGame();
        
        // âœ… Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        setInterval(loadGame, 30000); // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
        
        showNotification("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²Ø±Ø¹Ø© Ø¨Ù†Ø¬Ø§Ø­! Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ!", "success");
        
    } catch (error) {
        console.error("Loading error:", error);
        showNotification("âš ï¸ ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ø¹ Ø¨Ø¹Ø¶ Ø§Ù„Ù‚ÙŠÙˆØ¯.", "warning");
    } finally {
        if (loadingPage) {
            loadingPage.style.display = 'none';
        }
    }
}

// âœ… ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
document.addEventListener('DOMContentLoaded', function() {
    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    if (window.Telegram?.WebApp?.initDataUnsafe?.user) {
        const tgUser = window.Telegram.WebApp.initDataUnsafe.user;
        const fullName = `${tgUser.first_name} ${tgUser.last_name || ''}`.trim();
        document.getElementById('home-username').textContent = fullName || 'Ù…Ø²Ø§Ø±Ø¹';
    }
    
    // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
    document.querySelectorAll('.nav-item').forEach(btn => {
        btn.addEventListener('click', () => switchTab(btn.dataset.target));
    });
    
    // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    startGlobalLoading();
});

// âœ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ù†ØªØ§Ø¬ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
setInterval(() => {
    if (gameState.production > 0) {
        const now = Date.now();
        const timeDiff = now - gameState.lastCollectTime;
        const hoursPassed = timeDiff / (1000 * 60 * 60);
        const eggsProduced = Math.floor(gameState.production * hoursPassed);
        
        if (eggsProduced > 0) {
            // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ø¨ÙŠØ¶ ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙÙ‚Ø· (Ù„ÙŠØ³ ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø­ØªÙ‰ ÙŠØªÙ… Ø§Ù„Ø¬Ù…Ø¹)
            const tempEggs = gameState.eggs + eggsProduced;
            document.getElementById('eggs').textContent = tempEggs;
        }
    }
}, 60000); // ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
</script>
</body>
</html>
